!function(view){if(window.MSInputMethodContext&&document.documentMode||-1!==navigator.appVersion.indexOf("MSIE 10")){var constructors=["SVGSVGElement","SVGGElement"],dummy=document.createElement("dummy");if(!constructors[0]in view)return!1;if(Object.defineProperty){var innerHTMLPropDesc={get:function(){return dummy.innerHTML="",Array.prototype.slice.call(this.childNodes).forEach(function(node,index){dummy.appendChild(node.cloneNode(!0))}),dummy.innerHTML},set:function(content){var self=this,allNodes=Array.prototype.slice.call(self.childNodes),fn=function(to,node){if(1!==node.nodeType)return!1;var newNode=document.createElementNS("http://www.w3.org/2000/svg",node.nodeName);Array.prototype.slice.call(node.attributes).forEach(function(attribute){newNode.setAttribute(attribute.name,attribute.value)}),"TEXT"===node.nodeName&&(newNode.textContent=node.innerHTML),to.appendChild(newNode),node.childNodes.length&&Array.prototype.slice.call(node.childNodes).forEach(function(node,index){fn(newNode,node)})};content=content.replace(/<(\w+)([^<]+?)\/>/,"<$1$2></$1>"),allNodes.forEach(function(node,index){node.parentNode.removeChild(node)}),dummy.innerHTML=content,Array.prototype.slice.call(dummy.childNodes).forEach(function(node){fn(self,node)})},enumerable:!0,configurable:!0};try{constructors.forEach(function(constructor,index){Object.defineProperty(window[constructor].prototype,"innerHTML",innerHTMLPropDesc)})}catch(ex){}}else Object.prototype.__defineGetter__&&constructors.forEach(function(constructor,index){window[constructor].prototype.__defineSetter__("innerHTML",innerHTMLPropDesc.set),window[constructor].prototype.__defineGetter__("innerHTML",innerHTMLPropDesc.get)})}}(window),void 0===Function.prototype.name&&void 0!==Object.defineProperty&&Object.defineProperty(Function.prototype,"name",{get:function(){var funcNameRegex=/function\s([^(]{1,})\(/,results=funcNameRegex.exec(this.toString());return results&&results.length>1?results[1].trim():""},set:function(){}}),function(){function CustomEvent(event,params){params=params||{bubbles:!1,cancelable:!1,detail:void 0};var evt=document.createEvent("CustomEvent");return evt.initCustomEvent(event,params.bubbles,params.cancelable,params.detail),evt}(window.MSInputMethodContext&&document.documentMode||-1!==navigator.appVersion.indexOf("MSIE 10"))&&(CustomEvent.prototype=window.Event.prototype,window.CustomEvent=CustomEvent)}(),ContentEdit.INDENT="",ContentEdit.DEFAULT_MAX_ELEMENT_WIDTH=2e3,ContentTools.HIGHLIGHT_HOLD_DURATION=999999;var nhb={};window.addEventListener("DOMContentLoaded",function(){var editor;if(document.querySelector('[data-name="main-content"]')){var starterInterval;localStorage&&localStorage.getItem("nhb-open-"+nhbParams.post_id)&&(localStorage.removeItem("nhb-open-"+nhbParams.post_id),starterInterval=setInterval(function(){document.querySelector(".ct-widget--active")&&(document.querySelector(".ct-ignition__button--edit").dispatchEvent(new CustomEvent("click")),clearInterval(starterInterval))},200)),window.location.hash&&0===window.location.hash.indexOf("#nhb-edit")&&(starterInterval=setInterval(function(){document.querySelector(".ct-widget--active")&&(document.querySelector(".ct-ignition__button--edit").dispatchEvent(new CustomEvent("click")),clearInterval(starterInterval))},200)),editor=ContentTools.EditorApp.get(),window._contentToolsShim(editor),editor.init("*[data-editable]","data-name"),editor.bind("start",function(){clearInterval(editor._toolbox._updateToolsTimeout),editor._toolbox._updateToolsTimeout=setInterval(editor._toolbox._updateTools,300)}),document.addEventListener("click",function(ev){"nhb-help-docs"===ev.target.getAttribute("id")&&"undefined"!=typeof HS&&"undefined"!=typeof HS.beacon&&"undefined"!==HS.beacon.open?HS.beacon.open?HS.beacon.open():window.open("http://docs.pagebuildersandwich.com/","_blank"):"nhb-help-docs"===ev.target.getAttribute("id")&&window.open("http://docs.pagebuildersandwich.com/","_blank")}),document.querySelector("#wp-admin-bar-nhb_help_docs").addEventListener("click",function(ev){return"undefined"!=typeof HS&&"undefined"!=typeof HS.beacon&&"undefined"!==HS.beacon.open&&HS.beacon.open?HS.beacon.open():window.open("http://docs.pagebuildersandwich.com/","_blank"),ev.preventDefault(),!1}),editor.bind("start",function(){editor._toolboxScrollCheckInterval=setInterval(function(){var elements=document.querySelectorAll(".media-modal-backdrop"),hasModal=!1;elements&&Array.prototype.forEach.call(elements,function(el){(0!==el.offsetWidth||0!==el.offsetHeight)&&(hasModal=!0)});var toolbox=document.querySelector(".ct-toolbox");toolbox&&toolbox.style["overflow-y"]!==(hasModal?"hidden":"")&&(toolbox.style["overflow-y"]=hasModal?"hidden":"")},300)}),editor.bind("stop",function(){clearInterval(editor._toolboxScrollCheckInterval)}),editor.bind("start",function(){var adminBar=document.querySelector("#wpadminbar");adminBar&&(adminBar.style["pointer-events"]="none",setTimeout(function(){adminBar.style["pointer-events"]=""},100))}),editor.bind("stop",function(){var adminBar=document.querySelector("#wpadminbar");adminBar&&(adminBar.style["pointer-events"]="")}),editor.bind("save",function(regions){var name,payload,xhr;this.busy(!0),payload=new FormData;for(name in regions)if(regions.hasOwnProperty(name)){var html=regions[name];html=wp.hooks.applyFilters("nhb.save",html),payload.append(name,html)}payload.append("action","gambit_builder_save_content"),payload.append("save_nonce",nhbParams.nonce),payload.append("post_id",nhbParams.post_id),nhbParams.new_post_status&&(payload.append("post_status",nhbParams.new_post_status),nhbParams.new_post_status=void 0);var styles="";document.querySelector("style#nhb-style")&&(styles=document.querySelector("style#nhb-style").innerHTML),payload.append("style",styles),wp.hooks.doAction("nhb.save.payload",payload),xhr=new XMLHttpRequest,xhr.onload=function(){if(editor.busy(!1),xhr.status>=200&&xhr.status<400){if(xhr.responseText.match(/(http|https):\/\//)){var currentHref=window.location.href.replace(/#\.*$/,"");xhr.responseText!==currentHref&&(window.location.href=xhr.responseText)}new ContentTools.FlashUI("ok")}else new ContentTools.FlashUI("no")},xhr.open("POST",nhbParams.ajax_url),xhr.send(payload),wp.hooks.doAction("nhb.save.payload.post",payload)});var _isShiftDown=!1,_showColumnOutlines=_.debounce(function(){_isShiftDown&&document.querySelector("html").classList.add("nhb-show-outlines")},800),showColumnOutlines=function(e){e.shiftKey&&(_isShiftDown=!0,_showColumnOutlines())},hideColumnOutlines=function(e){16===e.which&&(_isShiftDown=!1,document.querySelector("html").classList.remove("nhb-show-outlines"))};editor.bind("start",function(){document.querySelector("html").classList.add("nhb-editing"),document.querySelector("html").classList.add("theme-"+nhbParams.theme_name);try{this.regions()["main-content"].children[0].focus()}catch(e){}this.domRegions()[0].classList.add("nhb-editing"),this._handleHighlightOn=function(){},this._handleHighlightOff=function(){},document.addEventListener("keydown",showColumnOutlines),document.addEventListener("keyup",hideColumnOutlines)}),editor.bind("stop",function(){this.domRegions()[0].classList.remove("nhb-editing"),document.querySelector("html").classList.remove("nhb-editing"),document.querySelector("html").classList.remove("theme-"+nhbParams.theme_name),window._nhbBodyTransitionIntervalNum=0,clearInterval(window._nhbBodyTransitionInterval),window._nhbBodyTransitionInterval=setInterval(function(){window._nhbBodyTransitionIntervalNum++,window.dispatchEvent(new CustomEvent("resize")),window._nhbBodyTransitionIntervalNum>=30&&clearInterval(window._nhbBodyTransitionInterval)},16),document.removeEventListener("keydown",showColumnOutlines),document.removeEventListener("keyup",hideColumnOutlines)}),ContentEdit.Root.get().bind("focus",function(element){document.body.setAttribute("data-nhb-focused",element.constructor.name)}),ContentEdit.Root.get().bind("blur",function(){document.body.removeAttribute("data-nhb-focused")}),editor.bind("start",function(){for(var element=document.querySelector(".nhb-main-wrapper");element&&"body"!==element.tagName;){for(var curElement=element;curElement.previousSibling;)1===curElement.previousSibling.nodeType?curElement.previousSibling.querySelector(".nhb-title-editor")?curElement=curElement.previousSibling:(curElement.previousSibling.classList&&curElement.previousSibling.classList.add("nhb-ignore-while-editing"),curElement=curElement.previousSibling):curElement=curElement.previousSibling;element=element.parentNode}}),editor.bind("stop",function(){var elements=document.querySelectorAll(".nhb-ignore-while-editing");elements&&Array.prototype.forEach.call(elements,function(el){el.classList.remove("nhb-ignore-while-editing")})}),document.body.addEventListener("mousedown",function(e){(e.target.classList.contains("ct-ignition__button--confirm")||e.target.parentNode&&e.target.parentNode.classList.contains("ct-ignition__button--confirm"))&&window.nhbEditor.updateModifiedContent()}),document.body.addEventListener("mousedown",function(e){for(var editorArea=document.querySelector('[data-name="main-content"]'),isInEditorArea=editorArea.contains(e.target),isEditorArea=editorArea===e.target,editorSemiRoot=editorArea;"body"!==editorSemiRoot.parentNode.tagName.toLowerCase();)editorSemiRoot=editorSemiRoot.parentNode;var isInEditorSemiRoot=editorSemiRoot.contains(e.target);if(!window.nhbSelectorMatches(e.target,".wp-core-ui *")){var isInTitle=window.nhbSelectorMatches(e.target,".nhb-title-editor, .nhb-title-editor *");if(editorArea.classList.contains("nhb-editing")&&isInEditorSemiRoot&&!isEditorArea&&!isInEditorArea&&!isInTitle){var elem,rect=editorArea.getBoundingClientRect(),mainRegion=ContentTools.EditorApp.get().regions()["main-content"],isTop=!0,scrollY=window.scrollY||window.pageYOffset;if(e.pageY>scrollY+rect.top+rect.height/2?(isTop=!1,elem=mainRegion.children[mainRegion.children.length-1]):elem=mainRegion.children[0],"Text"!==elem.constructor.name){var p=new ContentEdit.Text("p",{},"");isTop?elem.parent().attach(p,0):elem.parent().attach(p,elem.parent().children.indexOf(elem)+1),elem=p}var index=0;isTop||elem.content&&(index=elem.content.length()),e.preventDefault(),elem.focus();var selection=new ContentSelect.Range(index,index);return void selection.select(elem._domElement)}}}),wp.hooks.doAction("nhb.init")}}),ContentEdit.DRAG_HOLD_DURATION=400,ContentEdit.Root.get().bind("drag",function(){document.querySelector('[data-name="main-content"]').classList.add("dragging")}),ContentEdit.Root.get().bind("drop",function(){document.querySelector('[data-name="main-content"]').classList.remove("dragging"),window.nhbFixRowWidths&&window.nhbFixRowWidths()}),window.nhbSelectorMatches=function(el,selector){var p=Element.prototype,f=p.matches||p.webkitMatchesSelector||p.mozMatchesSelector||p.msMatchesSelector||function(s){return-1!==[].indexOf.call(document.querySelectorAll(s),this)};return 1!==el.nodeType&&el.parentNode&&(el=el.parentNode),1!==el.nodeType?!1:f.call(el,selector)},window.cssToStyleObject=function(cssString){for(var match,regex=/([\w-]*)\s*:\s*([^;]*)/g,properties={};match=regex.exec(cssString);)properties[match[1]]=match[2];return properties},window.cssToStyleString=function(cssObject){var s="";for(var i in cssObject)cssObject.hasOwnProperty(i)&&(s+=i+":"+cssObject[i]+";");return s},ContentEdit.Element.prototype._onMouseMove=function(){};var __slice=[].slice,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};window.nhbEditor={},window.nhbEditor.getToolUI=function(name){return ContentTools.EditorApp.get()._toolboxBar._toolUIs[name]?ContentTools.EditorApp.get()._toolboxBar._toolUIs[name]:ContentTools.EditorApp.get()._toolboxElements._toolUIs[name]?ContentTools.EditorApp.get()._toolboxElements._toolUIs[name]:ContentTools.EditorApp.get()._toolbox._toolUIs[name]},ContentEdit.Root.get().bind("mount",function(element){element.domElement()._ceElement=element}),ContentTools.EditorApp.get().highlightRegions=function(){},window.nhbEditor.updateModifiedContent=function(){var regions=ContentTools.EditorApp.get().regions();for(var i in regions)regions.hasOwnProperty(i)&&window.nhbEditor.updateModifiedContentRecursive(regions[i])},window.nhbEditor.updateModifiedContentRecursive=function(element){var children=element.children;if(children)for(var k=0;k<children.length;k++){var ctElement=children[k];"undefined"!=typeof ctElement.content&&ctElement.content.html()!==ctElement._domElement.innerHTML&&window.nhbEditor.updateElementContent(ctElement,ctElement._domElement.innerHTML),window.nhbEditor.updateModifiedContentRecursive(ctElement)}},window.nhbEditor.updateElementContent=function(element,newContent){"Shortcode"!==element.constructor.name&&(element.content=new HTMLString.String(newContent,element.content.preserveWhitespace()).trim(),element.updateInnerHTML(),element.taint())},window.nhbEditor.isEditing=function(){var editorArea=document.querySelector('[data-name="main-content"]');return editorArea?editorArea.classList.contains("nhb-editing"):!1},window.nhbEditor.getUniqueClassName=function(domElement){if(domElement.getAttribute("class")){var classes=domElement.getAttribute("class"),matches=classes.match(/nhbguid-\w+/);if(matches)return matches[0]}return null},window.nhbEditor.removeUniqueClassName=function(domElement){if(domElement.getAttribute("class")){var classes=domElement.getAttribute("class"),matches=classes.match(/nhbguid-\w+/);if(matches)return domElement.classList.remove(matches[0]),!0}return!1},window.nhbEditor.generateUniqueClassName=function(){var name;do name="nhbguid-"+window.nhbEditor.generateHash();while(document.querySelector("."+name));return name},window.nhbEditor.generateHash=function(){return Math.floor(4294967296*(1+Math.random())).toString(36).substring(1)},window.nhbEditor.addPseudoElementStylesRaw=function(styles){var styleTag=document.querySelector("style#nhb-style");styleTag||(styleTag=document.createElement("style"),styleTag.setAttribute("id","nhb-style"),document.body.appendChild(styleTag));var currentStyles=styleTag.innerHTML+styles,mainRegion=ContentTools.EditorApp.get().regions()["main-content"];return"undefined"==typeof mainRegion._debouncedTaint&&(mainRegion._debouncedTaint=_.debounce(function(){this.taint()}.bind(mainRegion),400)),mainRegion._debouncedTaint(),styleTag.innerHTML=currentStyles,styles},window.nhbEditor.addPseudoElementStyles=function(selector,styles){var selectorStillExists=window.nhbEditor.removePseudoElementStyles(selector,Object.keys(styles)),styleTag=document.querySelector("style#nhb-style");styleTag||(styleTag=document.createElement("style"),styleTag.setAttribute("id","nhb-style"),document.body.appendChild(styleTag));var currentStyles=styleTag.innerHTML,styleString="";for(var styleName in styles)if(styles.hasOwnProperty(styleName)){var value=styles[styleName];value.trim&&(value=value.trim()),value&&(styleString+=styleName+": "+value+";")}var escapedSelector=selector.replace(/\./g,"\\.");if(selectorStillExists){var re=new RegExp("("+escapedSelector+"\\s*\\{)","gm");currentStyles=currentStyles.replace(re,"$1"+styleString)}else currentStyles+=selector+" {"+styleString+"}";var mainRegion=ContentTools.EditorApp.get().regions()["main-content"];return"undefined"==typeof mainRegion._debouncedTaint&&(mainRegion._debouncedTaint=_.debounce(function(){this.taint()}.bind(mainRegion),400)),mainRegion._debouncedTaint(),styleTag.innerHTML=currentStyles,styleString},window.nhbEditor.getPseudoElementStyles=function(selector,style){var styleTag=document.querySelector("style#nhb-style");if(!styleTag)return null;var currentStyles=styleTag.innerHTML,selectorPattern=selector.replace(/\./g,"\\."),re=new RegExp(selectorPattern+"\\s*\\{([\\s\\S]*?)\\}","m"),matches=currentStyles.match(re);if(!matches)return null;for(var stylesMatch=matches[1].replace(/;$/,"").split(";"),k=0;k<stylesMatch.length;k++){var styleMatch=stylesMatch[k].match(new RegExp("^"+style+"\\s*:([\\s\\S]*$)"));if(styleMatch){var value=styleMatch[1].trim();return value&&(value=value.replace(/\s*!important/,"")),value}}return null},window.nhbEditor.removePseudoElementStyles=function(selector,styles){"string"==typeof styles&&(styles=[styles]);var styleTag=document.querySelector("style#nhb-style");if(!styleTag)return!1;for(var re,stylesMatch,selectorPattern=selector.replace(/\./g,"\\."),currentStyles=styleTag.innerHTML,i=0;i<styles.length;i++){var styleName=styles[i];re=new RegExp(selectorPattern+"\\s*\\{([\\s\\S]*?)\\}","m");var matches=currentStyles.match(re);if(matches){stylesMatch=matches[1].replace(/;$/,"").split(";");for(var k=0;k<stylesMatch.length;k++)if(stylesMatch[k].match(new RegExp("^"+styleName+"\\s*:"))){stylesMatch.splice(k,1);break}stylesMatch=stylesMatch.join(";"),currentStyles=currentStyles.replace(matches[0],""),currentStyles+=selector+" {"+stylesMatch+"}"}}return(currentStyles=currentStyles.replace(/(^|[^\}])+\{[\s]*\}/gm,"").trim())?(styleTag.innerHTML=currentStyles,re=new RegExp(selectorPattern+"\\s*\\{","gm"),!!styleTag.innerHTML.match(re)):(styleTag.parentNode.removeChild(styleTag),!1)},window.nhbEditor.convertSVGToBackgroundImage=function(svgElement){svgElement.setAttribute("xmlns","http://www.w3.org/2000/svg");var svgString=svgElement.outerHTML;return svgString=svgString.replace(/"/g,"'"),svgString=svgString.replace(/</g,"%3C"),svgString=svgString.replace(/>/g,"%3E"),svgString=svgString.replace(/&/g,"%26"),svgString=svgString.replace(/#/g,"%23"),svgString=svgString.replace(/\n/g,""),svgString='url("data:image/svg+xml,'+svgString+'")'},window.nhbEditor.isCtrlDown=!1,window.nhbEditor.isShiftDown=!1,window.addEventListener("DOMContentLoaded",function(){document.addEventListener("keydown",function(ev){(ev.ctrlKey||ev.metaKey)&&(window.nhbEditor.isCtrlDown=!0),ev.shiftKey&&(window.nhbEditor.isShiftDown=!0)}),document.addEventListener("keyup",function(ev){ev.ctrlKey||ev.metaKey||(window.nhbEditor.isCtrlDown=!1),ev.shiftKey||(window.nhbEditor.isShiftDown=!1)})}),function(){var _Root=ContentEdit.Root.get(),proxied=_Root._getDropPlacement;_Root._getDropPlacement=function(x,y){if(!this._dropTarget)return null;var placements=this._dropTarget.constructor.placements;if(-1===placements.indexOf("center")&&-1!==placements.indexOf("left")&&-1!==placements.indexOf("right")){var _ref,vert,horz,rect=this._dropTarget.domElement().getBoundingClientRect();return _ref=[x-rect.left,y-rect.top],x=_ref[0],y=_ref[1],horz="center",horz=x<rect.width/2?"left":"right",vert="above",y>rect.height/2&&(vert="below"),[vert,horz]}return proxied.call(this,x,y)}}(),function(){var proxied=ContentEdit.Text.prototype._keyReturn;ContentEdit.Text.prototype._keyReturn=function(ev){var element,selection,tail,tip;return ev.preventDefault(),this.content.isWhitespace()?proxied.call(this,ev):(ContentSelect.Range.query(this._domElement),selection=ContentSelect.Range.query(this._domElement),tip=this.content.substring(0,selection.get()[0]),tail=this.content.substring(selection.get()[1]),ev.shiftKey||tip.length()?proxied.call(this,ev):(element=new ContentEdit.Text("p",{},""),this.parent().attach(element,this.parent().children.indexOf(this)),void element.focus()))}}(),window.addEventListener("DOMContentLoaded",function(){document.body.addEventListener("click",function(ev){window.nhbEditor.isEditing()&&"A"===ev.target.tagName&&window.nhbSelectorMatches(ev.target,".nhb-main-wrapper *")&&ev.preventDefault()})}),ContentEdit.Element.prototype.style=function(name,value){var style;return"undefined"==typeof value?this._domElement?(style=this._domElement.style[name],style?style:(style=window.getComputedStyle(this._domElement),style[name])):null:this._domElement?this._domElement.style[name]===value?value:(this._domElement.style[name]=value,style=this._domElement.getAttribute("style"),null===style?(this._attributes.style="",this.isMounted()&&this._domElement.removeAttribute("style"),"undefined"==typeof this.debouncedTaint&&(this.debouncedTaint=_.debounce(function(){this.taint()}.bind(this),400)),this.debouncedTaint()):this.attr("style",style)):value},ContentEdit.Element.prototype.defaultStyle=function(name){var origStyleAttribute=this._domElement.getAttribute("style");this._domElement.style[name]="";var defaultStyle=window.getComputedStyle(this._domElement);return defaultStyle="undefined"!=typeof defaultStyle[name]?defaultStyle[name]:0,origStyleAttribute?this._domElement.setAttribute("style",origStyleAttribute):this._domElement.removeAttribute("style"),defaultStyle},ContentEdit.Element.prototype.attr=function(name,value){return name=name.toLowerCase(),void 0===value?this._attributes[name]:this._attributes[name]!==value?(this._attributes[name]=value,this.isMounted()&&"class"!==name.toLowerCase()&&(""!==value?this._domElement.setAttribute(name,value):this._domElement.removeAttribute(name)),"undefined"==typeof this.debouncedTaint&&(this.debouncedTaint=_.debounce(function(){this.taint()}.bind(this),400)),ContentEdit.Root.get().trigger("debounced_taint",this),this.debouncedTaint()):void 0},ContentEdit.Element.prototype.removeAllCSSClasses=function(){if(this._domElement&&this._domElement.classList)for(var i=this._domElement.classList.length-1;i>=0;i--)this.removeCSSClass(this._domElement.classList.item(i))},window._contentToolsShim=function(editor){editor.start=function(){ContentTools.EditorApp.getCls().prototype.start.call(this),editor.trigger("start")},editor.stop=function(){ContentTools.EditorApp.getCls().prototype.stop.call(this),editor.trigger("stop")}},function(){var proxied=ContentEdit.Element.prototype._addCSSClass;ContentEdit.Element.prototype._addCSSClass=function(className){return"ce-element--over"===className&&ContentEdit.Root.get().trigger("over",this),proxied.call(this,className)}}(),function(){var proxied=ContentEdit.Element.prototype._removeCSSClass;ContentEdit.Element.prototype._removeCSSClass=function(className){return"ce-element--over"===className&&ContentEdit.Root.get().trigger("out",this),proxied.call(this,className)}}(),window.addEventListener("DOMContentLoaded",function(){if(document.querySelector('[data-name="main-content"]'))var starterInterval=setInterval(function(){document.querySelector(".ct-widget--active")&&(wp.hooks.doAction("nhb.ct.ready"),clearInterval(starterInterval))},200)}),ContentTools.IgnitionUI.prototype.mount=function(){this._domElement=document.querySelector("#wpadminbar"),this._domEdit=document.querySelector("#wp-admin-bar-gambit_builder_edit"),this._domEdit.classList.add("ct-ignition__button--edit"),this._domConfirm=document.querySelector("#wp-admin-bar-gambit_builder_save"),this._domConfirm.classList.add("ct-ignition__button--confirm"),this._domCancel=document.querySelector("#wp-admin-bar-gambit_builder_cancel"),this._domCancel.classList.add("ct-ignition__button--cancel"),this._domBusy=document.querySelector("#wp-admin-bar-gambit_builder_busy"),this._domBusy.classList.add("ct-ignition__button--busy");var ret=this._addDOMEventListeners();return this._domEdit.addEventListener("mousedown",function(){this.prevScrollY=window.scrollY||window.pageYOffset}),this._domEdit.addEventListener("click",function(){window.scrollTo(0,this.prevScrollY)}),document.querySelector("#wp-admin-bar-gambit_builder_save_options #nhb-save-publish").addEventListener("click",function(ev){ev.preventDefault(),nhbParams.new_post_status="publish",this._domConfirm.click(),document.querySelector("#nhb-save-button").setAttribute("data-current-post-type","publish"),this._domConfirm.querySelector(".ab-item").childNodes[1].nodeValue=nhbParams.labels.save_and_update}.bind(this)),document.querySelector("#wp-admin-bar-gambit_builder_save_options #nhb-save-draft").addEventListener("click",function(ev){ev.preventDefault(),nhbParams.new_post_status="draft",this._domConfirm.click(),document.querySelector("#nhb-save-button").setAttribute("data-current-post-type","draft"),this._domConfirm.querySelector(".ab-item").childNodes[1].nodeValue=nhbParams.labels.save_as_draft}.bind(this)),document.querySelector("#wp-admin-bar-gambit_builder_save_options #nhb-save-pending").addEventListener("click",function(ev){ev.preventDefault(),nhbParams.new_post_status="pending",this._domConfirm.click(),document.querySelector("#nhb-save-button").setAttribute("data-current-post-type","pending"),this._domConfirm.querySelector(".ab-item").childNodes[1].nodeValue=nhbParams.labels.save_as_pending}.bind(this)),wp.hooks.doAction("nhb.ct.mounted"),ret},function(){var proxied=ContentTools.History.prototype.undo;ContentTools.History.prototype.undo=function(){var ret=proxied.call(this);return wp.hooks.doAction("nhb.undo"),ret}}(),function(){var proxied=ContentTools.History.prototype.redo;ContentTools.History.prototype.redo=function(){var ret=proxied.call(this);return wp.hooks.doAction("nhb.redo"),ret}}(),function(){var proxied=ContentEdit.ResizableElement.prototype.size;ContentEdit.ResizableElement.prototype.size=function(newSize){var height,width,rect;return!newSize&&this._domElement?(rect=this._domElement.getBoundingClientRect(),width=parseInt(rect.width||1,10),height=parseInt(rect.height||1,10),[width,height]):proxied.call(this,newSize)}}(),function(){var proxied=ContentEdit.ResizableElement.prototype._onMouseDown;ContentEdit.ResizableElement.prototype._onMouseDown=function(ev){var corner=this._getResizeCorner(ev.clientX,ev.clientY);corner&&window.nhbEditor.isCtrlDown&&window.nhbEditor.isShiftDown&&(this.style("width","auto"),this.style("height","auto"),this.attr("height",""),this.attr("width","")),proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Element.prototype.drop;ContentEdit.Element.prototype.drop=function(element,placement){var root=ContentEdit.Root.get();return element&&"undefined"!=typeof element.type&&!this.constructor.droppers[element.type()]&&!element.constructor.droppers[this.type()]&&element.constructor.droppers["*"]?(element._removeCSSClass("ce-element--drop"),element._removeCSSClass("ce-element--drop-"+placement[0]),element._removeCSSClass("ce-element--drop-"+placement[1]),element.constructor.droppers["*"](this,element,placement),void root.trigger("drop",this,element,placement)):proxied.call(this,element,placement)}}(),function(){var proxied=ContentEdit.Element.prototype._onOver;ContentEdit.Element.prototype._onOver=function(ev){var ret=proxied.call(this,ev);if(!ret){var root=ContentEdit.Root.get(),dragging=root.dragging();if(!dragging)return;if(dragging===this)return;if(root._dropTarget)return;if(this.constructor.droppers["*"])return this._addCSSClass("ce-element--drop"),root._dropTarget=this}return ret}}(),nhbEditor.Frame=wp.media.view.Frame.extend({className:"nhb-icon-modal",template:wp.template("nhb-icon-frame"),events:{"click .media-toolbar-primary button":"_primaryClicked"},initialize:function(){wp.media.view.Frame.prototype.initialize.apply(this,arguments),_.defaults(this.options,{title:"My Modal",button:"My Button",modal:!0}),this.options.modal&&(this.modal=new wp.media.view.Modal({controller:this}),this.modal.content(this),this.modal.on("open",_.bind(function(){this._onOpen()},this)),this.modal.on("close",_.bind(function(){this._onClose()},this)))},open:function(args){args||(args={}),this.options=_.defaults(args,this.options),args.content&&this.modal.content(args.content(this)),this.modal.open(),this.modal.el.children[0].classList.add("nhb-modal-frame"),this.className&&this.modal.el.children[0].classList.add(this.className),this.modal.el.querySelector(".media-frame-title h1")&&(this.modal.el.querySelector(".media-frame-title h1").textContent=this.options.title),this.modal.el.querySelector(".media-toolbar-primary button")&&(this.modal.el.querySelector(".media-toolbar-primary button").textContent=this.options.button),this.modal.el.children[0].classList.add("nhb-frame-hide"),setTimeout(function(){this.modal.el.children[0].classList.remove("nhb-frame-hide")}.bind(this),50)},close:function(){this.modal.close()},_primaryClicked:function(){this.modal.close(),this.options.successCallback&&this.options.successCallback(this)},_onOpen:function(){this.options.openCallback&&this.options.openCallback(this)},_onClose:function(){this.options.closeCallback&&this.options.closeCallback(this)}}),nhbEditor.SearchFrame=nhbEditor.Frame.extend({className:"nhb-icon-modal",template:wp.template("nhb-icon-frame"),events:{"click .media-toolbar-primary button":"_primaryClicked"},_onOpen:function(){nhbEditor.Frame.prototype._onOpen.apply(this),setTimeout(function(){var searchInput=this.modal.el.querySelector('input[type="search"]');searchInput.focus(),searchInput.select()}.bind(this),1),this.selected||this.modal.el.querySelector(".media-toolbar-primary button").setAttribute("disabled","disabled"),this.modal.el.querySelector(".nhb-no-results").style.display=""},_onClose:function(){this.modal.el.querySelector('input[type="search"]').focus()},searchKeyup:function(ev){clearTimeout(this._searchTimeout),this._searchTimeout=setTimeout(function(){this.doSearch(ev)}.bind(this),400)},reset:function(){this.selected=null,this.model.el.querySelector(".nhb-no-results").style.display="",this.modal.el.querySelector(".media-toolbar-primary button").setAttribute("disabled","disabled")},doSearch:function(ev){var keyword=ev.target.value.trim().toLowerCase(),shortcodes=this.modal.el.querySelectorAll(".nhb-search-list > *"),hasResult=!1;Array.prototype.forEach.call(shortcodes,function(el){""===keyword||-1!==el.textContent.trim().toLowerCase().indexOf(keyword)?(el.style.display="",hasResult=!0):el.style.display="none"}),this.modal.el.querySelector(".nhb-no-results").style.display=hasResult?"":"flex"},select:function(ev){for(var target=ev.target;!target.parentNode.classList.contains("nhb-search-list");)target=target.parentNode;this.selected=target,this.modal.el.querySelector(".nhb-selected")&&this.modal.el.querySelector(".nhb-selected").classList.remove("nhb-selected"),target.classList.add("nhb-selected"),this.modal.el.querySelector(".media-toolbar-primary button").removeAttribute("disabled"),this._justClicked===target&&this._primaryClicked(),this._justClicked=target,clearTimeout(this._justClickedTimeout),this._justClickedTimeout=setTimeout(function(){this._justClicked=!1}.bind(this),300)}}),nhbEditor._IconFrame=nhbEditor.Frame.extend({className:"nhb-icon-modal",template:wp.template("nhb-icon-frame"),events:{"click .media-toolbar-primary button":"_primaryClicked",'keyup [type="search"]':"searchKeyup","click .nhb-icon-display [data-name]":"selectIcon"},_onOpen:function(){nhbEditor.Frame.prototype._onOpen.apply(this),setTimeout(function(){var searchInput=this.modal.el.querySelector('input[type="search"]');""===searchInput.value&&(searchInput.value="dashicons",this.searchKeyup({target:searchInput})),searchInput.focus(),searchInput.select()}.bind(this),1),this.selected||this.modal.el.querySelector(".media-toolbar-primary button").setAttribute("disabled","disabled")},_onClose:function(){this.modal.el.querySelector('input[type="search"]').focus()},searchKeyup:function(ev){clearTimeout(this._searchTimeout),this._searchTimeout=setTimeout(function(){this.doSearch(ev)}.bind(this),400)},reset:function(){for(this._searchResults=[],this.modal.el.querySelector(".nhb-no-results").style.display="";this.modal.el.querySelector(".nhb-search-list > *:not(.nhb-no-results)");){var item=this.modal.el.querySelector(".nhb-search-list > *:not(.nhb-no-results)");item.parentNode.removeChild(item)}this._prevKeyword="",this.selected=null,this._currentGroup=null,this.modal.el.querySelector(".media-toolbar-primary button").setAttribute("disabled","disabled")},doSearch:function(ev){var keyword=ev.target.value.trim();if(keyword&&this._prevKeyword!==keyword){this.reset(),this._prevKeyword=keyword,
"undefined"==typeof nhbParams.icon_searches&&(nhbParams.icon_searches=[]),"undefined"!=typeof ev.keyCode&&nhbParams.icon_searches.push(keyword);var request=new XMLHttpRequest;request.open("POST",nhbParams.ajax_url,!0),request.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),request.onload=function(){if(request.status>=200&&request.status<400){if(request.responseText){var response=JSON.parse(request.responseText);return"undefined"!=typeof response.length||0===response.length?void this.displayNoResults():(this._searchResults=response,void this.displayResults())}this.displayNoResults()}}.bind(this),request.send("action=nhb_icon_search&nonce="+nhbParams.nonce+"&s="+keyword)}},displayNoResults:function(){this.modal.el.querySelector(".nhb-no-results").style.display="flex"},displayResults:function(){var groupLabel,keys=Object.keys(this._searchResults);if(keys.length){var key=keys[0],result=this._searchResults[Object.keys(this._searchResults)[0]];if(delete this._searchResults[key],"undefined"==typeof this.groups){this.groups={};for(groupLabel in nhbParams.icon_groups)nhbParams.icon_groups.hasOwnProperty(groupLabel)&&(this.groups[groupLabel]=new RegExp(nhbParams.icon_groups[groupLabel],"i"))}var currGroup="";for(groupLabel in this.groups)if(this.groups.hasOwnProperty(groupLabel)){var groupRegex=this.groups[groupLabel];if(key.match(groupRegex)){currGroup=groupLabel;break}}if(this._currentGroup!==currGroup){var item=document.createElement("h4");item.innerHTML=groupLabel,item.classList.add("nhb-icon-group-title"),this.modal.el.querySelector(".nhb-icon-display").appendChild(item),this._currentGroup=currGroup}var icon=document.createElement("div");icon.innerHTML=result,icon.setAttribute("data-name",key),this.modal.el.querySelector(".nhb-icon-display").appendChild(icon),keys.length>1&&setTimeout(function(){this.displayResults()}.bind(this),5),this.modal.el.querySelector(".nhb-no-results").style.display=""}},selectIcon:function(ev){for(var target=ev.target;!target.getAttribute("data-name");)target=target.parentNode;this.selected=target,this.modal.el.querySelector(".nhb-icon-display .nhb-selected")&&this.modal.el.querySelector(".nhb-icon-display .nhb-selected").classList.remove("nhb-selected"),target.classList.add("nhb-selected"),this.modal.el.querySelector(".media-toolbar-primary button").removeAttribute("disabled"),this._justClicked===target&&this._primaryClicked(),this._justClicked=target,clearTimeout(this._justClickedTimeout),this._justClickedTimeout=setTimeout(function(){this._justClicked=!1}.bind(this),300)}}),window.addEventListener("DOMContentLoaded",function(){nhbEditor.iconFrame=new nhbEditor._IconFrame}),wp.hooks.addAction("nhb.save.payload",function(payload){"undefined"!=typeof nhbParams.icon_searches&&payload.append("icon_searches",nhbParams.icon_searches)}),nhbEditor._WidgetFrame=nhbEditor.SearchFrame.extend({className:"nhb-widget-modal",template:wp.template("nhb-widget-frame"),events:{"click .media-toolbar-primary button":"_primaryClicked",'keyup [type="search"]':"searchKeyup","click [data-widget-slug]":"select"}}),window.addEventListener("DOMContentLoaded",function(){nhbEditor.widgetFrame=new nhbEditor._WidgetFrame}),nhbEditor._ShortcodeFrame=nhbEditor.SearchFrame.extend({className:"nhb-shortcode-modal",template:wp.template("nhb-shortcode-frame"),events:{"click .media-toolbar-primary button":"_primaryClicked",'keyup [type="search"]':"searchKeyup","click [data-shortcode-tag]":"select","click .nhb-refresh-mappings":"refreshShortcodeMappings"},_onOpen:function(){nhbEditor.SearchFrame.prototype._onOpen.apply(this),this.initShortcodeList()},initShortcodeList:function(){var map,shortcodeArea=this.modal.el.querySelector(".nhb-search-list");if(!shortcodeArea.querySelector("*:not(.nhb-no-results)")){for(var sc,tag,allShortcodes=[],i=0;i<nhbParams.shortcodes.length;i++)if(tag=nhbParams.shortcodes[i],"undefined"==typeof nhbParams.shortcodes_to_hide||-1===nhbParams.shortcodes_to_hide.indexOf(tag)){if(sc={tag:tag,name:tag.replace(/[\-_]/g," "),desc:"",owner:"",ownerslug:"",image:"",isMapped:!1},nhbParams.shortcode_mappings[tag]){if(map=nhbParams.shortcode_mappings[tag],"1"===map.is_hidden)continue;sc.desc=map.description,sc.owner=map.owner,sc.ownerslug=map["owner-slug"],sc.image="http://ps.w.org/"+sc.ownerslug+"/assets/icon-128x128.png), url(http://ps.w.org/"+sc.ownerslug+"/assets/icon.svg), url("+nhbParams.plugin_url+"no_hassle_builder/assets/element-icons/shortcode_single.svg",map.owner===nhbParams.theme&&(sc.image=nhbParams.stylesheet_directory_uri+"screenshot.png"),sc.isMapped=!0,map.name&&(sc.name=map.name)}if(nhbInspectorOptions.Shortcode[nhbParams.shortcodes[i]]){if(map=nhbInspectorOptions.Shortcode[nhbParams.shortcodes[i]],"1"===map.is_hidden)continue;map.label&&(sc.name=map.label),map.name&&(sc.name=map.name),map.desc&&(sc.desc=map.desc),map.owner&&(sc.owner=map.owner),map.image&&(sc.image=map.image),sc.isMapped=!0}allShortcodes.push(sc)}allShortcodes.sort(function(a,b){var x=a.name.toLowerCase(),y=b.name.toLowerCase(),ret=y>x?-1:x>y?1:0,xMap=a.isMapped,yMap=b.isMapped;return xMap===yMap?ret:xMap?-1:1});for(tag in allShortcodes)if(allShortcodes.hasOwnProperty(tag)){sc=allShortcodes[tag];var div=document.createElement("DIV");div.setAttribute("data-shortcode-tag",sc.tag);var title=document.createElement("H4");if(title.innerHTML=sc.name,div.appendChild(title),sc.desc){var desc=document.createElement("P");desc.innerHTML=sc.desc,div.appendChild(desc)}var owner=document.createElement("P");if(owner.classList.add("nhb-shortcode-owner"),owner.innerHTML=sc.owner+" ["+sc.tag+"]",div.appendChild(owner),sc.isMapped){var preview=document.createElement("DIV");preview.classList.add("nhb-shortcode-owner-image"),sc.image&&preview.setAttribute("style","background-image: url("+sc.image+")"),div.appendChild(preview),div.classList.add("nhb-has-owner-image")}shortcodeArea.appendChild(div)}}},refreshShortcodeMappings:function(ev){if(ev.preventDefault(),!this._isUpdatingShortcodes){this._isUpdatingShortcodes=!0,this.modal.$el.addClass("nhb-busy");var payload=new FormData;payload.append("action","nhb_update_shortcode_mappings"),payload.append("nonce",nhbParams.nonce);var xhr=new XMLHttpRequest;return xhr.onload=function(){if(this.modal.$el.removeClass("nhb-busy"),xhr.status>=200&&xhr.status<400){this._isUpdatingShortcodes=null;var response=JSON.parse(xhr.responseText);if(response){for(var shortcode in nhbParams.shortcode_mappings)nhbParams.shortcode_mappings.hasOwnProperty(shortcode)&&window.nhbRemoveInspector(shortcode);nhbParams.shortcode_mappings=response;var shortcodeArea=this.modal.el.querySelector(".nhb-search-list"),noResults=shortcodeArea.querySelector(".nhb-no-results");for(noResults.parentNode.removeChild(noResults);shortcodeArea.firstChild;)shortcodeArea.removeChild(shortcodeArea.firstChild);shortcodeArea.appendChild(noResults),this.initShortcodeList()}}}.bind(this),xhr.onerror=function(){this.modal.$el.removeClass("nhb-busy"),this._isUpdatingShortcodes=null},xhr.open("POST",nhbParams.ajax_url),xhr.send(payload),!1}}}),window.addEventListener("DOMContentLoaded",function(){nhbEditor.shortcodeFrame=new nhbEditor._ShortcodeFrame}),nhbEditor._PredesignedFrame=nhbEditor.SearchFrame.extend({className:"nhb-predesigned-modal",template:wp.template("nhb-predesigned-frame"),events:{"click .media-toolbar-primary button":"_primaryClicked",'keyup [type="search"]':"searchKeyup","click [data-template]":"select"},_onOpen:function(){nhbEditor.SearchFrame.prototype._onOpen.apply(this),this.initList()},initList:function(){if(!this.modal.el.querySelector(".nhb-search-list > *:not(.nhb-no-results)")){var container=this.modal.el.querySelector(".nhb-search-list"),designElements=document.querySelectorAll("[data-design-element-template]");Array.prototype.forEach.call(designElements,function(el){var elem,templateID=el.getAttribute("id"),name=el.getAttribute("data-name"),description=el.getAttribute("data-description"),image=el.getAttribute("data-image"),button=document.createElement("DIV");button.setAttribute("data-template",templateID),button.setAttribute("data-root-only",el.getAttribute("data-root-only")),image&&(elem=document.createElement("img"),elem.setAttribute("src",image),elem.setAttribute("alt",name?name:templateID),button.appendChild(elem)),name&&(elem=document.createElement("h4"),elem.innerHTML=name,button.appendChild(elem)),description&&(elem=document.createElement("p"),elem.classList.add("description"),elem.innerHTML=description,button.appendChild(elem)),container.appendChild(button)})}}}),window.addEventListener("DOMContentLoaded",function(){nhbEditor.predesignedFrame=new nhbEditor._PredesignedFrame}),nhbEditor._HtmlFrame=nhbEditor.Frame.extend({className:"nhb-html-modal",template:wp.template("nhb-html-frame"),events:{"click .media-toolbar-primary button":"_primaryClicked","keydown textarea":"tabHandler"},_onOpen:function(){nhbEditor.Frame.prototype._onOpen.apply(this),setTimeout(function(){var input=this.modal.el.querySelector("textarea");input.focus(),""===input.value&&(input.value="<div>\n	<p>Sample HTML</p>\n</div>",input.select())}.bind(this),1)},_onClose:function(){this.modal.el.querySelector("textarea").focus()},tabHandler:function(e){if(9===e.keyCode){var val=e.target.value,start=e.target.selectionStart,end=e.target.selectionEnd;return e.target.value=val.substring(0,start)+"	"+val.substring(end),e.target.selectionStart=e.target.selectionEnd=start+1,e.preventDefault(),!1}},getHtml:function(){var html=this.modal.el.querySelector("textarea").value.trim(),dummy=document.createElement("div");return dummy.innerHTML=html,dummy.innerHTML.replace(/\s{2,}/g," ")},setHtml:function(html){html=html.trim(),html=this.formatXml(html).trim(),this.modal.el.querySelector("textarea").value=html},formatXml:function(xml){var formatted="",reg=/(>)(<)(\/*)/g;xml=xml.toString().replace(reg,"$1\r\n$2$3");var pad=0,nodes=xml.split("\r\n");for(var n in nodes){var node=nodes[n],indent=0;node.match(/.+<\/\w[^>]*>$/)?indent=0:node.match(/^<\/\w/)?0!==pad&&(pad-=1):indent=node.match(/^<\w[^>]*[^\/]>.*$/)?1:0;for(var padding="",i=0;pad>i;i++)padding+="  ";formatted+=padding+node+"\r\n",pad+=indent}return formatted}}),window.addEventListener("DOMContentLoaded",function(){nhbEditor.htmlFrame=new nhbEditor._HtmlFrame}),nhbEditor._AdminFrame=nhbEditor.Frame.extend({className:"nhb-admin-modal",template:wp.template("nhb-admin-frame"),events:{},_onOpen:function(){nhbEditor.Frame.prototype._onOpen.apply(this),sessionStorage.setItem("nhb_in_admin_iframe",1),setTimeout(function(){this.modal.el.classList.add("nhb-busy");var iframe=this.modal.el.querySelector("iframe");iframe.onload=function(){this.modal.el.classList.remove("nhb-busy")}.bind(this),iframe.setAttribute("src",this.options.url)}.bind(this),1)},_onClose:function(){sessionStorage.removeItem("nhb_in_admin_iframe"),this.modal.el.querySelector("iframe").setAttribute("src",""),nhbEditor.Frame.prototype._onClose.apply(this)}}),window.addEventListener("DOMContentLoaded",function(){nhbEditor.adminFrame=new nhbEditor._AdminFrame}),nhbEditor.Overlays=[],nhbEditor.Overlay=function(){function Overlay(){this.showOnTaint=!0,this._domElement=null,this._active=!1,this._shown=!1,this._isMounted=!1,this._classname="",nhbEditor.Overlays.push(this),wp.hooks.addAction("nhb.element.over",function(element){if(!ContentEdit.Root.get().dragging()){clearTimeout(this._hideTimeout),this._hideTimeout=setTimeout(function(){this._shown||this._hide(),this._shown=!1}.bind(this),10);for(var couldApply=this.canApply(element);null!==element&&"Region"!==element.constructor.name&&!couldApply;)element=element.parent(),couldApply=this.canApply(element);couldApply&&(this.element=this.applyTo(element),this._shown=!0,this._show(this.element))}}.bind(this)),ContentEdit.Root.get().bind("unmount",function(element){element===this.element&&this._hide()}.bind(this)),ContentEdit.Root.get().bind("drag",function(){this._hide()}.bind(this)),ContentEdit.Root.get().bind("drop",function(){this._hide()}.bind(this)),document.addEventListener("mouseover",function(ev){if(this._isMounted&&!Overlay.active){if(window.nhbSelectorMatches(ev.target,'[data-name="main-content"], [data-name="main-content"] *, .nhb-quick-action-overlay, .nhb-quick-action-overlay *, .nhb-toolbar, .nhb-toolbar *'))return;this._hide()}}.bind(this)),ContentEdit.Root.get().bind("taint",function(element){this.showOnTaint&&this.element===element&&this._show(element)}.bind(this)),ContentEdit.Root.get().bind("debounced_taint",function(element){this.showOnTaint&&this.element===element&&this._show(element)}.bind(this));var editor=ContentTools.EditorApp.get();editor.bind("start",function(){this._domElement=this.createElement(),this.mount()}.bind(this)),editor.bind("stop",function(){this.unmount()}.bind(this))}return Overlay.prototype.mount=function(){this._domElement.classList.add("nhb-quick-action-overlay"),this._domElement.classList.add("nhb-overlay-"+this.constructor.name.toLowerCase()),this._classname&&this._domElement.classList.add(this._classname),document.body.appendChild(this._domElement),this.addEventHandlers(),this._isMounted=!0},Overlay.prototype.unmount=function(){this.removeEventHandlers(),document.body.removeChild(this._domElement),this._isMounted=!1},Overlay.prototype.addEventHandlers=function(){this._mousedownBound=this._mousedown.bind(this),this._mousemoveBound=this._mousemove.bind(this),this._mouseupBound=this._mouseup.bind(this),this._mouseenterBound=this._mouseenter.bind(this),this._mouseleaveBound=this._mouseleave.bind(this),this._domElement.addEventListener("mousedown",this._mousedownBound),this._domElement.addEventListener("mouseenter",this._mouseenterBound),this._domElement.addEventListener("mouseleave",this._mouseleaveBound),document.addEventListener("mousemove",this._mousemoveBound),document.addEventListener("mouseup",this._mouseupBound)},Overlay.prototype.removeEventHandlers=function(){this._domElement.removeEventListener("mousedown",this._mousedownBound),this._domElement.removeEventListener("mouseenter",this._mouseenterBound),this._domElement.removeEventListener("mouseleave",this._mouseleaveBound),document.removeEventListener("mousemove",this._mousemoveBound),document.removeEventListener("mouseup",this._mouseupBound)},Overlay.prototype._mousedown=function(ev){return this.canApply()?(this._active=!0,this.startX=parseInt(ev.screenX,10),this.startY=parseInt(ev.screenY,10),this.deltaX=0,this.deltaY=0,Overlay.active=!0,this._domElement.classList.add("nhb-active"),document.body.classList.add("nhb-overlay-is-active"),document.body.classList.add("nhb-overlay-"+this.constructor.name.toLowerCase()),this.onClick(ev),void this.onMoveStart(ev)):void(this._active=!1)},Overlay.prototype._mousemove=function(ev){this._active&&(this.deltaX=parseInt(ev.screenX,10)-this.startX,this.deltaY=parseInt(ev.screenY,10)-this.startY,ev.preventDefault(),ev.stopPropagation(),this.onMove(ev),Overlay.hideOtherOverlays(this))},Overlay.hideOtherOverlays=function(callingOverlay){Array.prototype.forEach.call(nhbEditor.Overlays,function(overlay){overlay!==callingOverlay&&overlay._hide()})},Overlay.prototype._mouseup=function(){this._active=!1,Overlay.active=!1,this._domElement.classList.remove("nhb-active"),document.body.classList.remove("nhb-overlay-is-active"),document.body.classList.remove("nhb-overlay-active-"+this.constructor.name.toLowerCase())},Overlay.prototype._mouseenter=function(ev){this._domElement.classList.add("nhb-over"),document.body.classList.add("nhb-overlay-hovered"),document.body.classList.add("nhb-overlay-hovered-"+this.constructor.name.toLowerCase()),this.onEnter(ev)},Overlay.prototype._mouseleave=function(){this._domElement.classList.remove("nhb-over"),document.body.classList.remove("nhb-overlay-hovered"),document.body.classList.remove("nhb-overlay-hovered-"+this.constructor.name.toLowerCase()),this.onLeave()},Overlay.prototype._show=function(element){var root=ContentEdit.Root.get();!root.dragging()&&element&&(this._domElement.style.display="block",this.show(element))},Overlay.prototype._hide=function(){this._domElement&&(this._domElement.style.display="none"),this.hide()},Overlay.active=!1,Overlay.prevOverElement=null,Overlay.prototype.canApply=function(){return!Overlay.active},Overlay.prototype.createElement=function(){},Overlay.prototype.onMoveStart=function(){},Overlay.prototype.onMove=function(){},Overlay.prototype.onClick=function(){},Overlay.prototype.show=function(element){},Overlay.prototype.hide=function(){},Overlay.prototype.onEnter=function(){},Overlay.prototype.onLeave=function(){},Overlay.prototype.applyTo=function(element){return element},Overlay}(),function(){var proxied=ContentEdit.Element.prototype._onMouseDown;ContentEdit.Element.prototype._onMouseDown=function(ev){return nhbEditor.Overlay.active?void 0:proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Element.prototype._onMouseMove;ContentEdit.Element.prototype._onMouseMove=function(ev){return nhbEditor.Overlay.active?void 0:(ContentEdit.Root.get().trigger("mousemove",this),proxied.call(this,ev))}}(),function(){var proxied=ContentEdit.Element.prototype._onMouseOver;ContentEdit.Element.prototype._onMouseOver=function(ev){return nhbEditor.Overlay.active?void 0:proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Element.prototype._onMouseOut;ContentEdit.Element.prototype._onMouseOut=function(ev){return nhbEditor.Overlay.active?void 0:proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Element.prototype._onMouseUp;ContentEdit.Element.prototype._onMouseUp=function(ev){return nhbEditor.Overlay.active?void 0:proxied.call(this,ev)}}(),function(){var currentOverElement=null,currentTarget=null,nhbOverElement=_.throttle(function(target){if(currentTarget===target)return void wp.hooks.doAction("nhb.element.over",currentOverElement);if(!target._ceElement){for(wp.hooks.doAction("nhb.nonelement.over",target);!target._ceElement;)if(target=target.parentNode,!target||"BODY"===target.tagName)return;if("Region"===target._ceElement.constructor.name)return}nhbEditor.Overlay.active||(currentTarget=target,currentOverElement=target._ceElement,wp.hooks.doAction("nhb.element.over",target._ceElement))},30),mouseListener=function(ev){nhbOverElement(ev.target)};ContentTools.EditorApp.get().bind("start",function(){window.addEventListener("mousemove",mouseListener),window.addEventListener("mouseover",mouseListener)}),ContentTools.EditorApp.get().bind("stop",function(){window.removeEventListener("mousemove",mouseListener),window.removeEventListener("mouseover",mouseListener)})}(),nhbEditor.OverlayControls=function(_super){function OverlayControls(controls){OverlayControls.__super__.constructor.call(this),this.showOnTaint=!1,"undefined"==typeof controls&&(controls=[]),this.controls=controls,ContentEdit.Root.get().bind("taint",function(){this.updatePosition(this.element)}.bind(this)),ContentEdit.Root.get().bind("focus",function(){this._hide()}.bind(this)),document.addEventListener("mousedown",function(ev){var focused=ContentEdit.Root.get().focused();focused&&focused._domElement===ev.target&&this._hide()}.bind(this)),ContentEdit.Root.get().bind("focus",function(){this._hide()}.bind(this)),document.addEventListener("keydown",function(ev){-1===[40,37,39,38,9,8,46,13,16,91,18].indexOf(ev.keyCode)&&this._hide()}.bind(this)),window.addEventListener("resize",function(){this._hide()}.bind(this))}return __extends(OverlayControls,_super),OverlayControls.prototype.createElement=function(){var element=document.createElement("DIV");if(!this.controls.length)return element;var wrapper=document.createElement("DIV");wrapper.classList.add("nhb-overlay-wrapper"),element.appendChild(wrapper);for(var i=0;i<this.controls.length;i++){var control=document.createElement("DIV");control.classList.add("nhb-overlay-"+this.controls[i].name),control.control=this.controls[i],this.controls[i]._domElement=control,control.addEventListener("mouseenter",function(overlay){overlay._domElement.classList.add("nhb-over-"+this.control.name),this.control._domElement.classList.add("nhb-control-over")}.bind(control,this)),control.addEventListener("mouseleave",function(overlay){overlay._domElement.classList.add("nhb-over-"+this.control.name),this.control._domElement.classList.remove("nhb-control-over")}.bind(control,this)),wrapper.appendChild(control)}return this._locationDragging=null,element},OverlayControls.prototype.canApply=function(element){return OverlayControls.__super__.canApply.call(this,element)?(element||(element=this.element),element?!0:!1):!1},OverlayControls.prototype.updatePosition=function(element){if(element&&element._domElement){var styles=getComputedStyle(element._domElement),rect=element._domElement.getBoundingClientRect(),toolbar=getComputedStyle(document.querySelector(".nhb-toolbox-bar")),toolbarHeight=parseInt(toolbar.height,10),scrollY=window.scrollY||window.pageYOffset;this._domElement.style.top=rect.top+scrollY-toolbarHeight+"px",this._domElement.style.height=rect.height+"px",this._domElement.style.left=rect.left+"px",this._domElement.style.width=rect.width+"px";for(var i=0;i<this.controls.length;i++)this.controls[i].refresh&&this.controls[i].refresh(this,element,styles,rect)}},OverlayControls.prototype._hide=function(){return this._domElement&&-1!==this._domElement.getAttribute("class").indexOf("nhb-active-")?void 0:OverlayControls.__super__._hide.call(this)},OverlayControls.prototype.hide=function(){if(this._domElement){this._domElement.classList.remove("nhb-overlay-show"),clearInterval(this._updatePositionTimeout);for(var i=0;i<this.controls.length;i++)this._domElement.classList.remove("nhb-active-"+this.controls[i].name)}},OverlayControls.prototype.show=function(element){if(element){if(this._domElement.classList.contains("nhb-overlay-show")){if(this._prevElement&&this._prevElement===element)return;this._prevElement=element}this.updatePosition(element),clearInterval(this._updatePositionTimeout),this._updatePositionTimeout=setInterval(function(){this.updatePosition(this.element)}.bind(this),60),this._domElement.classList.add("nhb-overlay-show");for(var i=0;i<this.controls.length;i++)this._domElement.classList.remove("nhb-active-"+this.controls[i].name),this._domElement.classList.remove("nhb-over-"+this.controls[i].name),this.controls[i]._domElement.classList.remove("nhb-control-active"),this.controls[i]._domElement.classList.remove("nhb-control-over")}},OverlayControls.prototype.onMoveStart=function(ev){for(var styles=getComputedStyle(this.element._domElement),rect=this.element._domElement.getBoundingClientRect(),i=0;i<this.controls.length;i++)this._locationDragging===this.controls[i].name&&this.controls[i].onMoveStart&&this.controls[i].onMoveStart(this,this.element,styles,rect,ev)},OverlayControls.prototype.onMove=function(ev){for(var i=0;i<this.controls.length;i++)if(this._locationDragging===this.controls[i].name){this.controls[i].onMove&&this.controls[i].onMove(this,this.element,this.deltaX,this.deltaY,ev);break}this.updatePosition(this.element)},OverlayControls.prototype.onClick=function(ev){this._locationDragging=null;for(var i=0;i<this.controls.length;i++)this._domElement.classList.remove("nhb-active-"+this.controls[i].name),this.controls[i].onClick&&this.controls[i].onClick(this,this.element);for(i=0;i<this.controls.length;i++)if(ev.target===this.controls[i]._domElement){this._locationDragging=this.controls[i].name,this._domElement.classList.add("nhb-active-"+this.controls[i].name),this._domElement.classList.add("nhb-active"),this.controls[i]._domElement.classList.add("nhb-control-active");break}this.updatePosition(this.element)},OverlayControls.prototype._mouseup=function(ev){for(var ret=OverlayControls.__super__._mouseup.call(this,ev),i=0;i<this.controls.length;i++)this._domElement.classList.remove("nhb-active-"+this.controls[i].name),this.controls[i]._domElement.classList.remove("nhb-control-active"),this._locationDragging===this.controls[i].name&&this.controls[i].onMoveStop&&this.controls[i].onMoveStop(this,this.element,ev);return this._locationDragging=null,ret},OverlayControls.prototype.applyTo=function(element){return this._alreadyShown2?this.element:(this._alreadyShown2=!0,setTimeout(function(){this._alreadyShown2=!1}.bind(this)),element)},OverlayControls}(nhbEditor.Overlay),nhbEditor.OverlayElement=function(_super){function OverlayElement(){var controls=[{name:"resize-bottom-left",refresh:function(overlay,element,styles,rect){if(this._domElement.style.display="none","Image"===element.constructor.name?this._domElement.style.display="":"Icon"===element.constructor.name&&(this._domElement.style.display=""),rect.height<150||rect.width<150){var side=rect.height;rect.height>rect.width&&(side=rect.width),side=.3*side,this._domElement.style.width=side+"px",this._domElement.style.height=side+"px"}else this._domElement.style.width="",this._domElement.style.height=""},onMoveStart:function(overlay,element,styles,rect){this._initWidth=rect.width,this._initHeight=rect.height,this._aspectRatio=rect.width/rect.height;var toolbar=getComputedStyle(document.querySelector(".nhb-toolbox-bar")),toolbarHeight=parseInt(toolbar.height,10),scrollY=window.scrollY||window.pageYOffset;this._toolbarHeight=toolbarHeight,this._domElement.style.top=this._overlaySize=document.createElement("DIV"),this._overlaySize.classList.add("nhb-size-indicator"),this._overlaySize.innerHTML=rect.width+" &times; "+parseInt(rect.height,10)+" px",this._overlaySize.style.top=rect.top+scrollY-this._toolbarHeight+"px",this._overlaySize.style.left=rect.right+"px",document.body.appendChild(this._overlaySize)},onMove:function(overlay,element,deltaX){var width=-deltaX+this._initWidth;if(window.nhbEditor.isShiftDown){var remainder=width%10;width-=remainder}width=parseInt(width,10);var height=1/this._aspectRatio*width;element.style("height",height+"px"),element.style("width",width+"px"),"Image"===element.constructor.name&&(element.attr("width",width),element.attr("height",height));var rect=element._domElement.getBoundingClientRect(),scrollY=window.scrollY||window.pageYOffset;this._overlaySize.style.top=rect.top+scrollY-this._toolbarHeight+"px",this._overlaySize.style.left=rect.right+"px",this._overlaySize.innerHTML=width+" &times; "+parseInt(height,10)+" px"},onMoveStop:function(overlay,element){document.body.removeChild(this._overlaySize),"Image"===element.constructor.name&&element.style("height","auto")}},{name:"resize-top-left",refresh:function(overlay,element,styles,rect){if(this._domElement.style.display="none","Image"===element.constructor.name?this._domElement.style.display="":"Icon"===element.constructor.name&&(this._domElement.style.display=""),rect.height<150||rect.width<150){var side=rect.height;rect.height>rect.width&&(side=rect.width),side=.3*side,this._domElement.style.width=side+"px",this._domElement.style.height=side+"px"}else this._domElement.style.width="",this._domElement.style.height=""},onMoveStart:function(overlay,element,styles,rect){this._initWidth=rect.width,this._initHeight=rect.height,this._aspectRatio=rect.width/rect.height;var toolbar=getComputedStyle(document.querySelector(".nhb-toolbox-bar")),toolbarHeight=parseInt(toolbar.height,10),scrollY=window.scrollY||window.pageYOffset;this._toolbarHeight=toolbarHeight,this._overlaySize=document.createElement("DIV"),this._overlaySize.classList.add("nhb-size-indicator"),this._overlaySize.innerHTML=rect.width+" &times; "+parseInt(rect.height,10)+" px",this._overlaySize.style.top=rect.top+scrollY-this._toolbarHeight+"px",this._overlaySize.style.left=rect.right+"px",document.body.appendChild(this._overlaySize)},onMove:function(overlay,element,deltaX){var width=-deltaX+this._initWidth;if(window.nhbEditor.isShiftDown){var remainder=width%10;width-=remainder}width=parseInt(width,10);var height=1/this._aspectRatio*width;element.style("height",height+"px"),element.style("width",width+"px"),"Image"===element.constructor.name&&(element.attr("width",width),element.attr("height",height));var rect=element._domElement.getBoundingClientRect(),scrollY=window.scrollY||window.pageYOffset;this._overlaySize.style.top=rect.top+scrollY-this._toolbarHeight+"px",this._overlaySize.style.left=rect.right+"px",this._overlaySize.innerHTML=width+" &times; "+parseInt(height,10)+" px"},onMoveStop:function(overlay,element){document.body.removeChild(this._overlaySize),"Image"===element.constructor.name&&element.style("height","auto")}},{name:"resize-top-right",refresh:function(overlay,element,styles,rect){if(this._domElement.style.display="none","Image"===element.constructor.name?this._domElement.style.display="":"Icon"===element.constructor.name&&(this._domElement.style.display=""),rect.height<150||rect.width<150){var side=rect.height;rect.height>rect.width&&(side=rect.width),side=.3*side,this._domElement.style.width=side+"px",this._domElement.style.height=side+"px"}else this._domElement.style.width="",this._domElement.style.height=""},onMoveStart:function(overlay,element,styles,rect){this._initWidth=rect.width,this._initHeight=rect.height,this._aspectRatio=rect.width/rect.height;var toolbar=getComputedStyle(document.querySelector(".nhb-toolbox-bar")),toolbarHeight=parseInt(toolbar.height,10),scrollY=window.scrollY||window.pageYOffset;this._toolbarHeight=toolbarHeight,this._domElement.style.top=this._overlaySize=document.createElement("DIV"),this._overlaySize.classList.add("nhb-size-indicator"),this._overlaySize.innerHTML=rect.width+" &times; "+parseInt(rect.height,10)+" px",this._overlaySize.style.top=rect.top+scrollY-this._toolbarHeight+"px",this._overlaySize.style.left=rect.right+"px",document.body.appendChild(this._overlaySize)},onMove:function(overlay,element,deltaX){var width=deltaX+this._initWidth;if(window.nhbEditor.isShiftDown){var remainder=width%10;width-=remainder}width=parseInt(width,10);var height=1/this._aspectRatio*width;element.style("height",height+"px"),element.style("width",width+"px"),"Image"===element.constructor.name&&(element.attr("width",width),element.attr("height",height));var rect=element._domElement.getBoundingClientRect(),scrollY=window.scrollY||window.pageYOffset;this._overlaySize.style.top=rect.top+scrollY-this._toolbarHeight+"px",this._overlaySize.style.left=rect.right+"px",this._overlaySize.innerHTML=width+" &times; "+parseInt(height,10)+" px"},onMoveStop:function(overlay,element){document.body.removeChild(this._overlaySize),"Image"===element.constructor.name&&element.style("height","auto")}},{name:"resize-bottom-right",refresh:function(overlay,element,styles,rect){if(this._domElement.style.display="none","Image"===element.constructor.name?this._domElement.style.display="":"Icon"===element.constructor.name&&(this._domElement.style.display=""),rect.height<150||rect.width<150){var side=rect.height;rect.height>rect.width&&(side=rect.width),side=.3*side,this._domElement.style.width=side+"px",this._domElement.style.height=side+"px"}else this._domElement.style.width="",this._domElement.style.height=""},onMoveStart:function(overlay,element,styles,rect){this._initWidth=rect.width,this._initHeight=rect.height,this._aspectRatio=rect.width/rect.height;var toolbar=getComputedStyle(document.querySelector(".nhb-toolbox-bar")),toolbarHeight=parseInt(toolbar.height,10),scrollY=window.scrollY||window.pageYOffset;this._toolbarHeight=toolbarHeight,this._domElement.style.top=this._overlaySize=document.createElement("DIV"),this._overlaySize.classList.add("nhb-size-indicator"),this._overlaySize.innerHTML=rect.width+" &times; "+parseInt(rect.height,10)+" px",this._overlaySize.style.top=rect.top+scrollY-this._toolbarHeight+"px",this._overlaySize.style.left=rect.right+"px",document.body.appendChild(this._overlaySize)},onMove:function(overlay,element,deltaX){var width=deltaX+this._initWidth;if(window.nhbEditor.isShiftDown){var remainder=width%10;width-=remainder}width=parseInt(width,10);var height=1/this._aspectRatio*width;element.style("height",height+"px"),element.style("width",width+"px"),"Image"===element.constructor.name&&(element.attr("width",width),element.attr("height",height));var rect=element._domElement.getBoundingClientRect(),scrollY=window.scrollY||window.pageYOffset;
this._overlaySize.style.top=rect.top+scrollY-this._toolbarHeight+"px",this._overlaySize.style.left=rect.right+"px",this._overlaySize.innerHTML=width+" &times; "+parseInt(height,10)+" px"},onMoveStop:function(overlay,element){document.body.removeChild(this._overlaySize),"Image"===element.constructor.name&&element.style("height","auto")}},{name:"resize-bottom",refresh:function(overlay,element,styles,rect){if(this._domElement.style.display="none","Map"===element.constructor.name&&(this._domElement.style.display=""),rect.height<150||rect.width<150){var side=rect.height;rect.height>rect.width&&(side=rect.width),side=.3*side,this._domElement.style.width=side+"px",this._domElement.style.height=side+"px"}else this._domElement.style.width="",this._domElement.style.height=""},onMoveStart:function(overlay,element,styles,rect){this._initWidth=rect.width,this._initHeight=rect.height;var toolbar=getComputedStyle(document.querySelector(".nhb-toolbox-bar")),toolbarHeight=parseInt(toolbar.height,10),scrollY=window.scrollY||window.pageYOffset;this._toolbarHeight=toolbarHeight,this._domElement.style.top=this._overlaySize=document.createElement("DIV"),this._overlaySize.classList.add("nhb-size-indicator"),this._overlaySize.innerHTML=rect.height+" px",this._overlaySize.style.top=rect.top+scrollY-this._toolbarHeight+"px",this._overlaySize.style.left=rect.right+"px",document.body.appendChild(this._overlaySize)},onMove:function(overlay,element,deltaX,deltaY){var height=deltaY+this._initHeight;if(window.nhbEditor.isShiftDown){var remainder=height%10;height-=remainder}height=parseInt(height,10),element.style("height",height+"px");var rect=element._domElement.getBoundingClientRect(),scrollY=window.scrollY||window.pageYOffset;this._overlaySize.style.top=rect.top+scrollY-this._toolbarHeight+"px",this._overlaySize.style.left=rect.right+"px",this._overlaySize.innerHTML=rect.height+" px"},onMoveStop:function(overlay,element){document.body.removeChild(this._overlaySize),"Image"===element.constructor.name&&element.style("height","auto")}},{name:"margin-top",refresh:function(overlay,element,styles,rect){this._domElement.style.display="","Shortcode"===element.constructor.name&&(this._domElement.style.display="none"),"Title"===element.constructor.name&&(this._domElement.style.display="none"),rect.width>100?this._domElement.setAttribute("data-label",nhbParams.labels.margin+": "+styles.marginTop):this._domElement.setAttribute("data-label",styles.marginTop),parseInt(styles.marginTop,10)<0?this._domElement.style.height="0px":this._domElement.style.height=styles.marginTop,this._domElement.setAttribute("data-value","margin-"+styles.marginTop)},onMoveStart:function(overlay,element,styles){this._initValue=parseInt(styles.marginTop,10)},onMove:function(overlay,element,deltaX,deltaY){var margin=deltaY+this._initValue;if(window.nhbEditor.isShiftDown){var remainder=margin%10;margin-=remainder}element.style("margin-top",margin+"px")}},{name:"margin-bottom",refresh:function(overlay,element,styles,rect){this._domElement.style.display="","Shortcode"===element.constructor.name&&(this._domElement.style.display="none"),"Title"===element.constructor.name&&(this._domElement.style.display="none"),rect.width>100?this._domElement.setAttribute("data-label",nhbParams.labels.margin+": "+styles.marginBottom):this._domElement.setAttribute("data-label",styles.marginBottom),parseInt(styles.marginBottom,10)<0?this._domElement.style.height="0px":this._domElement.style.height=styles.marginBottom,this._domElement.setAttribute("data-value","margin-"+styles.marginBottom)},onMoveStart:function(overlay,element,styles){this._initValue=parseInt(styles.marginBottom,10)},onMove:function(overlay,element,deltaX,deltaY){var margin=deltaY+this._initValue;if(window.nhbEditor.isShiftDown){var remainder=margin%10;margin-=remainder}element.style("margin-bottom",margin+"px")}}];OverlayElement.__super__.constructor.call(this,controls),this.showOnTaint=!1}return __extends(OverlayElement,_super),OverlayElement.prototype.canApply=function(element){return OverlayElement.__super__.canApply.call(this,element)?(element||(element=this.element),"Static"===element.constructor.name?!1:-1!==["ListItem","ListItemText"].indexOf(element.constructor.name)?!1:-1!==["Tab","TabPanelContainer"].indexOf(element.constructor.name)?!1:-1!==["TableRow","TableSection"].indexOf(element.constructor.name)?!1:-1!==["Carousel"].indexOf(element.constructor.name)?!1:-1!==["Div","DivRow","DivCol","Region"].indexOf(element.constructor.name)?!1:!0):!1},OverlayElement}(nhbEditor.OverlayControls),nhbEditor.OverlayColumn=function(_super){function OverlayColumn(){var controls=[{name:"padding-top",refresh:function(overlay,element,styles){this._domElement.setAttribute("data-label",nhbParams.labels.padding+": "+styles.paddingTop),this._domElement.style.height=styles.paddingTop,this._domElement.setAttribute("data-value","padding-"+styles.paddingTop)},onMoveStart:function(overlay,element,styles){this._initValue=parseInt(styles.paddingTop,10)},onMove:function(overlay,element,deltaX,deltaY){var padding=deltaY+this._initValue;if(0>padding&&(padding=0),window.nhbEditor.isShiftDown){var remainder=padding%10;padding-=remainder}element.style("padding-top",padding+"px")}},{name:"padding-bottom",refresh:function(overlay,element,styles){this._domElement.setAttribute("data-label",nhbParams.labels.padding+": "+styles.paddingBottom),this._domElement.style.height=styles.paddingBottom,this._domElement.setAttribute("data-value","padding-"+styles.paddingBottom)},onMoveStart:function(overlay,element,styles){this._initValue=parseInt(styles.paddingBottom,10)},onMove:function(overlay,element,deltaX,deltaY){var padding=deltaY+this._initValue;if(0>padding&&(padding=0),window.nhbEditor.isShiftDown){var remainder=padding%10;padding-=remainder}element.style("padding-bottom",padding+"px")}},{name:"padding-left",refresh:function(overlay,element,styles,rect){parseInt(rect.height,10)>100?this._domElement.setAttribute("data-label",nhbParams.labels.padding+": "+styles.paddingLeft):this._domElement.setAttribute("data-label",styles.paddingLeft),this._domElement.style.width=styles.paddingLeft,this._domElement.setAttribute("data-value","padding-"+styles.paddingLeft)},onMoveStart:function(overlay,element,styles){this._initValue=parseInt(styles.paddingLeft,10)},onMove:function(overlay,element,deltaX){var padding=deltaX+this._initValue;if(0>padding&&(padding=0),window.nhbEditor.isShiftDown){var remainder=padding%10;padding-=remainder}element.style("padding-left",padding+"px")}},{name:"padding-right",refresh:function(overlay,element,styles,rect){parseInt(rect.height,10)>100?this._domElement.setAttribute("data-label",nhbParams.labels.padding+": "+styles.paddingRight):this._domElement.setAttribute("data-label",styles.paddingRight),this._domElement.style.width=styles.paddingRight,this._domElement.setAttribute("data-value","padding-"+styles.paddingRight)},onMoveStart:function(overlay,element,styles){this._initValue=parseInt(styles.paddingRight,10)},onMove:function(overlay,element,deltaX){var padding=-deltaX+this._initValue;if(0>padding&&(padding=0),window.nhbEditor.isShiftDown){var remainder=padding%10;padding-=remainder}element.style("padding-right",padding+"px")}}];OverlayColumn.__super__.constructor.call(this,controls),this.showOnTaint=!1}return __extends(OverlayColumn,_super),OverlayColumn.prototype.canApply=function(element){if(!OverlayColumn.__super__.canApply.call(this,element))return!1;if(element||(element=this.element),!element)return!1;if("DivCol"===element.constructor.name)return!0;for(var parent=element.parent();parent&&"Region"!==parent.constructor.name;){if("DivCol"===parent.constructor.name)return!0;parent=parent.parent()}return element&&"DivCol"===element.constructor.name?!0:!1},OverlayColumn.prototype.show=function(element){if(element){if("DivCol"!==element.constructor.name){for(element=element.parent();element&&"Region"!==element.constructor.name&&"DivCol"!==element.constructor.name;)element=element.parent();if(!element||"Region"===element.constructor.name)return void this._hide();this.element=element}if(!this._alreadyShown)return this._alreadyShown=!0,setTimeout(function(){this._alreadyShown=!1}.bind(this)),OverlayColumn.__super__.show.call(this,this.element)}},OverlayColumn.prototype.applyTo=function(element){if(this._alreadyShown2)return this.element;if(this._alreadyShown2=!0,setTimeout(function(){this._alreadyShown2=!1}.bind(this)),!element)return element;if("DivCol"!==element.constructor.name)for(element=element.parent();element&&"Region"!==element.constructor.name;){if("DivCol"===element.constructor.name)return element;element=element.parent()}return element},OverlayColumn}(nhbEditor.OverlayControls),nhbEditor.OverlayRow=function(_super){function OverlayRow(){OverlayRow.__super__.constructor.call(this),this.showOnTaint=!1,ContentEdit.Root.get().bind("focus",function(){this._hide()}.bind(this)),document.addEventListener("mousedown",function(ev){var focused=ContentEdit.Root.get().focused();focused&&focused._domElement===ev.target&&this._hide()}.bind(this)),ContentEdit.Root.get().bind("focus",function(){this._hide()}.bind(this)),document.addEventListener("keydown",function(ev){-1===[40,37,39,38,9,8,46,13,16,91,18].indexOf(ev.keyCode)&&this._hide()}.bind(this)),window.addEventListener("resize",function(){this._hide()}.bind(this))}return __extends(OverlayRow,_super),OverlayRow.showOnTaint=!1,OverlayRow.prototype.createElement=function(){var element=document.createElement("DIV");return this._topMargin=document.createElement("DIV"),this._topMargin.classList.add("nhb-overlay-margin-top"),this._topMargin.addEventListener("mouseenter",function(){this._domElement.classList.add("nhb-over-margin-top")}.bind(this)),this._topMargin.addEventListener("mouseleave",function(){this._domElement.classList.remove("nhb-over-margin-top")}.bind(this)),element.appendChild(this._topMargin),this._bottomMargin=document.createElement("DIV"),this._bottomMargin.classList.add("nhb-overlay-margin-bottom"),this._bottomMargin.addEventListener("mouseenter",function(){this._domElement.classList.add("nhb-over-margin-bottom")}.bind(this)),this._bottomMargin.addEventListener("mouseleave",function(){this._domElement.classList.remove("nhb-over-margin-bottom")}.bind(this)),element.appendChild(this._bottomMargin),this._columnWidths=[],this._columnLabels=[],element},OverlayRow.prototype.canApply=function(element){if(!OverlayRow.__super__.canApply.call(this,element))return!1;if(element||(element=this.element),!element)return!1;if("DivRow"===element.constructor.name)return!0;var parent=element.parent();for(element=null;parent&&"Region"!==parent.constructor.name;){if("DivRow"===parent.constructor.name){element=parent;break}parent=parent.parent()}if(element){if(element.parent()&&"Div"===element.parent().constructor.name)return!1;if("DivRow"===element.constructor.name)return!0}return!1},OverlayRow.prototype.updatePosition=function(element){var rect=element._domElement.getBoundingClientRect(),toolbar=getComputedStyle(document.querySelector(".nhb-toolbox-bar")),toolbarHeight=parseInt(toolbar.height,10),scrollY=window.scrollY||window.pageYOffset;this._domElement.style.top=rect.top+scrollY-toolbarHeight+"px",this._domElement.style.height=rect.height+"px",this._domElement.style.left=rect.left+"px",this._domElement.style.width=rect.width+"px"},OverlayRow.prototype.hide=function(){OverlayRow.__super__.hide.call(this),clearInterval(this._updatePositionTimeout)},OverlayRow.prototype.show=function(element){if(element){if("DivRow"!==element.constructor.name){for(element=element.parent();element&&"Region"!==element.constructor.name&&"DivRow"!==element.constructor.name;)element=element.parent();if(!element||"Region"===element.constructor.name)return void this._hide();this.element=element}if(!this._alreadyShown){this._alreadyShown=!0,setTimeout(function(){this._alreadyShown=!1}.bind(this)),element=this.element,clearInterval(this._updatePositionTimeout),this._updatePositionTimeout=setInterval(function(){this.updatePosition(this.element)}.bind(this),60),this._topMargin.style.display="",this._bottomMargin.style.display="","Div"===element.parent().constructor.name?(this._topMargin.style.display="none",this._bottomMargin.style.display="none"):"TabPanelContainer"===element.parent().constructor.name&&(this._topMargin.style.display="none",this._bottomMargin.style.display="none");var styles=getComputedStyle(element._domElement),rect=element._domElement.getBoundingClientRect();this._domElement.classList.remove("nhb-active-margin-top"),this._domElement.classList.remove("nhb-active-margin-bottom"),this.updatePosition(element),this._topMargin.setAttribute("data-label",nhbParams.labels.margin+": "+styles.marginTop),this._topMargin.style.height=styles.marginTop,this._topMargin.setAttribute("data-value","margin-"+styles.marginTop),this._bottomMargin.setAttribute("data-label",nhbParams.labels.margin+": "+styles.marginBottom),this._bottomMargin.style.height=styles.marginBottom,this._bottomMargin.setAttribute("data-value","margin-"+styles.marginBottom);var i,margin,columnRect,totalWidth=0,totalWidthNoMargin=0;for(i=this._columnWidths.length-1;i>=0;i--)this._columnWidths[i].parentNode.removeChild(this._columnWidths[i]);for(i=this._columnLabels.length-1;i>=0;i--)this._columnLabels[i].parentNode.removeChild(this._columnLabels[i]);this._columnWidths=[],this._columnLabels=[];var rowLeftPadding=parseInt(element.style("padding-left"),10);for(i=0;i<element.children.length-1;i++){var o=document.createElement("DIV");o.classList.add("nhb-overlay-column-width-"+i),o.classList.add("nhb-overlay-column-width"),o._index=i,o._this=this,rect.height>100?o.setAttribute("data-label",nhbParams.labels.column_width):o.setAttribute("data-label",nhbParams.labels.width),o.addEventListener("mouseenter",function(){this._this._domElement.classList.add("nhb-over-column-width-"+this._index),this._this._domElement.classList.add("nhb-overlay-column-width")}),o.addEventListener("mouseleave",function(){this._this._domElement.classList.remove("nhb-over-column-width-"+this._index),this._this._domElement.classList.remove("nhb-overlay-column-width")}),columnRect=element.children[i]._domElement.getBoundingClientRect(),totalWidth+=columnRect.width,totalWidthNoMargin+=columnRect.width,o.style.left=rowLeftPadding+totalWidth+"px",element.children[i]._domElement.style.marginRight&&(margin=parseInt(element.children[i]._domElement.style.marginRight,10),totalWidth+=margin,o.style.width=margin+"px",o.style.marginLeft="0px"),this._domElement.appendChild(o),this._columnWidths.push(o)}for(element.children.length&&(columnRect=element.children[element.children.length-1]._domElement.getBoundingClientRect(),totalWidthNoMargin+=columnRect.width),totalWidth=0,i=0;i<element.children.length;i++){columnRect=element.children[i]._domElement.getBoundingClientRect();var label=document.createElement("DIV");label.classList.add("nhb-overlay-column-label"),label.innerHTML=(columnRect.width/totalWidthNoMargin*100).toFixed(1)+"%",i?label.style.left=rowLeftPadding+totalWidth+"px":label.style.left=totalWidth+"px",totalWidth+=columnRect.width,element.children[i]._domElement.style.marginRight&&(totalWidth+=parseInt(element.children[i]._domElement.style.marginRight,10)),this._domElement.appendChild(label),this._columnLabels.push(label)}}}},OverlayRow.prototype.onMoveStart=function(){var styles=getComputedStyle(this.element._domElement);this.marginTopInitialValue=parseInt(styles.marginTop,10),this.marginBottomInitialValue=parseInt(styles.marginBottom,10),this.columnWidthInitialValues=[];for(var i=0;i<this.element.children.length;i++){var rect=this.element.children[i]._domElement.getBoundingClientRect();this.columnWidthInitialValues.push(rect.width)}},OverlayRow.prototype.onMove=function(){var margin,remainder,rect,totalWidth,totalWidthNoMargin,i;if(rect=this.element._domElement.getBoundingClientRect(),"margin-top"===this._locationDragging)margin=this.deltaY+this.marginTopInitialValue,window.nhbEditor.isShiftDown&&(remainder=margin%10,margin-=remainder),this.element.style("margin-top",margin+"px"),this._topMargin.setAttribute("data-label",nhbParams.labels.margin+": "+margin+"px"),this._topMargin.style.height=margin+"px",this._topMargin.setAttribute("data-value","margin-"+margin+"px");else if("margin-bottom"===this._locationDragging)margin=this.deltaY+this.marginBottomInitialValue,window.nhbEditor.isShiftDown&&(remainder=margin%10,margin-=remainder),this.element.style("margin-bottom",margin+"px"),rect.width>100?this._bottomMargin.setAttribute("data-label",nhbParams.labels.margin+": "+margin+"px"):this._bottomMargin.setAttribute("data-label",margin+"px"),this._bottomMargin.style.height=margin+"px",this._bottomMargin.setAttribute("data-value","margin-"+margin+"px");else if(0===this._locationDragging.indexOf("column-")){var width=this.deltaX+this.columnWidthInitialValues[this._columnDragging];window.nhbEditor.isShiftDown&&(remainder=width%10,width-=remainder);var change=this.columnWidthInitialValues[this._columnDragging]-width;for(totalWidth=0,totalWidthNoMargin=0,i=0;i<this.element.children.length;i++){var colRect=this.element.children[i]._domElement.getBoundingClientRect();totalWidth+=colRect.width,totalWidthNoMargin+=colRect.width,i<this.element.children.length-1&&(this._columnWidths[i].style.left=totalWidth+"px",this.element.children[i]._domElement.style.marginRight&&(totalWidth+=parseInt(this.element.children[i]._domElement.style.marginRight,10)))}for(this.element._domElement.classList.add("nhb-overlay-changing-cols"),i=0;i<this.element.children.length;i++)this.element.children[i].style("flex-grow",""),i===this._columnDragging?this.element.children[i].style("flex-basis",width/totalWidthNoMargin*100+"%"):i===this._columnDragging+1?this.element.children[i].style("flex-basis",(this.columnWidthInitialValues[i]+change)/totalWidthNoMargin*100+"%"):this.element.children[i].style("flex-basis",this.columnWidthInitialValues[i]/totalWidthNoMargin*100+"%")}rect=this.element._domElement.getBoundingClientRect();var toolbar=getComputedStyle(document.querySelector(".nhb-toolbox-bar")),toolbarHeight=parseInt(toolbar.height,10),scrollY=window.scrollY||window.pageYOffset;this._domElement.style.top=rect.top+scrollY-toolbarHeight+"px",this._domElement.style.height=rect.height+"px",this._domElement.style.left=rect.left+"px",this._domElement.style.width=rect.width+"px";var columnRect,rowLeftPadding=parseInt(this.element.style("padding-left"),10);for(totalWidthNoMargin=0,totalWidth=0,i=0;i<this.element.children.length;i++)columnRect=this.element.children[i]._domElement.getBoundingClientRect(),totalWidthNoMargin+=columnRect.width;for(i=0;i<this.element.children.length;i++)columnRect=this.element.children[i]._domElement.getBoundingClientRect(),this._columnLabels[i].classList.add("nhb-overlay-column-label"),this._columnLabels[i].innerHTML=(columnRect.width/totalWidthNoMargin*100).toFixed(1)+"%",i?this._columnLabels[i].style.left=rowLeftPadding+totalWidth+"px":this._columnLabels[i].style.left=totalWidth+"px",totalWidth+=columnRect.width,this.element.children[i]._domElement.style.marginRight&&(totalWidth+=parseInt(this.element.children[i]._domElement.style.marginRight,10))},OverlayRow.prototype.applyTo=function(element){if(this._alreadyShown2)return this.element;if(this._alreadyShown2=!0,setTimeout(function(){this._alreadyShown2=!1}.bind(this)),!element)return element;if("DivRow"!==element.constructor.name)for(element=element.parent();element&&"Region"!==element.constructor.name;){if("DivRow"===element.constructor.name)return element;element=element.parent()}return element},OverlayRow.prototype._mouseup=function(){OverlayRow.__super__._mouseup.call(this),this.element&&this.element._domElement&&this.element._domElement.classList.remove("nhb-overlay-changing-cols"),this._domElement.classList.remove("nhb-active-overlay-column")},OverlayRow.prototype.onClick=function(ev){var i;if(this._locationDragging=null,this._domElement.classList.remove("nhb-active-overlay-column"),ev.target===this._topMargin)this._locationDragging="margin-top";else if(ev.target===this._bottomMargin)this._locationDragging="margin-bottom";else for(i=0;i<this._columnWidths.length;i++)if(ev.target===this._columnWidths[i]){this._locationDragging="column-"+this._columnWidths[i]._index,this._columnDragging=this._columnWidths[i]._index,this._domElement.classList.add("nhb-active-overlay-column");break}for(this._domElement.classList.remove("nhb-active-margin-top"),this._domElement.classList.remove("nhb-active-margin-bottom"),i=0;10>i;i++)this._domElement.classList.remove("nhb-active-column-"+i);this._locationDragging&&this._domElement.classList.add("nhb-active-"+this._locationDragging)},OverlayRow}(nhbEditor.Overlay),function(){var _Root=ContentEdit.Root.get(),proxiedGetDropPlacement=_Root._getDropPlacement;_Root._getDropPlacement=function(x,y){var placement=proxiedGetDropPlacement.call(this,x,y);return placement&&(placement[1]="center",showDropIndicator(placement)),placement};var proxiedCancelDragging=_Root.cancelDragging;_Root.cancelDragging=function(){return this._dragging&&hideDropIndicator(),proxiedCancelDragging.call(this)};var proxiedOnStopDragging=_Root._onStopDragging;_Root._onStopDragging=function(ev){return proxiedOnStopDragging.call(this,ev)};var proxiedOnMouseOut=ContentEdit.Element.prototype._onMouseOut;ContentEdit.Element.prototype._onMouseOut=function(ev){var ret=proxiedOnMouseOut.call(this,ev),root=ContentEdit.Root.get();return root.dragging()&&hideDropIndicator(),ret};var proxiedOnMouseOver=ContentEdit.Element.prototype._onMouseOver;ContentEdit.Element.prototype._onMouseOver=function(ev){var ret=proxiedOnMouseOver.call(this,ev),root=ContentEdit.Root.get();return root.dragging()===this&&(hideDropIndicator(),ev.stopPropagation(),ev.preventDefault()),ret};var proxiedDrop=ContentEdit.Element.prototype.drop;ContentEdit.Element.prototype.drop=function(element,placement){var ret=proxiedDrop.call(this,element,placement);return element&&hideDropIndicator(),ret};var indicatorTimeout=null,dropIndicator=null,prevDropTarget=null,prevDropPlacement=null,showDropIndicator=function(placement){var root=ContentEdit.Root.get();dropIndicator||(dropIndicator=document.createElement("DIV"),dropIndicator.classList.add("nhb-drop-indicator"),dropIndicator.appendChild(document.createElement("SPAN")),dropIndicator.appendChild(document.createElement("SPAN")));var dropTargetDom=root._dropTarget._domElement;if(prevDropTarget!==dropTargetDom||prevDropPlacement!==placement[0]){prevDropTarget=dropTargetDom,prevDropPlacement=placement[0],clearTimeout(indicatorTimeout),dropIndicator.firstChild.innerHTML=nhbParams.labels.move_above_s.replace(/%s/,root._dropTarget.typeName()),dropIndicator.firstChild.nextSibling.innerHTML=nhbParams.labels.move_below_s.replace(/%s/,root._dropTarget.typeName());var styles=getComputedStyle(root._dropTarget._domElement),rect=root._dropTarget._domElement.getBoundingClientRect(),toolbar=getComputedStyle(document.querySelector(".nhb-toolbox-bar")),toolbarHeight=parseInt(toolbar.height,10),scrollY=window.scrollY||window.pageYOffset;dropIndicator.classList.remove("nhb-drop-indicator-small"),rect.height+parseInt(styles.marginTop,10)+parseInt(styles.marginBottom,10)<60&&dropIndicator.classList.add("nhb-drop-indicator-small"),dropIndicator.classList.remove("nhb-drop-indicator-above"),dropIndicator.classList.remove("nhb-drop-indicator-below"),dropIndicator.classList.add("nhb-drop-indicator-"+placement[0]),"P"===dropTargetDom.tagName&&"DIV"===dropTargetDom.parentNode.tagName&&dropTargetDom.parentNode.classList&&dropTargetDom.classList&&dropTargetDom.parentNode.classList.contains("nhb-col")&&dropTargetDom.classList.contains("ce-element--empty")&&(dropIndicator.firstChild.innerHTML=nhbParams.labels.move_inside_column,dropIndicator.firstChild.nextSibling.innerHTML=nhbParams.labels.move_inside_column,dropIndicator.classList.remove("nhb-drop-indicator-above"),dropIndicator.classList.add("nhb-drop-indicator-below"));var marginTop=0;parseInt(styles.marginTop,10)>0&&(marginTop=parseInt(styles.marginTop,10)),dropIndicator.style.top=rect.top+scrollY-toolbarHeight-32-marginTop+"px",dropIndicator.style.left=rect.left+"px",dropIndicator.style.width=rect.width+"px",dropIndicator.style.height=rect.height+marginTop+parseInt(styles.marginBottom,10)+"px",setTimeout(function(){dropIndicator&&dropIndicator.classList.add("nhb-drop-indicator-show")},10),document.body.appendChild(dropIndicator)}},hideDropIndicator=function(){prevDropTarget=null,prevDropPlacement=null,clearTimeout(indicatorTimeout),indicatorTimeout=setTimeout(function(){dropIndicator&&(document.body.removeChild(dropIndicator),dropIndicator=null)},10)},proxiedStartDragging=_Root.startDragging;_Root.startDragging=function(element,x,y){var ret=proxiedStartDragging.call(this,element,x,y);if(this._dragging)return setTimeout(function(){this._draggingDOMElement&&this._draggingDOMElement.classList.add("nhb-drag-helper-show")}.bind(this),10),ret};var nhbOverElement=_.throttle(function(ev){var root=ContentEdit.Root.get();if(root.dragging()){if(window.nhbSelectorMatches(ev.target,".ct-widget, .ct-widget *"))return hideDropIndicator(),void(root._dropTarget=null);var elements=document.querySelectorAll(".nhb-main-wrapper > .ce-element, .nhb-main-wrapper > [data-ce-tag]"),pointerX=ev.pageX,pointerY=ev.pageY,closestDistance=999999999,closestElement=null,placement=["above","center"],doExit=!1;Array.prototype.forEach.call(elements,function(el){if(el._ceElement&&el._ceElement!==root.dragging()){if(window.nhbSelectorMatches(el,".ce-element *, [data-ce-tag] *"))return void(doExit=!0);var elemX,elemY,rect=el.getBoundingClientRect(),scrollY=window.scrollY||window.pageYOffset,top=rect.top+scrollY,bottom=top+rect.height,left=rect.left,right=left+rect.width;elemY=top>=pointerY?top:pointerY>=bottom?bottom:pointerY,elemX=left>=pointerX?left:pointerX>=right?right:pointerX;var dist=Math.pow(pointerX-elemX,2)+Math.pow(pointerY-elemY,2);return 0===dist?void(doExit=!0):void(closestDistance>dist&&(closestDistance=dist,closestElement=el._ceElement,placement[0]=pointerY<=top+rect.height/2?"above":"below"))}}),doExit||closestElement&&(root._dropTarget=closestElement,showDropIndicator(placement))}},30),mouseListener=function(ev){nhbOverElement(ev)};ContentTools.EditorApp.get().bind("start",function(){window.addEventListener("mousemove",mouseListener),window.addEventListener("mouseover",mouseListener)}),ContentTools.EditorApp.get().bind("stop",function(){window.removeEventListener("mousemove",mouseListener),window.removeEventListener("mouseover",mouseListener)})}(),window.addEventListener("DOMContentLoaded",function(){for(var origTitles=[],findInThese=["h1","h2","h3","h4",""],titleMarkers=null,i=0;i<findInThese.length;i++)document.querySelectorAll(findInThese[i]+" [data-nhb-title-marker-post-id]").length&&(titleMarkers=document.querySelectorAll(findInThese[i]+" [data-nhb-title-marker-post-id]"));titleMarkers||(titleMarkers=document.querySelectorAll("[data-nhb-title-marker-post-id]"));var titles=[];if(Array.prototype.forEach.call(titleMarkers,function(marker){var titleElement=marker.parentNode,postID=marker.getAttribute("data-nhb-title-marker-post-id");titleElement.classList.add("nhb-title-editor"),titleElement.getAttribute("nhb-post-id",postID),titles.push(titleElement)}),titleMarkers=document.querySelectorAll("[data-nhb-title-marker-post-id]"),Array.prototype.forEach.call(titleMarkers,function(marker){marker.parentNode.removeChild(marker)}),titles.length){var editor=ContentTools.EditorApp.get();for(nhbEditor.Title=function(){function Title(domElement){this._domElement=domElement}return Title.prototype.mount=function(){this._domElement.setAttribute("contenteditable","true"),this._onPasteBound=Title.prototype._onPaste.bind(this),this._domElement.addEventListener("paste",this._onPasteBound),this._onKeyDownBound=Title.prototype._onKeyDown.bind(this),this._domElement.addEventListener("keydown",this._onKeyDownBound),this._onFocusBound=Title.prototype._onFocus.bind(this),this._domElement.addEventListener("focus",this._onFocusBound),this._onBlurBound=Title.prototype._onBlur.bind(this),this._domElement.addEventListener("blur",this._onBlurBound),this._onMouseEnterBound=Title.prototype._onMouseEnter.bind(this),this._domElement.addEventListener("mouseenter",this._onMouseEnterBound),this._onMouseLeaveBound=Title.prototype._onMouseLeave.bind(this),this._domElement.addEventListener("mouseleave",this._onMouseLeaveBound)},Title.prototype.unmount=function(){this._domElement.removeEventListener("paste",this._onKeyDownBound),this._domElement.removeEventListener("keydown",this._onKeyDownBound),this._domElement.removeEventListener("focus",this._onFocusBound),this._domElement.removeEventListener("blur",this._onBlurBound),this._domElement.removeEventListener("mouseenter",this._onMouseEnterBound),this._domElement.removeEventListener("mouseleave",this._onMouseLeaveBound),this._domElement.removeAttribute("contenteditable"),this._domElement.classList.remove("ce-element--focused")},Title.prototype._onKeyDown=function(ev){(ev.ctrlKey||ev.metaKey)&&(-1!==[82,73,66].indexOf(ev.keyCode)&&ev.preventDefault(),-1!==[90].indexOf(ev.keyCode)&&ev.stopPropagation())},Title.prototype._onPaste=function(ev){ev.preventDefault();var text="";ev.clipboardData||ev.originalEvent.clipboardData?text=(ev.originalEvent||ev).clipboardData.getData("text/plain"):window.clipboardData&&(text=window.clipboardData.getData("Text")),document.queryCommandSupported("insertText")?document.execCommand("insertText",!1,text):document.execCommand("paste",!1,text)},Title.prototype._onFocus=function(){var root=ContentEdit.Root.get();root.focused()&&root.focused().blur(),this._domElement.classList.add("ce-element--focused"),nhbEditor.Overlay.hideOtherOverlays(null)},Title.prototype._onBlur=function(){this._domElement.classList.remove("ce-element--focused")},Title.prototype._onMouseEnter=function(){wp.hooks.doAction("nhb.element.over",this)},Title.prototype._onMouseLeave=function(){},Title.prototype.parent=function(){return null},Title}(),i=0;i<titles.length;i++)titles[i]=new nhbEditor.Title(titles[i]);editor.bind("start",function(){origTitles=[];for(var i=0;i<titles.length;i++)titles[i].mount(),origTitles.push(titles[i]._domElement.textContent)}),editor.bind("stop",function(){for(var i=0;i<titles.length;i++)titles[i].unmount()}),wp.hooks.addAction("nhb.save.payload",function(payload){for(var i=titles.length-1;i>=0;i--)if(origTitles[i]!==titles[i]._domElement.textContent){payload.append("title",titles[i]._domElement.textContent);break}})}}),nhbEditor.Toolbar=function(_super){function Toolbar(elementName,tools){Toolbar.__super__.constructor.call(this),this.tools=tools,this.elementName=elementName}return __extends(Toolbar,_super),Toolbar.prototype.createElement=function(){var element=document.createElement("DIV");element.classList.add("nhb-overlay-toolbar"),element.classList.add("nhb-toolbar-"+this.elementName.toLowerCase().replace(/[^\w\d]/,"-"));var buttonContainer=document.createElement("DIV");buttonContainer.classList.add("nhb-toolbar-wrapper"),element.appendChild(buttonContainer),this._buttonContainer=buttonContainer;for(var tool,i=0;i<this.tools.length;i++)tool=document.createElement("DIV"),tool.classList.add("nhb-toolbar-tool"),this.tools[i].label?(tool.classList.add("nhb-toolbar-label"),tool.innerHTML=this.tools[i].label,buttonContainer.appendChild(tool)):(tool.classList.add("nhb-toolbar-tool-"+this.tools[i].id),this.tools[i].tooltip&&tool.setAttribute("data-tooltip",this.tools[i].tooltip),tool.toolbar=this,tool.tool=this.tools[i],tool.addEventListener("click",function(ev){this.tool.onClick&&(this.tool.onClick(tool.toolbar.element,this,ev),tool.toolbar.updatePosition(tool.toolbar.element))}.bind(tool)),tool.addEventListener("mousedown",function(ev){this.tool.onMouseDown&&(this.tool.onMouseDown(tool.toolbar.element,this,ev),tool.toolbar.updatePosition(tool.toolbar.element))}.bind(tool)),tool.addEventListener("mouseenter",function(ev){
this.tool.onEnter&&(this.tool.onEnter(tool.toolbar.element,tool.toolbar,ev),tool.toolbar.updatePosition(tool.toolbar.element))}.bind(tool)),buttonContainer.appendChild(tool));return element},Toolbar.prototype.canApply=function(element){if(!Toolbar.__super__.canApply.call(this,element))return!1;if(element||(element=this.element),!element)return!1;if(element.constructor.name===this.elementName){for(var i=0;i<this.tools.length;i++)"function"==typeof this.tools[i].label&&(this._domElement.children[0].children[i].innerHTML=this.tools[i].label(element)),this._domElement.children[0].children[i].classList.remove("nhb-toolbar-tool-hide"),"function"==typeof this.tools[i].display&&(this.tools[i].display(element)||this._domElement.children[0].children[i].classList.add("nhb-toolbar-tool-hide"));return!0}return!1},Toolbar.prototype._updateFirstLastButtons=function(){var button=this._buttonContainer.querySelector(".nhb-toolbar-button-first");button&&button.classList.remove("nhb-toolbar-button-first"),button=this._buttonContainer.querySelector(".nhb-toolbar-button-last"),button&&button.classList.remove("nhb-toolbar-button-last");for(var i=0;i<this._buttonContainer.children.length;i++)if(0!==this._buttonContainer.children[i].offsetWidth){this._buttonContainer.children[i].classList.add("nhb-toolbar-button-first");break}for(i=this._buttonContainer.children.length-1;i>=0;i--)if(0!==this._buttonContainer.children[i].offsetWidth){this._buttonContainer.children[i].classList.add("nhb-toolbar-button-last");break}},Toolbar.prototype.show=function(element){Toolbar.__super__.show.call(this,element),this._updateFirstLastButtons()},Toolbar.prototype._mouseenter=function(ev){Toolbar.__super__._mouseenter.call(this,ev),this._updateFirstLastButtons()},Toolbar}(nhbEditor.OverlayControls),nhbEditor.ToolbarElement=function(_super){function ToolbarElement(){ToolbarElement.__super__.constructor.call(this,"Text",toolbars)}__extends(ToolbarElement,_super);var toolbars=[];return toolbars.push({id:"move",tooltip:nhbParams.labels.move,display:function(element){return!element.content.isWhitespace()},onMouseDown:function(element,toolbar,ev){ev.stopPropagation(),element.drag(ev.pageX,ev.pageY)}}),toolbars.push({id:"remove",tooltip:nhbParams.labels["delete"],onClick:function(element){element.parent().detach(element)}}),ToolbarElement}(nhbEditor.Toolbar),nhbEditor.ToolbarImage=function(_super){function ToolbarImage(){ToolbarImage.__super__.constructor.call(this,"Image",toolbars)}__extends(ToolbarImage,_super);var toolbars=[];return toolbars.push({id:"align-left",tooltip:nhbParams.labels.align_left,onClick:function(element){element.removeCSSClass("alignleft"),element.removeCSSClass("alignright"),element.removeCSSClass("aligncenter"),element.removeCSSClass("alignnone"),element.addCSSClass("alignleft")}},{id:"align-center",tooltip:nhbParams.labels.align_center,onClick:function(element){element.removeCSSClass("alignleft"),element.removeCSSClass("alignright"),element.removeCSSClass("aligncenter"),element.removeCSSClass("alignnone"),element.addCSSClass("aligncenter")}},{id:"align-right",tooltip:nhbParams.labels.align_right,onClick:function(element){element.removeCSSClass("alignleft"),element.removeCSSClass("alignright"),element.removeCSSClass("aligncenter"),element.removeCSSClass("alignnone"),element.addCSSClass("alignright")}},{id:"edit",tooltip:nhbParams.labels.edit,onClick:function(element){element.openMediaManager()}},{id:"remove",tooltip:nhbParams.labels["delete"],onClick:function(element){element.parent().detach(element)}}),ToolbarImage}(nhbEditor.Toolbar),nhbEditor.ToolbarNewsletter=function(_super){function ToolbarNewsletter(){ToolbarNewsletter.__super__.constructor.call(this,"Newsletter",[{label:nhbParams.labels.newsletter},{id:"move",tooltip:nhbParams.labels.move,onMouseDown:function(element,toolbar,ev){ev.stopPropagation(),element.drag(ev.pageX,ev.pageY)}},{id:"settings",tooltip:nhbParams.labels.properties,onClick:function(element){ContentTools.EditorApp.get()._toolboxProperties.inspect(element)}},{id:"remove",tooltip:nhbParams.labels["delete"],onClick:function(element){element.parent().detach(element)}}])}return __extends(ToolbarNewsletter,_super),ToolbarNewsletter}(nhbEditor.Toolbar),nhbEditor.ToolbarHtml=function(_super){function ToolbarHtml(){ToolbarHtml.__super__.constructor.call(this,"Html",[{label:nhbParams.labels.html},{id:"edit",tooltip:nhbParams.labels.edit,onClick:function(element){element.openEditor()}},{id:"remove",tooltip:nhbParams.labels["delete"],onClick:function(element){element.parent().detach(element)}}])}return __extends(ToolbarHtml,_super),ToolbarHtml}(nhbEditor.Toolbar),nhbEditor.ToolbarIframe=function(_super){function ToolbarIframe(){ToolbarIframe.__super__.constructor.call(this,"IFrame",[{label:nhbParams.labels.iframe},{id:"edit",tooltip:nhbParams.labels.edit,onClick:function(element){element._onDoubleClick()}},{id:"remove",tooltip:nhbParams.labels["delete"],onClick:function(element){element.parent().detach(element)}}])}return __extends(ToolbarIframe,_super),ToolbarIframe}(nhbEditor.Toolbar),nhbEditor.ToolbarEmbed=function(_super){function ToolbarEmbed(){ToolbarEmbed.__super__.constructor.call(this,"Embed",[{label:nhbParams.labels.embedded_url},{id:"edit",tooltip:nhbParams.labels.edit,onClick:function(element){element._onDoubleClick()}},{id:"remove",tooltip:nhbParams.labels["delete"],onClick:function(element){element.parent().detach(element)}}])}return __extends(ToolbarEmbed,_super),ToolbarEmbed}(nhbEditor.Toolbar),nhbEditor.ToolbarMap=function(_super){function ToolbarMap(){ToolbarMap.__super__.constructor.call(this,"Map",[{label:nhbParams.labels.map},{id:"settings",tooltip:nhbParams.labels.properties,onClick:function(element){ContentTools.EditorApp.get()._toolboxProperties.inspect(element)}},{id:"remove",tooltip:nhbParams.labels["delete"],onClick:function(element){element.parent().detach(element)}}])}return __extends(ToolbarMap,_super),ToolbarMap}(nhbEditor.Toolbar),nhbEditor.ToolbarIcon=function(_super){function ToolbarIcon(){ToolbarIcon.__super__.constructor.call(this,"Icon",[{label:nhbParams.labels.icon},{id:"settings",tooltip:nhbParams.labels.properties,onClick:function(element){ContentTools.EditorApp.get()._toolboxProperties.inspect(element)}},{id:"edit",tooltip:"Edit",onClick:function(element){element._onDoubleClick()}},{id:"clone",tooltip:nhbParams.labels.clone,onClick:function(element){element.clone()}},{id:"remove",tooltip:nhbParams.labels["delete"],onClick:function(element){element.parent().detach(element)}}])}return __extends(ToolbarIcon,_super),ToolbarIcon.prototype.canApply=function(element){var ret=ToolbarIcon.__super__.canApply.call(this,element);if(ret){this._domElement.classList.remove("nhb-small-toolbar");var rect=this._domElement.getBoundingClientRect();rect.width<130&&this._domElement.classList.add("nhb-small-toolbar")}return ret},ToolbarIcon}(nhbEditor.Toolbar),nhbEditor.ToolbarShortcode=function(_super){function ToolbarShortcode(){ToolbarShortcode.__super__.constructor.call(this,"Shortcode",[{label:function(element){var label=wp.hooks.applyFilters("nhb.toolbar.shortcode.label",element.sc_base);return nhbInspectorOptions.Shortcode[element.sc_base]&&nhbInspectorOptions.Shortcode[element.sc_base].label&&(label=wp.hooks.applyFilters("nhb.toolbar.shortcode.label",nhbInspectorOptions.Shortcode[element.sc_base].label)),label}},{id:"settings",tooltip:nhbParams.labels.properties,onClick:function(element){ContentTools.EditorApp.get()._toolboxProperties.inspect(element)}},{id:"edit",tooltip:nhbParams.labels.edit,onClick:function(element){element.convertToText()}},{id:"clone",tooltip:nhbParams.labels.clone,onClick:function(element){element.clone()}},{id:"remove",tooltip:nhbParams.labels["delete"],onClick:function(element){element.parent().detach(element)}}])}return __extends(ToolbarShortcode,_super),ToolbarShortcode}(nhbEditor.Toolbar),nhbEditor.ToolbarList=function(_super){function ToolbarList(){ToolbarList.__super__.constructor.call(this,"List",[{label:nhbParams.labels.list},{id:"move",tooltip:nhbParams.labels.move,onMouseDown:function(element,toolbar,ev){ev.stopPropagation(),element.drag(ev.pageX,ev.pageY)}},{id:"settings",tooltip:nhbParams.labels.properties,onClick:function(element){ContentTools.EditorApp.get()._toolboxProperties.inspect(element)}},{id:"remove",tooltip:nhbParams.labels["delete"],onClick:function(element){element.parent().detach(element)}}])}return __extends(ToolbarList,_super),ToolbarList}(nhbEditor.Toolbar),nhbEditor.ToolbarRow=function(_super){function ToolbarRow(){this._alreadyShown=!1,ToolbarRow.__super__.constructor.call(this,"DivRow",[{"class":"nhb-toolbar-yellow",display:function(element){return element.parent()?element.parent()._domElement.classList.contains("glide__slide"):void 0},label:function(){return nhbParams.labels.carousel}},{id:"move",tooltip:nhbParams.labels.move_carousel,"class":"nhb-toolbar-yellow",display:function(element){return element.parent()._domElement.classList.contains("glide__slide")},onMouseDown:function(element,toolbar,ev){ev.stopPropagation();var o=element.parent().parent().parent().parent();o.drag(ev.pageX,ev.pageY)}},{id:"settings",tooltip:nhbParams.labels.properties,"class":"nhb-toolbar-yellow",display:function(element){return element.parent()._domElement.classList.contains("glide__slide")},onClick:function(element){var o=element.parent().parent().parent().parent();ContentTools.EditorApp.get()._toolboxProperties.inspect(o)}},{id:"minus",tooltip:nhbParams.labels.remove_slide,"class":"nhb-toolbar-yellow",display:function(element){if(element.parent()._domElement.classList.contains("glide__slide")){var o=element.parent().parent().parent().parent();return o.numSlides()>1}return!1},onClick:function(element){var o=element.parent().parent().parent().parent();o.removeSlide(o.activeSlide())}},{id:"add",tooltip:nhbParams.labels.add_slide,"class":"nhb-toolbar-yellow",display:function(element){return element.parent()._domElement.classList.contains("glide__slide")},onClick:function(element){var o=element.parent().parent().parent().parent();o.addSlide()}},{id:"clone",tooltip:nhbParams.labels.clone_slide,"class":"nhb-toolbar-yellow",display:function(element){return element.parent()._domElement.classList.contains("glide__slide")},onClick:function(element){var o=element.parent().parent().parent().parent();o.cloneSlide(o.activeSlide())}},{id:"remove",tooltip:nhbParams.labels.delete_carousel,"class":"nhb-toolbar-yellow",display:function(element){return element.parent()._domElement.classList.contains("glide__slide")},onClick:function(element){var o=element.parent().parent().parent().parent();o.parent().detach(o)}},{label:nhbParams.labels.row},{id:"move",tooltip:nhbParams.labels.move,display:function(element){return element.parent()._domElement.classList.contains("glide__slide")?!1:"TabPanelContainer"===element.parent().constructor.name?!1:"Toggle"===element.parent().constructor.name?!1:!0},onMouseDown:function(element,toolbar,ev){ev.stopPropagation(),element.drag(ev.pageX,ev.pageY)}},{id:"settings",tooltip:nhbParams.labels.properties,onClick:function(element){ContentTools.EditorApp.get()._toolboxProperties.inspect(element)}},{id:"add",tooltip:nhbParams.labels.add_column,onClick:function(element){var overElement=element._domElement.querySelector(".ce-element--over");overElement&&overElement.classList.remove("ce-element--over");var col,root=ContentEdit.Root.get(),index=element.children.length+1;if(root.focused())for(col=root.focused();"Region"!==col.constructor.name&&"DivRow"!==col.constructor.name;){if("DivCol"===col.constructor.name){index=element.children.indexOf(col)+1;break}col=col.parent()}col=element.addNewColumn(index)}},{id:"clone",tooltip:nhbParams.labels.clone_row,display:function(element){return element.parent()._domElement.classList.contains("glide__slide")?!1:"TabPanelContainer"===element.parent().constructor.name?!1:"Toggle"===element.parent().constructor.name?!1:!0},onClick:function(element){var newRow=element.clone();window._nhbFixRowWidth(newRow._domElement)}},{id:"remove",tooltip:nhbParams.labels["delete"],display:function(element){return element.parent()._domElement.classList.contains("glide__slide")?!1:"TabPanelContainer"===element.parent().constructor.name?!1:"Toggle"===element.parent().constructor.name?!1:!0},onClick:function(element){element.parent().detach(element)}}])}return __extends(ToolbarRow,_super),ToolbarRow.prototype.canApply=function(element){if(ToolbarRow.__super__.show.call(this,this.element))return!0;if("undefined"==typeof element&&(element=this.element),!element)return!1;if("DivRow"===element.constructor.name)return!0;if(this._alreadyShown)return!0;if(setTimeout(function(){this._alreadyShown=!1}.bind(this),10),"DivRow"!==element.constructor.name){for(element=element.parent();element&&"Region"!==element.constructor.name&&"DivRow"!==element.constructor.name;)element=element.parent();return element&&"Region"!==element.constructor.name?(this.element=element,this._alreadyShown=!0,!0):void this._hide()}return element&&element.parent()&&"Div"===element.parent().constructor.name?!1:!1},ToolbarRow.prototype.applyTo=function(element){if("DivRow"!==element.constructor.name)for(element=element.parent();element&&"Region"!==element.constructor.name&&"DivRow"!==element.constructor.name;)element=element.parent();if("Region"===element.constructor.name)return null;if(this._alreadyShown2)return this.element;this._alreadyShown2=!0,setTimeout(function(){this._alreadyShown2=!1}.bind(this));for(var i=0;i<this.tools.length;i++)this.tools[i]["class"]&&this._domElement.children[0].children[i].classList.add(this.tools[i]["class"]),"function"==typeof this.tools[i].label&&(this._domElement.children[0].children[i].innerHTML=this.tools[i].label(element)),"function"==typeof this.tools[i].tooltip&&this._domElement.children[0].children[i].setAttribute("data-tooltip",this.tools[i].tooltip(element)),this._domElement.children[0].children[i].classList.remove("nhb-toolbar-tool-hide"),"function"==typeof this.tools[i].display&&(this.tools[i].display(element)||this._domElement.children[0].children[i].classList.add("nhb-toolbar-tool-hide"));return element},ToolbarRow}(nhbEditor.Toolbar),nhbEditor.ToolbarColumn=function(_super){function ToolbarColumn(){this._alreadyShown2=!1,ToolbarColumn.__super__.constructor.call(this,"DivCol",[{label:nhbParams.labels.column},{id:"settings",tooltip:nhbParams.labels.properties,onClick:function(element){ContentTools.EditorApp.get()._toolboxProperties.inspect(element)}},{id:"clone",tooltip:nhbParams.labels.clone,onClick:function(element){element._domElement.classList.remove("ce-element--over");var col=element.clone();col.focus(),col._domElement.classList.add("ce-element--over")}},{id:"remove",tooltip:nhbParams.labels["delete"],display:function(element){if(element.parent()&&element.parent().parent()){if(element.parent().parent()._domElement.classList.contains("glide__slide"))return element.parent().children.length>1;if("TabPanelContainer"===element.parent().parent().constructor.name)return element.parent().children.length>1;if("Toggle"===element.parent().parent().constructor.name)return element.parent().children.length>1}return!0},onClick:function(element){element.parent().detach(element)}}])}return __extends(ToolbarColumn,_super),ToolbarColumn.prototype.canApply=function(element){if(ToolbarColumn.__super__.show.call(this,this.element))return!0;if("undefined"==typeof element&&(element=this.element),!element)return!1;if("DivCol"===element.constructor.name)return!0;if(this._alreadyShown)return!0;if(setTimeout(function(){this._alreadyShown=!1}.bind(this)),"DivCol"!==element.constructor.name){for(element=element.parent();element&&"Region"!==element.constructor.name&&"DivCol"!==element.constructor.name;)element=element.parent();return element&&"Region"!==element.constructor.name?(this.element=element,this._alreadyShown=!0,!0):void this._hide()}return!1},ToolbarColumn.prototype.applyTo=function(element){if("DivCol"!==element.constructor.name)for(element=element.parent();element&&"Region"!==element.constructor.name&&"DivCol"!==element.constructor.name;)element=element.parent();if(this._alreadyShown2)return this.element;this._alreadyShown2=!0,setTimeout(function(){this._alreadyShown2=!1}.bind(this));for(var i=0;i<this.tools.length;i++)this._domElement.children[0].children[i].classList.remove("nhb-toolbar-tool-hide"),"function"==typeof this.tools[i].display&&(this.tools[i].display(element)||this._domElement.children[0].children[i].classList.add("nhb-toolbar-tool-hide"));return element},ToolbarColumn.prototype.show=function(element){ToolbarColumn.__super__.show.call(this,element),this.checkToolbarSize(element)},ToolbarColumn.prototype.checkToolbarSize=function(element){var colToolbar=document.querySelector(".nhb-toolbar-divcol.nhb-quick-action-overlay .nhb-toolbar-wrapper"),rowToolbar=document.querySelector(".nhb-toolbar-divrow.nhb-quick-action-overlay .nhb-toolbar-wrapper");this._domElement.classList.remove("nhb-small-toolbar"),rowToolbar.parentNode.classList.remove("nhb-small-toolbar"),this._domElement.classList.remove("nhb-smaller-toolbar"),rowToolbar.parentNode.classList.remove("nhb-smaller-toolbar"),this._domElement.classList.remove("nhb-tiny-toolbar"),rowToolbar.parentNode.classList.remove("nhb-tiny-toolbar");var ret=ToolbarColumn.__super__.show.call(this,element),colRect=colToolbar.getBoundingClientRect(),rowRect=rowToolbar.getBoundingClientRect();return colRect.left-rowRect.right<0?(colToolbar.parentNode.classList.add("nhb-small-toolbar"),rowToolbar.parentNode.classList.add("nhb-small-toolbar"),colRect=colToolbar.getBoundingClientRect(),rowRect=rowToolbar.getBoundingClientRect(),colRect.left-rowRect.right<0?(colToolbar.parentNode.classList.remove("nhb-small-toolbar"),rowToolbar.parentNode.classList.remove("nhb-small-toolbar"),colToolbar.parentNode.classList.add("nhb-smaller-toolbar"),rowToolbar.parentNode.classList.add("nhb-smaller-toolbar"),colRect=colToolbar.getBoundingClientRect(),rowRect=rowToolbar.getBoundingClientRect(),colRect.left-rowRect.right<0&&(colToolbar.parentNode.classList.remove("nhb-smaller-toolbar"),rowToolbar.parentNode.classList.remove("nhb-smaller-toolbar"),colToolbar.parentNode.classList.add("nhb-tiny-toolbar"),rowToolbar.parentNode.classList.add("nhb-tiny-toolbar")),ret):ret):ret},ToolbarColumn}(nhbEditor.Toolbar),nhbEditor.ToolbarTabContainer=function(_super){function ToolbarTabContainer(){ToolbarTabContainer.__super__.constructor.call(this,"TabContainer",toolbar)}__extends(ToolbarTabContainer,_super);var toolbar=[];return toolbar.push({label:nhbParams.labels.tabs},{id:"move",tooltip:nhbParams.labels.move,onMouseDown:function(element,toolbar,ev){ev.stopPropagation(),element.parent().drag(ev.pageX,ev.pageY)}},{id:"add",tooltip:nhbParams.labels.add_tab,onClick:function(element){element.parent().addTab()}}),toolbar.push({id:"remove",tooltip:nhbParams.labels["delete"],onClick:function(element){element.parent().parent().detach(element.parent())}}),ToolbarTabContainer.prototype.applyTo=function(element){element=ToolbarTabContainer.__super__.applyTo.call(this,element);var rect=element._domElement.getBoundingClientRect();return this._domElement.classList.remove("nhb-small-toolbar"),rect.width<100&&this._domElement.classList.add("nhb-small-toolbar"),element},ToolbarTabContainer}(nhbEditor.Toolbar),nhbEditor.ToolbarTable=function(_super){function ToolbarTable(){ToolbarTable.__super__.constructor.call(this,"Table",[{label:nhbParams.labels.table},{id:"move",tooltip:nhbParams.labels.move,onMouseDown:function(element,toolbar,ev){ev.stopPropagation(),element.drag(ev.pageX,ev.pageY)}},{id:"remove",tooltip:nhbParams.labels["delete"],onClick:function(element){element.parent().detach(element)}}])}return __extends(ToolbarTable,_super),ToolbarTable}(nhbEditor.Toolbar),nhbEditor.ToolbarTitle=function(_super){function ToolbarTitle(){ToolbarTitle.__super__.constructor.call(this,"Title",[{label:"Post Title"}])}return __extends(ToolbarTitle,_super),ToolbarTitle}(nhbEditor.Toolbar),nhbEditor.Tooltip=function(){function Tooltip(name,selector,labelFunction,tools){this._domElement=null,this.name=name||this.constructor.name.toLowerCase(),this.labelFunction=labelFunction||function(){},this.selector=selector||"",this.tools=tools||[],this.init()}return Tooltip.prototype.init=function(){this._onMouseOverBound=this._onMouseOver.bind(this),this._onMouseOutBound=this._onMouseOut.bind(this),ContentTools.EditorApp.get().bind("start",function(){this._domElement=document.createElement("DIV"),this._domElement.classList.add("nhb-tooltip--"+this.name),this._domElement.classList.add("nhb-tooltip");var label=document.createElement("DIV");this._domElement.appendChild(label);for(var i=0;i<this.tools.length;i++){var tool=document.createElement("DIV");tool.classList.add("nhb-tooltip-button"),tool.classList.add("nhb-tooltip-button-"+this.tools[i].name),tool.addEventListener("click",this.tools[i].onClick.bind(this)),this._domElement.appendChild(tool)}document.body.appendChild(this._domElement),document.addEventListener("mouseover",this._onMouseOverBound),document.addEventListener("mouseout",this._onMouseOutBound)}.bind(this)),ContentTools.EditorApp.get().bind("stop",function(){this.hide(),document.removeEventListener("mouseover",this._onMouseOverBound),document.removeEventListener("mouseout",this._onMouseOutBound),this._domElement.parentNode.removeChild(this._domElement),this._domElement=null}.bind(this))},Tooltip.prototype._onMouseOver=function(ev){if(nhbSelectorMatches(ev.target,".nhb-main-wrapper "+this.selector+", .nhb-main-wrapper "+this.selector+" *")){for(var target=ev.target;!nhbSelectorMatches(target,".nhb-main-wrapper "+this.selector);)target=target.parentNode;this.show(target)}},Tooltip.prototype._onMouseOut=function(ev){return ev.relatedTarget?void((!nhbSelectorMatches(ev.target,".nhb-main-wrapper "+this.selector)&&!nhbSelectorMatches(ev.target,".nhb-main-wrapper "+this.selector+" *")||ev.relatedTarget!==this._domElement&&!this._domElement.contains(ev.relatedTarget))&&(this._domElement!==ev.target&&!this._domElement.contains(ev.target)||!nhbSelectorMatches(ev.relatedTarget,".nhb-main-wrapper "+this.selector)&&!nhbSelectorMatches(ev.relatedTarget,".nhb-main-wrapper "+this.selector+" *"))&&(this._domElement!==ev.target&&!this._domElement.contains(ev.target)||this._domElement!==ev.relative&&!this._domElement.contains(ev.relatedTarget))&&this.hide()):void this.hide()},Tooltip.prototype.show=function(domElementTarget){var rect=domElementTarget.getBoundingClientRect(),toolbar=getComputedStyle(document.querySelector(".nhb-toolbox-bar")),toolbarHeight=parseInt(toolbar.height,10),scrollY=window.scrollY||window.pageYOffset;this._domElement.style.top=rect.top+scrollY-toolbarHeight+"px",this._domElement.style.left=rect.left+rect.width/2+"px","function"==typeof this.labelFunction?this._domElement.firstChild.innerHTML=this.labelFunction(domElementTarget):this._domElement.firstChild.innerHTML=this.labelFunction,this._domElement.classList.add("nhb-tooltip-show"),this.element=domElementTarget},Tooltip.prototype.hide=function(){this._domElement.classList.remove("nhb-tooltip-show")},Tooltip}(),nhbEditor.TooltipLink=function(_super){function TooltipLink(){TooltipLink.__super__.constructor.call(this,"link",".ce-element--type-text a:not(.nhb-button)",function(element){var link=element.getAttribute("href");return link.length>70&&(link=link.substr(0,70)+"..."),link},[{name:"visit",onClick:function(){window.open(this.element.getAttribute("href"),"_linktool"),this.hide()}},{name:"edit",onClick:function(){for(var domElement=this.element;!domElement._ceElement;)domElement=domElement.parentNode;var index=domElement._ceElement.content.indexOf(this.element.innerHTML),selection=new ContentSelect.Range(index,index);selection.select(domElement),window.nhbEditor.getToolUI("link").apply(domElement._ceElement,selection,function(){}),this.hide()}},{name:"unlink",onClick:function(){for(var domElement=this.element;!domElement._ceElement;)domElement=domElement.parentNode;var index=domElement._ceElement.content.indexOf(this.element.innerHTML),selected=ContentTools.Tools.Link.getSelectedLink(domElement._ceElement,index,index),from=selected.from,to=selected.to;domElement._ceElement.content=domElement._ceElement.content.unformat(from,to,"a"),domElement._ceElement.updateInnerHTML(),domElement._ceElement.taint(),this.hide()}}])}return __extends(TooltipLink,_super),TooltipLink}(nhbEditor.Tooltip),nhbEditor.TooltipButton=function(_super){function TooltipButton(){TooltipButton.__super__.constructor.call(this,"button","a.nhb-button",function(element){var link=element.getAttribute("href");return link.length>70&&(link=link.substr(0,70)+"..."),link},[{name:"settings",onClick:function(){ContentTools.EditorApp.get()._toolboxProperties.inspect(this.element)}},{name:"visit",onClick:function(){window.open(this.element.getAttribute("href"),"_linktool"),this.hide()}},{name:"edit",onClick:function(){for(var domElement=this.element;!domElement._ceElement;)domElement=domElement.parentNode;var index=domElement._ceElement.content.indexOf(this.element.innerHTML),selection=new ContentSelect.Range(index,index);selection.select(domElement),window.nhbEditor.getToolUI("link").apply(domElement._ceElement,selection,function(){}),this.hide()}},{name:"unlink",onClick:function(){for(var domElement=this.element;!domElement._ceElement;)domElement=domElement.parentNode;var index=domElement._ceElement.content.indexOf(this.element.innerHTML),selected=ContentTools.Tools.Link.getSelectedLink(domElement._ceElement,index,index),from=selected.from,to=selected.to;domElement._ceElement.content=domElement._ceElement.content.unformat(from,to,"a"),domElement._ceElement.updateInnerHTML(),domElement._ceElement.taint(),this.hide()}}])}return __extends(TooltipButton,_super),TooltipButton}(nhbEditor.Tooltip),nhbEditor.TooltipInput=function(_super){function TooltipInput(){TooltipInput.__super__.constructor.call(this,"input",'p[class*="ce-element--"] input[type="text"]',nhbParams.labels.input_field,[{name:"settings",onClick:function(){ContentTools.EditorApp.get()._toolboxProperties.inspect(this.element)}}])}return __extends(TooltipInput,_super),TooltipInput}(nhbEditor.Tooltip),nhbEditor.TooltipTab=function(_super){function TooltipTab(){TooltipTab.__super__.constructor.call(this,"button",'[data-ce-tag="tab"]',nhbParams.labels.tab,[{name:"remove",onClick:function(){this.element._ceElement.parent().parent().removeTab(this.element._ceElement),this.hide()}}])}return __extends(TooltipTab,_super),TooltipTab}(nhbEditor.Tooltip),document.addEventListener("DOMContentLoaded",function(){ContentEdit.Root.get().bind("detach",function(){"undefined"!=typeof AOS&&AOS.refresh()})}),nhbEditor.allDroppers={Carousel:ContentEdit.Element._dropVert,DivRow:ContentEdit.Element._dropVert,Div:ContentEdit.Element._dropVert,Embed:ContentEdit.Element._dropVert,Hr:ContentEdit.Element._dropVert,IFrame:ContentEdit.Element._dropVert,Shortcode:ContentEdit.Element._dropVert,Static:ContentEdit.Element._dropVert,Text:ContentEdit.Element._dropVert,Image:ContentEdit.Element._dropVert,List:ContentEdit.Element._dropVert,PreText:ContentEdit.Element._dropVert,Table:ContentEdit.Element._dropVert,Video:ContentEdit.Element._dropVert,Tabs:ContentEdit.Element._dropVert,Toggle:ContentEdit.Element._dropVert},nhbEditor.isNewStaticLikeElement=function(element){return"Static"===element.constructor.name?!1:"undefined"==typeof element._content?!1:!0},ContentEdit.Text.prototype._elementOverrideKeyLeft=ContentEdit.Text.prototype._keyLeft,ContentEdit.Text.prototype._keyLeft=function(ev){var selection=ContentSelect.Range.query(this._domElement);if(0===selection.get()[0]){var elem=this.previousContent();if(elem&&nhbEditor.isNewStaticLikeElement(elem))return ev.preventDefault(),ev.stopPropagation(),void elem.focus()}return this._elementOverrideKeyLeft(ev)},ContentEdit.Text.prototype._elementOverrideKeyRight=ContentEdit.Text.prototype._keyRight,ContentEdit.Text.prototype._keyRight=function(ev){var selection=ContentSelect.Range.query(this._domElement);if(this._atEnd(selection)){var elem=this.nextContent();if(elem&&nhbEditor.isNewStaticLikeElement(elem))return ev.preventDefault(),ev.stopPropagation(),void elem.focus()}return this._elementOverrideKeyRight(ev)},window.addEventListener("DOMContentLoaded",function(){var editor=ContentEdit.Root.get();document.addEventListener("keydown",function(ev){if(editor.focused()&&(!ev.target||-1===["INPUT","TEXTAREA"].indexOf(ev.target.tagName))&&nhbEditor.isNewStaticLikeElement(editor.focused())&&-1!==["body","html"].indexOf(ev.target.tagName.toLowerCase())&&-1===[16,17,18,91,92].indexOf(ev.which)){var p,elem,parent,selection,sc=editor.focused(),index=sc.parent().children.indexOf(sc);if(-1!==[13,8,46].indexOf(ev.which)&&ev.preventDefault(),8===ev.which?(sc.blur(),sc.parent().children[index-1]?(elem=sc.parent().children[index-1],elem.focus(),elem.content&&(selection=new ContentSelect.Range(elem.content.length(),elem.content.length()),selection.select(elem._domElement))):sc.parent().children[index+1]?(elem=sc.parent().children[index+1],elem.focus(),elem.content&&(selection=new ContentSelect.Range(elem.content.length(),elem.content.length()),selection.select(elem._domElement))):(parent=sc.parent(),setTimeout(function(){parent.children[0].focus()},10))):46===ev.which&&(sc.blur(),sc.parent().children[index+1]?sc.parent().children[index+1].focus():sc.parent().children[index-1]?sc.parent().children[index-1].focus():(parent=sc.parent(),setTimeout(function(){parent.children[0].focus()},10))),8===ev.which||46===ev.which)return void sc.parent().detach(sc);if((40===ev.which||39===ev.which)&&sc.nextContent()&&sc.parent().children.indexOf(sc)!==sc.parent().children.length-1)return ev.preventDefault(),void sc.nextContent().focus();if((38===ev.which||37===ev.which)&&sc.previousContent()&&0!==sc.parent().children.indexOf(sc))return ev.preventDefault(),void sc.previousContent().focus();38!==ev.which&&37!==ev.which&&index++,p=new ContentEdit.Text("p"),sc.parent().attach(p,index),sc.blur(),p.focus()}})}),ContentEdit.Node.prototype._overridePreviousContent=ContentEdit.Node.prototype.previousContent,ContentEdit.Node.prototype.previousContent=function(){var node=this.previousWithTest(function(node){return void 0!==node.content||nhbEditor.isNewStaticLikeElement(node)});return node},ContentEdit.Node.prototype._overrideNextContent=ContentEdit.Node.prototype.nextContent,ContentEdit.Node.prototype.nextContent=function(){return this.nextWithTest(function(node){return void 0!==node.content||nhbEditor.isNewStaticLikeElement(node)})},function(){var proxied=ContentEdit.Element.prototype._addDOMEventListeners;ContentEdit.Element.prototype._addDOMEventListeners=function(){return this._syncContent&&(this._domElement.oninput=function(){return this._syncContent?this._syncContent():void 0}.bind(this)),proxied.call(this)}}(),function(){var proxied=ContentEdit.Static.prototype._onMouseUp;ContentEdit.Static.prototype._onMouseUp=function(ev){proxied.call(this,ev),clearTimeout(this._dragTimeout),clearTimeout(this._doubleClickTimeout),this._doubleClickTimeout=setTimeout(function(_this){return function(){_this._doubleClickCount=0}}(this),500),this._doubleClickCount++}}(),function(){var proxied=ContentEdit.Static.prototype._onMouseOut;ContentEdit.Static.prototype._onMouseOut=function(ev){proxied.call(this,ev),this._doubleClickCount=0,clearTimeout(this._dragTimeout)}}(),function(){var proxied=ContentEdit.Static.prototype._onMouseMove;ContentEdit.Static.prototype._onMouseMove=function(ev){proxied.call(this,ev),this._doubleClickCount=0}}(),function(){var proxied=ContentEdit.Static.prototype._onMouseDown;ContentEdit.Static.prototype._onMouseDown=function(ev){ev.preventDefault(),ev.stopPropagation(),proxied.call(this,ev),clearTimeout(this._dragTimeout),this.domElement()===ev.target&&(this._dragTimeout=setTimeout(function(_this){return function(){return _this.drag(ev.pageX,ev.pageY)}}(this),ContentEdit.DRAG_HOLD_DURATION/2),
clearTimeout(this._doubleClickTimeout),this._doubleClickTimeout=setTimeout(function(_this){return function(){_this._doubleClickCount=0}}(this),500),this._doubleClickCount++,3===this._doubleClickCount&&(clearTimeout(this._dragTimeout),this._doubleClickCount=0,"function"==typeof this._onDoubleClick&&this._onDoubleClick(ev)))}}(),ContentEdit.Static.prototype.convertToText=function(text,keepSize){"undefined"==typeof keepSize&&(keepSize=!1);var elem=document.createElement("P");elem.innerHTML=text,elem=ContentEdit.Text.fromDOMElement(elem),this.blur();var index=this.parent().children.indexOf(this),rect=this._domElement.getBoundingClientRect(),marginBottom=0;if(this._domElement.nextElementSibling){var nextRect=this._domElement.nextElementSibling.getBoundingClientRect();marginBottom=nextRect.top-rect.bottom}return this.parent().attach(elem,index),this.parent().detach(this),keepSize&&(elem._domElement.style.minHeight=rect.height+"px",elem._domElement.style.marginBottom=marginBottom+"px"),elem.focus(),function(elem){setTimeout(function(){var selection=new ContentSelect.Range(elem.content.length(),elem.content.length());elem._domElement&&selection.select(elem._domElement)},1)}(elem),elem},ContentEdit.StaticEditable=function(_super){function StaticEditable(tagName,attributes,content){this._doubleClickCount=0,StaticEditable.__super__.constructor.call(this,tagName,attributes),this._content=content}return __extends(StaticEditable,_super),StaticEditable.droppers=nhbEditor.allDroppers,StaticEditable.prototype.blur=function(){var root=ContentEdit.Root.get();return this.isFocused()?(this._removeCSSClass("ce-element--focused"),root._focused=null,root.trigger("blur",this)):void 0},StaticEditable.prototype._onMouseOver=function(ev){return StaticEditable.__super__._onMouseOver.call(this,ev),this._addCSSClass("ce-element--over")},StaticEditable.prototype.focus=function(supressDOMFocus){var root;return root=ContentEdit.Root.get(),this.isFocused()?void 0:(root.focused()&&root.focused().blur(),this._addCSSClass("ce-element--focused"),root._focused=this,this.isMounted()&&!supressDOMFocus&&this.domElement().focus(),root.trigger("focus",this))},StaticEditable.prototype.cssTypeName=function(){return"staticeditable"},StaticEditable.prototype.typeName=function(){return"StaticEditable"},StaticEditable}(ContentEdit.Static),function(){var proxied=ContentEdit.Text.prototype._keyReturn;ContentEdit.Text.prototype._keyReturn=function(ev){if(ev.preventDefault(),this.content.isWhitespace())return proxied.call(this,ev);if(ev.shiftKey||ev.metaKey||ev.ctrlKey){ContentSelect.Range.query(this._domElement);var selection=ContentSelect.Range.query(this._domElement),tip=this.content.substring(0,selection.get()[0]),tail=this.content.substring(selection.get()[1]),cursor=selection.get()[0]+1,br=new HTMLString.String("<br><br>",!0);return 0!==tail.length()&&(br=new HTMLString.String("<br>",!0)),this.content=tip.concat(br,tail),this.updateInnerHTML(),selection.set(cursor,cursor),this.selection(selection),this.taint()}return proxied.call(this,ev)}}(),function(){ContentEdit.Text.prototype._onMouseDown=function(ev){return this.isFocused()&&this.content.isWhitespace()?void ev.preventDefault():(ContentEdit.Text.__super__._onMouseDown.call(this),this.content.isWhitespace()?void setTimeout(function(){var selection=new ContentSelect.Range(0,0);selection.select(this.domElement())}.bind(this),10):(clearTimeout(this._dragTimeout),this._dragTimeout=setTimeout(function(_this){return function(){return _this.drag(ev.pageX,ev.pageY)}}(this),ContentEdit.DRAG_HOLD_DURATION)))};var proxied=ContentEdit.Text.prototype._onMouseUp;ContentEdit.Text.prototype._onMouseUp=function(ev){proxied.call(this,ev),this.content.isWhitespace()&&ev.preventDefault()}}(),function(){var bringBackState=!1,mouseDownHandler=function(ev){if(!ev.target._ceElement&&window.nhbSelectorMatches(ev.target,"[data-editable]")){var root=ContentEdit.Root.get(),element=root.focused();if(!element)return;element.storeState(),bringBackState=!0}},mouseUpHandler=function(){if(bringBackState){bringBackState=!1;var root=ContentEdit.Root.get(),element=root.focused();if(!element)return;element.restoreState()}},proxiedFocus=ContentEdit.Text.prototype.focus;ContentEdit.Text.prototype.focus=function(supressDOMFocus){var ret=proxiedFocus.call(this,supressDOMFocus);return document.addEventListener("mousedown",mouseDownHandler),document.addEventListener("mouseup",mouseUpHandler),ret};var proxiedBlur=ContentEdit.Text.prototype.blur;ContentEdit.Text.prototype.blur=function(){var ret=proxiedBlur.call(this);return document.removeEventListener("mousedown",mouseDownHandler),document.removeEventListener("mouseup",mouseUpHandler),ret}}(),function(){var proxied=ContentEdit.Text.prototype._onKeyDown;ContentEdit.Text.prototype._onKeyDown=function(ev){if(-1===[40,37,39,38,9,8,46,13,32].indexOf(ev.keyCode)){var n,range,sel,docRange=window.getSelection().getRangeAt(0);docRange.startContainer.parentNode&&(docRange.startContainer.nextSibling&&"A"!==docRange.startContainer.parentNode.tagName&&"A"===docRange.startContainer.nextSibling.tagName?docRange.startOffset===docRange.startContainer.length&&(docRange.startContainer.nextSibling.innerHTML.match(/^&nbsp;/)||(n=document.createTextNode(""),docRange.startContainer.nextSibling.insertBefore(n,docRange.startContainer.nextSibling.firstChild),range=document.createRange(),sel=window.getSelection(),range.setStart(docRange.startContainer.nextSibling,1),range.collapse(!0),sel.removeAllRanges(),sel.addRange(range))):"A"===docRange.startContainer.parentNode.tagName&&docRange.startOffset===docRange.startContainer.length&&(docRange.startContainer.parentNode.innerHTML.match(/&nbsp;$/)||(n=document.createTextNode(""),docRange.startContainer.parentNode.appendChild(n)),range=document.createRange(),sel=window.getSelection(),range.setStart(docRange.startContainer,docRange.startContainer.length),range.collapse(!0),sel.removeAllRanges(),sel.addRange(range)))}proxied.call(this,ev)}}(),function(){var proxiedBlur=ContentEdit.Text.prototype.blur;ContentEdit.Text.prototype.blur=function(){if(this._domElement){var innerHTML=this._domElement.innerHTML;innerHTML=innerHTML.replace(/(\s|&nbsp;)+(<\/a>)/,"$2"),innerHTML=innerHTML.replace(/(<a\s[^>]+>)(&nbsp;|\s)+/,"$1"),this._domElement.innerHTML!==innerHTML&&(this._domElement.innerHTML=innerHTML,this._syncContent())}return proxiedBlur.call(this)}}(),function(){var proxied=ContentEdit.Text.prototype._syncContent;ContentEdit.Text.prototype._syncContent=function(ev){return this._domElement&&"undefined"!=typeof this._domElement.innerHTML?proxied.call(this,ev):this._flagIfEmpty()}}(),function(){var proxied=ContentEdit.Text.prototype._onKeyUp;ContentEdit.Text.prototype._onKeyUp=function(ev){var ret=proxied.call(this,ev);if(9===ev.keyCode&&"lorem"===this.content.text().toLowerCase()){this.content=new HTMLString.String("Lorem ipsum dolor sit amet, consectetur adipisicing elit. At dolor sed numquam? Sapiente autem adipisci, minus expedita enim, suscipit laboriosam deleniti possimus sequi pariatur explicabo numquam alias atque officia sit."),this.updateInnerHTML(),this.taint();var selection=new ContentSelect.Range(this.content.length(),this.content.length());selection.select(this._domElement)}return ret}}(),function(){var proxied=ContentEdit.Text.prototype.blur;ContentEdit.Text.prototype.blur=function(ev){if("lorem"===this.content.text().toLowerCase()){this.content=new HTMLString.String("Lorem ipsum dolor sit amet, consectetur adipisicing elit. At dolor sed numquam? Sapiente autem adipisci, minus expedita enim, suscipit laboriosam deleniti possimus sequi pariatur explicabo numquam alias atque officia sit."),this.updateInnerHTML(),this.taint();var selection=new ContentSelect.Range(this.content.length(),this.content.length());selection.select(this._domElement)}return proxied.call(this,ev)}}(),ContentEdit.Shortcode=function(_super){function Shortcode(tagName,attributes,content){this.sc_hash=attributes["data-shortcode"],this.sc_base=attributes["data-base"],this.sc_raw=Shortcode.atob(this.sc_hash),this.sc_prev_raw=this.sc_raw,this.model=new Backbone.Model({}),this.parseShortcode(),this.model.element=this,this.model.listenTo(this.model,"change",this.modelChanged.bind(this)),this._doubleClickCount=0,Shortcode.__super__.constructor.call(this,tagName,attributes),this._content=content}return __extends(Shortcode,_super),Shortcode.sc_raw="",Shortcode.sc_hash="",Shortcode.sc_base="",Shortcode.sc_prev_raw="",Shortcode.btoa=function(str){return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g,function(match,p1){return String.fromCharCode("0x"+p1)}))},Shortcode.atob=function(str){return decodeURIComponent(Array.prototype.map.call(window.atob(str),function(c){return"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)}).join(""))},Shortcode.prototype.mount=function(){var ret=Shortcode.__super__.mount.call(this),scStyles=getComputedStyle(this._domElement);return"0px"===scStyles.height?this._domElement.classList.add("nhb--blank"):this._domElement.classList.remove("nhb--blank"),setTimeout(function(){if(this._domElement){var scStyles=getComputedStyle(this._domElement);"0px"===scStyles.height?this._domElement.classList.add("nhb--blank"):this._domElement.classList.remove("nhb--blank")}}.bind(this),1),ret},Shortcode.createShortcode=function(shortcode){var o=document.createElement("DIV");return o.setAttribute("data-ce-moveable",""),o.setAttribute("data-ce-tag","shortcode"),o.setAttribute("data-base",shortcode.shortcode.tag),o.setAttribute("data-shortcode",Shortcode.btoa(shortcode.shortcode.string())),ContentEdit.Shortcode.fromDOMElement(o)},Shortcode.fromDOMElement=function(domElement){var newElement=new this(domElement.tagName,this.getDOMElementAttributes(domElement),domElement.innerHTML);return nhbEditor._justAddedDesignElement&&newElement.ajaxUpdate(!0),newElement},Shortcode.prototype.convertToText=function(){var innerHTML=this._domElement.innerHTML,elem=Shortcode.__super__.convertToText.call(this,this.sc_raw);return elem.origShortcode=this.sc_raw,elem.origInnerHTML=innerHTML,elem.isShortcodeEditing=!0,elem},Shortcode.prototype.parseShortcode=function(){var sc=wp.shortcode.next(this.sc_base,this.sc_raw,0);for(var attributeName in sc.shortcode.attrs.named)sc.shortcode.attrs.named.hasOwnProperty(attributeName)&&this.model.set(attributeName,sc.shortcode.attrs.named[attributeName],{silent:!0});for(var i=0;i<sc.shortcode.attrs.numeric.length;i++)this.model.set(i,sc.shortcode.attrs.numeric[i],{silent:!0});this.model.set("content",sc.shortcode.content,{silent:!0})},Shortcode.prototype._onDoubleClick=function(){wp.hooks.applyFilters("nhb.shortcode.allow_raw_edit",!0,this.sc_base,this)&&this.convertToText()},Shortcode.prototype.cssTypeName=function(){return"shortcode"},Shortcode.prototype.typeName=function(){return"Shortcode"},Shortcode.prototype.clone=function(){var root=ContentEdit.Root.get();root.focused()===this&&root.focused().blur();var clone=document.createElement("div");clone.innerHTML=this.html();var newElement=Shortcode.fromDOMElement(clone.childNodes[0]),index=this.parent().children.indexOf(this);this.parent().attach(newElement,index+1),newElement.focus()},Shortcode.prototype.modelChanged=function(){this.updateSCRaw(),this.updateSCHash(),clearTimeout(this._scRefreshTrigger);var _this=this;this._scRefreshTrigger=setTimeout(function(){_this.ajaxUpdate()},500)},Shortcode.prototype.setSCAttr=function(name,value){this.model.set(name,value)},Shortcode.prototype.setSCContent=function(value){this.model.set("content",value)},Shortcode.prototype.updateSCRaw=function(){var sc="";sc+="["+this.sc_base;for(var keys=this.model.keys(),i=0;i<keys.length;i++){var attrName=keys[i];if("content"!==attrName){var value=this.model.get(attrName)||"";value=value.replace(/\n/g,"<br>"),sc+=" "+attrName+'="'+value+'"'}}sc+="]",this.model.get("content")&&(sc+=this.model.get("content")),sc+="[/"+this.sc_base+"]",this.sc_raw=sc},Shortcode.prototype.updateSCHash=function(){this.sc_hash=Shortcode.btoa(this.sc_raw),this.attr("data-shortcode",this.sc_hash)},Shortcode.prototype.unmount=function(){Shortcode.__super__.unmount.call(this),setTimeout(function(){this.runInitScripts()}.bind(this),100)},Shortcode.prototype.runInitScripts=function(){var ranInitCode=!1;if(this._scriptsToRun)for(var i=0;i<this._scriptsToRun.length;i++)try{new Function(this._scriptsToRun[i])(),ranInitCode=!0}catch(err){console.log("nhb:",this.sc_base,"init code errored out.")}if("undefined"!=typeof nhbParams.shortcode_mappings[this.sc_base]){var map=nhbParams.shortcode_mappings[this.sc_base];if("undefined"!=typeof map.init_code)try{this._domElement?new Function(map.init_code).bind(this._domElement.firstChild)():new Function(map.init_code)(),ranInitCode=!0}catch(err){console.log("nhb:",this.sc_base,"init code errored out.")}}ranInitCode?setTimeout(function(){this._domElement&&(this._content=this._domElement.innerHTML)}.bind(this),10):this._domElement&&(this._content=this._domElement.innerHTML)},Shortcode.prototype.ajaxUpdate=function(forceUpdate){clearTimeout(this._ajaxUpdateTimeout),this._ajaxUpdateTimeout=setTimeout(function(){this._ajaxUpdate(forceUpdate)}.bind(this),500)},Shortcode.prototype._ajaxUpdate=function(forceUpdate){if(this.sc_prev_raw!==this.sc_raw||forceUpdate){var payload=new FormData;payload.append("action","nhb_shortcode_render"),payload.append("shortcode",this.sc_hash),payload.append("nonce",nhbParams.nonce),this._domElement.classList.add("nhb--rendering");var _this=this,request=new XMLHttpRequest;request.open("POST",window.location.href),request.onload=function(){if(request.status>=200&&request.status<400){var i,node,response;try{response=JSON.parse(request.responseText)}catch(err){return console.log("nhb: Error getting rendered shortcode"),_this._domElement.classList.remove("nhb--rendering"),_this._domElement.style.minHeight="",_this._domElement.style.marginBottom="",void(_this.sc_prev_raw=_this.sc_raw)}var enqueued=response.scripts+response.styles,dummyContainer=document.createElement("div");dummyContainer.innerHTML=enqueued.trim();var currentHead=document.querySelector("html").innerHTML,enqueuedScriptsPending=0,scriptsToRun=[];if(enqueued.trim().length)for(i=dummyContainer.childNodes.length-1;i>=0;i--)if(dummyContainer.childNodes[i].getAttribute){if(node=dummyContainer.childNodes[i],"SCRIPT"===node.tagName){if(node.getAttribute("src")){var scriptURL=node.getAttribute("src");document.querySelector('script[src="'+scriptURL+'"]')||(enqueuedScriptsPending++,jQuery.getScript(node.getAttribute("src")).done(function(){enqueuedScriptsPending--}).fail(function(){enqueuedScriptsPending--}));continue}scriptsToRun.unshift(node.innerHTML);continue}if("LINK"===node.tagName&&"stylesheet"===node.getAttribute("rel")&&node.getAttribute("href")){var styleURL=node.getAttribute("href");if(document.querySelector('link[href="'+styleURL+'"]'))continue}-1===currentHead.indexOf(node.outerHTML)&&document.body.appendChild(node)}if(dummyContainer=document.createElement("div"),dummyContainer.innerHTML=response.output.trim(),_this._domElement.innerHTML="",dummyContainer.innerHTML.length)for(i=dummyContainer.childNodes.length-1;i>=0;i--)if(node=dummyContainer.childNodes[i],3===dummyContainer.childNodes[i].nodeType)_this._domElement.insertBefore(node,_this._domElement.firstChild);else{if("SCRIPT"===node.tagName){scriptsToRun.unshift(node.innerHTML);continue}_this._domElement.insertBefore(node,_this._domElement.firstChild)}if(_this._content=dummyContainer.innerHTML,scriptsToRun&&(_this._scriptsToRun=scriptsToRun,_this._scriptRunInterval=setInterval(function(){enqueuedScriptsPending||(this.runInitScripts(),clearInterval(this._scriptRunInterval))}.bind(_this),100)),_this.style("float",""),1===_this._domElement.children.length)try{var style=getComputedStyle(_this._domElement.firstChild);("left"===style["float"]||"right"===style["float"])&&_this.style("float",style["float"])}catch(err){}document.dispatchEvent(new CustomEvent("nhb:shortcode-render",{detail:document.querySelector(".nhb--rendering")}))}_this._domElement.classList.remove("nhb--rendering"),_this._domElement.classList.remove("nhb--blank"),_this._domElement.style.minHeight="",_this._domElement.style.marginBottom="",_this.sc_prev_raw=_this.sc_raw;var scStyles=getComputedStyle(_this._domElement);"0px"===scStyles.height?_this._domElement.classList.add("nhb--blank"):_this._domElement.classList.remove("nhb--blank")},request.onerror=function(){_this._domElement.classList.remove("nhb--rendering"),_this._domElement.style.minHeight="",_this._domElement.style.marginBottom="",_this.sc_prev_raw=_this.sc_raw},request.send(payload)}},Shortcode}(ContentEdit.StaticEditable),ContentEdit.TagNames.get().register(ContentEdit.Shortcode,"shortcode"),ContentEdit.Text.prototype.convertShortcodes=function(){var html=this.content.html(),textParts=[],shortcodes=[];if(""!==html.trim()){var shortcodeRegex=/\[([^\/][^\s\]\[]+)[^\]]*\]/g,shortcodeMatch=shortcodeRegex.exec(html);if(shortcodeMatch){for(var prevIndex=0;shortcodeMatch;)if(-1!==nhbParams.shortcodes.indexOf(shortcodeMatch[1]))if(shortcodeMatch.index<prevIndex)shortcodeMatch=shortcodeRegex.exec(html);else{var base=shortcodeMatch[1],sc=wp.shortcode.next(base,html,shortcodeMatch.index);textParts.push(html.substr(prevIndex,shortcodeMatch.index-prevIndex)),shortcodes.push(sc),prevIndex=shortcodeMatch.index+sc.content.length,shortcodeMatch=shortcodeRegex.exec(html)}else shortcodeMatch=shortcodeRegex.exec(html);if(0!==shortcodes.length){textParts.push(html.substr(prevIndex));var elem,minHeight,bottomMargin,insertAt=this.parent().children.indexOf(this),parent=this.parent(),dom=this._domElement;dom&&dom.style.minHeight&&(minHeight=dom.style.minHeight,bottomMargin=dom.style.bottomMargin);for(var i=0;i<textParts.length+shortcodes.length;i++){var isShortcode=i%2===1;if(elem=null,0!==i){if(isShortcode?elem=ContentEdit.Shortcode.createShortcode(shortcodes[Math.floor(i/2)]):textParts[i/2].trim()&&(elem=document.createElement("P"),elem.innerHTML=textParts[i/2],elem=ContentEdit.Text.fromDOMElement(elem)),elem&&(insertAt++,parent.attach(elem,insertAt),1===i&&dom&&minHeight&&(elem._domElement.style.minHeight=minHeight,elem._domElement.style.bottomMargin=bottomMargin),"Shortcode"===elem.constructor.name)){var doAjax=!0;if(1===i&&elem.sc_raw===this.origShortcode){elem._domElement.innerHTML=this.origInnerHTML,elem._content=this.origInnerHTML;var scStyles=getComputedStyle(elem._domElement);"0px"===scStyles.height?elem._domElement.classList.add("nhb--blank"):elem._domElement.classList.remove("nhb--blank"),doAjax=!1}doAjax&&elem.ajaxUpdate(!0)}}else this.content=new HTMLString.String(textParts[i],!0),this.updateInnerHTML(),this.taint()}this.parent()&&this.content.isWhitespace()&&this.parent().detach(this)}}}},function(){var proxied=ContentEdit.Text.prototype._keyReturn;ContentEdit.Text.prototype._keyReturn=function(ev){if(this.isShortcodeEditing)return this.blur(),this.convertShortcodes();var ret=proxied.call(this,ev);return this.convertShortcodes(),ret}}(),window.addEventListener("DOMContentLoaded",function(){ContentEdit.Root.get().bind("blur",function(element){"Text"===element.constructor.name&&element.convertShortcodes()}),document.querySelector("#wpadminbar").addEventListener("mouseover",function(){var root=ContentEdit.Root.get(),focused=root.focused();focused&&"Text"===focused.constructor.name&&focused.content&&focused.content.html().match(/\[\w+[^\]]+\]/)&&focused.blur()})}),window.addEventListener("DOMContentLoaded",function(){var shortcodes=document.querySelectorAll('[data-name="main-content"] [data-shortcode]');Array.prototype.forEach.call(shortcodes,function(el){if(1===el.children.length)try{var style=getComputedStyle(el.firstChild);("left"===style["float"]||"right"===style["float"])&&(el.style["float"]=style["float"])}catch(err){}})}),ContentEdit.Hr=function(_super){function Hr(tagName,attributes){this.model=new Backbone.Model({}),Hr.__super__.constructor.call(this,tagName,attributes),this._content=""}return __extends(Hr,_super),Hr.prototype.blur=function(){var root=ContentEdit.Root.get();return this.isFocused()?(this._removeCSSClass("ce-element--focused"),root._focused=null,root.trigger("blur",this)):void 0},Hr.droppers=nhbEditor.allDroppers,Hr.prototype.focus=function(supressDOMFocus){var root;return root=ContentEdit.Root.get(),this.isFocused()?void 0:(root.focused()&&root.focused().blur(),this._addCSSClass("ce-element--focused"),root._focused=this,this.isMounted()&&!supressDOMFocus&&this.domElement().focus(),root.trigger("focus",this))},Hr.prototype.cssTypeName=function(){return"hr"},Hr.prototype.typeName=function(){return"Horizontal Rule"},Hr}(ContentEdit.Static),ContentEdit.TagNames.get().register(ContentEdit.Hr,"hr"),ContentEdit.Embed=function(_super){function Embed(tagName,attributes,content){this.url=attributes["data-url"],this.model=new Backbone.Model({}),this._doubleClickCount=0,Embed.__super__.constructor.call(this,tagName,attributes),this._content=content}return __extends(Embed,_super),Embed.create=function(url){var o=document.createElement("DIV");return o.setAttribute("data-ce-moveable",""),o.setAttribute("data-ce-tag","embed"),o.setAttribute("data-url",url),ContentEdit.Embed.fromDOMElement(o)},Embed.prototype.mount=function(){var ret=Embed.__super__.mount.call(this);return this._domElement.innerHTML="",jQuery(this._domElement).html(this._content),wp.hooks.doAction("nhb.embed.mount",this),ret},Embed.prototype._onDoubleClick=function(){this.convertToText(this.url,!1)},Embed.prototype.cssTypeName=function(){return"embed"},Embed.prototype.typeName=function(){return"Embed"},Embed.updateEmbedContent=function(url,textElement){var payload=new FormData;payload.append("post_ID",nhbParams.post_id),payload.append("type","embed"),payload.append("action","parse-embed"),payload.append("shortcode","[embed]"+url+"[/embed]");var request=new XMLHttpRequest;request.open("POST",nhbParams.ajax_url),request.onload=function(){if(request.status>=200&&request.status<400){var response=JSON.parse(request.responseText);if(!response.success)return;if(!textElement.parent())return;var elem=ContentEdit.Embed.create(url),insertAt=textElement.parent().children.indexOf(textElement),parent=textElement.parent();parent.attach(elem,insertAt),parent.detach(textElement),jQuery(elem._domElement).html("<p>"+response.data.body+"</p>"),elem._content="<p>"+response.data.body+"</p>",elem._domElement.classList.remove("nhb--rendering"),wp.hooks.doAction("nhb.embed.update_embed_content",elem)}},request.onerror=function(){},request.send(payload)},Embed}(ContentEdit.StaticEditable),ContentEdit.TagNames.get().register(ContentEdit.Embed,"embed"),ContentEdit.Text.prototype.convertOEmbedURLs=function(){if(!this.content.isWhitespace()){var text=this.content.text();text&&(this.content.html().match(/<a[^>]+/g)||(text=text.trim(),text&&text.match(/^https?:\/\/[^\s/$.?#].[^\s]*$/)&&ContentEdit.Embed.updateEmbedContent(text,this)))}},window.addEventListener("DOMContentLoaded",function(){ContentEdit.Root.get().bind("blur",function(element){"Text"===element.constructor.name&&element.convertOEmbedURLs()})}),window.addEventListener("DOMContentLoaded",function(){var editor=ContentTools.EditorApp.get();editor.bind("stop",function(){var shortcodes=document.querySelectorAll('[data-ce-tag="embed"]');Array.prototype.forEach.call(shortcodes,function(el){var html=el.innerHTML;el.innerHTML="",jQuery(el).html(html)})})}),function(){ContentEdit.PreText.prototype.unhighlight=function(){this.updateInnerHTML()},ContentEdit.PreText.prototype.rehighlight=function(){"undefined"!=typeof hljs&&(this.storeState(),this.removeAllCSSClasses(),hljs.highlightBlock(this._domElement),this.restoreState())}}(),function(){var proxied=ContentEdit.PreText.prototype.html;ContentEdit.PreText.prototype.html=function(indent){return proxied.call(this,indent),this._cached=this._cached.replace(/<\/?\w+[^>]*>/g,""),""+indent+"<"+this._tagName+this._attributesToString()+">"+(""+this._cached.replace(/\n/g,"\r\n")+"</"+this._tagName+">")}}(),function(){var proxied=ContentEdit.PreText.prototype.focus;ContentEdit.PreText.prototype.focus=function(){var ret=proxied.call(this);return this.unhighlight(),ret}}(),function(){var proxied=ContentEdit.PreText.prototype.mount;ContentEdit.PreText.prototype.mount=function(){var ret=proxied.call(this);return this.rehighlight(),ret}}(),function(){var proxied=ContentEdit.PreText.prototype.blur;ContentEdit.PreText.prototype.blur=function(){var ret=proxied.call(this);return this.rehighlight(),ret}}(),function(){var proxied=ContentEdit.PreText.fromDOMElement;ContentEdit.PreText.fromDOMElement=function(domElement){return domElement.innerHTML=domElement.innerHTML.replace(/<\/?\w+[^>]*>/g,""),proxied.call(this,domElement)}}(),window.addEventListener("DOMContentLoaded",function(){var editor=ContentTools.EditorApp.get();editor.bind("stop",function(){window.nhbInitAllPretext&&window.nhbInitAllPretext()})}),function(){var proxied=ContentEdit.PreText.prototype._onKeyDown;ContentEdit.PreText.prototype._onKeyDown=function(ev){if(9===ev.keyCode){ev.preventDefault(),ContentSelect.Range.query(this._domElement);var insertAt,selection=ContentSelect.Range.query(this._domElement),preserveWhitespace=this.content.preserveWhitespace();insertAt=selection.get()[1],this.content=this.content.insert(insertAt,new HTMLString.String("	",preserveWhitespace),preserveWhitespace),this.updateInnerHTML(),insertAt+=1,selection=new ContentSelect.Range(insertAt,insertAt),selection.select(this.domElement())}return proxied.call(this,ev)}}(),function(){var fitVideos=function(element){if("undefined"!=typeof jQuery&&"undefined"!=typeof jQuery.fn.fitVids){var domElement=element._domElement||element;jQuery(domElement).fitVids()}};wp.hooks.addAction("nhb.embed.mount",fitVideos),wp.hooks.addAction("nhb.embed.update_embed_content",fitVideos),window.addEventListener("DOMContentLoaded",function(){var editor=ContentTools.EditorApp.get();editor.bind("stop",function(){var shortcodes=document.querySelectorAll('[data-ce-tag="embed"] iframe');Array.prototype.forEach.call(shortcodes,function(el){fitVideos(el.parentNode)})})})}();var nhbTwitterMount=function(element){var domElement=element._domElement||element;if(domElement.querySelector("[data-tweet-id]")){var tweetID=domElement.querySelector("[data-tweet-id]").getAttribute("data-tweet-id");domElement.innerHTML="",twttr.widgets.createTweet(tweetID,domElement)}};wp.hooks.addAction("nhb.embed.mount",nhbTwitterMount),window.addEventListener("DOMContentLoaded",function(){var editor=ContentTools.EditorApp.get();editor.bind("stop",function(){var shortcodes=document.querySelectorAll("[data-tweet-id]");Array.prototype.forEach.call(shortcodes,function(el){nhbTwitterMount(el.parentNode)})})}),ContentEdit.IFrame=function(_super){function IFrame(tagName,attributes,content){this.model=new Backbone.Model({}),IFrame.__super__.constructor.call(this,tagName,attributes),this._content=content}return __extends(IFrame,_super),IFrame.prototype.html=function(){return"<p>"+this._content+"</p>"},IFrame.prototype._onDoubleClick=function(){var html=this._domElement.innerHTML.replace(/</g,"&lt;").replace(/<p>|<\/p>/g,"").replace(/data-ce-tag=['"]iframe['"]/,""),textElement=this.convertToText(html,!1);textElement.isIframeEditing=!0},IFrame.prototype.cssTypeName=function(){return"iframe"},IFrame.prototype.typeName=function(){return"IFrame"},IFrame.convertTextToIFrame=function(html,textElement){var elem=new ContentEdit.IFrame("P",[],html),insertAt=textElement.parent().children.indexOf(textElement),parent=textElement.parent();parent.attach(elem,insertAt),parent.detach(textElement)},IFrame}(ContentEdit.StaticEditable),ContentEdit.TagNames.get().register(ContentEdit.IFrame,"iframe"),function(){var proxied=ContentEdit.Text.fromDOMElement;ContentEdit.Text.fromDOMElement=function(domElement){return domElement&&domElement.children&&1===domElement.children.length&&"IFRAME"===domElement.firstChild.tagName?new ContentEdit.IFrame(domElement.tagName,this.getDOMElementAttributes(domElement),domElement.innerHTML):proxied.call(this,domElement)}}(),ContentEdit.Text.prototype.convertIFrameTags=function(){if(!this.content.isWhitespace()){var text=this.content.text();text&&(text=text.trim(),text&&text.match(/^\s*<iframe.*/)&&ContentEdit.IFrame.convertTextToIFrame(text,this))}},window.addEventListener("DOMContentLoaded",function(){ContentEdit.Root.get().bind("blur",function(element){"Text"===element.constructor.name&&element.convertIFrameTags()})}),window.addEventListener("DOMContentLoaded",function(){document.querySelector("#wpadminbar").addEventListener("mouseover",function(){var root=ContentEdit.Root.get(),focused=root.focused();focused&&"Text"===focused.constructor.name&&focused.content&&focused.content.text().match(/^\s*<iframe.*/)&&focused.blur()})}),function(){var proxied=ContentEdit.Text.prototype._keyReturn;ContentEdit.Text.prototype._keyReturn=function(ev){return this.isIframeEditing?void this.blur():proxied.call(this,ev)}}(),ContentEdit.Div=function(_super){function Div(tagName,attributes){Div.__super__.constructor.call(this,tagName,attributes)}return __extends(Div,_super),Div.prototype.cssTypeName=function(){return"div"},Div.prototype.type=function(){return"Div"},Div.prototype.typeName=function(){return"Div"},Div.prototype._onMouseUp=function(ev){ev.target===this._domElement&&(Div.__super__._onMouseUp.call(this,ev),clearTimeout(this._dragTimeout))},Div.prototype._onMouseOut=function(ev){Div.__super__._onMouseOut.call(this,ev),clearTimeout(this._dragTimeout)},Div.prototype._onMouseDown=function(ev){return ev.target===this._domElement&&(Div.__super__._onMouseDown.call(this,ev),clearTimeout(this._dragTimeout),this.domElement()===ev.target)?(ev.preventDefault(),this._dragTimeout=setTimeout(function(_this){return function(){return _this.drag(ev.pageX,ev.pageY)}}(this),ContentEdit.DRAG_HOLD_DURATION)):void 0},Div.prototype._onMouseOver=function(ev){ev.target===this._domElement&&Div.__super__._onMouseOver.call(this,ev)},Div.prototype._onMouseMove=function(ev){Div.__super__._onMouseMove.call(this,ev)},Div.prototype.attach=function(component,index){2===this.children.length&&"undefined"!=typeof this.children[0].content&&this.children[0].content.isWhitespace()&&this.detach(this.children[0]),2===this.children.length&&"undefined"!=typeof this.children[1].content&&this.children[1].content.isWhitespace()&&this.detach(this.children[1]),Div.__super__.attach.call(this,component,index)},Div.prototype.detach=function(element){ContentEdit.NodeCollection.prototype.detach.call(this,element),setTimeout(function(){0===this.children.length&&this.attach(new ContentEdit.Text("p"),0)}.bind(this),1)},Div.prototype.focus=function(){for(var root=ContentEdit.Root.get(),i=this.children.length-1;i>=0;i--)if(this.children[i].constructor&&"DivRow"!==this.children[i].constructor.name){if(this.children[i].isFocused())return;return root.focused()&&root.focused().blur(),void(this.children[i].focus&&this.children[i].focus())}0===this.children.length&&this.attach(new ContentEdit.Text("p"),0),this.children[0].isFocused()||(root.focused()&&root.focused().blur(),this.children[0].focus())},Div.prototype.blur=function(){var root;return root=ContentEdit.Root.get(),this.isFocused()?(this._removeCSSClass("ce-element--focused"),root._focused=null,root.trigger("blur",this)):void 0},Div._dropInside=function(element,target,placement){var insertIndex=0;return"below"===placement[0]&&(insertIndex=target.children.length),target.attach(element,insertIndex)},Div.droppers=nhbEditor.allDroppers,Div._fromDOMElement=function(domElement){var cls,tagNames=ContentEdit.TagNames.get();if(domElement.getAttribute("data-ce-tag"))cls=tagNames.match(domElement.getAttribute("data-ce-tag"));else if(domElement.classList.contains("nhb-row"))cls=tagNames.match("row");else if(domElement.classList.contains("nhb-col"))cls=tagNames.match("column");else if(domElement.getAttribute("data-shortcode"))cls=tagNames.match("shortcode");else{if("DIV"===domElement.tagName)return null;
cls=tagNames.match(domElement.tagName)}return cls.fromDOMElement(domElement)},Div.fromDOMElement=function(domElement){var element=this._fromDOMElement(domElement);if(element)return element;var c,childNode,childNodes,list,_i,_len;list=new this(domElement.tagName,this.getDOMElementAttributes(domElement)),childNodes=function(){var _i,_len,_ref,_results;for(_ref=domElement.childNodes,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)c=_ref[_i],_results.push(c);return _results}();var tagNames=ContentEdit.TagNames.get();for(_i=0,_len=childNodes.length;_len>_i;_i++)if(childNode=childNodes[_i],1===childNode.nodeType){var cls;cls=childNode.getAttribute("data-ce-tag")?tagNames.match(childNode.getAttribute("data-ce-tag")):tagNames.match(childNode.tagName),element=cls.fromDOMElement(childNode),element&&list.attach(element)}return 0===list.children.length&&list.attach(new ContentEdit.Text("p"),0),list},Div}(ContentEdit.ElementCollection),ContentEdit.TagNames.get().register(ContentEdit.Div,"div"),ContentEdit.DivRow=function(_super){function DivRow(tagName,attributes){DivRow.__super__.constructor.call(this,tagName,attributes),this.isCompundElement=!0}return __extends(DivRow,_super),DivRow.prototype.cssTypeName=function(){return"row"},DivRow.prototype.type=function(){return"DivRow"},DivRow.prototype.typeName=function(){return"Row"},DivRow.prototype.showOutline=function(){for(var currElem=this;currElem;)"DivRow"===currElem.constructor.name&&currElem._addCSSClass("nhb-new-column"),currElem=currElem.parent()},DivRow.prototype.hideOutline=function(){for(var currElem=this;currElem;)"DivRow"===currElem.constructor.name&&currElem._removeCSSClass("nhb-new-column"),currElem=currElem.parent()},DivRow.prototype._onMouseOver=function(ev){this._removeCSSClass("nhb-new-column");var root=ContentEdit.Root.get(),dragging=root.dragging();return null!==root._dropTarget&&dragging&&nhbSelectorMatches(root._dropTarget.domElement(),".ce-element--dragging *")?(root._dropTarget._removeCSSClass("ce-element--drop"),root._dropTarget._removeCSSClass("ce-element--drop-above"),root._dropTarget._removeCSSClass("ce-element--drop-below"),root._dropTarget._removeCSSClass("ce-element--drop-center"),root._dropTarget._removeCSSClass("ce-element--drop-left"),root._dropTarget._removeCSSClass("ce-element--drop-right"),void(root._dropTarget=null)):(DivRow.__super__._onMouseOver.call(this,ev),void(ev.target.classList.contains("nhb-row")||this._removeCSSClass("ce-element--over")))},DivRow.prototype._onMouseUp=function(ev){DivRow.__super__._onMouseUp.call(this,ev),clearTimeout(this._dragTimeout),this._checkForBetweenRowClick&&this.testClickBetweenRows(ev),clearTimeout(this._betweenRowSelectorTimeout)},DivRow.prototype._onMouseOut=function(ev){DivRow.__super__._onMouseOut.call(this,ev),clearTimeout(this._dragTimeout),this._checkForBetweenRowClick=!1,clearTimeout(this._betweenRowSelectorTimeout)},DivRow.prototype._onMouseMove=function(ev){this._checkForBetweenRowClick=!1,clearTimeout(this._betweenRowSelectorTimeout);var root=ContentEdit.Root.get();if(null!==root._dropTarget){if("DivCol"===root._dropTarget.constructor.name&&"DivRow"===root.dragging().constructor.name){var row=root._dropTarget.parent();return root._dropTarget._onMouseOut(ev),void row._onOver(ev)}if(ev.target===root.dragging()._domElement)return root._dropTarget._removeCSSClass("ce-element--drop"),root._dropTarget._removeCSSClass("ce-element--drop-above"),root._dropTarget._removeCSSClass("ce-element--drop-below"),root._dropTarget._removeCSSClass("ce-element--drop-center"),root._dropTarget._removeCSSClass("ce-element--drop-left"),root._dropTarget._removeCSSClass("ce-element--drop-right"),void(root._dropTarget=null);if(nhbSelectorMatches(root._dropTarget._domElement,".ce-element--dragging *"))return root._dropTarget._removeCSSClass("ce-element--drop"),root._dropTarget._removeCSSClass("ce-element--drop-above"),root._dropTarget._removeCSSClass("ce-element--drop-below"),root._dropTarget._removeCSSClass("ce-element--drop-center"),root._dropTarget._removeCSSClass("ce-element--drop-left"),root._dropTarget._removeCSSClass("ce-element--drop-right"),void(root._dropTarget=null)}DivRow.__super__._onMouseMove.call(this,ev),clearTimeout(this._dragTimeout)},DivRow.prototype._onMouseDown=function(ev){return DivRow.__super__._onMouseDown.call(this,ev),clearTimeout(this._dragTimeout),this._checkForBetweenRowClick=!0,clearTimeout(this._betweenRowSelectorTimeout),this._betweenRowSelectorTimeout=setTimeout(function(){this._checkForBetweenRowClick=!1}.bind(this),300),this.domElement()===ev.target?(ev.preventDefault(),this._dragTimeout=setTimeout(function(_this){return function(){return _this.drag(ev.pageX,ev.pageY)}}(this),ContentEdit.DRAG_HOLD_DURATION)):void 0},DivRow.droppers=nhbEditor.allDroppers,DivRow.prototype.mount=function(){DivRow.__super__.mount.call(this),this.addCSSClass("nhb-row"),window._nhbFixRowWidth&&window._nhbFixRowWidth(this._domElement)},DivRow.fromDOMElement=function(domElement){var childNode,childNodes,list,_i,_len;list=new this(domElement.tagName,this.getDOMElementAttributes(domElement)),childNodes=domElement.children;var tagNames=ContentEdit.TagNames.get();for(_i=0,_len=childNodes.length;_len>_i;_i++)if(childNode=childNodes[_i],1===childNode.nodeType&&("div"===childNode.tagName.toLowerCase()||childNode.classList.contains("nhb-col"))){var element=tagNames.match("column").fromDOMElement(childNode);element&&list.attach(element)}return list},DivRow.prototype.focus=function(){var overElem=document.querySelector(".ce-element--over");if(null===overElem){if(this.children[0].isFocused())return;this.children[0].focus()}if(document.querySelector(".ce-element--over")===this._domElement){if(this.children[this.children.length-1].isFocused())return;this.children[this.children.length-1].focus()}},DivRow.prototype.addNewColumn=function(index){"undefined"==typeof index&&(index=this.children.length);for(var existingGap=this.hasColumnGap(),i=0;i<this.children.length;i++){var currFlexBasis=this.children[i].style("flex-basis");currFlexBasis&&"0px"!==currFlexBasis||this.children[i].style("flex-basis",100/(this.children.length+1)+"%")}var col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},"");return col.attach(p),this.attach(col,index),col.style("flex-grow","1"),col.style("flex-basis",100/this.children.length+"%"),existingGap&&index!==this.children.length-1?col.style("margin-right",existingGap):existingGap&&this.children[index-1].style("margin-right",existingGap),col},DivRow.prototype.adjustColumnNumber=function(numColumns){if(this.children.length<numColumns)for(;this.children.length<numColumns;)this.addNewColumn();else if(this.children.length>numColumns)for(;this.children.length>numColumns;)this.children[numColumns].blurIfFocused(),this.children[numColumns-1].merge(this.children[numColumns])},DivRow.prototype.adjustColumns=function(columnEquation){var arrWidths=columnEquation.replace(/(\s*\+\s*|\s+)/g," ").split(" ");this.adjustColumnNumber(arrWidths.length);for(var highestDenom=1,i=0;i<arrWidths.length;i++)if(-1!==arrWidths[i].indexOf("/")){var denom=parseInt(arrWidths[i].split("/")[1],10);denom>highestDenom&&(highestDenom=denom)}for(i=0;i<arrWidths.length;i++){var grow=1;if(-1!==arrWidths[i].indexOf("/")){var nums=arrWidths[i].split("/");grow=nums[0]/nums[1]*highestDenom}else grow=parseInt(arrWidths[i],10);this.children[i].style("flex-grow",grow)}},DivRow.prototype.clone=function(){this.blurIfFocused();var clone=document.createElement("div");clone.innerHTML=this.html();var newRow=ContentEdit.Div.fromDOMElement(clone.childNodes[0]),index=this.parent().children.indexOf(this);return this.parent().attach(newRow,index+1),newRow.focus(),newRow},DivRow.prototype.getColumnEquation=function(){var col,colStyle,i,totalGrow=0;for(i=0;i<this.children.length;i++)col=this.children[i],colStyle=window.getComputedStyle(col._domElement),totalGrow+=parseFloat(colStyle["flex-grow"]);var equation="";for(i=0;i<this.children.length;i++)col=this.children[i],colStyle=window.getComputedStyle(col._domElement),equation+=equation?" + ":"",equation+=parseFloat(colStyle["flex-grow"])+"/"+totalGrow;return equation},DivRow.prototype.blurIfFocused=function(){var root=ContentEdit.Root.get();if(root.focused())for(var currElem=root.focused();currElem;){if(currElem===this)return void root.focused().blur();currElem=currElem.parent()}},DivRow.prototype.hasColumnGap=function(){for(var existingMargin="",currMargin="",i=0;i<this.children.length;i++)i<this.children.length-1?""===currMargin?(currMargin=this.children[i]._domElement.style["margin-right"],existingMargin=currMargin):currMargin!==this.children[i]._domElement.style["margin-right"]&&(existingMargin=""):""!==this.children[i]._domElement.style["margin-right"]&&(existingMargin="");return existingMargin},DivRow.prototype.testClickBetweenRows=function(ev){if(ev.target._ceElement&&!("DivCol"!==ev.target._ceElement.constructor.name&&"DivRow"!==ev.target._ceElement.constructor.name||"DivCol"===ev.target._ceElement.constructor.name&&ev.target._ceElement.parent()!==this||"DivRow"===ev.target._ceElement.constructor.name&&ev.target._ceElement!==this||"Region"!==this.parent().constructor.name&&"DivCol"!==this.parent().constructor.name)){var clickedOnTop=!1,clickedOnBottom=!1;if(ev.offsetY<10)clickedOnTop=!0;else{if(!(ev.offsetY>ev.target.offsetHeight-10))return;clickedOnBottom=!0}var otherElement,p,index=this.parent().children.indexOf(this),doAddEmpty=!0;clickedOnTop?(index&&(otherElement=this.parent().children[index-1],"Text"===otherElement.type()&&(doAddEmpty=!1)),doAddEmpty&&(p=new ContentEdit.Text("p",{},""),this.parent().attach(p,index),p.focus())):clickedOnBottom&&(index<this.parent().children.length-1&&(otherElement=this.parent().children[index+1],"Text"===otherElement.type()&&(doAddEmpty=!1)),doAddEmpty&&(p=new ContentEdit.Text("p",{},""),this.parent().attach(p,index+1),p.focus()))}},DivRow}(ContentEdit.ElementCollection),ContentEdit.TagNames.get().register(ContentEdit.DivRow,"row"),ContentEdit.DivCol=function(_super){function DivCol(tagName,attributes){DivCol.__super__.constructor.call(this,tagName,attributes)}function selectAfterFocus(domElement,index){var selection=new ContentSelect.Range(index,index);selection.select(domElement)}return __extends(DivCol,_super),DivCol.prototype.cssTypeName=function(){return"col"},DivCol.prototype.type=function(){return"DivRow"},DivCol.prototype.typeName=function(){return"Column"},DivCol.prototype._onMouseUp=function(ev){DivCol.__super__._onMouseUp.call(this,ev),clearTimeout(this._dragTimeout)},DivCol.prototype._onMouseOut=function(ev){DivCol.__super__._onMouseOut.call(this,ev),clearTimeout(this._dragTimeout)},DivCol.prototype._onMouseDown=function(ev){return DivCol.__super__._onMouseDown.call(this,ev),clearTimeout(this._dragTimeout),this.domElement()===ev.target?(ev.preventDefault(),this.draggableParent||(this.draggableParent=this.parent()),this._dragTimeout=setTimeout(function(_this){return function(){return _this.draggableParent.drag(ev.pageX,ev.pageY)}}(this),ContentEdit.DRAG_HOLD_DURATION)):void 0},DivCol.prototype._onMouseMove=function(ev){DivCol.__super__._onMouseMove.call(this,ev),DivCol.__super__._onMouseOver.call(this,ev),clearTimeout(this._dragTimeout);var root=ContentEdit.Root.get(),dragging=root.dragging();dragging&&ev.target===this._domElement?(this._onMouseOut(ev),this.parent()._onOver(ev),this.parent()._removeCSSClass("ce-element--over")):ev.target!==this._domElement&&this._removeCSSClass("ce-element--over")},DivCol.prototype._onKeyDown=function(ev){DivCol.__super__._onMouseDown.call(this,ev);var index;if(190===ev.keyCode&&(ev.metaKey||ev.ctrlKey)&&ev.shiftKey)return index=this.parent().children.indexOf(this),this.blurIfFocused(),this.parent().addNewColumn(index+1).focus(),void ev.preventDefault();if(188===ev.keyCode&&(ev.metaKey||ev.ctrlKey)&&ev.shiftKey){index=this.parent().children.indexOf(this),this.blurIfFocused();var parent=this.parent();return parent.detach(this),index>0&&parent&&parent.children.length&&index--,parent&&parent.children.length&&parent.children[index].focus(),void ev.preventDefault()}if(ev.target._ceElement){if(-1!==ev.target._ceElement.constructor.name.toLowerCase().indexOf("list"))return;if(-1!==ev.target._ceElement.constructor.name.toLowerCase().indexOf("table"))return}9===ev.keyCode&&(!ev.shiftKey&&this.nextSibling()?(this.nextSibling().focus(),ev.stopPropagation()):ev.shiftKey&&this.previousSibling()&&(this.previousSibling().focus(),ev.stopPropagation()))},DivCol.droppers={},DivCol.prototype.mount=function(){DivCol.__super__.mount.call(this),this.addCSSClass("nhb-col");for(var numEmpties=0,numNonEmpties=0,i=this.children.length-1;i>=0;i--)"undefined"!=typeof this.children[i].content&&this.children[i].content.isWhitespace()?numEmpties++:numNonEmpties++;if(numEmpties>1)for(i=this.children.length-1;i>=0;i--)"undefined"!=typeof this.children[i].content&&this.children[i].content.isWhitespace()&&(numEmpties>1&&0===numNonEmpties?(this.detach(this.children[i]),numEmpties--):this.detach(this.children[i]))},DivCol.prototype.merge=function(element){for(var len=element.children.length,i=0;len>i;i++)this.attach(element.children[0]);for(element.parent().detach(element),len=this.children.length,i=len-1;i>=0;i--)this.children[i].content&&this.children[i].content.isWhitespace()&&this.detach(this.children[i]);return this.taint()},DivCol.fromDOMElement=function(domElement){var c,childNode,childNodes,list,_i,_len;list=new this(domElement.tagName,this.getDOMElementAttributes(domElement)),childNodes=function(){var _i,_len,_ref,_results;for(_ref=domElement.childNodes,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)c=_ref[_i],_results.push(c);return _results}();var tagNames=ContentEdit.TagNames.get();for(_i=0,_len=childNodes.length;_len>_i;_i++)if(childNode=childNodes[_i],1===childNode.nodeType){var cls;cls=childNode.getAttribute("data-ce-tag")?tagNames.match(childNode.getAttribute("data-ce-tag")):tagNames.match(childNode.tagName);var element=cls.fromDOMElement(childNode);element&&list.attach(element)}return 0===list.children.length&&list.attach(new ContentEdit.Text("p"),0),list},DivCol.prototype.focus=function(){for(var root=ContentEdit.Root.get(),i=0;i<this.children.length;i++)if(this.children[i].constructor&&"DivRow"!==this.children[i].constructor.name){if(this.children[i].isFocused())return;root.focused()&&root.focused().blur(),this.children[i].focus&&this.children[i].focus();var index=0;this.children[i].content&&(index=this.children[i].content.length());var domElement=this.children[i]._domElement;return void setTimeout(selectAfterFocus,1,domElement,index)}if(this.children.length){var allCompounds=!0;for(i=0;i<this.children.length;i++)"undefined"!=typeof this.children[i].isCompundElement&&this.children[i].isCompundElement||(allCompounds=!1);if(allCompounds)return root.focused()&&root.focused().blur(),this._addCSSClass("ce-element--focused"),root._focused=this,this.domElement().focus(),root.trigger("focus",this)}for(i=this.children.length-1;i>=0;i--)if(this.children[i].constructor&&"DivRow"===this.children[i].constructor.name){if(this.children[i].children[0].isFocused())return;return root.focused()&&root.focused().blur(),void this.children[i].children[0].focus()}0===this.children.length&&this.attach(new ContentEdit.Text("p"),0),this.children[0].isFocused()||(root.focused()&&root.focused().blur(),this.children[0].focus())},DivCol.prototype.clone=function(){var existingGap=this.parent().hasColumnGap();this.blurIfFocused();var clone=document.createElement("div");clone.innerHTML=this.html();var newCol=ContentEdit.Div.fromDOMElement(clone.childNodes[0]),index=this.parent().children.indexOf(this);return this.parent().attach(newCol,index+1),newCol.focus(),existingGap&&this.style("margin-right")!==existingGap&&this.style("margin-right",existingGap),newCol},DivCol.prototype.blurIfFocused=function(){var root=ContentEdit.Root.get();if(root.focused())for(var currElem=root.focused();currElem;){if(currElem===this)return void root.focused().blur();currElem=currElem.parent()}},DivCol}(ContentEdit.Div),ContentEdit.TagNames.get().register(ContentEdit.DivCol,"column"),ContentEdit.Root.get().bind("drop",function(element,droppedElement){if(null!==droppedElement&&null!==droppedElement.parent()){var col,i;if("DivCol"===droppedElement.parent().constructor.name||"Div"===droppedElement.parent().constructor.name)for(col=droppedElement.parent(),i=0;i<col.children.length;i++)null!==col.children[i].content&&"undefined"!=typeof col.children[i].content&&col.children.length>1&&col.children[i].content.isWhitespace()&&col.children[i]!==element&&col.detach(col.children[i]);else if("DivRow"===droppedElement.parent().constructor.name)for(col=droppedElement,i=0;i<col.children.length;i++)null!==col.children[i].content&&"undefined"!=typeof col.children[i].content&&col.children.length>1&&col.children[i].content.isWhitespace()&&col.children[i]!==element&&col.detach(col.children[i])}}),ContentEdit.Root.get().bind("drop",function(element,droppedElement){null!==droppedElement&&null!==droppedElement.parent()&&"DivRow"===element.constructor.name&&("Div"===element.parent().constructor.name||"DivCol"===element.parent().constructor.name)&&element.attr("data-width")&&(element.style("margin-right",""),element.style("margin-left",""),"full-width-retain-content"===element.attr("data-width")&&(element.style("padding-right",""),element.style("padding-left","")),element.removeAttr("data-width"))}),function(){var proxied=ContentEdit.Text.prototype._keyUp;ContentEdit.Text.prototype._keyUp=function(ev){var selection=ContentSelect.Range.query(this._domElement);if(("DivCol"===this.parent().constructor.name||"Div"===this.parent().constructor.name)&&0===this.parent().children.indexOf(this)&&0===selection.get()[0]){var row=this.parent().parent(),index=row.parent().children.indexOf(row);if(index>0&&row.parent().children[index-1].content)return void row.parent().children[index-1].focus();var p=new ContentEdit.Text("p",{},"");return row.parent().attach(p,index),void p.focus()}return proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Text.prototype._keyDown;ContentEdit.Text.prototype._keyDown=function(ev){var selection=ContentSelect.Range.query(this._domElement);if(("DivCol"===this.parent().constructor.name||"Div"===this.parent().constructor.name)&&this.parent().children.indexOf(this)===this.parent().children.length-1&&this._atEnd(selection)){var row=this.parent().parent(),index=row.parent().children.indexOf(row);if(index<row.parent().children.length-1&&row.parent().children[index+1].content)return void row.parent().children[index+1].focus();var p=new ContentEdit.Text("p",{},"");return row.parent().attach(p,index+1),void p.focus()}return proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Text.prototype.blur;ContentEdit.Text.prototype.blur=function(ev){if(this.content.isWhitespace()&&this.parent()&&("Div"===this.parent().constructor.name||"DivCol"===this.parent().constructor.name)){for(var otherWhitespaces=0,otherNonWhitespaces=0,i=0;i<this.parent().children.length;i++){var sibling=this.parent().children[i];sibling.content&&sibling.content.isWhitespace()?otherWhitespaces++:otherNonWhitespaces++}if(1===otherWhitespaces&&0===otherNonWhitespaces){var error;if(this.isMounted()&&this._syncContent(),this.isMounted()){try{this._domElement.blur()}catch(_error){error=_error}this._domElement.removeAttribute("contenteditable")}return ContentEdit.Text.__super__.blur.call(this)}}return proxied.call(this,ev)}}(),wp.hooks.addFilter("nhb.save",function(html){return html=html.replace(/(<[^>]+nhb-row[^>]+style=[^>]*[^-])(max-width:\s?[-0-9.\w]+;?\s?)([^>]+>)/g,"$1$3"),html=html.replace(/(<[^>]+nhb-row[^>]+style\=[^>]*[^-])(width:\s?[-0-9.\w]+;?\s?)([^>]+>)/g,"$1$3"),html=html.replace(/(<[^>]+nhb-row[^>]+style=[^>]*[^-])(left:\s?[-0-9.\w]+;?\s?)([^>]+>)/g,"$1$3"),html=html.replace(/(<div[^>]+>)\s+/gm,"$1"),html=html.replace(/\s+(<\/div>)/gm,"$1"),html=html.replace(/<[^>]+nhb-row[^>]+data-width\=["']full-width-retain-content["'][^>]+>/g,function(match){return match=match.replace(/(padding:\s?)([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)[;"']/,"padding-top: $2; padding-bottom: $4;"),match=match.replace(/(padding:\s?)([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)[;"']/,"padding-top: $2; padding-bottom: $4;"),match=match.replace(/(padding:\s?)([\d\w.]+)\s([\d\w.]+)[;"']/,"padding-top: $2; padding-bottom: $2;"),match=match.replace(/(padding:\s?)([\d\w.]+)[;"']/,"padding-top: $2; padding-bottom: $2;"),match=match.replace(/\s?padding-left:\s?[\d\w.]+;?\s?/g,""),match=match.replace(/\s?padding-right:\s?[\d\w.]+;?\s?/g,""),match=match.replace(/(margin:\s?)([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $4;"),match=match.replace(/(margin:\s?)([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $4;"),match=match.replace(/(margin:\s?)([\d\w.]+)\s([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $2;"),match=match.replace(/(margin:\s?)([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $2;"),match=match.replace(/\s?margin-left:\s?[\d\w.-]+;?\s?/g,""),match=match.replace(/\s?margin-right:\s?[\d\w.-]+;?\s?/g,""),match=match.replace(/([^-])left:\s?[-\d\w.]+;?\s?/g,"$1")}),html=html.replace(/<[^>]+nhb-row[^>]+data-width\=["']full-width["'][^>]+>/g,function(match){return match=match.replace(/(margin:\s?)([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $4;"),match=match.replace(/(margin:\s?)([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $4;"),match=match.replace(/(margin:\s?)([\d\w.]+)\s([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $2;"),match=match.replace(/(margin:\s?)([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $2;"),match=match.replace(/\s?margin-left:\s?[\d\w.-]+;?\s?/g,""),match=match.replace(/\s?margin-right:\s?[\d\w.-]+;?\s?/g,""),match=match.replace(/([^-])left:\s?[-\d\w.]+;?\s?/g,"$1")})}),function(){var _EditorApp=ContentTools.EditorApp.getCls(),proxied=_EditorApp.prototype.paste;_EditorApp.prototype.paste=function(element,clipboardData){var content,encodeHTML,i,insertAt,insertIn,insertNode,item,lastItem,line,lineLength,lines,type,_i,_len;if(content=clipboardData.getData("text/plain"),lines=content.split("\n"),lines=lines.filter(function(line){return""!==line.trim()}),!lines)return proxied.call(this,element,clipboardData);if(encodeHTML=HTMLString.String.encode,type=element.type(),"PreText"===type||"ListItemText"===type||"DivRow"!==element.parent().type())return proxied.call(this,element,clipboardData);if(lines.length>1||!element.content){for(insertNode=element,insertIn=insertNode.parent(),insertAt=insertIn.children.indexOf(insertNode)+1,i=_i=0,_len=lines.length;_len>_i;i=++_i)line=lines[i],line=encodeHTML(line),item=new ContentEdit.Text("p",{},line),lastItem=item,insertIn.attach(item,insertAt+i);return lineLength=lastItem.content.length(),lastItem.focus(),lastItem.selection(new ContentSelect.Range(lineLength,lineLength))}return proxied.call(this,element,clipboardData)}}(),ContentEdit.Icon=function(_super){function Icon(tagName,attributes,content){attributes["data-ce-tag"]||(attributes["data-ce-tag"]="icon"),attributes.role||(attributes.role="presentation"),Icon.__super__.constructor.call(this,tagName,attributes),this._content=content,this._domSizeInfoElement=null,this._aspectRatio=1}return __extends(Icon,_super),Icon.prototype.cssTypeName=function(){return"icon"},Icon.prototype.typeName=function(){return"Icon"},Icon.fromDOMElement=function(domElement){return new this(domElement.tagName,this.getDOMElementAttributes(domElement),domElement.innerHTML)},Icon.droppers=nhbEditor.allDroppers,Icon.prototype.focus=function(supressDOMFocus){var root;return root=ContentEdit.Root.get(),this.isFocused()?void 0:(root.focused()&&root.focused().blur(),this._addCSSClass("ce-element--focused"),root._focused=this,this.isMounted()&&!supressDOMFocus&&this.domElement().focus(),root.trigger("focus",this))},Icon.prototype.blur=function(){var root;return root=ContentEdit.Root.get(),this._removeCSSClass("ce-element--over"),this._removeCSSClass("ce-element--focused"),root._focused=null,root.trigger("blur",this)},Icon.prototype.mount=function(){var ret=Icon.__super__.mount.call(this),svg=this._domElement.children[0];return svg.setAttribute("xmlns","http://www.w3.org/2000/svg"),svg.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),svg.innerHTML=svg.innerHTML.trim()+" ",this._content=this._domElement.innerHTML,this._domElement.setAttribute("data-ce-size",this._getSizeInfo()),ret},Icon.prototype.change=function(svg){this._domElement.innerHTML=svg.outerHTML,this._content=this._domElement.innerHTML,this.taint()},Icon.prototype.clone=function(){this.isFocused()&&this.blur();var clone=document.createElement("div");clone.innerHTML=this.html();var newElem=ContentEdit.Div.fromDOMElement(clone.childNodes[0]),index=this.parent().children.indexOf(this);return this.parent().attach(newElem,index+1),newElem.focus(),newElem},Icon.prototype._onMouseOver=function(ev){return Icon.__super__._onMouseOver.call(this,ev),this._addCSSClass("ce-element--over")},Icon.droppers=nhbEditor.allDroppers,Icon.prototype.aspectRatio=function(){return this._aspectRatio},Icon.prototype.maxSize=function(){var maxWidth;return maxWidth=parseInt(this.attr("data-ce-max-width")||0,10),maxWidth||(maxWidth=ContentEdit.DEFAULT_MAX_ELEMENT_WIDTH),maxWidth=Math.max(maxWidth,this.size()[0]),[maxWidth,maxWidth*this.aspectRatio()]},Icon.prototype.minSize=function(){var minWidth;return minWidth=parseInt(this.attr("data-ce-min-width")||0,10),minWidth||(minWidth=20),minWidth=Math.min(minWidth,this.size()[0]),[minWidth,minWidth*this.aspectRatio()]},Icon.prototype.resize=function(corner,x,y){return this.isMounted()?ContentEdit.Root.get().startResizing(this,corner,x,y,!0):void 0},Icon.prototype._onDoubleClick=function(){nhbEditor.iconFrame.open({title:nhbParams.labels.icon_frame_change_title,button:nhbParams.labels.icon_frame_change_button,successCallback:function(frameView){this.change(frameView.selected.firstChild)}.bind(this)})},Icon.prototype.size=function(newSize){var height,maxSize,minSize,width;return newSize?(newSize[0]=parseInt(newSize[0],10),newSize[1]=parseInt(newSize[1],10),minSize=this.minSize(),newSize[0]=Math.max(newSize[0],minSize[0]),newSize[1]=Math.max(newSize[1],minSize[1]),maxSize=this.maxSize(),newSize[0]=Math.min(newSize[0],maxSize[0]),newSize[1]=Math.min(newSize[1],maxSize[1]),this.style("width",parseInt(newSize[0],10)+"px"),this.style("height",parseInt(newSize[1],10)+"px"),this.isMounted()?(this._domElement.style.width=newSize[0]+"px",this._domElement.style.height=newSize[1]+"px",this._domElement.setAttribute("data-ce-size",this._getSizeInfo())):void 0):(width=parseInt(this.style("width")||1,10),height=parseInt(this.style("height")||1,10),[width,height])},Icon.prototype._onMouseDown=function(ev){var corner;return Icon.__super__._onMouseDown.call(this,ev),corner=this._getResizeCorner(ev.clientX,ev.clientY),corner?(window.nhbEditor.isCtrlDown&&window.nhbEditor.isShiftDown&&(this.style("width","100px"),this.style("height","100px")),clearTimeout(this._dragTimeout),this.resize(corner,ev.clientX,ev.clientY)):(clearTimeout(this._dragTimeout),this._dragTimeout=setTimeout(function(_this){return function(){return _this.drag(ev.pageX,ev.pageY)}}(this),150))},Icon.prototype._onMouseMove=function(ev){var corner;return Icon.__super__._onMouseMove.call(this),this._removeCSSClass("ce-element--resize-top-left"),this._removeCSSClass("ce-element--resize-top-right"),this._removeCSSClass("ce-element--resize-bottom-left"),this._removeCSSClass("ce-element--resize-bottom-right"),corner=this._getResizeCorner(ev.clientX,ev.clientY),corner?this._addCSSClass("ce-element--resize-"+corner[0]+"-"+corner[1]):void 0},Icon.prototype._onMouseOut=function(ev){return Icon.__super__._onMouseOut.call(this,ev),this._removeCSSClass("ce-element--resize-top-left"),this._removeCSSClass("ce-element--resize-top-right"),this._removeCSSClass("ce-element--resize-bottom-left"),this._removeCSSClass("ce-element--resize-bottom-right")},Icon.prototype._onMouseUp=function(ev){return Icon.__super__._onMouseUp.call(this,ev),this._dragTimeout?clearTimeout(this._dragTimeout):void 0},Icon.prototype._getResizeCorner=function(x,y){var corner,cornerSize,rect,size,_ref;return rect=this._domElement.getBoundingClientRect(),_ref=[x-rect.left,y-rect.top],x=_ref[0],y=_ref[1],size=this.size(),cornerSize=ContentEdit.RESIZE_CORNER_SIZE,cornerSize=Math.min(cornerSize,Math.max(parseInt(size[0]/4,10),1)),cornerSize=Math.min(cornerSize,Math.max(parseInt(size[1]/4,10),1)),corner=null,cornerSize>x?cornerSize>y?corner=["top","left"]:y>rect.height-cornerSize&&(corner=["bottom","left"]):x>rect.width-cornerSize&&(cornerSize>y?corner=["top","right"]:y>rect.height-cornerSize&&(corner=["bottom","right"])),corner},Icon.prototype._getSizeInfo=function(){var size;return size=this.size(),"w "+size[0]+"  h "+size[1]},Icon}(ContentEdit.Static),ContentEdit.TagNames.get().register(ContentEdit.Icon,"icon"),ContentEdit.Html=function(_super){function Html(tagName,attributes,content){this.model=new Backbone.Model({}),Html.__super__.constructor.call(this,tagName,attributes),this._content=content}return __extends(Html,_super),Html.prototype.openEditor=function(){nhbEditor.htmlFrame.open({title:nhbParams.labels.html,button:nhbParams.labels.html_frame_button,successCallback:function(frameView){var html=frameView.getHtml();this._domElement.innerHTML=html,this._content=html,html||(this.nextContent()?this.nextContent().focus():this.previousContent()&&this.previousContent().focus(),this.parent().detach(this))}.bind(this),openCallback:function(frameView){frameView.setHtml(this._content)}.bind(this)})},Html.prototype._onDoubleClick=function(){this.openEditor()},Html.prototype.cssTypeName=function(){return"html"},Html.prototype.typeName=function(){return"Html"},Html.prototype.focus=function(supressDOMFocus){var root;return root=ContentEdit.Root.get(),this.isFocused()?void 0:(root.focused()&&root.focused().blur(),this._addCSSClass("ce-element--focused"),root._focused=this,this.isMounted()&&!supressDOMFocus&&this.domElement().focus(),root.trigger("focus",this))},Html.prototype.blur=function(){var root;return root=ContentEdit.Root.get(),this._removeCSSClass("ce-element--over"),this._removeCSSClass("ce-element--focused"),root._focused=null,root.trigger("blur",this)},Html.prototype._onMouseOver=function(ev){return Html.__super__._onMouseOver.call(this,ev),this._addCSSClass("ce-element--over")},Html}(ContentEdit.StaticEditable),ContentEdit.TagNames.get().register(ContentEdit.Html,"html"),wp.hooks.addFilter("nhb.toolbar.shortcode.label",function(scBase){return"nhb_sidebar"===scBase?nhbParams.labels.sidebar:scBase}),ContentEdit.Map=function(_super){function Map(tagName,attributes){attributes["data-ce-tag"]||(attributes["data-ce-tag"]="map"),this.model=new Backbone.Model({}),Map.__super__.constructor.call(this,tagName,attributes),this._content=""}return __extends(Map,_super),Map.prototype.blur=function(){var root=ContentEdit.Root.get();return this.isFocused()?(this._removeCSSClass("ce-element--over"),this._removeCSSClass("ce-element--focused"),root._focused=null,root.trigger("blur",this)):void 0},Map.prototype._onMouseOver=function(ev){return Map.__super__._onMouseOver.call(this,ev),this._addCSSClass("ce-element--over")},Map.prototype._onMouseUp=function(ev){Map.__super__._onMouseUp.call(this,ev),this.updateMapData(),this._removeCSSClass("nhb-map-editing"),this._dragging=!1,this._clicked=!1,clearInterval(this._forceCentered)},Map.prototype.updateMapData=function(){if(!this._dragging){var latlng=this._domElement.map.getCenter(),center=latlng.lat().toFixed(6)+", "+latlng.lng().toFixed(6);this.attr("data-center")!==center&&(this.attr("data-center",center),this.attr("data-lat",latlng.lat().toFixed(6)),this.attr("data-lng",latlng.lng().toFixed(6)),this.model.set("data-center",center),this._domElement.map.marker&&this._domElement.map.marker.setPosition(this._domElement.map.getCenter()));
}var zoom=this._domElement.map.getZoom();parseInt(this.attr("data-zoom"),10)!==zoom&&(this.attr("data-zoom",zoom),this.model.trigger("change",this.model))},Map.prototype._onMouseDown=function(ev){return this._clicked=!0,this.focus(),clearTimeout(this._dragTimeout),this._dragTimeout=setTimeout(function(_this){return function(){return _this._dragging=!0,_this.drag(ev.pageX,ev.pageY)}}(this),2*ContentEdit.DRAG_HOLD_DURATION)},Map.prototype._onMouseMove=function(ev){this._dragging||clearTimeout(this._dragTimeout),!this._dragging&&this._clicked&&this._addCSSClass("nhb-map-editing"),Map.__super__._onMouseMove.call(this,ev)},Map.droppers=nhbEditor.allDroppers,Map.prototype.focus=function(supressDOMFocus){var root;return root=ContentEdit.Root.get(),this.isFocused()?void 0:(root.focused()&&root.focused().blur(),this._addCSSClass("ce-element--focused"),root._focused=this,this.isMounted()&&!supressDOMFocus&&this.domElement().focus(),root.trigger("focus",this))},Map.prototype.cssTypeName=function(){return"map"},Map.prototype.typeName=function(){return"Map"},Map.prototype.mount=function(){var ret=Map.__super__.mount.call(this);return window.initnhbMaps(this._domElement,function(){google.maps.event.addListener(this._domElement.map,"zoom_changed",_.throttle(function(){this.updateMapData()}.bind(this),2)),google.maps.event.addListener(this._domElement.map,"drag",_.throttle(function(){this.updateMapData()}.bind(this),2))}.bind(this)),ret},Map.prototype.unmount=function(){return"undefined"!=typeof google&&google.maps.event.clearInstanceListeners(this._domElement.map),Map.__super__.unmount.call(this)},Map.create=function(){var o=document.createElement("DIV");return o.setAttribute("data-ce-tag","map"),o.setAttribute("data-ce-moveable",""),ContentEdit.Map.fromDOMElement(o)},Map}(ContentEdit.Static),ContentEdit.TagNames.get().register(ContentEdit.Map,"map"),window.addEventListener("DOMContentLoaded",function(){var editor=ContentTools.EditorApp.get();window.initnhbMaps&&editor.bind("stop",window.initnhbMaps);var mapRefreshInterval;window.nhbMapsReCenter&&(editor.bind("start",function(){mapRefreshInterval=setInterval(function(){document.querySelector(".ce-element--dragging")||document.querySelector(".nhb-map-editing")||window.nhbMapsReCenter()},1e3)}),editor.bind("stop",function(){clearInterval(mapRefreshInterval)}))}),ContentEdit.Tabs=function(_super){function Tabs(tagName,attributes){Tabs.__super__.constructor.call(this,tagName,attributes),this.isCompundElement=!0}return __extends(Tabs,_super),Tabs.prototype.cssTypeName=function(){return"tabs"},Tabs.prototype.type=function(){return"Tabs"},Tabs.prototype.typeName=function(){return"Tabs"},Tabs.fromDOMElement=function(domElement){var c,childNode,childNodes,list,_i,_len;list=new this(domElement.tagName,this.getDOMElementAttributes(domElement)),childNodes=function(){var _i,_len,_ref,_results;for(_ref=domElement.childNodes,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)c=_ref[_i],_results.push(c);return _results}();var tagNames=ContentEdit.TagNames.get();for(_i=0,_len=childNodes.length;_len>_i;_i++)if(childNode=childNodes[_i],1===childNode.nodeType){var cls;cls=childNode.getAttribute("data-ce-tag")?tagNames.match(childNode.getAttribute("data-ce-tag")):tagNames.match(childNode.tagName);var element=cls.fromDOMElement(childNode);element&&list.attach(element)}return list},Tabs.prototype.detachTabAndContent=function(tab){var inputID=tab._domElement.getAttribute("for"),inputElem=this._domElement.querySelector('[id="'+inputID+'"]')._ceElement,tabID=inputElem.attr("data-tab"),tabRow=this._domElement.querySelector('[data-panel="'+tabID+'"]')._ceElement;return inputElem.parent().detach(inputElem),tab.parent().detach(tab),tabRow.parent().detach(tabRow),this.reIndexTabs(),tabRow},Tabs.prototype.attachTabAndContent=function(tab,index,row){for(var tabsID=this._domElement.getAttribute("class").match(/nhb-tabs-(\w+)/)[0],tabIndex=this.numTabs()+1,hash=window.nhbEditor.generateHash();document.querySelector('[id="nhb-tab-'+hash+'"]');)hash=window.nhbEditor.generateHash();var radio=document.createElement("input");radio.classList.add("nhb-tab-state"),radio.setAttribute("type","radio"),radio.setAttribute("name",tabsID),radio.setAttribute("id","nhb-tab-"+hash),radio.setAttribute("data-tab",tabIndex),radio.setAttribute("data-ce-tag","static"),this.attach(ContentEdit.Static.fromDOMElement(radio),0),tab.attr("for","nhb-tab-"+hash),row.attr("data-panel",tabIndex),this._domElement.querySelector(".nhb-tab-tabs")._ceElement.attach(tab,index),this._domElement.querySelector(".nhb-tab-panels")._ceElement.attach(row)},Tabs.prototype.reIndexTabs=function(){for(var numTabs=this._domElement.querySelectorAll(".nhb-tab-state").length,i=1;numTabs>=i;i++){var radio=this._domElement.querySelector('[data-tab="'+i+'"]');radio||(radio=this._domElement.querySelector('[data-tab="'+(i+1)+'"]'),radio&&(radio._ceElement.attr("data-tab",i),this._domElement.querySelector('[data-panel="'+(i+1)+'"]')._ceElement.attr("data-panel",i)))}},Tabs.prototype.getOpenTab=function(){var radio=this._domElement.querySelector(".nhb-tab-state:checked")._ceElement,panel=this._domElement.querySelector('[data-panel="'+radio.attr("data-tab")+'"]');return panel||(panel=this._domElement.querySelector("[data-panel]")),panel._ceElement},Tabs.prototype.numTabs=function(){return this._domElement.querySelectorAll(".nhb-tab-state").length},Tabs.prototype.addTab=function(){var firstTab=this._domElement.querySelector(".nhb-tab-state")._ceElement,radioID="nhb-tab-"+window.nhbEditor.generateHash(),tabNum=this.numTabs()+1,radio=new ContentEdit.TabRadio("input",{"data-ce-tag":"tabradio","class":"nhb-tab-state","data-tab":tabNum,id:radioID,name:firstTab.attr("name"),type:"radio"});this.attach(radio,0);var tab=new ContentEdit.Tab("label",{"data-ce-tag":"tab","for":radioID},"<span>New Tab</span>"),tabContainer=this._domElement.querySelector(".nhb-tab-tabs")._ceElement;tabContainer.attach(tab,tabContainer.children.length),tabContainer.children.length&&tab.attr("style",tabContainer.children[0].attr("style"));var panelContainer=this._domElement.querySelector(".nhb-tab-panels")._ceElement,row=new ContentEdit.DivRow("div",{"data-panel":tabNum});panelContainer.attach(row);var col=new ContentEdit.DivCol("div");row.attach(col);var p=new ContentEdit.Text("p",{},"");col.attach(p),tab.openTab(),p.focus()},Tabs.prototype.removeTab=function(tab){if("undefined"==typeof tab){var radio=this._domElement.querySelector(".nhb-tab-state:checked")._ceElement;tab=this._domElement.querySelector('label[for="'+radio.attr("id")+'"]')._ceElement}var otherTab=tab.nextSibling();if(otherTab||(otherTab=tab.previousSibling()),this.detachTabAndContent(tab),otherTab)otherTab.openTab();else{this.blur();var focusTo=this.nextSibling();focusTo||(focusTo=this.previousSibling()),focusTo&&focusTo.focus(),this.parent().detach(this)}},Tabs.droppers=nhbEditor.allDroppers,Tabs}(ContentEdit.Div),ContentEdit.TagNames.get().register(ContentEdit.Tabs,"tabs"),ContentEdit.Tab=function(_super){function Tab(tagName,attributes,content){Tab.__super__.constructor.call(this,tagName,attributes,content)}return __extends(Tab,_super),Tab.prototype.cssTypeName=function(){return"tab"},Tab.prototype.type=function(){return"Tab"},Tab.prototype.typeName=function(){return"Tab"},Tab.prototype.parentTab=function(){return this.parent().parent()},Tab.prototype.setActiveTab=function(){var activeTab=this.parentTab()._domElement.querySelector(".nhb-tab-tabs .nhb-tab-active");activeTab&&activeTab._ceElement.removeCSSClass("nhb-tab-active"),this.addCSSClass("nhb-tab-active")},Tab.prototype._onMouseDown=function(ev){return setTimeout(function(){this.setActiveTab()}.bind(this),1),Tab.__super__._onMouseDown.call(this,ev)},Tab.prototype.openTab=function(){this.parentTab()._domElement.querySelector('[id="'+this.attr("for")+'"]').checked=!0,this.setActiveTab()},Tab._dropTab=function(element,target,placement){var insertIndex=target.parent().children.indexOf(target);if("left"!==placement[1]&&(insertIndex+=1),element.parent()!==target.parent()){var originalTabElement=element.parentTab(),otherTab=element.previousSibling();otherTab||(otherTab=element.nextSibling());var tabRow=element.parentTab().detachTabAndContent(element);return target.parentTab().attachTabAndContent(element,insertIndex,tabRow),element.openTab(),void(otherTab?otherTab.openTab():originalTabElement.parent().detach(originalTabElement))}return element.parent().detach(element),target.parent().attach(element,insertIndex)},Tab.prototype._onMouseOver=function(ev){var root=ContentEdit.Root.get();return root.dragging()&&this.openTab(),Tab.__super__._onMouseOver.call(this,ev)},Tab.droppers={Tab:Tab._dropTab},Tab.placements=["left","right"],Tab.prototype.focus=function(){return this.openTab(),Tab.__super__.focus.call(this)},Tab.prototype._keyReturn=function(ev){ev.preventDefault();var next=this.nextSibling();next&&next.focus()},Tab.prototype.isLastTab=function(){return this.parent().children.indexOf(this)===this.parent().children.length-1},Tab.prototype.getMatchingPanel=function(){var inputID=this.attr("for"),inputElem=this.parentTab()._domElement.querySelector('[id="'+inputID+'"]')._ceElement,tabID=inputElem.attr("data-tab");return this.parentTab()._domElement.querySelector('[data-panel="'+tabID+'"]')._ceElement},Tab.prototype.html=function(){var ret=Tab.__super__.html.call(this);if(0===this.parent().children.indexOf(this)){if(!ret.match(/nhb-tab-active/)){var r=new RegExp("(<"+this._tagName+"[^>]+class=['\"])");ret.match(r)?ret=ret.replace(r,"$1nhb-tab-active "):(r=new RegExp("(<"+this._tagName+")"),ret=ret.replace(r,'$1 class="nhb-tab-active"'))}}else ret=ret.replace(/\s*nhb-tab-active\s*/g,""),ret=ret.replace(/\s*class=[\'\"][\'\"]/g,"");return ret},Tab.prototype._keyLeft=function(ev){if(0===this.parent().children.indexOf(this)){var selection=ContentSelect.Range.query(this._domElement);0===selection.get()[0]&&selection.isCollapsed()&&this._keyUp(ev)}return Tab.__super__._keyLeft.call(this,ev)},Tab.prototype._keyUp=function(ev){if(0===this.parent().children.indexOf(this)){var selection=ContentSelect.Range.query(this._domElement);if(0===selection.get()[0]&&selection.isCollapsed()){var tabs=this.parent().parent(),index=tabs.parent().children.indexOf(tabs);if(index>0&&tabs.parent().children[index-1].content){var elem=tabs.parent().children[index-1];return elem.focus(),selection=new ContentSelect.Range(elem.content.length(),elem.content.length()),selection.select(elem.domElement())}var p=new ContentEdit.Text("p",{},"");tabs.parent().attach(p,index),p.focus()}}return Tab.__super__._keyUp.call(this,ev)},Tab.prototype._keyDown=function(ev){if(this.parent().children.indexOf(this)===this.parent().children.length-1){var selection=ContentSelect.Range.query(this._domElement);if(!this._atEnd(selection)||!selection.isCollapsed())return;if(this._atEnd(selection)){ev.preventDefault();var row=this.getMatchingPanel();return void row.children[0].children[0].focus()}}return Tab.__super__._keyDown.call(this,ev)},Tab.prototype._keyRight=function(ev){var selection=ContentSelect.Range.query(this._domElement);if(this._atEnd(selection)&&selection.isCollapsed()){if(this.isLastTab()){ev.preventDefault();var row=this.getMatchingPanel();return void row.children[0].children[0].focus()}return Tab.__super__._keyRight.call(this,ev)}},Tab}(ContentEdit.Text),ContentEdit.TagNames.get().register(ContentEdit.Tab,"tab"),ContentEdit.TabContainer=function(_super){function TabContainer(tagName,attributes){TabContainer.__super__.constructor.call(this,tagName,attributes)}return __extends(TabContainer,_super),TabContainer.prototype.cssTypeName=function(){return"tabcontainer"},TabContainer.prototype.type=function(){return"TabContainer"},TabContainer.prototype.typeName=function(){return"TabContainer"},TabContainer._dropOutside=function(element,target,placement){var insertIndex;return element.parent().detach(element),insertIndex=target.parent().parent().children.indexOf(target.parent()),"below"===placement[0]&&(insertIndex+=1),target.parent().parent().attach(element,insertIndex)},TabContainer.prototype._onOver=function(ev){var ret=TabContainer.__super__._onOver.call(this,ev);if(ret){var root=ContentEdit.Root.get();return this._removeCSSClass("ce-element--drop"),this.parent()._addCSSClass("ce-element--drop"),root._dropTarget=this.parent()}return ret},TabContainer.droppers={"*":TabContainer._dropOutside},TabContainer.prototype._onMouseUp=function(ev){TabContainer.__super__._onMouseUp.call(this,ev),clearTimeout(this._dragTimeout)},TabContainer.prototype._onMouseOut=function(ev){TabContainer.__super__._onMouseOut.call(this,ev),clearTimeout(this._dragTimeout)},TabContainer.prototype._onMouseDown=function(ev){return TabContainer.__super__._onMouseDown.call(this,ev),clearTimeout(this._dragTimeout),this.domElement()===ev.target?(ev.preventDefault(),this.draggableParent||(this.draggableParent=this.parent()),this._dragTimeout=setTimeout(function(_this){return function(){return _this.draggableParent.drag(ev.pageX,ev.pageY)}}(this),ContentEdit.DRAG_HOLD_DURATION)):void 0},TabContainer.fromDOMElement=function(domElement){var c,childNode,childNodes,list,_i,_len;list=new this(domElement.tagName,this.getDOMElementAttributes(domElement)),childNodes=function(){var _i,_len,_ref,_results;for(_ref=domElement.childNodes,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)c=_ref[_i],_results.push(c);return _results}();var tagNames=ContentEdit.TagNames.get();for(_i=0,_len=childNodes.length;_len>_i;_i++)if(childNode=childNodes[_i],1===childNode.nodeType){var cls;cls=childNode.getAttribute("data-ce-tag")?tagNames.match(childNode.getAttribute("data-ce-tag")):tagNames.match(childNode.tagName);var element=cls.fromDOMElement(childNode);element&&list.attach(element)}return list},TabContainer}(ContentEdit.Div),ContentEdit.TagNames.get().register(ContentEdit.TabContainer,"tabcontainer"),ContentEdit.TabPanelContainer=function(_super){function TabPanelContainer(tagName,attributes){TabPanelContainer.__super__.constructor.call(this,tagName,attributes)}return __extends(TabPanelContainer,_super),TabPanelContainer.prototype.cssTypeName=function(){return"tabpanelcontainer"},TabPanelContainer.prototype.type=function(){return"TabPanelContainer"},TabPanelContainer.prototype.typeName=function(){return"TabPanelContainer"},TabPanelContainer.fromDOMElement=function(domElement){var c,childNode,childNodes,list,_i,_len;list=new this(domElement.tagName,this.getDOMElementAttributes(domElement)),childNodes=function(){var _i,_len,_ref,_results;for(_ref=domElement.childNodes,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)c=_ref[_i],_results.push(c);return _results}();var tagNames=ContentEdit.TagNames.get();for(_i=0,_len=childNodes.length;_len>_i;_i++)if(childNode=childNodes[_i],1===childNode.nodeType){var cls;cls=childNode.getAttribute("data-ce-tag")?tagNames.match(childNode.getAttribute("data-ce-tag")):tagNames.match(childNode.tagName);var element=cls.fromDOMElement(childNode);element&&list.attach(element)}return list},TabPanelContainer}(ContentEdit.Div),ContentEdit.TagNames.get().register(ContentEdit.TabPanelContainer,"tabpanelcontainer"),ContentEdit.TabRadio=function(_super){function TabRadio(tagName,attributes){TabRadio.__super__.constructor.call(this,tagName,attributes)}return __extends(TabRadio,_super),TabRadio.prototype.cssTypeName=function(){return"tabradio"},TabRadio.prototype.type=function(){return"TabRadio"},TabRadio.prototype.typeName=function(){return"TabRadio"},TabRadio.prototype.mount=function(){var ret=TabRadio.__super__.mount.call(this);return this._domElement.setAttribute("disabled","disabled"),ret},TabRadio.prototype.unmount=function(){return this._domElement.removeAttribute("disabled"),TabRadio.__super__.unmount.call(this)},TabRadio}(ContentEdit.Static),ContentEdit.TagNames.get().register(ContentEdit.TabRadio,"tabradio"),wp.hooks.addFilter("nhb.overlay.margin_top.can_apply",function(apply,element){if(element&&element._domElement&&element._domElement.parentNode&&element._domElement.parentNode.classList){var parent=element._domElement.parentNode;if(parent.classList&&parent.classList.contains("nhb-tab-tabs"))return!1}return apply}),wp.hooks.addFilter("nhb.overlay.margin_bottom.can_apply",function(apply,element){if(element&&element._domElement&&element._domElement.parentNode&&element._domElement.parentNode.classList){var parent=element._domElement.parentNode;if(parent.classList&&parent.classList.contains("nhb-tab-tabs"))return!1}return apply}),function(){var proxied=ContentEdit.Text.prototype._keyUp;ContentEdit.Text.prototype._keyUp=function(ev){var selection=ContentSelect.Range.query(this._domElement);if("DivCol"===this.parent().constructor.name&&0===this.parent().children.indexOf(this)&&0===selection.get()[0]&&"TabPanelContainer"===this.parent().parent().parent().constructor.name){ev.preventDefault();var tabs=this.parent().parent().parent().parent()._domElement.querySelector(".nhb-tab-tabs")._ceElement,tab=tabs.children[tabs.children.length-1];return tab.focus(),selection=new ContentSelect.Range(tab.content.length(),tab.content.length()),selection.select(tab.domElement())}return proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Text.prototype._keyLeft;ContentEdit.Text.prototype._keyLeft=function(ev){var selection=ContentSelect.Range.query(this._domElement);if("DivCol"===this.parent().constructor.name&&0===this.parent().children.indexOf(this)&&0===this.parent().parent().children.indexOf(this.parent())&&0===selection.get()[0]&&"TabPanelContainer"===this.parent().parent().parent().constructor.name){ev.preventDefault();var tabs=this.parent().parent().parent().parent()._domElement.querySelector(".nhb-tab-tabs")._ceElement,tab=tabs.children[tabs.children.length-1];return tab.focus(),selection=new ContentSelect.Range(tab.content.length(),tab.content.length()),selection.select(tab.domElement())}return proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Text.prototype._keyDown;ContentEdit.Text.prototype._keyDown=function(ev){var selection=ContentSelect.Range.query(this._domElement);if("DivCol"===this.parent().constructor.name&&this.parent().children.indexOf(this)===this.parent().children.length-1&&this._atEnd(selection)&&"TabPanelContainer"===this.parent().parent().parent().constructor.name){var tabs=this.parent().parent().parent().parent(),index=tabs.parent().children.indexOf(tabs);if(index<tabs.parent().children.length-1&&tabs.parent().children[index+1].content)return ev.preventDefault(),tabs.parent().children[index+1].focus(),selection=new ContentSelect.Range(0,0),selection.select(tabs.parent().children[index+1]._domElement);var p=new ContentEdit.Text("p",{},"");return tabs.parent().attach(p,index+1),void p.focus()}return proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Text.prototype._keyRight;ContentEdit.Text.prototype._keyRight=function(ev){var selection=ContentSelect.Range.query(this._domElement);if("DivCol"===this.parent().constructor.name&&this.parent().children.indexOf(this)===this.parent().children.length-1&&this.parent().parent().children.indexOf(this.parent())===this.parent().parent().children.length-1&&this._atEnd(selection)&&"TabPanelContainer"===this.parent().parent().parent().constructor.name){var tabs=this.parent().parent().parent().parent(),index=tabs.parent().children.indexOf(tabs);if(index<tabs.parent().children.length-1&&tabs.parent().children[index+1].content)return ev.preventDefault(),void tabs.parent().children[index+1].focus();var p=new ContentEdit.Text("p",{},"");return tabs.parent().attach(p,index+1),void p.focus()}return proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Node.prototype.previous;ContentEdit.Node.prototype.previous=function(){var node=proxied.call(this);if(node&&node._domElement&&window.nhbSelectorMatches(node._domElement,".nhb-tab-panels *")&&0===node._domElement.offsetWidth&&0===node._domElement.offsetHeight){for(var tabs=node.parent().parent();tabs&&"Tabs"!==tabs.constructor.name;)tabs=tabs.parent();if(tabs){node=tabs.getOpenTab();for(var allVisibles=node._domElement.querySelectorAll("*"),i=allVisibles.length-1;i>=0;i--)if(allVisibles[i]._ceElement)return allVisibles[i]._ceElement}}return node}}(),function(){var proxied=ContentEdit.DivCol.prototype._onMouseDown;ContentEdit.DivCol.prototype._onMouseDown=function(ev){return this.parent().parent()._domElement.classList.contains("nhb-tab-panels")&&(this.draggableParent=this.parent().parent().parent()),proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.DivRow.prototype._onOver;ContentEdit.DivRow.prototype._onOver=function(ev){var ret=proxied.call(this,ev);if(ret&&"TabPanelContainer"===this.parent().constructor.name){var root=ContentEdit.Root.get();return this._removeCSSClass("ce-element--drop"),this.parent().parent()._addCSSClass("ce-element--drop"),root._dropTarget=this.parent().parent()}return ret}}();var root=ContentEdit.Root.get();root._overrideImageOnStopResizing=root._onStopResizing,root._onStopResizing=function(ev){if("Image"===this._resizing.constructor.name){var match=this._resizing._attributes["class"].match(/size-\w+/);match&&this._resizing.removeCSSClass(match[0]),this._resizing.style("height","auto")}return this._overrideImageOnStopResizing(ev)}.bind(root),ContentEdit.Image.prototype._onDblclick=function(){this.openMediaManager()},ContentEdit.Image.prototype.openMediaManager=function(){var frame=wp.media.editor.open("edit",{frame:"image",state:"image-details",metadata:_nhbImageGetMetaData(this._domElement)});frame.state("image-details").on("update",function(imageData){_nhbUpdateNonCaptionedImageCTElement(this,imageData)}.bind(this)),frame.state("replace-image").on("replace",function(imageData){_nhbUpdateNonCaptionedImageCTElement(this,imageData)}.bind(this)),frame.on("close",function(){wp.media.editor.remove("edit"),frame.detach()})},ContentEdit.Image.prototype._removeDOMEventListeners=function(){this._domElement.removeEventListener("dblclick",this._onDblClickBound),window.removeEventListener("keydown",this._onKeyDownBound)},ContentEdit.Image.prototype.mount=function(){var i;if(this._attributes){var responsiveAttributes=["srcset","sizes","data-lazy-loaded","data-lazy-src","data-pin-nopin","src-orig","scale"];for(i=0;i<responsiveAttributes.length;i++)this._attributes[responsiveAttributes[i]]&&delete this._attributes[responsiveAttributes[i]]}if(this._attributes&&this._attributes["class"]){var classes=this._attributes["class"].split(" ");-1!==classes.indexOf("alignnone")&&(classes[classes.indexOf("alignnone")]="aligncenter",this._attributes["class"]=classes.join(" "))}this._domElement=document.createElement("img");for(i in this._attributes)this._attributes.hasOwnProperty(i)&&this._attributes[i]&&this._domElement.setAttribute(i,this._attributes[i]);return this._onDblClickBound=this._onDblclick.bind(this),this._domElement.addEventListener("dblclick",this._onDblClickBound),this._onKeyDownBound=this._onKeyDown.bind(this),window.addEventListener("keydown",this._onKeyDownBound),ContentEdit.Image.__super__.mount.call(this)},ContentEdit.Image.prototype._onKeyDown=function(ev){16!==ev.keyCode&&91!==ev.keyCode&&93!==ev.keyCode&&(ev.ctrlKey||ev.metaKey||-1===["input","select","textarea","button"].indexOf(ev.target.tagName.toLowerCase())&&this.isFocused()&&(ev.preventDefault(),ContentTools.Tools.Paragraph.apply(this,null,function(){})))},ContentEdit.Image._dropBoth=function(element,target,placement){var insertIndex;return element.parent().detach(element),insertIndex=target.parent().children.indexOf(target),"below"===placement[0]&&"center"===placement[1]&&(insertIndex+=1),element.removeCSSClass("alignleft"),element.removeCSSClass("alignright"),element.removeCSSClass("aligncenter"),element.removeCSSClass("alignnone"),-1!==["left","right","center"].indexOf(placement[1])&&element.addCSSClass("align"+placement[1]),target.parent().attach(element,insertIndex)},ContentEdit.Image.droppers={Image:ContentEdit.Image._dropBoth,PreText:ContentEdit.Image._dropBoth,Static:ContentEdit.Image._dropBoth,Text:ContentEdit.Image._dropBoth},wp.hooks.addFilter("nhb.shortcode.allow_raw_edit",function(allow,scBase,element){if("caption"===scBase){var target=element._domElement.querySelector("img"),frame=wp.media.editor.open("edit",{frame:"image",state:"image-details",metadata:_nhbImageGetMetaData(target)});return frame.state("image-details").on("update",function(imageData){_nhbUpdateNonCaptionedImage(target,imageData)}),frame.state("replace-image").on("replace",function(imageData){_nhbUpdateNonCaptionedImage(target,imageData)}),frame.on("close",function(){wp.media.editor.remove("edit"),frame.detach()}),!1}return allow});var _nhbToolbarImageHasTextContent=function(node){return node&&!(!node.textContent&&!node.innerText)},_nhbToolbarImageGetParent=function(node,className){for(;node&&node.parentNode;){if(node.className&&-1!==(" "+node.className+" ").indexOf(" "+className+" "))return node;node=node.parentNode}return!1},_nhbUpdateNonCaptionedImage=function(imageNode,imageData){var classes,node,captionNode,id,attrs,linkAttrs,width,height,align;classes=imageData.extraClasses.split(" "),classes||(classes=[]),imageData.caption||classes.push("align"+imageData.align),imageData.attachment_id&&(classes.push("wp-image-"+imageData.attachment_id),imageData.size&&"custom"!==imageData.size&&classes.push("size-"+imageData.size)),width=imageData.width,height=imageData.height,"custom"===imageData.size&&(width=imageData.customWidth,height=imageData.customHeight),attrs={src:imageData.url,width:width||null,height:height||null,alt:imageData.alt,title:imageData.title||null,"class":classes.join(" ")||null};for(var key in attrs)attrs.hasOwnProperty(key)&&imageNode.setAttribute(key,attrs[key]);if(linkAttrs={href:imageData.linkUrl,rel:imageData.linkRel||null,target:imageData.linkTargetBlank?"_blank":null,"class":imageData.linkClassName||null},imageNode.parentNode&&"A"===imageNode.parentNode.nodeName&&!_nhbToolbarImageHasTextContent(imageNode.parentNode))if(imageData.linkUrl)for(key in linkAttrs)linkAttrs.hasOwnProperty(key)&&null!==linkAttrs[key]&&imageNode.parentNode.setAttribute(key,linkAttrs[key]);else{var oldA=imageNode.parentNode;oldA.parentNode.insertBefore(imageNode,oldA),oldA.parentNode.removeChild(oldA)}else if(imageData.linkUrl){var linkNode=_nhbToolbarImageGetParent(imageNode,"a");linkNode&&imageNode.parentNode.insertBefore(linkNode,imageNode.nextSibling),linkNode=document.createElement("a");for(var i in linkAttrs)linkAttrs.hasOwnProperty(i)&&null!==linkAttrs[i]&&linkNode.setAttribute(i,linkAttrs[i]);imageNode.parentNode.insertBefore(linkNode,imageNode),linkNode.appendChild(imageNode)}captionNode=_nhbToolbarImageGetParent(imageNode,".mceTemp"),node=imageNode.parentNode&&"A"===imageNode.parentNode.nodeName&&!_nhbToolbarImageHasTextContent(imageNode.parentNode)?imageNode.parentNode:imageNode;for(var textElement=null,currElement=node;currElement;){if(currElement._ceElement){textElement=currElement._ceElement;break}currElement=currElement.parentNode}var parent,index,newElem;if(imageData.caption){id=imageData.attachment_id?"attachment_"+imageData.attachment_id:null,align="align"+(imageData.align||"none");var scData={tag:"caption",type:"closed",content:node.outerHTML+" "+imageData.caption,attrs:{id:id,align:align,width:width}},shortcode=new wp.shortcode(scData).string();parent=textElement.parent(),index=parent.children.indexOf(textElement),shortcode=wp.shortcode.next("caption",shortcode,0),newElem=ContentEdit.Shortcode.createShortcode(shortcode),parent.attach(newElem,index),parent.detach(textElement),newElem.ajaxUpdate(!0),newElem.focus(),textElement=newElem}else parent=textElement.parent(),index=parent.children.indexOf(textElement),newElem=ContentEdit.Image.fromDOMElement(node),parent.attach(newElem,index),parent.detach(textElement),newElem.focus()},_nhbToolbarImageGetParent=function(node,className){for(;node&&node.parentNode;){if(node.className&&-1!==(" "+node.className+" ").indexOf(" "+className+" "))return node;node=node.parentNode}return!1},_nhbUpdateNonCaptionedImageCTElement=function(imageNode,imageData){var classes,id,attrs,linkAttrs,width,height,align;classes=imageData.extraClasses.split(" "),classes||(classes=[]),imageData.caption||classes.push("align"+imageData.align),imageData.attachment_id&&(classes.push("wp-image-"+imageData.attachment_id),imageData.size&&"custom"!==imageData.size&&classes.push("size-"+imageData.size)),width=imageData.width,height=imageData.height,"custom"===imageData.size&&(width=imageData.customWidth,height=imageData.customHeight),attrs={src:imageData.url,width:width||null,height:height||null,alt:imageData.alt,title:imageData.title||null,"class":classes.join(" ")||null},imageNode._aspectRatio=height/width,imageNode.size([width,height]);var cls=imageNode.attr("class").match(/wp-image-\d+/);cls&&imageNode.removeCSSClass(cls[0]),cls=imageNode.attr("class").match(/size-\w+/),cls&&imageNode.removeCSSClass(cls[0]),imageNode.removeCSSClass("alignleft"),imageNode.removeCSSClass("alignright"),imageNode.removeCSSClass("aligncenter"),imageNode.removeCSSClass("alignnone");for(var i=0;i<classes.length;i++)classes[i]&&imageNode.addCSSClass(classes[i]);for(var key in attrs)attrs.hasOwnProperty(key)&&"class"!==key&&(null!==attrs[key]?imageNode.attr(key,attrs[key]):imageNode.removeAttr(key));if(linkAttrs={href:imageData.linkUrl,rel:imageData.linkRel||null,target:imageData.linkTargetBlank?"_blank":null,"class":imageData.linkClassName||null},imageNode.a)if(imageData.linkUrl)for(key in linkAttrs)linkAttrs.hasOwnProperty(key)&&(null!==linkAttrs[key]?imageNode.a[key]=linkAttrs[key]:delete imageNode.a[key]);else imageNode.a=null;else if(imageData.linkUrl){imageNode.a={};for(key in linkAttrs)linkAttrs.hasOwnProperty(key)&&null!==linkAttrs[key]&&(imageNode.a[key]=linkAttrs[key])}if(imageData.caption){id=imageData.attachment_id?"attachment_"+imageData.attachment_id:null,align="align"+(imageData.align||"none");var scData={tag:"caption",type:"closed",content:imageNode.html()+" "+imageData.caption,attrs:{id:id,align:align,width:width}},shortcode=new wp.shortcode(scData),newElem=ContentEdit.Shortcode.createShortcode(wp.shortcode.next("caption",shortcode.string(),0)),index=imageNode.parent().children.indexOf(imageNode);return imageNode.parent().attach(newElem,index),imageNode.parent().detach(imageNode),void newElem.ajaxUpdate(!0)}},_nhbImageGetMetaData=function(img){var i,attachmentID=img.getAttribute("class").match(/wp-image-(\d+)/),align=img.getAttribute("class").match(/align(\w+)/),size=img.getAttribute("class").match(/size-(\w+)/),tmpClasses=img.getAttribute("class").split(" "),extraClasses=[],classRegex=/wp-image-\d+|align\w+|size-\w+|ce-element[-\w]*/;if(img._ceElement&&img._ceElement.a&&img._ceElement.a["class"]){var aClasses=img._ceElement.a["class"].split(" ");for(i=0;i<aClasses.length;i++)aClasses[i].match(classRegex)||extraClasses.push(aClasses[i])}for(i=0;i<tmpClasses.length;i++)tmpClasses[i].match(classRegex)||extraClasses.push(tmpClasses[i]);var metadata={attachment_id:attachmentID?attachmentID[1]:!1,size:size?size[1]:"custom",caption:"",align:align?align[1]:"none",extraClasses:extraClasses.join(" "),link:!1,linkUrl:"",linkClassName:"",linkTargetBlank:!1,linkRel:"",title:""};metadata.url=img.getAttribute("src"),metadata.alt=img.getAttribute("alt"),metadata.title=img.getAttribute("title");var width=img.getAttribute("width"),height=img.getAttribute("height");metadata.customWidth=metadata.width=width,metadata.customHeight=metadata.height=height;for(var captionClassName=[],captionBlock=img.parentNode;null!==captionBlock&&"undefined"!=typeof captionBlock.classList&&!captionBlock.classList.contains("wp-caption");)captionBlock=captionBlock.parentNode;if(captionBlock&&captionBlock.classList){var classes=captionBlock.classList;for(i=0;i<classes.length;i++){var c=classes.item(i);/^align/.test(c)?metadata.align=c.replace("align",""):c&&"wp-caption"!==c&&captionClassName.push(c)}metadata.captionClassName=captionClassName.join(" ");var caption=captionBlock.querySelector(".wp-caption-text");
caption&&(metadata.caption=caption.innerHTML.replace(/<br[^>]*>/g,"$&\n").replace(/^<p>/,"").replace(/<\/p>$/,""))}if(img.parentNode&&"A"===img.parentNode.nodeName){var link=img.parentNode;metadata.linkUrl=link.getAttribute("href"),metadata.linkTargetBlank="_blank"===link.getAttribute("target")?!0:!1,metadata.linkRel=link.getAttribute("rel"),metadata.linkClassName=link.className}return img._ceElement&&img._ceElement.a&&(metadata.linkUrl=img._ceElement.a.href,metadata.linkTargetBlank="_blank"===img._ceElement.a.target?!0:!1,metadata.linkRel=img._ceElement.a.rel,metadata.linkClassName=img._ceElement.a["class"]),metadata};window.addEventListener("DOMContentLoaded",function(){if(document.querySelector('[data-name="main-content"]')){for(var editableArea=document.querySelector('[data-name="main-content"]'),selector="a:not([data-ce-tag]) > img.alignright, a:not([data-ce-tag]) > img.alignleft, a:not([data-ce-tag]) > img.aligncenter, a:not([data-ce-tag]) > img.alignnone, p > img.alignright, p > img.alignleft, p > img.aligncenter, p > img.alignnone";editableArea.querySelector(selector);){var el=editableArea.querySelector(selector),mainImageNode=el;if("A"===el.parentNode.tagName&&(mainImageNode=el.parentNode,mainImageNode.setAttribute("data-ce-tag","img")),"P"===mainImageNode.parentNode.tagName){var clonedPNode,p=mainImageNode.parentNode,startingIndex=p.innerHTML.indexOf(mainImageNode.outerHTML),endingIndex=startingIndex+mainImageNode.outerHTML.length,tip=p.innerHTML.substr(0,startingIndex).trim(),tail=p.innerHTML.substr(endingIndex).trim(),newContent="";""!==tip&&(clonedPNode=p.cloneNode(),clonedPNode.innerHTML=tip,newContent+=clonedPNode.outerHTML),newContent+=mainImageNode.outerHTML,""!==tail&&(clonedPNode=p.cloneNode(),clonedPNode.innerHTML=tail,newContent+=clonedPNode.outerHTML),p.outerHTML=newContent}}for(;editableArea.querySelector('img ~ br, [data-ce-tag="img"] ~ br');)editableArea.querySelector('img ~ br, [data-ce-tag="img"] ~ br').remove()}}),wp.hooks.addFilter("nhb.save",function(html){return html=html.replace(/\sdata-ce-tag=["']img["']/g,""),html=html.replace(/(<a[^>]*)\sclass((\s|>)[^>]*>)/g,"$1$2"),html=html.replace(/((<a[^>]+>\s*)?<img[^>]*>(\s*<\/a>)?)\s*(<p[^\w>]*>)/g,"$4$1"),html=html.replace(/(<[^pa][^>]*>\s*)(<img[^>]*>)/g,"$1<p>$2</p>"),html=html.replace(/(<[^p][^>]*>\s*)(<a[^>]+>\s*<img[^>]*>\s*<\/a>)/g,"$1<p>$2</p>"),html=html.replace(/((<a[^>]+>\s*)?<img[^>]*>(\s*<\/a>)?)\s*(<br[^>]*>)*/g,"$1")}),wp.hooks.addFilter("nhb.toolbar.shortcode.label",function(scBase){return"nhb_widget"===scBase?nhbParams.labels.widget:scBase}),wp.hooks.addFilter("nhb.inspector.do_add_section_options",function(doContinue,optionName,model,divGroup,element,toolboxUI){return"widgetSettings"===optionName&&model&&model.attributes&&model.attributes.widget&&(doContinue=!!document.querySelector("#tmpl-nhb-widget-"+model.attributes.widget),doContinue||toolboxUI.addGenericShortcodeOptions(divGroup,element)),doContinue}),HTMLString.String.prototype.removeStyles=function(){var c,from,i,newString,to,_i,newStyles,tagName;for(from=arguments[0],to=arguments[1],tagName=arguments[2],newStyles=arguments[3],0>to&&(to=this.length()+to+1),0>from&&(from=this.length()+from),newString=this.copy(),i=_i=from;to>=from?to>_i:_i>to;i=to>=from?++_i:--_i)if(c=newString.characters[i],c._tags.length)for(var z=c._tags.length-1;z>=0;z--)"a"!==c.tags()[z].name()&&newString.characters[i].removeTags(c.tags()[z]);return newString.optimize(),newString},HTMLString.String.prototype.hasStyle=function(){var c,from,i,to,_i,styleName=null;for(from=arguments[0],to=arguments[1],arguments.length>=3&&(styleName=arguments[2]),0>to&&(to=this.length()+to+1),0>from&&(from=this.length()+from),i=_i=from;to>=from?to>_i:_i>to;i=to>=from?++_i:--_i)if(c=this.characters[i],c&&c._tags.length)if(styleName){var currentStyles=window.cssToStyleObject(c.tags()[0].attr("style"));if("undefined"!=typeof currentStyles[styleName])return currentStyles[styleName]}else{if(-1!==["b","strong","i","em"].indexOf(c.tags()[0].name()))return!0;if(c.tags()[0].attr("style"))return!0}return!1},HTMLString.String.prototype.style=function(){var c,from,i,newString,tags,to,_i,newStyles,tagName;from=arguments[0],to=arguments[1],tagName=arguments[2],newStyles=arguments[3],tags=new HTMLString.Tag("span"),0>to&&(to=this.length()+to+1),0>from&&(from=this.length()+from);var dummy=document.createElement(tagName);for(dummy.style.display="none",document.body.appendChild(dummy),newString=this.copy(),i=_i=from;to>=from?to>_i:_i>to;i=to>=from?++_i:--_i){c=newString.characters[i],c._tags.length||c.addTags(tags);for(var isBr=!1,z=0;z<c._tags.length;z++)if("br"===c._tags[z].name()){isBr=!0;break}if(!isBr){var currentStyles=window.cssToStyleObject(c.tags()[0].attr("style"));for(var styleName in newStyles){if(newStyles.hasOwnProperty(styleName)&&newStyles[styleName]){"string"==typeof newStyles[styleName]?newStyles[styleName]=["",newStyles[styleName]]:""!==newStyles[styleName][0]&&newStyles[styleName].unshift("");for(var applyStyle,expectedStyleValue=newStyles[styleName][newStyles[styleName].length-1],k=0;k<newStyles[styleName].length;k++){applyStyle=newStyles[styleName][k];var dummyStyleAttribute="";applyStyle&&(dummyStyleAttribute='style="'+styleName+": "+applyStyle+'"'),dummy.innerHTML="<span "+dummyStyleAttribute+">"+c.c()+"</span>";var appliedStyles=window.getComputedStyle(dummy.firstChild);if(appliedStyles[styleName]===expectedStyleValue)break}currentStyles[styleName]=applyStyle}else delete currentStyles[styleName];""===currentStyles[styleName]&&delete currentStyles[styleName]}newString.characters[i]._tags[0].attr("style",window.cssToStyleString(currentStyles)),"span"===newString.characters[i]._tags[0].name()&&""===newString.characters[i]._tags[0].attr("style").trim()&&newString.characters[i].removeTags()}}return document.body.removeChild(dummy),newString.optimize(),newString},HTMLString.String.prototype.getStyle=function(styleName,element){var dashedStyleName=styleName;styleName=styleName.replace(/-([a-z])/g,function(m,w){return w.toUpperCase()});var nodeToCheck=element._domElement,nodeHTML=this.html(),foundNode=!1;if(0===nodeHTML.indexOf("<"))for(var i=0;i<element._domElement.children.length;i++)if(element._domElement.children[i].outerHTML===nodeHTML){nodeToCheck=element._domElement.children[i],foundNode=!0;break}if(!foundNode&&0===nodeHTML.indexOf("<")){var styleRegex=new RegExp("(<\\w+[^>]+style=[^>]*[^-]"+dashedStyleName+":\\s*)([\\w.]+)"),match=nodeHTML.match(styleRegex);if(match)return match[2]}return getComputedStyle(nodeToCheck)[styleName]},HTMLString.Character.prototype.addTags=function(){var tag,tags,_i,_len,_results;for(tags=1<=arguments.length?__slice.call(arguments,0):[],_results=[],_i=0,_len=tags.length;_len>_i;_i++)tag=tags[_i],Array.isArray(tag)||(tag.selfClosing()?this.isTag()||this._tags.unshift(tag.copy()):_results.push(this._tags.push(tag.copy())));return _results},window.addEventListener("DOMContentLoaded",function(){wp.media.frames.nhbSelectImage=wp.media({title:nhbParams.labels.select_image,multiple:!1,library:{type:"image"},button:{text:nhbParams.labels.use_selected_image}}),nhbEditor.openMediaManager=function(callback,selectedImageID){wp.media.frames.nhbSelectImage.callback=function(){wp.media.frames.nhbSelectImage.off("close",wp.media.frames.nhbSelectImage.callback),wp.media.frames.nhbSelectImage.off("select",wp.media.frames.nhbSelectImage.callback);var selection=wp.media.frames.nhbSelectImage.state().get("selection");if(selection){var ret=null;selection.each(function(attachment){ret=attachment}),ret&&callback(ret)}},wp.media.frames.nhbSelectImage.on("close",wp.media.frames.nhbSelectImage.callback),wp.media.frames.nhbSelectImage.on("select",wp.media.frames.nhbSelectImage.callback),wp.media.frames.nhbSelectImage._onOpen=function(){wp.media.frames.nhbSelectImage.off("open",wp.media.frames.nhbSelectImage._onOpen);var selection=wp.media.frames.nhbSelectImage.state().get("selection");if(selection){for(;selection.length;)selection.remove(selection.first());if(selectedImageID){var attachment=wp.media.attachment(selectedImageID);attachment&&selection.add(attachment)}}},wp.media.frames.nhbSelectImage.on("open",wp.media.frames.nhbSelectImage._onOpen),wp.media.frames.nhbSelectImage.open()}}),window.addEventListener("DOMContentLoaded",function(){if(document.querySelector('[data-name="main-content"]')){var appendWidgetTemplates=function(ajaxResponse){localStorage.setItem("nhb_get_widget_templates_hash",nhbParams.widget_list_hash),localStorage.setItem("nhb_get_widget_templates",ajaxResponse);var dummy=document.createElement("DIV");for(dummy.innerHTML=ajaxResponse;dummy.firstChild;)document.body.appendChild(dummy.firstChild)},storedWidgetHash=localStorage.getItem("nhb_get_widget_templates_hash"),storedWidgets=localStorage.getItem("nhb_get_widget_templates");if(storedWidgetHash===nhbParams.widget_list_hash&&storedWidgets)return void appendWidgetTemplates(storedWidgets);var payload=new FormData;payload.append("action","nhb_get_widget_templates"),payload.append("nonce",nhbParams.nonce);var xhr=new XMLHttpRequest;xhr.onload=function(){xhr.status>=200&&xhr.status<400&&appendWidgetTemplates(xhr.responseText)},xhr.open("POST",nhbParams.ajax_url),xhr.send(payload)}}),ContentTools.ToolboxBarUI=function(_super){function ToolboxBarUI(tools){ToolboxBarUI.__super__.constructor.call(this),this._tools=tools,this._toolUIs={}}return __extends(ToolboxBarUI,_super),ToolboxBarUI.prototype.isDragging=function(){return!1},ToolboxBarUI.prototype.hide=function(){return this._removeDOMEventListeners(),ToolboxBarUI.__super__.hide.call(this)},ToolboxBarUI.prototype.tools=function(tools){return void 0===tools?this._tools:(this._tools=tools,this.unmount(),this.mount())},ToolboxBarUI.prototype.mount=function(){var domToolGroup,i,tool,toolGroup,toolName,_i,_j,_len,_len1,_ref;for(this._domElement=this.constructor.createDiv(["nhb-toolbox-bar","ct-widget","ct-toolbox"]),document.body.appendChild(this._domElement),_ref=this._tools,i=_i=0,_len=_ref.length;_len>_i;i=++_i)for(toolGroup=_ref[i],domToolGroup=this.constructor.createDiv(["ct-tool-group"]),this._domElement.appendChild(domToolGroup),_j=0,_len1=toolGroup.length;_len1>_j;_j++)toolName=toolGroup[_j],"|"!==toolName?(tool=ContentTools.ToolShelf.fetch(toolName),this._toolUIs[toolName]=new ContentTools.ToolUI(tool),this._toolUIs[toolName].mount(domToolGroup),this._toolUIs[toolName].disabled(!0),this._toolUIs[toolName].bind("apply",function(_this){return function(){return _this.updateTools()}}(this))):(tool=this.constructor.createDiv(["nhb-tool-sep"]),domToolGroup.appendChild(tool));return this._addDOMEventListeners()},ToolboxBarUI.prototype.updateTools=function(){ToolboxBarUI.__super__.updateTools.call(this)},ToolboxBarUI.prototype._addDOMEventListeners=function(){return this._updateTools=function(_this){return function(){var app,element,name,selection,toolUI,update,_ref,_results;app=ContentTools.EditorApp.get(),update=!1,element=ContentEdit.Root.get().focused(),selection=null,element===_this._lastUpdateElement?element&&element.selection&&(selection=element.selection(),_this._lastUpdateSelection&&selection.eq(_this._lastUpdateSelection)&&(update=!0)):update=!0,app.history&&(_this._lastUpdateHistoryLength!==app.history.length()&&(update=!0),_this._lastUpdateHistoryLength=app.history.length()),_this._lastUpdateElement=element,_this._lastUpdateSelection=selection,_ref=_this._toolUIs,_results=[];for(name in _ref)toolUI=_ref[name],_results.push(toolUI.update(element,selection));return _results}}(this),this._updateToolsTimeout=setInterval(this._updateTools,100),this._handleKeyDown=function(){return function(ev){var element,os,redo,undo,version;switch(46===ev.keyCode&&(element=ContentEdit.Root.get().focused(),element&&!element.content&&ContentTools.Tools.Remove.apply(element,null,function(){})),version=navigator.appVersion,os="linux",-1!==version.indexOf("Mac")?os="mac":-1!==version.indexOf("Win")&&(os="windows"),redo=!1,undo=!1,os){case"linux":90===ev.keyCode&&ev.ctrlKey&&(redo=ev.shiftKey,undo=!redo);break;case"mac":90===ev.keyCode&&ev.metaKey&&(redo=ev.shiftKey,undo=!redo);break;case"windows":89===ev.keyCode&&ev.ctrlKey&&(redo=!0),90===ev.keyCode&&ev.ctrlKey&&(undo=!0)}return undo&&ContentTools.Tools.Undo.canApply(null,null)&&ContentTools.Tools.Undo.apply(null,null,function(){}),redo&&ContentTools.Tools.Redo.canApply(null,null)?ContentTools.Tools.Redo.apply(null,null,function(){}):void 0}}(this),window.addEventListener("keydown",this._handleKeyDown)},ToolboxBarUI.prototype._removeDOMEventListeners=function(){return window.removeEventListener("keydown",this._handleKeyDown),clearInterval(this._updateToolsTimeout)},ToolboxBarUI.prototype._onStartDragging=function(){},ToolboxBarUI.prototype._onStopDragging=function(){},ToolboxBarUI.prototype._onDrag=function(){},ToolboxBarUI}(ContentTools.ToolboxUI),function(){var _EditorApp=ContentTools.EditorApp.getCls(),proxied=_EditorApp.prototype.init;_EditorApp.prototype.init=function(queryOrDOMElements,namingProp){proxied.call(this,queryOrDOMElements,namingProp),this._toolboxBar=new ContentTools.ToolboxBarUI(window.nhbEditor.formattingTools),this.attach(this._toolboxBar)};var unmountProxy=_EditorApp.prototype.unmount;_EditorApp.prototype.unmount=function(){unmountProxy.call(this),this.isMounted()&&(this._toolboxBar=null)};var startProxy=_EditorApp.prototype.start;_EditorApp.prototype.start=function(){startProxy.call(this),this._toolboxBar.show()};var stopProxy=_EditorApp.prototype.stop;_EditorApp.prototype.stop=function(){stopProxy.call(this),this._toolboxBar.hide()}}(),ContentTools.Tools.Bold.label=nhbParams.labels.bold,ContentTools.Tools.Italic.label=nhbParams.labels.italic,ContentTools.Tools.Link.label=nhbParams.labels.link,ContentTools.Tools.AlignLeft.label=nhbParams.labels.align_left,ContentTools.Tools.AlignCenter.label=nhbParams.labels.align_center,ContentTools.Tools.AlignRight.label=nhbParams.labels.align_right,ContentTools.Tools.OrderedList.label=nhbParams.labels.numbered_list,ContentTools.Tools.UnorderedList.label=nhbParams.labels.bullet_list,ContentTools.Tools.Indent.label=nhbParams.labels.indent,ContentTools.Tools.Unindent.label=nhbParams.labels.unindent,ContentTools.Tools.Undo.label=nhbParams.labels.undo,ContentTools.Tools.Redo.label=nhbParams.labels.redo,ContentTools.ToolboxFixedUI=function(_super){function ToolboxFixedUI(tools){ToolboxFixedUI.__super__.constructor.call(this),this._tools=tools,this._toolUIs={}}return __extends(ToolboxFixedUI,_super),ToolboxFixedUI.prototype.isDragging=function(){return!1},ToolboxFixedUI.prototype.toggle=function(){this._domElement&&this._domElement.classList.contains("nhb-toolbox-elements-shown")?this.hide():this.show()},ToolboxFixedUI.prototype.show=function(){this.isMounted()||this.mount(),this._domElement.scrollTop=0,this.addCSSClass("ct-widget--active")},ToolboxFixedUI.prototype.hide=function(){return this._domElement&&this.removeCSSClass("ct-widget--active"),this._removeDOMEventListeners(),ToolboxFixedUI.__super__.hide.call(this)},ToolboxFixedUI.prototype.tools=function(tools){return void 0===tools?this._tools:(this._tools=tools,this.unmount(),this.mount())},ToolboxFixedUI.prototype.mount=function(){var domToolGroup,i,tool,toolGroup,toolName,_i,_j,_len,_len1,_ref;this._domElement=this.constructor.createDiv(["nhb-interactive-elements-group","nhb-toolbox-elements","ct-widget","ct-toolbox"]),document.body.appendChild(this._domElement);var note=this.constructor.createDiv(["nhb-toolbox-elements-note"]);for(note.innerHTML=nhbParams.labels.drag_an_element,this._domElement.appendChild(note),_ref=this._tools,i=_i=0,_len=_ref.length;_len>_i;i=++_i)for(toolGroup=_ref[i],domToolGroup=this.constructor.createDiv(["ct-tool-group"]),this._domElement.appendChild(domToolGroup),_j=0,_len1=toolGroup.length;_len1>_j;_j++)toolName=toolGroup[_j],tool=ContentTools.ToolShelf.fetch(toolName),this._toolUIs[toolName]=new ContentTools.ToolUI(tool),this._toolUIs[toolName].mount(domToolGroup),this._toolUIs[toolName].disabled(!0),this._toolUIs[toolName].bind("apply",function(_this){return function(){return _this.updateTools()}}(this));return this._addDOMEventListeners()},ToolboxFixedUI.prototype.updateTools=function(){ToolboxFixedUI.__super__.updateTools.call(this)},ToolboxFixedUI.prototype._addDOMEventListeners=function(){return this._domElement.addEventListener("mouseleave",function(ev){ev.relatedTarget&&window.nhbSelectorMatches(ev.relatedTarget,".ct-tool--insert-element, .ct-tool--insert-element *")||this.hide()}.bind(this)),this._updateTools=function(_this){return function(){var app,element,name,selection,toolUI,update,_ref,_results;app=ContentTools.EditorApp.get(),update=!1,element=ContentEdit.Root.get().focused(),selection=null,element===_this._lastUpdateElement?element&&element.selection&&(selection=element.selection(),_this._lastUpdateSelection&&selection.eq(_this._lastUpdateSelection)&&(update=!0)):update=!0,app.history&&(_this._lastUpdateHistoryLength!==app.history.length()&&(update=!0),_this._lastUpdateHistoryLength=app.history.length()),_this._lastUpdateElement=element,_this._lastUpdateSelection=selection,_ref=_this._toolUIs,_results=[];for(name in _ref)toolUI=_ref[name],_results.push(toolUI.update(element,selection));return _results}}(this),this._updateToolsTimeout=setInterval(this._updateTools,100),this._handleKeyDown=function(){return function(ev){var element,os,redo,undo,version;switch(46===ev.keyCode&&(element=ContentEdit.Root.get().focused(),element&&!element.content&&ContentTools.Tools.Remove.apply(element,null,function(){})),version=navigator.appVersion,os="linux",-1!==version.indexOf("Mac")?os="mac":-1!==version.indexOf("Win")&&(os="windows"),redo=!1,undo=!1,os){case"linux":90===ev.keyCode&&ev.ctrlKey&&(redo=ev.shiftKey,undo=!redo);break;case"mac":90===ev.keyCode&&ev.metaKey&&(redo=ev.shiftKey,undo=!redo);break;case"windows":89===ev.keyCode&&ev.ctrlKey&&(redo=!0),90===ev.keyCode&&ev.ctrlKey&&(undo=!0)}return undo&&ContentTools.Tools.Undo.canApply(null,null)&&ContentTools.Tools.Undo.apply(null,null,function(){}),redo&&ContentTools.Tools.Redo.canApply(null,null)?ContentTools.Tools.Redo.apply(null,null,function(){}):void 0}}(this),window.addEventListener("keydown",this._handleKeyDown)},ToolboxFixedUI.prototype._removeDOMEventListeners=function(){return window.removeEventListener("keydown",this._handleKeyDown),clearInterval(this._updateToolsTimeout)},ToolboxFixedUI.prototype._onStartDragging=function(){},ToolboxFixedUI.prototype._onStopDragging=function(){},ToolboxFixedUI.prototype._onDrag=function(){},ToolboxFixedUI}(ContentTools.ToolboxUI),function(){var _EditorApp=ContentTools.EditorApp.getCls(),proxied=_EditorApp.prototype.init;_EditorApp.prototype.init=function(queryOrDOMElements,namingProp){proxied.call(this,queryOrDOMElements,namingProp),this._toolboxElements=new ContentTools.ToolboxFixedUI(window.nhbEditor.insertElements),this.attach(this._toolboxElements)};var unmountProxy=_EditorApp.prototype.unmount;_EditorApp.prototype.unmount=function(){unmountProxy.call(this),this.isMounted()&&(this._toolboxElements=null)};var startProxy=_EditorApp.prototype.start;_EditorApp.prototype.start=function(){startProxy.call(this),this._toolboxElements.isMounted()||this._toolboxElements.mount()};var stopProxy=_EditorApp.prototype.stop;_EditorApp.prototype.stop=function(){stopProxy.call(this),this._toolboxElements.hide()}}(),window.addEventListener("DOMContentLoaded",function(){document.querySelector(".nhb-main-wrapper").addEventListener("mousedown",function(){ContentTools.EditorApp.get()._toolboxElements.hide()}),document.querySelector(".nhb-main-wrapper").addEventListener("mouseup",function(){ContentTools.EditorApp.get()._toolboxElements.hide()}),document.querySelector(".nhb-main-wrapper").addEventListener("keydown",function(){ContentTools.EditorApp.get()._toolboxElements.hide()})}),function(){var proxied=ContentTools.ToolUI.prototype._onMouseLeave;ContentTools.ToolUI.prototype._onMouseLeave=function(ev){if(this._mouseDown&&this._domElement.classList.contains("nhb-tool-large")){var element=new ContentEdit.NewElementDragHelper(this.tool),scrollY=window.scrollY||window.pageYOffset;ContentTools.EditorApp.get().regions()["main-content"].attach(element),element.drag(ev.screenX,ev.screenY+scrollY),ev.stopPropagation(),ev.preventDefault()}return proxied.call(this,ev)}}(),ContentEdit.NewElementDragHelper=function(_super){function NewElementDragHelper(tool,attributes){NewElementDragHelper.__super__.constructor.call(this,"div",attributes),this._content="",this.tool=tool}return __extends(NewElementDragHelper,_super),NewElementDragHelper.droppers=nhbEditor.allDroppers,NewElementDragHelper.prototype.typeName=function(){return this.tool.label},NewElementDragHelper.prototype.drop=function(element,placement){if(!element)return ContentEdit.Root.get().cancelDragging(),void this.parent().detach(this);var index=element.parent().children.indexOf(element);index+="above"===placement[0]?0:1,this.tool.createNew(element.parent(),index),this.parent().detach(this)},NewElementDragHelper}(ContentEdit.Static),ContentEdit.TagNames.get().register(ContentEdit.NewElementDragHelper,"NewElementDragHelper"),ContentTools.ToolboxPropertiesUI=function(_super){function ToolboxPropertiesUI(tools){this._onClose=__bind(this._onClose,this),ToolboxPropertiesUI.__super__.constructor.call(this,tools)}return __extends(ToolboxPropertiesUI,_super),ToolboxPropertiesUI.prototype.isDragging=function(){return ToolboxPropertiesUI.__super__.isDragging.call(this)},ToolboxPropertiesUI.prototype.show=function(){return this.isMounted()||this.mount(),this.addCSSClass("ct-widget--active")},ToolboxPropertiesUI.prototype.hide=function(){this.removeCSSClass("ct-widget--active")},ToolboxPropertiesUI.prototype.tools=function(tools){return ToolboxPropertiesUI.__super__.tools.call(this,tools)},ToolboxPropertiesUI.prototype.mount=function(){var coord,domToolGroup,i,position,restore,tool,toolGroup,toolName,_i,_j,_len,_len1,_ref;this._domElement=this.constructor.createDiv(["nhb-toolbox-properties","ct-widget","ct-toolbox"]),this.parent().domElement().appendChild(this._domElement),this._domGrip=this.constructor.createDiv(["nhb-toolbox-titlebar"]),this._domElement.appendChild(this._domGrip),this._domTabs=this.constructor.createDiv(["nhb-toolbox-tabs"]),this._domElement.appendChild(this._domTabs),this._domSections=this.constructor.createDiv(["nhb-toolbox-sections"]),this._domElement.appendChild(this._domSections),this._domResize=this.constructor.createDiv(["nhb-toolbox-resizer"]),this._domElement.appendChild(this._domResize);var title=this.constructor.createDiv(["nhb-toolbox-title"]);for(title.innerHTML=nhbParams.labels.properties_inspector,this._domGrip.appendChild(title),this._closeButton=this.constructor.createDiv(["nhb-titlebox-close"]),this._domGrip.appendChild(this._closeButton),_ref=this._tools,i=_i=0,_len=_ref.length;_len>_i;i=++_i)for(toolGroup=_ref[i],domToolGroup=this.constructor.createDiv(["ct-tool-group"]),this._domElement.appendChild(domToolGroup),_j=0,_len1=toolGroup.length;_len1>_j;_j++)toolName=toolGroup[_j],tool=ContentTools.ToolShelf.fetch(toolName),this._toolUIs[toolName]=new ContentTools.ToolUI(tool),this._toolUIs[toolName].mount(domToolGroup),this._toolUIs[toolName].bind("apply",function(_this){return function(){return _this.updateTools()}}(this));return null===window.localStorage.getItem("nhb-toolbox-elements-position")&&window.localStorage.setItem("nhb-toolbox-elements-position",window.innerWidth-250-30+",87,"+(window.innerHeight-77-20)),restore=window.localStorage.getItem("nhb-toolbox-elements-position"),restore&&/^\d+,\d+,\d+$/.test(restore)&&(position=function(){var _k,_len2,_ref1,_results;for(_ref1=restore.split(","),_results=[],_k=0,_len2=_ref1.length;_len2>_k;_k++)coord=_ref1[_k],_results.push(parseInt(coord,10));return _results}(),this._domElement.style.left=position[0]+"px",this._domElement.style.top=position[1]+"px",this._domElement.style.height=position[2]+"px"),this._addDOMEventListeners()},ToolboxPropertiesUI.prototype.updateTools=function(){return ToolboxPropertiesUI.__super__.updateTools.call(this)},ToolboxPropertiesUI.prototype.unmount=function(){return ToolboxPropertiesUI.__super__.unmount.call(this)},ToolboxPropertiesUI.prototype._addDOMEventListeners=function(){this._closeButton.addEventListener("mousedown",this._onClose),this._onResizeBound=this._onResize.bind(this),this._onResizeMoveBound=this._onResizeMove.bind(this),this._onResizeStopBound=this._onResizeStop.bind(this),this._domResize.addEventListener("mousedown",this._onResizeBound),ToolboxPropertiesUI.__super__._addDOMEventListeners.call(this)},ToolboxPropertiesUI.prototype._onResize=function(ev){ev.preventDefault(),ev.stopPropagation(),document.body.addEventListener("mousemove",this._onResizeMoveBound),document.body.addEventListener("mouseup",this._onResizeStopBound),this._resizeStart=ev.screenY,this._resizeOrigHeight=this._domElement.getBoundingClientRect().height},ToolboxPropertiesUI.prototype._onResizeMove=function(ev){ev.preventDefault(),ev.stopPropagation(),this._domElement.style.transition="none",this._domElement.style.height=this._resizeOrigHeight+(ev.screenY-this._resizeStart)+"px"},ToolboxPropertiesUI.prototype._onResizeStop=function(ev){ev.preventDefault(),ev.stopPropagation(),document.body.removeEventListener("mousemove",this._onResizeMoveBound),document.body.removeEventListener("mouseup",this._onResizeStopBound),this._domElement.style.transition="";var rect=this._domElement.getBoundingClientRect();window.localStorage.setItem("nhb-toolbox-elements-position",parseInt(rect.left,10)+","+parseInt(rect.top,10)+","+parseInt(rect.height,10)),this._contain()},ToolboxPropertiesUI.prototype._contain=function(){var rect;if(this.isMounted()){var top=0;document.querySelector("#wpadminbar")&&(top+=parseInt(document.querySelector("#wpadminbar").clientHeight,10)),document.querySelector(".nhb-toolbox-bar")&&(top+=parseInt(document.querySelector(".nhb-toolbox-bar").clientHeight,10)),rect=this._domElement.getBoundingClientRect(),rect.left+rect.width>window.innerWidth&&(window.innerWidth-rect.width<0?this._domElement.style.left="0px":this._domElement.style.left=window.innerWidth-rect.width+"px"),rect.top+rect.height>window.innerHeight&&(window.innerHeight-rect.height<77?this._domElement.style.top="77px":this._domElement.style.top=window.innerHeight-rect.height+"px"),rect.left<0&&(this._domElement.style.left="0px"),rect.top<77&&(this._domElement.style.top="77px")}},ToolboxPropertiesUI.prototype._removeDOMEventListeners=function(){this.isMounted()&&this._closeButton.removeEventListener("mousedown",this._onClose),ToolboxPropertiesUI.__super__._removeDOMEventListeners.call(this)},ToolboxPropertiesUI.prototype._onClose=function(){return this.isMounted()?this.hide():void 0},ToolboxPropertiesUI.prototype._onDrag=function(ev){return ToolboxPropertiesUI.__super__._onDrag.call(this,ev)},ToolboxPropertiesUI.prototype._onStartDragging=function(ev){return ToolboxPropertiesUI.__super__._onStartDragging.call(this,ev)},ToolboxPropertiesUI.prototype._onStopDragging=function(ev){var rect=this._domElement.getBoundingClientRect();return window.localStorage.setItem("nhb-toolbox-elements-position",parseInt(rect.left,10)+","+parseInt(rect.top,10)+","+parseInt(rect.height,10)),ToolboxPropertiesUI.__super__._onStopDragging.call(this,ev)},ToolboxPropertiesUI.prototype.inspect=function(element){this._inspectElement(element),this.show(),this._contain(),setTimeout(function(){this._domElement.classList.contains("ct-widget--active")&&this._contain()}.bind(this),1e3)},ToolboxPropertiesUI.prototype._addTab=function(label,element){var tab=document.createElement("DIV");tab.classList.add("nhb-toolbox-tab"),tab.innerHTML=label,tab.setAttribute("data-name",element.constructor.name),this._domTabs.appendChild(tab),tab._targetElement=element,1===this._domTabs.children.length&&tab.classList.add("nhb-toolbox-tab-shown"),tab.addEventListener("click",function(){var visibleTab=this.parentNode.querySelector(".nhb-toolbox-tab-shown");visibleTab&&visibleTab.classList.remove("nhb-toolbox-tab-shown"),this.classList.add("nhb-toolbox-tab-shown");var visibleSection=this.parentNode.parentNode.querySelector(".nhb-toolbox-section-shown");visibleSection&&visibleSection.classList.remove("nhb-toolbox-section-shown"),this.parentNode.parentNode.querySelector('.nhb-toolbox-section[data-name="'+this.getAttribute("data-name")+'"]').classList.add("nhb-toolbox-section-shown")}.bind(tab))},ToolboxPropertiesUI.prototype._removeTab=function(name){var removeMe=this._domTabs.querySelector('[data-name="'+name+'"]');removeMe&&this._domTabs.removeChild(removeMe)},ToolboxPropertiesUI.prototype.addSection=function(label,element,optionIndex){this._addTab(label,element);var section=document.createElement("DIV");section.classList.add("nhb-toolbox-section"),section.setAttribute("data-name",element.constructor.name),this._domSections.appendChild(section),1===this._domSections.children.length&&section.classList.add("nhb-toolbox-section-shown"),"Shortcode"===element.constructor.name&&"undefined"==typeof nhbInspectorOptions.Shortcode[element.sc_base]&&"undefined"!=typeof nhbParams.shortcode_mappings&&"undefined"!=typeof nhbParams.shortcode_mappings[element.sc_base]&&this.createShortcodeMappingOptions&&this.createShortcodeMappingOptions(element.sc_base);var numWithGroups,numNoGroup,k,note,elemType=element.constructor.name;if("Shortcode"===elemType){var shortcodeBase=element.sc_base,shortcodeProperties=nhbInspectorOptions.Shortcode[shortcodeBase];if("undefined"!=typeof shortcodeProperties&&"undefined"!=typeof shortcodeProperties.hidden&&shortcodeProperties.hidden)return;var heading;if("undefined"!=typeof shortcodeProperties&&"undefined"!=typeof shortcodeProperties.options){for(numWithGroups=0,numNoGroup=0,k=0;k<shortcodeProperties.options.length;k++)shortcodeProperties.options[k].group?numWithGroups++:numNoGroup++;if(numWithGroups&&numNoGroup)for(k=0;k<shortcodeProperties.options.length;k++)shortcodeProperties.options[k].group||(shortcodeProperties.options[k].group=nhbParams.labels.general);for(k=0;k<shortcodeProperties.options.length;k++)this.addSectionOptions(section,shortcodeProperties.options[k],element);shortcodeProperties.options.length||(note=document.createElement("DIV"),note.innerHTML=nhbParams.labels.no_attributes_available,note.classList.add("nhb-shortcode-no-options"),section.appendChild(note))}else heading=document.createElement("DIV"),heading.innerHTML=nhbParams.labels.note_options_are_detected,section.appendChild(heading),this.addGenericShortcodeOptions(section,element);var shortcodeNote=document.createElement("DIV");shortcodeNote.classList.add("nhb-inspector-shortcode-note"),shortcodeNote.innerHTML=nhbParams.labels.note_shortcode_not_appearing,section.appendChild(shortcodeNote)}else if("undefined"!=typeof nhbInspectorOptions[optionIndex]){var currElemModel;for(element.model?(currElemModel=element.model,currElemModel.set("element",element)):currElemModel=new Backbone.Model({element:element}),numWithGroups=0,numNoGroup=0,k=0;k<nhbInspectorOptions[optionIndex].options.length;k++)nhbInspectorOptions[optionIndex].options[k].group?numWithGroups++:numNoGroup++;if(numWithGroups&&numNoGroup)for(k=0;k<nhbInspectorOptions[optionIndex].options.length;k++)nhbInspectorOptions[optionIndex].options[k].group||(nhbInspectorOptions[optionIndex].options[k].group=nhbParams.labels.general);for(k=0;k<nhbInspectorOptions[optionIndex].options.length;k++)this.addSectionOptions(section,nhbInspectorOptions[optionIndex].options[k],element,currElemModel);nhbInspectorOptions[optionIndex].onMouseEnter&&section.addEventListener("mouseenter",function(e){nhbInspectorOptions[optionIndex].onMouseEnter(this,e)}.bind(element)),nhbInspectorOptions[optionIndex].onMouseLeave&&section.addEventListener("mouseleave",function(e){nhbInspectorOptions[optionIndex].onMouseLeave(this,e)}.bind(element)),"undefined"!=typeof nhbInspectorOptions[optionIndex].footer&&Math.random()>.5&&(note=document.createElement("DIV"),
note.innerHTML=nhbInspectorOptions[optionIndex].footer,note.classList.add("nhb-group-footer"),section.appendChild(note))}},ToolboxPropertiesUI.prototype.removeSection=function(name){this._removeTab(name);var removeMe=this._domSections.querySelector('[data-name="'+name+'"]');removeMe&&this._domSections.removeChild(removeMe)},ToolboxPropertiesUI.prototype.removeAllSections=function(){for(this.clearSections();this._domTabs.firstChild;)this._domTabs.removeChild(this._domTabs.firstChild);for(;this._domSections.firstChild;)this._domSections.removeChild(this._domSections.firstChild)},ToolboxPropertiesUI.prototype._inspectElement=function(element){for(this.removeAllSections();element.nodeType&&!element._ceElement&&"BODY"!==element.tagName;)this.addOptions(element),element=element.parentNode;element._ceElement&&(element=element._ceElement);for(var inspectedElementNames=[];element&&element.type;)-1===inspectedElementNames.indexOf(element.constructor.name)&&(this.addOptions(element),inspectedElementNames.push(element.constructor.name),"DivRow"===element.constructor.name&&inspectedElementNames.push("DivCol")),element=element.parent()},ToolboxPropertiesUI.prototype.addOptions=function(element){var optionIndex=element.constructor.name,label=optionIndex;if(!window.nhbInspectorOptions[element.constructor.name]&&element.nodeType){var matched=!1;for(var index in window.nhbInspectorOptions)if(window.nhbInspectorOptions.hasOwnProperty(index)&&window.nhbSelectorMatches(element,index)){optionIndex=index,matched=!0;break}if(!matched)return}window.nhbInspectorOptions[optionIndex]&&(label=window.nhbInspectorOptions[optionIndex].label,"Shortcode"===element.constructor.name&&(label=element.constructor.name,"nhb_widget"===element.sc_base?label="Widget":"nhb_sidebar"===element.sc_base&&(label="Sidebar")),this.addSection(label,element,optionIndex))},ToolboxPropertiesUI.prototype.addOption=function(){},ToolboxPropertiesUI}(ContentTools.ToolboxUI),function(){var _EditorApp=ContentTools.EditorApp.getCls(),proxied=_EditorApp.prototype.init;_EditorApp.prototype.init=function(queryOrDOMElements,namingProp){proxied.call(this,queryOrDOMElements,namingProp),this._toolboxProperties=new ContentTools.ToolboxPropertiesUI([]),this.attach(this._toolboxProperties)};var unmountProxy=_EditorApp.prototype.unmount;_EditorApp.prototype.unmount=function(){unmountProxy.call(this),this.isMounted()&&(this._toolboxProperties=null)};var startProxy=_EditorApp.prototype.start;_EditorApp.prototype.start=function(){startProxy.call(this),this._toolboxProperties.isMounted()||this._toolboxProperties.mount()};var stopProxy=_EditorApp.prototype.stop;_EditorApp.prototype.stop=function(){stopProxy.call(this),this._toolboxProperties.hide()}}(),window.addEventListener("DOMContentLoaded",function(){if(document.querySelector('[data-name="main-content"]')){var editor=ContentTools.EditorApp.get(),stopBodyScroll=function(ev){var $=jQuery,$this=$(this),scrollTop=this.scrollTop,scrollHeight=this.scrollHeight,height=$this.height(),delta="DOMMouseScroll"===ev.type?-40*ev.originalEvent.detail:ev.originalEvent.wheelDelta,up=delta>0,prevent=function(){return ev.stopPropagation(),ev.preventDefault(),ev.returnValue=!1,!1};return!up&&-delta>scrollHeight-height-scrollTop?($this.scrollTop(scrollHeight),prevent()):up&&delta>scrollTop?($this.scrollTop(0),prevent()):void 0};editor.bind("start",function(){jQuery("body").on("DOMMouseScroll mousewheel",".nhb-toolbox-elements, .nhb-toolbox-sections",stopBodyScroll)}),editor.bind("stop",function(){jQuery("body").off("DOMMouseScroll mousewheel",".nhb-toolbox-elements, .nhb-toolbox-sections",stopBodyScroll)})}}),window.addEventListener("DOMContentLoaded",function(){document.addEventListener("mousedown",function(ev){window.nhbEditor.isEditing()&&window.nhbSelectorMatches(ev.target,'[data-name="main-content"] *, .nhb-quick-action-overlay, .nhb-quick-action-overlay *')&&ContentTools.EditorApp.get()._toolboxProperties.hide()}),document.addEventListener("keyup",function(ev){window.nhbEditor.isEditing()&&window.nhbSelectorMatches(ev.target,'[data-name="main-content"] *')&&-1!==[40,37,39,38,9,8,46,13].indexOf(ev.keyCode)&&ContentTools.EditorApp.get()._toolboxProperties.hide()}),ContentEdit.Root.get().bind("focus",function(){ContentTools.EditorApp.get()._toolboxProperties.hide()}),ContentEdit.Root.get().bind("blur",function(){}),ContentEdit.Root.get().bind("drag",function(){ContentTools.EditorApp.get()._toolboxProperties.hide()}),ContentEdit.Root.get().bind("drop",function(){ContentTools.EditorApp.get()._toolboxProperties.hide()})}),window.nhbEditor.createGroupTip=function(text){var tip=document.createElement("span");tip.classList.add("nhb-group-tip"),tip.innerHTML="?";var tipText=document.createElement("span");return tipText.classList.add("nhb-group-tip-details"),tipText.innerHTML=text,tip.appendChild(tipText),tip};var _nhbCreatedViews=[];ContentTools.ToolboxPropertiesUI.prototype.addSectionOptions=function(divGroup,option,element,model){"undefined"==typeof model&&(model=element.model);var matchesAnOptionType=null;"undefined"!=typeof option.type&&(matchesAnOptionType=Object.keys(nhbOption).some(function(name){return name.toLowerCase()===option.type.toLowerCase().replace(/_/g,"")})),matchesAnOptionType||(option.type="Text");var type=option.type.toLowerCase().replace(/_/g,"");for(optionName in nhbOption)if(nhbOption.hasOwnProperty(optionName)&&type===optionName.toLowerCase()){var id=optionName.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();element.constructor.name&&(id=element.constructor.name.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()+"-"+option.id);var optionWrapper=document.createElement("DIV");if(optionWrapper.classList.add("ct-tool"),"button"!==type&&optionWrapper.classList.add("nhb-tool-option"),option["class"]&&optionWrapper.setAttribute("class",optionWrapper.getAttribute("class")+" "+option["class"]),optionName&&optionWrapper.classList.add("nhb-"+optionName.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()),option.id&&optionWrapper.setAttribute("id",id),option.group){var subGroupName=option.group.toLowerCase().trim().replace(/\"/g,""),subGroup=divGroup.querySelector('[data-subgroup="'+subGroupName+'"]');divGroup.classList.add("nhb-has-group"),subGroup||(subGroup=document.createElement("DIV"),subGroup.setAttribute("data-subgroup",subGroupName),divGroup.appendChild(subGroup),"default"!==option.group&&(subGroup.innerHTML='<div class="nhb-option-subtitle nhb-tool-option">'+option.group+"</div>",subGroup.firstChild.classList.add("nhb-collapsable-title"),subGroup.setAttribute("data-collapse-group",element.constructor.name.toLowerCase()),divGroup.querySelectorAll("[data-subgroup]").length>1&&window.nhbCollapseSection(subGroup))),subGroup.appendChild(optionWrapper),option["group-tip"]&&(subGroup.querySelector(".nhb-group-tip-details")?subGroup.querySelector(".nhb-group-tip-details").innerHTML=option["group-tip"]:subGroup.querySelector(".nhb-option-subtitle").appendChild(window.nhbEditor.createGroupTip(option["group-tip"])))}else{var firstSubGroup=divGroup.querySelector("[data-subgroup]");firstSubGroup?divGroup.insertBefore(optionWrapper,firstSubGroup):divGroup.appendChild(optionWrapper)}if(!wp.hooks.applyFilters("nhb.inspector.do_add_section_options",!0,optionName,model,divGroup,element,this))return;var o=new nhbOption[optionName]({optionSettings:option,model:model,el:optionWrapper});return _nhbCreatedViews.push(o.render()),divGroup.view=o,void this.applyOptionDependencies(o)}},ContentTools.ToolboxPropertiesUI.prototype.applyOptionDependencies=function(view){if(view.optionSettings.depends){var depends=view.optionSettings.depends;"number"!=typeof depends.length&&(depends=[depends]),view.listenTo(view.model,"change",function(){for(var allConditions=[],i=0;i<depends.length;i++)if(depends[i].id&&depends[i].value){var id=depends[i].id,value=depends[i].value,currentValue=this.model.get(id),makeVisible=!1;if("string"==typeof value&&("__not_empty"===value.toLowerCase().trim()||"__empty"===value.toLowerCase().trim()||value.match(/^(>=?|<=?|==|!=)(.*)/)||(value=[value])),value===!1||"string"==typeof value&&"false"===value.toLowerCase().trim())"undefined"==typeof currentValue?makeVisible=!0:"string"==typeof currentValue&&"false"===currentValue.toLowerCase().trim()?makeVisible=!0:"string"==typeof currentValue&&""===currentValue.toLowerCase().trim()?makeVisible=!0:"boolean"!=typeof currentValue||currentValue?currentValue||(makeVisible=!0):makeVisible=!0;else if(value===!0||"string"==typeof value&&"true"===value.toLowerCase().trim())"string"==typeof currentValue&&"true"===currentValue.toLowerCase().trim()?makeVisible=!0:"boolean"==typeof currentValue&&currentValue?makeVisible=!0:currentValue&&(makeVisible=!0);else if("object"==typeof value&&"number"==typeof value.length){var k,brokenByUnmatch=!1,onceMatched=!1,allNegatives=!0;for(k=0;k<value.length;k++)if(!value[k].match(/^!(.*)/)){allNegatives=!1;break}for(k=0;k<value.length;k++)if(value[k].match(/^!(.*)/)){var text=value[k].match(/^!(.*)/);if(text=text[1],text===currentValue){brokenByUnmatch=!0;break}}else if(value[k]===currentValue){onceMatched=!0;break}allNegatives&&!brokenByUnmatch?makeVisible=!0:!brokenByUnmatch&&onceMatched&&(makeVisible=!0)}else if("__not_empty"===value.toLowerCase().trim())"string"==typeof currentValue&&""!==currentValue.trim()?makeVisible=!0:"boolean"==typeof currentValue&&currentValue&&(makeVisible=!0);else if("__empty"===value.toLowerCase().trim())"undefined"==typeof currentValue?makeVisible=!0:""===currentValue.trim()&&(makeVisible=!0);else if(value.match(/^(>=?|<=?|==|!=)(.*)/)){var matches=value.match(/^(>=?|<=?|==|!=)(.*)/),operator=matches[1],num=matches[2];num=num.match(/\./)?parseFloat(num):parseInt(num,10),currentValue="undefined"==typeof currentValue?0:currentValue.match(/\./)?parseFloat(currentValue):parseInt(currentValue,10),makeVisible="<"===operator?num>currentValue:"<="===operator?num>=currentValue:">"===operator?currentValue>num:">="===operator?currentValue>=num:"!="===operator?currentValue!==num:currentValue===num}allConditions.push(makeVisible)}var allTrue=!0;for(i=0;i<allConditions.length;i++)allConditions[i]||(allTrue=!1);allTrue?this.$el.fadeIn():this.$el.fadeOut()}),view.model.trigger("change",view.model)}},ContentTools.ToolboxPropertiesUI.prototype.addGenericShortcodeOptions=function(divGroup,element){var view,keys,i,attributeName,hasOptions=!1;for(divGroup.classList.add("nhb-shortcode-generic"),keys=element.model.keys(),i=0;i<keys.length;i++)attributeName=keys[i],"content"!==attributeName&&(view=new nhbOption.GenericOption({attribute:attributeName,model:element.model}),_nhbCreatedViews.push(view.render()),divGroup.appendChild(view.el),hasOptions=!0);if(element.model.get("content")&&(view=new nhbOption.GenericOption({attribute:"content",model:element.model}),_nhbCreatedViews.push(view.render()),divGroup.appendChild(view.el),hasOptions=!0),!hasOptions){var note=document.createElement("DIV");note.innerHTML=nhbParams.labels.shortcodes_not_attributes_detected,note.classList.add("nhb-shortcode-no-options"),divGroup.appendChild(note)}},ContentTools.ToolboxPropertiesUI.prototype._addSection=function(domElement){var currElem,i,k,group,heading,label,doneTypes=[];if(this._previouslySelectedElement!==domElement){if(this._newGroups=[],this._currentGroupIndex=0,"undefined"==typeof this._oldGroups){this._oldGroups=[];var editor=ContentTools.EditorApp.get();editor.bind("start",function(){this._oldGroups=[]}.bind(this))}if(this._previouslySelectedElement=domElement,"undefined"==typeof this._domInspectorGroups&&(this._domInspectorGroups=[]),domElement){for(var currDomElement=null;domElement;){if(domElement.tagName&&"DIV"!==domElement.tagName&&window.nhbSelectorMatches(domElement,'[data-name="main-content"] *')){currDomElement=domElement;break}domElement=domElement.parentNode}var matchedPattern="";if(label="",currDomElement)for(var pattern in nhbInspectorOptions)if(nhbInspectorOptions.hasOwnProperty(pattern))try{window.nhbSelectorMatches(domElement,pattern)&&(matchedPattern=pattern)}catch(err){}if(matchedPattern)for(nhbInspectorOptions[matchedPattern].label&&(label=nhbInspectorOptions[matchedPattern].label),label||(label=matchedPattern),group=this.constructor.createDiv(["ct-tool-group","nhb-inspector-group","nhb-dom-group"]),group.groupType=matchedPattern,heading=document.createElement("DIV"),heading.classList.add("nhb-group-title"),heading.classList.add("nhb-collapsable-title"),heading.classList.add("nhb-dom-title"),heading.innerHTML=nhbParams.labels.inspector_title.replace("%s",label),group.insertBefore(heading,group.firstChild),wp.hooks.doAction("inspector.group_title.create",group),this.placeGroup(group),currElemModel=new Backbone.Model({element:currDomElement}),i=0;i<nhbInspectorOptions[matchedPattern].options.length;i++)this.addSectionOptions(group,nhbInspectorOptions[matchedPattern].options[i],currDomElement,currElemModel)}var root=ContentEdit.Root.get(),element=root.focused();if(element){currElem=element;for(var hierarchy=[],finishedClasses=[];currElem&&"Region"!==currElem.constructor.name;)-1===finishedClasses.indexOf(currElem.constructor.name)&&(hierarchy.push(currElem),finishedClasses.push(currElem.constructor.name)),currElem=currElem.parent();var elem,note;for(i=0;i<hierarchy.length;i++)if("DivRow"===hierarchy[i].constructor.name){elem=hierarchy[i],hierarchy.splice(i,1),hierarchy.push(elem);break}for(i=0;i<hierarchy.length;i++)if("DivCol"===hierarchy[i].constructor.name){elem=hierarchy[i],hierarchy.splice(i,1),hierarchy.push(elem);break}var currElemModel,finishedElemTypes=[];for(i=0;i<hierarchy.length;i++){currElem=hierarchy[i];var groupClasses,shortcodeProperties,elemType=currElem.constructor.name;if(elemType=wp.hooks.applyFilters("nhb.inspector.elemtype",elemType,currElem),-1===finishedElemTypes.indexOf(elemType)){if(finishedElemTypes.push(elemType),"Shortcode"===elemType)label=currElem._domElement.getAttribute("data-base"),label=label.replace(/[-_]/g," ").replace(/\b[a-z]/g,function(letter){return letter.toUpperCase()}),"undefined"==typeof nhbInspectorOptions.Shortcode[currElem.sc_base]&&"undefined"!=typeof nhbParams.shortcode_mappings&&"undefined"!=typeof nhbParams.shortcode_mappings[currElem.sc_base]&&this.createShortcodeMappingOptions&&this.createShortcodeMappingOptions(currElem.sc_base),"undefined"!=typeof nhbInspectorOptions.Shortcode[currElem.sc_base]&&"undefined"!=typeof nhbInspectorOptions.Shortcode[currElem.sc_base].label&&(label=nhbInspectorOptions.Shortcode[currElem.sc_base].label);else{if("undefined"==typeof nhbInspectorOptions[elemType]||-1!==doneTypes.indexOf(elemType))continue;label=currElem.typeName(),nhbInspectorOptions[elemType].label&&(label=nhbInspectorOptions[elemType].label)}if(groupClasses=["ct-tool-group","nhb-inspector-group","nhb-"+currElem.cssTypeName()+"-group"],"Shortcode"===elemType&&groupClasses.push("nhb-shortcode-"+currElem.sc_base+"-group"),group=this.constructor.createDiv(groupClasses),group.groupType=elemType,heading=document.createElement("DIV"),heading.classList.add("nhb-group-title"),heading.classList.add("nhb-collapsable-title"),heading.classList.add("nhb-"+currElem.cssTypeName()+"-title"),heading.innerHTML=nhbParams.labels.inspector_title.replace("%s",label),group.insertBefore(heading,group.firstChild),wp.hooks.doAction("inspector.group_title.create",group),this.placeGroup(group),"Shortcode"===elemType){var shortcodeBase=currElem.sc_base;if(shortcodeProperties=nhbInspectorOptions.Shortcode[shortcodeBase],"undefined"!=typeof shortcodeProperties&&"undefined"!=typeof shortcodeProperties.hidden&&shortcodeProperties.hidden)continue;if("undefined"!=typeof shortcodeProperties&&"undefined"!=typeof shortcodeProperties.options){for(k=0;k<shortcodeProperties.options.length;k++)this.addSectionOptions(group,shortcodeProperties.options[k],currElem);if(shortcodeProperties.desc&&(heading.innerHTML+="<span>"+shortcodeProperties.desc+"</span>"),!shortcodeProperties.options.length){var note=document.createElement("DIV");note.innerHTML=nhbParams.labels.no_attributes_available,note.classList.add("nhb-shortcode-no-options"),group.appendChild(note)}}else this.addGenericShortcodeOptions(group,currElem),heading.innerHTML+="<span>"+nhbParams.labels.note_options_are_detected+"</span>";var shortcodeNote=document.createElement("DIV");shortcodeNote.classList.add("nhb-inspector-shortcode-note"),shortcodeNote.innerHTML=nhbParams.labels.note_shortcode_not_appearing,group.appendChild(shortcodeNote)}else{if("undefined"==typeof nhbInspectorOptions[elemType]||-1!==doneTypes.indexOf(elemType))continue;for(currElem.model?(currElemModel=currElem.model,currElemModel.set("element",currElem)):currElemModel=new Backbone.Model({element:currElem}),k=0;k<nhbInspectorOptions[elemType].options.length;k++)this.addSectionOptions(group,nhbInspectorOptions[elemType].options[k],currElem,currElemModel);"undefined"!=typeof nhbInspectorOptions[elemType].footer&&Math.random()>.5&&(note=document.createElement("DIV"),note.innerHTML=nhbInspectorOptions[elemType].footer,note.classList.add("nhb-group-footer"),group.appendChild(note)),wp.hooks.doAction("nhb.inspector.add_section",group,label)}}}for(this.clearOldGroups();this._newGroups.length;)this._oldGroups.push(this._newGroups.pop())}}},ContentTools.ToolboxPropertiesUI.prototype.clearOldGroups=function(){for(var i=0;i<this._oldGroups.length;i++){var oldGroup=this._oldGroups[i];"undefined"!=typeof oldGroup.view,oldGroup.style.height=window.getComputedStyle(oldGroup).height,oldGroup.style.webkitTransition="height .3s ease-in-out",oldGroup.style.mozTransition="height .3s ease-in-out",oldGroup.style.msTransition="height .3s ease-in-out",oldGroup.style.transition="height .3s ease-in-out",oldGroup.style.overflow="hidden",oldGroup.offsetHeight,oldGroup.style.height=0,oldGroup.addEventListener("transitionend",function transitionEnd(event){"height"===event.propertyName&&(this.removeEventListener("transitionend",transitionEnd,!1),"undefined"!=typeof this.view&&this.view.remove(),this.parentNode.removeChild(this))}.bind(oldGroup),!1),setTimeout(function(){"undefined"!=typeof this.view&&this.view.remove(),this.parentNode&&this.parentNode.removeChild(this)}.bind(oldGroup),350)}this._oldGroups=[]},ContentTools.ToolboxPropertiesUI.prototype.clearSections=function(){for(;_nhbCreatedViews.length>0;){var o=_nhbCreatedViews.pop();o.remove()}if(this._domInspectorGroups)for(;this._domInspectorGroups.length;){var elemToRemove=this._domInspectorGroups.shift();elemToRemove.parentNode.removeChild(elemToRemove)}this._previouslySelectedElement=null},ContentTools.ToolboxPropertiesUI.prototype.placeGroup=function(group){this._newGroups.push(group);for(var i=0;i<this._oldGroups.length;i++){var oldGroup=this._oldGroups[i];if(oldGroup.groupType===group.groupType){var startHeight=getComputedStyle(oldGroup).height;return group.style.overflow="hidden",group.style.height=startHeight,"undefined"!=typeof oldGroup.view&&oldGroup.view.remove(),this._domElement.replaceChild(group,oldGroup),this._currentGroupIndex=i+1,this._oldGroups.splice(i,1),void setTimeout(function(){this.style.height="auto";var endHeight=getComputedStyle(this).height;this.classList.contains("nhb-collapse")&&(endHeight=getComputedStyle(this.querySelector(".nhb-group-title")).height),this.style.height=startHeight,this.offsetHeight,this.style.webkitTransition="height .3s ease-in-out",this.style.mozTransition="height .3s ease-in-out",this.style.msTransition="height .3s ease-in-out",this.style.transition="height .3s ease-in-out",this.style.overflow="hidden",this.style.height=endHeight;var didTransition=!1;this.addEventListener("transitionend",function transitionEnd(event){"height"===event.propertyName&&(this.style.webkitTransition="",this.style.mozTransition="",this.style.msTransition="",this.style.transition="",this.classList.contains("nhb-collapse")||(this.style.height="auto",this.style.overflow="visible"),didTransition=!0,this.removeEventListener("transitionend",transitionEnd,!1))},!1),setTimeout(function(){!didTransition&&this&&(this.classList.contains("nhb-collapse")||(this.style.height="auto",this.style.overflow="visible"))}.bind(this),350)}.bind(group),1)}}group.style.height=0,group.style.overflow="hidden",this._domElement.insertBefore(group,this._domElement.querySelectorAll(".ct-tool-group")[this._currentGroupIndex+1]),this._currentGroupIndex++,setTimeout(function(){this.style.height="auto";var endHeight=getComputedStyle(this).height;this.classList.contains("nhb-collapse")&&(endHeight=getComputedStyle(this.querySelector(".nhb-group-title")).height),this.style.height=0,this.offsetHeight,this.style.webkitTransition="height .3s ease-in-out",this.style.mozTransition="height .3s ease-in-out",this.style.msTransition="height .3s ease-in-out",this.style.transition="height .3s ease-in-out",this.style.overflow="hidden",this.style.height=endHeight,this.addEventListener("transitionend",function transitionEnd(event){"height"===event.propertyName&&(this.style.webkitTransition="",this.style.mozTransition="",this.style.msTransition="",this.style.transition="",this.classList.contains("nhb-collapse")||(this.style.height="auto",this.style.overflow="visible"),this.removeEventListener("transitionend",transitionEnd,!1))},!1)}.bind(group),1)},window.nhbElementsWithInspector=[],window.nhbAddInspector=function(elemName,args){if("object"==typeof args){var i,container=nhbInspectorOptions;if("object"!=typeof elemName){if("undefined"!=typeof args.is_shortcode&&args.is_shortcode?container=nhbInspectorOptions.Shortcode:-1===window.nhbElementsWithInspector.indexOf(elemName)&&window.nhbElementsWithInspector.push(elemName),"undefined"==typeof container[elemName])return void(container[elemName]=args);for(var argName in args)if(args.hasOwnProperty(argName))if("options"!==argName)container[elemName][argName]=args[argName];else{var options=args[argName];for(i=0;i<options.length;i++)container[elemName].options.push(options[i])}}else for(i=0;i<elemName.length;i++)window.nhbAddInspector(elemName[i],args)}},window.nhbRemoveInspector=function(elemName){var i,container=nhbInspectorOptions;if("object"!=typeof elemName)"undefined"!=typeof nhbInspectorOptions.Shortcode[elemName]&&(container=nhbInspectorOptions.Shortcode),"undefined"!=typeof container[elemName]&&delete container[elemName];else for(i=0;i<elemName.length;i++)window.nhbRemoveInspector(elemName[i])};var nhbInspectorOptions={Shortcode:{}};if(nhbParams.additional_shortcodes)for(var elemName in nhbParams.additional_shortcodes)nhbParams.additional_shortcodes.hasOwnProperty(elemName)&&(nhbInspectorOptions.Shortcode[elemName]=nhbParams.additional_shortcodes[elemName]);window.nhbCollapseSection=function(section){var classes;if(section.classList.contains("nhb-collapse")){if(section.getAttribute("data-collapse-group")){var openSections=document.querySelectorAll('[data-collapse-group="'+section.getAttribute("data-collapse-group")+'"]:not(.nhb-collapse)');Array.prototype.forEach.call(openSections,function(el){window.nhbCollapseSection(el)})}var prevHeight=section.style.height;section.style.height="auto";var endHeight=getComputedStyle(section).height;section.style.height=prevHeight,section.offsetHeight,section.style.webkitTransition="height .3s ease-in-out",section.style.mozTransition="height .3s ease-in-out",section.style.msTransition="height .3s ease-in-out",section.style.transition="height .3s ease-in-out",section.style.overflow="hidden",section.style.height=endHeight,section.addEventListener("transitionend",function transitionEnd(event){"height"===event.propertyName&&(section.style.webkitTransition="",section.style.mozTransition="",section.style.msTransition="",section.style.transition="",section.style.height="auto",section.style.overflow="visible",section.removeEventListener("transitionend",transitionEnd,!1))},!1),section.classList.remove("nhb-collapse"),classes=section.getAttribute("class"),classes=classes.replace(/\s*(ct-tool-group|nhb-collapse|nhb-inspector-group)\s*/g,"")}else section.style.height=window.getComputedStyle(section).height,section.style.webkitTransition="height .3s ease-in-out",section.style.mozTransition="height .3s ease-in-out",section.style.msTransition="height .3s ease-in-out",section.style.transition="height .3s ease-in-out",section.style.overflow="hidden",section.offsetHeight,section.style.height="38px",section.addEventListener("transitionend",function transitionEnd(event){"height"===event.propertyName&&section.removeEventListener("transitionend",transitionEnd,!1)},!1),section.classList.add("nhb-collapse"),classes=section.getAttribute("class"),classes=classes.replace(/\s*(ct-tool-group|nhb-collapse|nhb-inspector-group)\s*/g,"")},window.nhbOpenAllSections=function(){var sections=document.querySelectorAll(".ct-tool-group");Array.prototype.forEach.call(sections,function(el){el.classList.contains("nhb-collapse")&&window.nhbCollapseSection(el)})},window.nhbOnlyOpenSection=function(sectionClass){var sections=document.querySelectorAll(".ct-tool-group");Array.prototype.forEach.call(sections,function(el){sectionClass&&el.classList.contains(sectionClass)?el.classList.contains("nhb-collapse")&&window.nhbCollapseSection(el):el.classList.contains("nhb-collapse")||window.nhbCollapseSection(el)})},window.addEventListener("DOMContentLoaded",function(){document.querySelector('[data-name="main-content"]')&&document.addEventListener("click",function(ev){var section=ev.target;if(ev.target.classList.contains("nhb-collapsable-title"))section=ev.target.parentNode;else{if(!ev.target.parentNode)return;if(!ev.target.parentNode.classList)return;if(!ev.target.parentNode.classList.contains("nhb-collapsable-title"))return;section=ev.target.parentNode.parentNode}window.nhbCollapseSection(section)})}),wp.hooks.addAction("inspector.group_title.create",function(section){var classes=section.getAttribute("class");classes=classes.replace(/\s*(ct-tool-group|nhb-collapse|nhb-inspector-group)\s*/g,""),-1!==storedCollapsed.indexOf(classes)&&(section.classList.add("nhb-collapse"),setTimeout(function(){section.style.height=window.getComputedStyle(section.firstChild).height},1))}),function(){var proxied=ContentTools.Tools.Remove.apply;ContentTools.Tools.Remove.apply=function(element,selection,callback){document.activeElement&&-1!==["INPUT","TEXTAREA"].indexOf(document.activeElement.tagName)||proxied.call(element,selection,callback)}}();var nhbOption={},nhbBaseView=Backbone.View.extend({initialize:function(options){this.optionSettings=_.clone(options.optionSettings),this.optionSettings.initialize&&this.optionSettings.initialize(this.model.get("element"),this),this.optionSettings.visible&&(this._visibleBound=this._visible.bind(this),wp.hooks.addAction("nhb.option.changed",this._visibleBound),this._visible()),Backbone.View.prototype.initialize.call(this,options)},_visible:function(){this.optionSettings.visible(this.model.get("element"))?this.$el.show():this.$el.hide()},remove:function(){this.optionSettings.visible&&wp.hooks.removeAction("nhb.option.changed",this._visibleBound),Backbone.View.prototype.remove.apply(this)}});nhbOption.widgetSettings=Backbone.View.extend({className:"nhb-tool-option",events:{"change input":"attributeChanged","keyup input":"attributeChanged","change textarea":"attributeChanged","keyup textarea":"attributeChanged",'click input[type="radio"]':"attributeChanged",'click input[type="checkbox"]':"attributeChanged","change select":"attributeChanged","keyup select":"attributeChanged"},initialize:function(options){this.optionSettings=_.clone(options.optionSettings),this.attribute=_.clone(options.attribute),"undefined"==typeof this.model.attributes.widget&&(this.model.attributes.widget="WP_Widget_Text"),this.template=wp.template("nhb-widget-"+this.model.attributes.widget)},render:function(){var data=_.extend({},this.model.attributes,this.optionSettings);this.$el.html(this.template(data));var widgetInfo=nhbParams.widget_list[this.model.attributes.widget];for(var attributeName in this.model.attributes)if(this.model.attributes.hasOwnProperty(attributeName)){var option=this.el.querySelector("#widget-"+widgetInfo.id_base+"--"+attributeName);option&&("TEXTAREA"===option.tagName?option.value=this.model.attributes[attributeName].replace(/<br>/g,"\n"):"INPUT"===option.tagName&&"checkbox"===option.getAttribute("type")?this.model.attributes[attributeName]&&(option.checked=!0):option.value=this.model.attributes[attributeName])}var fields=this.el.querySelectorAll("[id^=widget-"+widgetInfo.id_base+"--");return Array.prototype.forEach.call(fields,function(el){this.attributeChanged({target:el})}.bind(this)),this},attributeChanged:function(e){var widgetInfo=nhbParams.widget_list[this.model.attributes.widget],attribute=e.target.getAttribute("id").replace("widget-"+widgetInfo.id_base+"--","");"INPUT"===e.target.tagName&&"checkbox"===e.target.getAttribute("type")?this.model.set(attribute,e.target.checked?e.target.value:""):this.model.set(attribute,e.target.value)}}),nhbOption.Button=nhbBaseView.extend({events:{click:"click",mouseenter:"mouseenter",mouseleave:"mouseleave",mousedown:"mousedown",mouseup:"mouseup"},initialize:function(options){nhbBaseView.prototype.initialize.call(this,options),this.attribute=_.clone(options.attribute),this._canApplyUpdater()},render:function(){return this.optionSettings.name&&this.el.setAttribute("data-tooltip",this.optionSettings.name),this.optionSettings.render&&this.optionSettings.render(this.model.get("element"),this),this._tooltipUpdater(),this._isAppliedUpdater(),this._canApplyUpdater(),this},click:function(){this.el.classList.contains("ct-tool--disabled")||(this.optionSettings.click&&this.optionSettings.click(this.model.get("element"),this),this._tooltipUpdater(),this._isAppliedUpdater(),this._canApplyUpdater(),this._selectedElement&&this._selectedElement.restoreState&&this._selectedElement.restoreState())},updateTooltip:function(value){if(value||(value=""),window.nhbEditor.isCtrlDown&&window.nhbEditor.isShiftDown){if(this.optionSettings["tooltip-reset"])return void this.el.setAttribute("data-tooltip",this.optionSettings["tooltip-reset"].replace("{0}",value))}else if(window.nhbEditor.isCtrlDown){if(this.optionSettings["tooltip-down"])return void this.el.setAttribute("data-tooltip",this.optionSettings["tooltip-down"].replace("{0}",value))}else if(this.optionSettings.tooltip)return void this.el.setAttribute("data-tooltip",this.optionSettings.tooltip.replace("{0}",value));this.optionSettings.tooltip?this.el.setAttribute("data-tooltip",this.optionSettings.tooltip):this.optionSettings.name&&this.el.setAttribute("data-tooltip",this.optionSettings.name)},_tooltipUpdater:function(){this.optionSettings.tooltipValue&&this.model.get("element")?this.updateTooltip(this.optionSettings.tooltipValue(this.model.get("element"),this)):this.updateTooltip()},updateIsApplied:function(value){this.el.classList.remove("ct-tool--applied"),value&&this.el.classList.add("ct-tool--applied")},_canApplyUpdater:function(){this.el.classList.remove("ct-tool--disabled"),this.optionSettings.canApply&&this.model.get("element")&&this.model.get("element")._domElement&&(this.optionSettings.canApply(this.model.get("element"),this)||this.el.classList.add("ct-tool--disabled"))},_isAppliedUpdater:function(){this.optionSettings.isApplied&&this.model.get("element")&&this.model.get("element")._domElement&&this.updateIsApplied(this.optionSettings.isApplied(this.model.get("element"),this))},mouseenter:function(){this.optionSettings.mouseenter&&this.model.get("element")&&this.model.get("element")._domElement&&this.optionSettings.mouseenter(this.model.get("element"),this),this.optionSettings.hold&&(clearTimeout(this._holdTimeout),clearInterval(this._holdInterval)),this.model.get("element")&&this.model.get("element")._domElement&&this.model.get("element")._domElement.classList.add("ce-element--over"),this._tooltipUpdaterInterval=setInterval(this._tooltipUpdater.bind(this),100)},mouseleave:function(){this.optionSettings.mouseleave&&this.model.get("element")&&this.model.get("element")._domElement&&this.optionSettings.mouseleave(this.model.get("element"),this),
this.optionSettings.hold&&(clearTimeout(this._holdTimeout),clearInterval(this._holdInterval)),this.model.get("element")&&this.model.get("element")._domElement&&this.model.get("element")._domElement.classList.remove("ce-element--over"),clearInterval(this._tooltipUpdaterInterval)},mousedown:function(){var root=ContentEdit.Root.get(),selectedElement=root.focused();selectedElement&&selectedElement.storeState&&selectedElement.storeState(),selectedElement&&(this._selectedElement=selectedElement),this.optionSettings.hold&&(clearTimeout(this._holdTimeout),clearInterval(this._holdInterval),this._holdTimeout=setTimeout(function(){this._holdInterval=setInterval(function(){this.optionSettings.hold(this.model.get("element"),this),this._tooltipUpdater(),this._isAppliedUpdater()}.bind(this),30)}.bind(this),500))},mouseup:function(){this.optionSettings.hold&&(clearTimeout(this._holdTimeout),clearInterval(this._holdInterval))}}),nhbOption.GenericOption=Backbone.View.extend({template:wp.template("nhb-shortcode-generic-option"),className:"nhb-tool-option",events:{"change input":"attributeChanged","keyup input":"attributeChanged","change textarea":"attributeChanged","keyup textarea":"attributeChanged"},initialize:function(options){this.optionSettings=_.clone(options.optionSettings),this.attribute=_.clone(options.attribute),"content"===this.attribute&&(this.template=wp.template("nhb-shortcode-generic-content"))},render:function(){var data=_.extend({},this.model.attributes,this.optionSettings);return data.value=this.model.get(this.attribute),data.attr=this.attribute,this.$el.html(this.template(data)),this},attributeChanged:function(e){this.model.set(this.attribute,e.target.value)}}),nhbOption.Border=Backbone.View.extend({template:wp.template("nhb-option-border"),events:{"change select":"styleChanged","change .width":"widthChanged","keyup .width":"widthChanged","change .radius":"radiusChanged","keyup .radius":"radiusChanged","click .nhb-color-preview":"togglePicker","change .nhb-color-popup input":"colorChanged","keyup .nhb-color-popup input":"colorChanged"},initialize:function(options){this.optionSettings=_.clone(options.optionSettings),this.randomID=this.optionSettings.id+"-"+_.random(0,1e4),this._hidePickerBound=this.hidePicker.bind(this),document.querySelector(".ct-toolbox").addEventListener("mouseleave",this._hidePickerBound)},render:function(){var data=_.extend({},this.model.attributes,this.optionSettings);data.id=this.randomID;for(var styles=window.getComputedStyle(this.model.get("element")._domElement),stylesToAdd=["border-color","border-style","border-width","border-radius"],i=0;i<stylesToAdd.length;i++)this.model.set(stylesToAdd[i],styles[stylesToAdd[i]],{silent:!0});this.$el.html(this.template(data));var _this=this;return jQuery("#"+this.randomID).iris({defaultColor:!0,change:function(){_this.colorChanged()},clear:function(){},hide:!1,palettes:["#000","#fff","#CF000F","#D2527F","#F89406","#F9BF3B","#2ECC71","#19B5FE","#8E44AD"]}),this},remove:function(){jQuery("#"+this.randomID).iris("destroy"),document.querySelector(".ct-toolbox").removeEventListener("mouseleave",this._hidePickerBound),Backbone.View.prototype.remove.call(this)},colorChanged:function(){var inputColor=this.el.querySelector(".nhb-color-popup input").value,color=jQuery(this.el.querySelector("#"+this.randomID)).iris("color");("transparent"===inputColor||""===inputColor)&&(color=inputColor),this.model.get("element").style("border-color",color),"transparent"===color&&(color=""),this.el.querySelector(".nhb-color-preview").style.background=color},styleChanged:function(e){this.model.get("element").style("border-style",e.target.value);var newBorder="0px";"none"!==e.target.value&&(newBorder="1px");var allBordersZero=!0;parseInt(this.model.get("border-top-width"),10)&&(allBordersZero=!1),parseInt(this.model.get("border-right-width"),10)&&(allBordersZero=!1),parseInt(this.model.get("border-bottom-width"),10)&&(allBordersZero=!1),parseInt(this.model.get("border-left-width"),10)&&(allBordersZero=!1),(allBordersZero&&"none"!==e.target.value||"none"===e.target.value)&&(this.model.set("border-top-width",newBorder),this.model.set("border-right-width",newBorder),this.model.set("border-bottom-width",newBorder),this.model.set("border-left-width",newBorder),this.model.get("element").style("border-width",newBorder),this.model.trigger("change",this.model))},widthChanged:function(e){var value=e.target.value;isNaN(value)||""===value.trim()||(value+="px"),this.model.get("element").style("border-width",value)},radiusChanged:function(e){var value=e.target.value;isNaN(value)||""===value.trim()||(value+="px"),this.model.get("element").style("border-radius",value)},togglePicker:function(){"block"===this.el.querySelector(".nhb-color-popup").style.display?this.el.querySelector(".nhb-color-popup").style.display="":this.el.querySelector(".nhb-color-popup").style.display="block"},hidePicker:function(){this.el.querySelector(".nhb-color-popup").style.display=""}}),nhbOption.Color=nhbBaseView.extend({template:wp.template("nhb-option-color"),events:{mouseenter:"mouseenter",mouseleave:"mouseleave","change input":"selectChanged","keyup input":"selectChanged","click .nhb-color-preview":"togglePicker","mousedown .iris-square-handle":"mousedownPicker","mouseup .iris-square-handle":"mouseupPicker","click .iris-square-handle":"irisHandleClick"},initialize:function(options){nhbBaseView.prototype.initialize.call(this,options),this.randomID=this.optionSettings.id+"-"+_.random(0,1e4),this.optionSettings.value&&this.model.set(this.optionSettings.id,this.optionSettings.value(this.model.get("element"))),this._hidePickerBound=this.hidePicker.bind(this),document.querySelector(".ct-toolbox").addEventListener("mouseleave",this._hidePickerBound),this._canApplyUpdater()},_canApplyUpdater:function(){this.el.classList.remove("ct-tool--disabled"),this.optionSettings.canApply&&(this.optionSettings.canApply(this.model.get("element"),this)||this.el.classList.add("ct-tool--disabled"))},updateColor:function(color){this.el.querySelector(".nhb-color-preview").style.background!==color&&(this.el.querySelector(".nhb-color-preview").style.background=color,this.el.querySelector("input").value=color,jQuery("#"+this.randomID).iris("color",color))},irisHandleClick:function(ev){ev.preventDefault()},render:function(){var data=_.extend({},this.model.attributes,this.optionSettings);data.id=this.randomID,this.optionSettings.value?data.value=this.optionSettings.value(this.model.get("element")):this.optionSettings.id&&(data.value=this.model.get(this.optionSettings.id)),this.$el.html(this.template(data));var _this=this;return jQuery("#"+this.randomID).iris({defaultColor:!0,change:function(){return _this._justInit?void _this.selectChanged():void(_this._justInit=!0)},clear:function(){},hide:!1,palettes:["#000","#fff","#CF000F","#D2527F","#F89406","#F9BF3B","#2ECC71","#19B5FE","#8E44AD"]}),this._canApplyUpdater(),this},remove:function(){jQuery("#"+this.randomID).iris("destroy"),document.querySelector(".ct-toolbox").removeEventListener("mouseleave",this._hidePickerBound),nhbBaseView.prototype.remove.call(this)},selectChanged:function(forceColor){var input=this.el.querySelector("input"),color=jQuery(input).iris("color");forceColor&&(color=input.value),(""===input.value||"transparent"===input.value)&&(color=input.value),this.optionSettings.change&&this.optionSettings.change(this.model.get("element"),color,this),this.optionSettings.id&&this.model.set(this.optionSettings.id,color),"transparent"===color&&(color=""),this.el.querySelector(".nhb-color-preview").style.background=color,wp.hooks.doAction("nhb.option.changed")},togglePicker:function(){if(window.nhbEditor.isCtrlDown&&window.nhbEditor.isShiftDown){var input=this.el.querySelector("input");return input.value="",this.selectChanged(),void jQuery("#"+this.randomID).iris("color","transparent")}var popup=this.el.querySelector(".nhb-color-popup"),otherPopups=document.querySelectorAll(".nhb-color-popup");Array.prototype.forEach.call(otherPopups,function(el){el!==popup&&(el.style.display="")}),"block"===popup.style.display?popup.style.display="":(wp.hooks.doAction("nhb.tool.popup.open"),popup.style.display="block"),wp.hooks.addAction("nhb.tool.popup.open",function(){popup.style.display=""}.bind(this))},hidePicker:function(){this.el.querySelector(".nhb-color-popup").style.display=""},mouseenter:function(){this.optionSettings.mouseenter&&this.optionSettings.mouseenter(this.model.get("element"),this)},mouseleave:function(){this.optionSettings.mouseleave&&this.optionSettings.mouseleave(this.model.get("element"),this)},mousedownPicker:function(){ContentTools.EditorApp.get().history.stopWatching()},mouseupPicker:function(){ContentTools.EditorApp.get().history.watch()}}),nhbOption.ColorButton=nhbOption.Color.extend({}),nhbOption.Select=nhbBaseView.extend({template:wp.template("nhb-option-select"),events:{"change select":"selectChanged"},initialize:function(options){if(nhbBaseView.prototype.initialize.call(this,options),this.listenTo(this.model,"change",this.render),this.optionSettings.value)this.model.set(this.optionSettings.id,this.optionSettings.value(this.model.get("element")));else{var value=this.model.element.model.attributes[this.optionSettings.id]||"";this.model.set(this.optionSettings.id,value)}},render:function(){var data=_.extend({},this.model.attributes,this.optionSettings);return this.optionSettings.value?data.value=this.optionSettings.value(this.model.get("element"),this):data.value=this.model.element.model.attributes[this.optionSettings.id]||"",this.$el.html(this.template(data)),this},selectChanged:function(e){this.optionSettings.change&&this.optionSettings.change(this.model.get("element"),e.target.value,this),this.model.set(this.optionSettings.id,e.target.value),wp.hooks.doAction("nhb.option.changed")}}),nhbOption.Checkbox=nhbBaseView.extend({template:wp.template("nhb-option-checkbox"),events:{"change input":"selectChanged"},initialize:function(options){nhbBaseView.prototype.initialize.call(this,options),"undefined"==typeof this.optionSettings.checked&&(this.optionSettings.checked=!0),this.listenTo(this.model,"change",this.render),this.optionSettings.value&&this.model.set(this.optionSettings.id,this.optionSettings.value(this.model.get("element")))},render:function(){var data=_.extend({},this.model.attributes,this.optionSettings);return data.value="",this.optionSettings.value?data.value=this.optionSettings.value(this.model.get("element")):this.optionSettings.id&&(data.value=this.model.get(this.optionSettings.id)),this.$el.html()?this.$el.find('input[type="checkbox"]')[0].checked=data.value===this.optionSettings.checked:this.$el.html(this.template(data)),this},selectChanged:function(e){var value=!1;this.optionSettings.unchecked&&(value=this.optionSettings.unchecked),e.target.checked&&(value=!0,this.optionSettings.checked&&(value=this.optionSettings.checked)),this.optionSettings.change&&this.optionSettings.change(this.model.get("element"),value,this),this.model.set(this.optionSettings.id,value),wp.hooks.doAction("nhb.option.changed")},click:function(e){this.optionSettings.click&&this.optionSettings.click(this.model.get("element"),e.target.value)}}),nhbOption.Text=nhbBaseView.extend({template:wp.template("nhb-option-text"),events:{"change input":"selectChanged","keyup input":"selectChanged","click input":"click"},initialize:function(options){nhbBaseView.prototype.initialize.call(this,options),this.listenTo(this.model,"change",this.render),this.optionSettings.value&&this.model.set(this.optionSettings.id,this.optionSettings.value(this.model.get("element")))},render:function(){var data=_.extend({},this.model.attributes,this.optionSettings);return data.value="",this.optionSettings.value?data.value=this.optionSettings.value(this.model.get("element")):this.optionSettings.id&&(data.value=this.model.get(this.optionSettings.id)),this.$el.html()?this.$el.find('input[type="text"]').val()!==data.value&&this.$el.find('input[type="text"]').val(data.value):this.$el.html(this.template(data)),this},selectChanged:function(e){this.optionSettings.change&&this.optionSettings.change(this.model.get("element"),e.target.value,this),this.model.set(this.optionSettings.id,e.target.value),wp.hooks.doAction("nhb.option.changed")},click:function(e){this.optionSettings.click&&this.optionSettings.click(this.model.get("element"),e.target.value)}}),nhbOption.Textarea=nhbOption.Text.extend({template:wp.template("nhb-option-textarea"),events:{"change textarea":"selectChanged","keyup textarea":"selectChanged","click textarea":"click"}}),nhbOption.Number=nhbOption.Text.extend({template:wp.template("nhb-option-number"),render:function(){var input;if(this.$el.html()){if(this.optionSettings.value){var value=this.optionSettings.value(this.model.get("element")),slider=this.$el.find(".nhb-option-number-slider");input=this.$el.find("input"),slider.slider("value").toString()!==value.toString()&&slider.slider("value",value),input.val(value)}return this}return nhbOption.Number.__super__.render.call(this),input=this.$el.find("input"),this.$el.find(".nhb-option-number-slider").slider({max:parseFloat(input.attr("max")),min:parseFloat(input.attr("min")),step:parseFloat(input.attr("step")),value:input.val(),animate:"fast",change:function(event,ui){clearTimeout(this._changeTimeout),this._changeTimeout=setTimeout(function(ui){var input=this.$el.find("input");ui.value!==input.val()&&input.val(ui.value).trigger("change")}.bind(this,ui),60)}.bind(this),slide:function(event,ui){clearTimeout(this._changeTimeout),this._changeTimeout=setTimeout(function(ui){var input=this.$el.find("input");ui.value!==input.val()&&input.val(ui.value).trigger("change")}.bind(this,ui),60)}.bind(this)}).disableSelection(),this},selectChanged:function(e){nhbOption.Number.__super__.selectChanged.call(this,e);var slider=this.$el.find(".nhb-option-number-slider"),input=this.$el.find("input"),inputVal=input.val();"keyup"===e.type&&""!==inputVal&&slider.slider("value").toString()!==input.val().toString()&&slider.slider("value",input.val()),""===inputVal&&input.val(""),this.optionSettings.change&&this.optionSettings.change(this.model.get("element"),inputVal,this),wp.hooks.doAction("nhb.option.changed")}}),nhbOption.Image=nhbOption.Text.extend({template:wp.template("nhb-option-image"),multiple:!1,events:{"change input":"selectChanged","click .nhb-image-preview":"openImagePicker","click .nhb-image-preview-remove":"removeImage"},render:function(){var ajaxToGetImageURL=!1;this.$el.html()||(ajaxToGetImageURL=!0);var ret=nhbOption.Image.__super__.render.call(this);if(ajaxToGetImageURL){var imageIDsToAjaxLoad="";this.$el.find('.nhb-image-preview:not([data-id=""])').each(function(){var imageID=this.getAttribute("data-id");return imageID.match(/^[\d,]+$/)?void(nhbOption.Image._imageURLs.hasOwnProperty(imageID)?this.style.backgroundImage="url("+nhbOption.Image._imageURLs[imageID]+")":(imageIDsToAjaxLoad+=imageIDsToAjaxLoad?",":"",imageIDsToAjaxLoad+=imageID)):void(this.style.backgroundImage=imageID.match(/url\(/)?imageID:"url("+imageID+")")}),imageIDsToAjaxLoad&&nhbOption.Image.doAjaxToGetImageURLs(imageIDsToAjaxLoad)}return ret},openImagePicker:function(){var frame=wp.media({title:nhbParams.labels.s_attribute.replace("%s",this.optionSettings.name),multiple:this.multiple,library:{type:"image"},button:{text:nhbParams.labels.select_image}});return frame.on("open",function(){var imageIDs=this.model.get(this.optionSettings.id)||"";imageIDs=imageIDs.split(",");for(var selection=frame.state().get("selection"),i=0;i<imageIDs.length;i++){var attachment=wp.media.attachment(imageIDs[i]);selection.add(attachment?[attachment]:[])}}.bind(this)),frame.on("select",function(){var selection=frame.state().get("selection"),value="";this.$el.find(".nhb-image-preview").remove();var attachmentURLs=[],attachmentIDs=[];selection.each(function(attachment){if("undefined"!=typeof attachment.attributes.sizes){var image=attachment.attributes.sizes.full;"undefined"!=typeof attachment.attributes.sizes.medium&&(image=attachment.attributes.sizes.medium),jQuery("<div></div>").addClass("nhb-image-preview").css("backgroundImage","url("+image.url+")").attr("data-id",attachment.id).append(jQuery("<div></div>").addClass("nhb-image-preview-remove")).appendTo(this.$el),attachmentURLs.push(attachment.attributes.sizes.full.url),attachmentIDs.push(attachment.id),value+=value?",":"",value+=attachment.id,nhbOption.Image._imageURLs[attachment.id]=image.url}}.bind(this)),this.model.set(this.optionSettings.id,value),wp.hooks.doAction("nhb.option.changed"),this.optionSettings.change&&this.optionSettings.change(this.model.get("element"),attachmentIDs,attachmentURLs,this),frame.off("select")}.bind(this)),frame.open(),!1},removeImage:function(e){var value="",removeMe=e.target.parentNode.getAttribute("data-id"),attachmentIDs=[];return this.multiple&&this.$el.find(".nhb-image-preview").each(function(){this.getAttribute("data-id")!==removeMe&&(value+=value?",":"",value+=this.getAttribute("data-id"),attachmentIDs.push(this.getAttribute("data-id")))}),e.target.parentNode.parentNode.removeChild(e.target.parentNode),(!this.multiple||this.multiple&&!this.$el.find(".nhb-image-preview").length)&&jQuery("<div></div>").addClass("nhb-image-preview").attr("data-id","").appendTo(this.$el),this.model.set(this.optionSettings.id,value),wp.hooks.doAction("nhb.option.changed"),this.optionSettings.remove&&this.optionSettings.remove(this.model.get("element"),attachmentIDs,this),!1}}),nhbOption.Image._imageURLs={},nhbOption.Image.doAjaxToGetImageURLs=function(imageIDs){"undefined"==typeof nhbOption.Image._imageIDsToAjax&&(nhbOption.Image._imageIDsToAjax=""),imageIDs.match(/^[\d,]+$/)&&(nhbOption.Image._imageIDsToAjax+=nhbOption.Image._imageIDsToAjax?",":"",nhbOption.Image._imageIDsToAjax+=imageIDs,clearTimeout(nhbOption.Image._doAjaxToGetImageURLsTimeout),nhbOption.Image._doAjaxToGetImageURLsTimeout=setTimeout(function(){nhbOption.Image._doAjaxToGetImageURLs()},50))},nhbOption.Image._doAjaxToGetImageURLs=function(){var imageIDs=nhbOption.Image._imageIDsToAjax||"";imageIDs=imageIDs.split(",");for(var i=0;i<imageIDs.length;i++)jQuery(".nhb-tool-option .nhb-image-preview[data-id="+imageIDs[i]+"]").addClass("nhb-loading");var payload=new FormData;payload.append("action","nhb_get_attachment_urls"),payload.append("image_ids",nhbOption.Image._imageIDsToAjax),payload.append("nonce",nhbParams.nonce);var request=new XMLHttpRequest;request.open("POST",nhbParams.ajax_url),request.onload=function(){var i,response;if(request.status>=200&&request.status<400)try{for(response=JSON.parse(request.responseText),i=0;i<imageIDs.length;i++)"undefined"!=typeof response[imageIDs[i]]?(jQuery(".nhb-tool-option .nhb-image-preview[data-id="+imageIDs[i]+"]").css("backgroundImage","url("+response[imageIDs[i]]+")"),nhbOption.Image._imageURLs[imageIDs[i]]=response[imageIDs[i]]):jQuery(".nhb-tool-option .nhb-image-preview[data-id="+imageIDs[i]+"]").addClass("nhb-ajax-error")}catch(e){for(i=0;i<imageIDs.length;i++)jQuery(".nhb-tool-option .nhb-image-preview[data-id="+imageIDs[i]+"]").addClass("nhb-ajax-error")}for(i=0;i<imageIDs.length;i++)jQuery(".nhb-tool-option .nhb-image-preview[data-id="+imageIDs[i]+"]").removeClass("nhb-loading");nhbOption.Image._imageIDsToAjax=""},request.onerror=function(){for(var i=0;i<imageIDs.length;i++)jQuery(".nhb-tool-option .nhb-image-preview[data-id="+imageIDs[i]+"]").removeClass("nhb-loading");nhbOption.Image._imageIDsToAjax=""},request.send(payload)},nhbOption.Images=nhbOption.Image.extend({multiple:"toggle"}),nhbOption.MarginsAndPaddings=Backbone.View.extend({template:wp.template("nhb-option-margins-and-paddings"),events:{"keyup input":"inputChanged","change input":"inputChanged","blur input":"fixBlankValue","keydown input":"incrementDecrementValue"},initialize:function(options){this.optionSettings=_.clone(options.optionSettings),this.listenTo(this.model,"change",this.render)},render:function(){for(var element=this.model.get("element")._domElement,styles=window.getComputedStyle(element),stylesToAdd=["margin-top","margin-right","margin-bottom","margin-left","border-top-width","border-right-width","border-bottom-width","border-left-width","padding-top","padding-right","padding-bottom","padding-left"],i=0;i<stylesToAdd.length;i++)element.style[stylesToAdd[i]]?this.model.set(stylesToAdd[i],element.style[stylesToAdd[i]],{silent:!0}):this.model.set(stylesToAdd[i],styles[stylesToAdd[i]],{silent:!0});"full-width-retain-content"===element.getAttribute("data-width")||"full-width"===element.getAttribute("data-width")?("full-width-retain-content"===this.model.get("width")?this.model.set("disableHorizontalPaddings",!0):this.model.unset("disableHorizontalPaddings"),"full-width-retain-content"===this.model.get("width")||"full-width"===this.model.get("width")?this.model.set("disableHorizontalMargins",!0):this.model.unset("disableHorizontalMargins")):(this.model.unset("disableHorizontalPaddings"),this.model.unset("disableHorizontalMargins"));var data=_.extend({},this.model.attributes,this.optionSettings);return this.$el.html(this.template(data)),this},inputChanged:function(e){var value=e.target.value,styleName=e.target.getAttribute("data-style");isNaN(value)||""===value.trim()||(value+="px"),this.model.get("element").style(styleName,value),this.model.set(styleName,value,{silent:!0})},incrementDecrementValue:function(e){var regex=/^(\-?\d+)([^\d]*)$/,match=regex.exec(e.target.value);!match||38!==e.which&&40!==e.which||(38===e.which?(match[1]++,(e.ctrlKey||e.metaKey||e.shiftKey)&&(match[1]++,match[1]++,match[1]++,match[1]++)):(match[1]--,(e.ctrlKey||e.metaKey||e.shiftKey)&&(match[1]--,match[1]--,match[1]--,match[1]--)),e.target.value=match[1]+match[2],e.target.dispatchEvent(new CustomEvent("change")))},fixBlankValue:function(e){var style=e.target.getAttribute("data-style"),styleCamel=style.replace(/-([a-z])/g,function(m,w){return w.toUpperCase()}),cssValue=this.model.get("element")._domElement.style[styleCamel];if(!cssValue){var values=window.getComputedStyle(this.model.get("element")._domElement);cssValue=values[style]}e.target.value=cssValue,this.model.set(style,cssValue,{silent:!0})}}),nhbOption.CustomClass=Backbone.View.extend({template:wp.template("nhb-option-text"),events:{"change input":"selectChanged","keyup input":"selectChanged"},getClasses:function(){var element=this.model.get("element");if("undefined"==typeof element.attr("class"))return"";var classes=element.attr("class");if(this.optionSettings.ignoredClasses){var currentClasses=classes.trim().split(" ");classes="",this.staticClasses=[];for(var staticClassRegex=new RegExp(this.optionSettings.ignoredClasses,"i"),i=0;i<currentClasses.length;i++)staticClassRegex.test(currentClasses[i])?this.staticClasses.push(currentClasses[i]):(classes+=0===classes.length?"":" ",classes+=currentClasses[i])}return classes},change:function(element,value){var i;if(value=value.toLowerCase(),"undefined"!=typeof element.attr("class")){var currentClasses=element.attr("class").split(" ");for(i=0;i<currentClasses.length;i++)element.removeCSSClass(currentClasses[i])}if(""!==value.trim()){var newClasses=value.trim().split(" ");for(i=0;i<newClasses.length;i++)element.addCSSClass(newClasses[i])}if(this.staticClasses.length)for(i=0;i<this.staticClasses.length;i++)element.addCSSClass(this.staticClasses[i]);element.taint()},initialize:function(options){this.optionSettings=_.clone(options.optionSettings),this.staticClasses=[],this.optionSettings.initialize&&this.optionSettings.initialize(this.model.get("element"),this),this.listenTo(this.model,"change",this.render),this.model.set(this.optionSettings.id,this.getClasses(this.model.get("element")))},render:function(){var data=_.extend({},this.model.attributes,this.optionSettings);return data.value=this.getClasses(this.model.get("element")),this.$el.html(this.template(data)),this},selectChanged:function(e){this.change(this.model.get("element"),e.target.value),this.model.set(this.optionSettings.id,e.target.value)}}),nhbOption.CustomID=Backbone.View.extend({template:wp.template("nhb-option-text"),events:{"change input":"selectChanged","keyup input":"selectChanged"},getID:function(){var element=this.model.get("element");return"undefined"==typeof element.attr("id")?"":element.attr("id")},change:function(element,value){element.attr("id",value),element.taint()},initialize:function(options){this.optionSettings=_.clone(options.optionSettings),this.staticClasses=[],this.optionSettings.initialize&&this.optionSettings.initialize(this.model.get("element"),this),this.listenTo(this.model,"change",this.render),this.model.set(this.optionSettings.id,this.getID(this.model.get("element")))},render:function(){var data=_.extend({},this.model.attributes,this.optionSettings);return data.value=this.getID(this.model.get("element")),this.$el.html(this.template(data)),this},selectChanged:function(e){this.change(this.model.get("element"),e.target.value),this.model.set(this.optionSettings.id,e.target.value)}}),nhbOption.Button2=nhbBaseView.extend({template:wp.template("nhb-option-button2"),events:{'click input[type="button"]':"click"},render:function(){if(!this.$el.html()){var data=_.extend({},this.model.attributes,this.optionSettings);this.$el.html(this.template(data))}return this.optionSettings.disabled&&(this.optionSettings.disabled(this.model.get("element"),this)?this.$el.find('[type="button"]').removeAttr("disabled"):this.$el.find('[type="button"]').attr("disabled","disabled")),this},click:function(e){this.optionSettings.click&&this.optionSettings.click(this.model.get("element"),e.target.value,this)}});var options=[];options.push({name:nhbParams.labels.icon_frame_change_title,button:nhbParams.labels.pick_an_icon,type:"button2",group:nhbParams.labels.general,click:function(element){nhbEditor.iconFrame.open({title:nhbParams.labels.choose_icon,button:nhbParams.labels.choose_icon,successCallback:function(frameView){element.change(frameView.selected.firstChild)}})}},{name:nhbParams.labels.icon_color,type:"color",group:nhbParams.labels.general,value:function(element){return element._domElement.style.fill},change:function(element,value){element.style("fill",value)}}),window.nhbAddInspector("Icon",{label:nhbParams.labels.icon,footer:nhbParams.labels.icon_lite_footer,onMouseEnter:function(element){element._addCSSClass("ce-element--over")},onMouseLeave:function(element){element._removeCSSClass("ce-element--over")},options:options}),window.nhbAddInspector("nhb_widget",{is_shortcode:!0,label:nhbParams.labels.widget,desc:nhbParams.labels.widget_inspector_desc,options:[{type:"widgetSettings"}]}),window.nhbAddInspector("nhb_sidebar",{is_shortcode:!0,label:nhbParams.labels.sidebar,desc:nhbParams.labels.sidebar_inspector_desc,options:[{type:"select",name:nhbParams.labels.select_a_sidebar,id:"id",options:nhbParams.sidebar_list,desc:nhbParams.sidebar_label_id}]});var options=[];options.push({name:nhbParams.labels.row_width,desc:nhbParams.labels.desc_row_width,type:"select",group:nhbParams.labels.general,options:{"":nhbParams.labels.normal_width,"full-width-retain-content":nhbParams.labels.full_width_retained_content_width,"full-width":nhbParams.labels.full_width},getRootRow:function(element){for(var rootRow=element,currElem=element._domElement;currElem&&currElem._ceElement;)currElem.classList.contains("nhb-row")&&(rootRow=currElem._ceElement),currElem=currElem.parentNode;return rootRow},value:function(element){return element._domElement.getAttribute("data-width")||""},render:function(element,view){var rootRow=view.optionSettings.getRootRow(element),val=rootRow._domElement.getAttribute("data-width");val||(val=""),view.el.classList.remove("full"),view.el.classList.remove("full-retain"),"full-width"===val?view.el.classList.add("full"):"full-width-retain-content"===val&&view.el.classList.add("full-retain"),view.model.set(view.optionSettings.id,val)},change:function(element,value,view){var rootRow=view.optionSettings.getRootRow(element);rootRow.style("margin-left",""),rootRow.style("margin-right",""),rootRow.style("padding-left",""),rootRow.style("padding-right",""),view.el.classList.remove("full"),view.el.classList.remove("full-retain"),"full-width"===value?view.el.classList.add("full"):"full-width-retain-content"===value&&view.el.classList.add("full-retain"),rootRow.attr("data-width",value),window._nhbFixRowWidth(rootRow._domElement),rootRow.taint(),view.model.set(view.optionSettings.id,value)}},{name:nhbParams.labels.full_height,type:"checkbox",group:nhbParams.labels.general,value:function(element){return"100vh"===element._domElement.style["min-height"]},change:function(element,value){element.style("min-height",value?"100vh":"")}},{name:nhbParams.labels.background_color,type:"color",group:nhbParams.labels.background,initialize:function(element,view){view.listenTo(view.model,"change:background-color",view.render)},value:function(element){return element._domElement.style.backgroundColor||""},change:function(element,value){var bgImage=element._domElement.style["background-image"],url=bgImage.match(/url\([^\)]+\)/i)||"";element.style("background-color",value),-1!==bgImage.indexOf("gradient")&&element.style("background-image","linear-gradient("+value+", "+value+"), "+url)}},{name:nhbParams.labels.background_image,type:"image",group:nhbParams.labels.background,value:function(element){if(element._domElement.style.backgroundImage){var matches=element._domElement.style.backgroundImage.match(/url\([^,$]+/);return matches?matches[0]:element._domElement.style.backgroundImage}return""},change:function(element,attachmentIDs,attachmentURLs){for(var backgrounds="",i=0;i<attachmentURLs.length;i++)backgrounds+=backgrounds?",":"",backgrounds+="url("+attachmentURLs[i]+")";var background=element.style("background-image");background.match(/url\(/)?(background=background.replace(/url\([^\)]+\)/,backgrounds),element.style("background-image",background)):element.style("background-image",backgrounds)},remove:function(element,attachmentIDs,view){element.style("background-image",""),view.model.set("background-image","")}}),options.push({name:nhbParams.labels.border_style,type:"select",group:nhbParams.labels.borders,options:{"":nhbParams.labels.none,solid:nhbParams.labels.solid,dashed:nhbParams.labels.dashed,dotted:nhbParams.labels.dotted},value:function(element){return element._domElement.style["border-style"]},change:function(element,value,view){element.style("border-style",value),value?((""===element._domElement.style["border-width"]||"transparent"===element._domElement.style["border-width"])&&(element.style("border-width","1px"),view.model.set("border-width","1")),(""===element._domElement.style["border-color"]||"0px"===element._domElement.style["border-color"])&&(element.style("border-color","#000000"),view.model.set("border-color","#000000"))):(element.style("border-width",""),element.style("border-color",""),view.model.set("border-width",""),view.model.set("border-color",""))}},{name:nhbParams.labels.border_color,type:"color",group:nhbParams.labels.borders,initialize:function(element,view){view.listenTo(view.model,"change:border-color",view.render)},value:function(element){return element._domElement.style.borderColor||""},change:function(element,value){element.style("border-color",value)}},{name:nhbParams.labels.border_thickness,type:"number",group:nhbParams.labels.borders,step:"1",min:"0",max:"20",initialize:function(element,view){view.listenTo(view.model,"change:border-width",view.render)},value:function(element){var size=parseInt(element._domElement.style["border-width"],10);return isNaN(size)?0:size},change:function(element,value){element.style("border-width",value+"px")}},{name:nhbParams.labels.border_radius,type:"number",group:nhbParams.labels.borders,step:"1",min:"0",max:"1000",initialize:function(element){this.max=parseInt(parseInt(element._domElement.getBoundingClientRect().height,10)/2+1,10)},value:function(element){var size=parseInt(element._domElement.style["border-radius"],10);return isNaN(size)?0:size},change:function(element,value){element.style("border-radius",value+"px");
}}),window.nhbAddInspector("DivRow",{label:nhbParams.labels.row,options:options}),window.addEventListener("DOMContentLoaded",function(){ContentEdit.Root.get().bind("blur",function(element){for(var row=null;element&&"Region"!==element.constructor.name;)"DivRow"===element.constructor.name&&(row=element),element=element.parent();row&&"none"===row.style("border-style")&&("0px"!==row.style("border-width")&&row.style("border-width",""),""!==row.style("border-color")&&row.style("border-color",""))})});var options=[];options.push({name:nhbParams.labels.background_color,type:"color",group:nhbParams.labels.background,initialize:function(element,view){view.listenTo(view.model,"change:background-color",view.render)},value:function(element){return element._domElement.style.backgroundColor||""},change:function(element,value){var bgImage=element._domElement.style["background-image"],url=bgImage.match(/url\([^\)]+\)/i)||"";element.style("background-color",value),-1!==bgImage.indexOf("gradient")&&element.style("background-image","linear-gradient("+value+", "+value+"), "+url)}},{name:nhbParams.labels.background_image,type:"image",group:nhbParams.labels.background,value:function(element){if(element._domElement.style.backgroundImage){var matches=element._domElement.style.backgroundImage.match(/url\([^,$]+/);return matches?matches[0]:element._domElement.style.backgroundImage}return""},change:function(element,attachmentIDs,attachmentURLs){for(var backgrounds="",i=0;i<attachmentURLs.length;i++)backgrounds+=backgrounds?",":"",backgrounds+="url("+attachmentURLs[i]+")";var background=element.style("background-image");background.match(/url\(/)?(background=background.replace(/url\([^\)]+\)/,backgrounds),element.style("background-image",background)):element.style("background-image",backgrounds)},remove:function(element,attachmentIDs,view){element.style("background-image",""),view.model.set("background-image","")}}),options.push({name:nhbParams.labels.border_style,type:"select",group:nhbParams.labels.borders,options:{"":nhbParams.labels.none,solid:nhbParams.labels.solid,dashed:nhbParams.labels.dashed,dotted:nhbParams.labels.dotted},value:function(element){return element._domElement.style["border-style"]},change:function(element,value,view){element.style("border-style",value),value?((""===element._domElement.style["border-width"]||"transparent"===element._domElement.style["border-width"])&&(element.style("border-width","1px"),view.model.set("border-width","1")),(""===element._domElement.style["border-color"]||"0px"===element._domElement.style["border-color"])&&(element.style("border-color","#000000"),view.model.set("border-color","#000000"))):(element.style("border-width",""),element.style("border-color",""),view.model.set("border-width",""),view.model.set("border-color",""))}},{name:nhbParams.labels.border_color,type:"color",group:nhbParams.labels.borders,initialize:function(element,view){view.listenTo(view.model,"change:border-color",view.render)},value:function(element){return element._domElement.style.borderColor||""},change:function(element,value){element.style("border-color",value)}},{name:nhbParams.labels.border_thickness,type:"number",group:nhbParams.labels.borders,step:"1",min:"0",max:"20",initialize:function(element,view){view.listenTo(view.model,"change:border-width",view.render)},value:function(element){var size=parseInt(element._domElement.style["border-width"],10);return isNaN(size)?0:size},change:function(element,value){element.style("border-width",value+"px")}},{name:nhbParams.labels.border_radius,type:"number",group:nhbParams.labels.borders,step:"1",min:"0",max:"1000",initialize:function(element){this.max=parseInt(parseInt(element._domElement.getBoundingClientRect().height,10)/2+1,10)},value:function(element){var size=parseInt(element._domElement.style["border-radius"],10);return isNaN(size)?0:size},change:function(element,value){element.style("border-radius",value+"px")}}),window.nhbAddInspector("DivCol",{label:nhbParams.labels.column,options:options}),window.addEventListener("DOMContentLoaded",function(){ContentEdit.Root.get().bind("blur",function(element){for(var col=null;element&&"Region"!==element.constructor.name;)"DivCol"===element.constructor.name&&(col=element),element=element.parent();col&&"none"===col.style("border-style")&&("0px"!==col.style("border-width")&&col.style("border-width",""),""!==col.style("border-color")&&col.style("border-color",""))})}),ContentTools.ToolboxUI.prototype.createShortcodeMappingOptions=function(shortcodeTag){var map=nhbParams.shortcode_mappings[shortcodeTag],name=map.name;name||(name=shortcodeTag),name=name.replace(/[-_]/g," ").replace(/\b[a-z]/g,function(letter){return letter.toUpperCase()});var i,opts,value,label,attributes=[],typesDone=[];for(var attribute in map.attributes){var options=map.attributes[attribute];if(options.desc=options.description||"",options.id=options.attribute,options.type_orig=options.type,options.first_of_type=-1===typesDone.indexOf(options.type),typesDone.push(options.type),"iframe"===options.type&&(options.attribute=""),"undefined"!=typeof options.name&&options.name||(options.name=options.attribute,options.name=options.name.replace(/[-_]/g," ").replace(/\b[a-z]/g,function(letter){return letter.toUpperCase()})),nhbParams.is_lite)if("color"===options.type)options.type="text";else if("dropdown_post"===options.type)options.type="text";else if("dropdown_post_type"===options.type)options.type="text";else if("boolean"===options.type)options.type="text";else if("number"===options.type)options.type="text";else if("dropdown"===options.type)options.type="text";else if("select"===options.type)options.type="text";else if("iframe"===options.type)continue;if("boolean"===options.type)options.type="checkbox",options.checked=options.extra_boolean_checked||"true",options.unchecked=options.extra_boolean_unchecked||"false";else if("number"===options.type)options.min=options.extra_num_min||0,options.max=options.extra_num_max||1e3,options.step=options.extra_num_step||1;else if("multicheck"===options.type)for(options.options={},opts=options.extra_dropdown.split(/\n/)||{},i=0;i<opts.length;i++)value=opts[i].substr(0,opts[i].indexOf(",")),label=opts[i].substr(opts[i].indexOf(",")+1),options.options[value]=label;else if("multicheck_post_type"===options.type)options.type="multicheck",options.options=nhbParams.post_types;else if("dropdown"===options.type)for(options.type="select",options.options={"":" "+nhbParams.labels.select_one+" "},opts=options.extra_dropdown.split(/\n/)||{},i=0;i<opts.length;i++)value=opts[i].substr(0,opts[i].indexOf(",")),label=opts[i].substr(opts[i].indexOf(",")+1),options.options[value]=label;else if("dropdown_post_type"===options.type){options.type="select",options.options={"":" "+nhbParams.labels.select_a_post_type+" "};for(i in nhbParams.post_types)options.options[i]=nhbParams.post_types[i]}else if("dropdown_post"===options.type)options.type="select_post",options.post_type=options.extra||"post";else if("dropdown_db"===options.type)options.type="select_db",options.db_table=options.extra_db_table||"posts",options.db_field_id=options.extra_db_value||"ID",options.db_field_label=options.extra_db_label||"post_title",options.db_where_column=options.extra_db_where_field,options.db_where_value=options.extra_db_where_value;else if("iframe"===options.type){if(options.url=options.extra_url,!options.url)continue;options.button=options.extra_button||nhbParams.labels.open}else"content"===options.type&&(options.type="textarea");attributes.push(options)}window.nhbAddInspector(shortcodeTag,{is_shortcode:!0,label:name,desc:map.description||"",options:attributes})};var options=[];options.push({name:nhbParams.labels.latitude_longitude_and_address,type:"text",desc:nhbParams.labels.latitude_longitude_desc,initialize:function(element,view){view.listenTo(view.model,"change:data-center",view.render)},value:function(element){return element.attr("data-center")},change:_.debounce(function(element,value,view){if(element.attr("data-center")!==value){element.attr("data-center",value),view.$el.find("input").removeClass("nhb-option-error");var center=value.trim()||"37.09024, -95.712891";element._domElement.map.marker&&(element._domElement.map.marker.setMap(null),delete element._domElement.map.marker);var latLonMatch=center.match(/^([-+]?\d{1,2}([.]\d+)?)\s*,?\s*([-+]?\d{1,3}([.]\d+)?)$/);if(latLonMatch)element.attr("data-lat",latLonMatch[1]),element.attr("data-lng",latLonMatch[3]),center={lat:parseFloat(latLonMatch[1]),lng:parseFloat(latLonMatch[3])},element._domElement.map.setCenter(center),element.attr("data-marker-image")?element._domElement.map.marker=new google.maps.Marker({position:element._domElement.map.getCenter(),map:element._domElement.map,icon:element.attr("data-marker-image")}):element.attr("data-marker")&&(element._domElement.map.marker=new google.maps.Marker({position:element._domElement.map.getCenter(),map:element._domElement.map}));else{var geocoder=new google.maps.Geocoder;geocoder.geocode({address:center},function(results,status){status===google.maps.GeocoderStatus.OK?(element.attr("data-lat",results[0].geometry.location.lat()),element.attr("data-lng",results[0].geometry.location.lng()),center={lat:results[0].geometry.location.lat(),lng:results[0].geometry.location.lng()},element._domElement.map.setCenter(center),element.attr("data-marker-image")?element._domElement.map.marker=new google.maps.Marker({position:element._domElement.map.getCenter(),map:element._domElement.map,icon:element.attr("data-marker-image")}):element.attr("data-marker")&&(element._domElement.map.marker=new google.maps.Marker({position:element._domElement.map.getCenter(),map:element._domElement.map}))):view.$el.find("input").addClass("nhb-option-error")})}}},300)},{name:nhbParams.labels.map_controls,type:"checkbox",value:function(element){return!element._domElement.getAttribute("data-disable-ui")},change:function(element,value){element.attr("data-disable-ui",value?"1":""),element._domElement.map.setOptions({disableDefaultUI:!value})}},{name:nhbParams.labels.map_marker,type:"checkbox",value:function(element){return!!element._domElement.getAttribute("data-marker")},change:function(element,value){element._domElement.map.marker&&(element._domElement.map.marker.setMap(null),delete element._domElement.map.marker),value?(element.attr("data-marker","1"),element._domElement.map.marker=new google.maps.Marker({position:element._domElement.map.getCenter(),map:element._domElement.map})):(element.attr("data-marker",""),element.attr("data-marker-image",""))}}),window.nhbAddInspector("Map",{label:nhbParams.labels.map,footer:nhbParams.is_lite?nhbParams.labels.map_lite_footer:"",options:options});var options=[];window.nhbAddInspector("Tabs",{label:nhbParams.labels.tabs,footer:nhbParams.is_lite?nhbParams.labels.tabs_lite_footer:"",options:options});for(var options=[],i=0;i<window.nhbElementsWithInspector.length;i++)ContentEdit[window.nhbElementsWithInspector[i]]&&window.nhbAddInspector(window.nhbElementsWithInspector[i],{options:options});ContentTools.Tools.ElementButton=function(_super){function ElementButton(){return ElementButton.__super__.constructor.apply(this,arguments)}return __extends(ElementButton,_super),ElementButton.canApply=function(){return!0},ElementButton.isApplied=function(){return!1},ElementButton}(ContentTools.Tool),function(){var proxied=ContentTools.ToolUI.prototype.disabled;ContentTools.ToolUI.prototype.disabled=function(disabledState){return this._domElement.classList.contains("nhb-tool-large")?void 0:proxied.call(this,disabledState)};var proxied2=ContentTools.ToolUI.prototype._onMouseUp;ContentTools.ToolUI.prototype._onMouseUp=function(ev){return this._domElement.classList.contains("nhb-tool-large")?(this._mouseDown=!1,this.removeCSSClass("ct-tool--down")):proxied2.call(this,ev)}}(),function(){var proxied=ContentTools.ToolUI.prototype.mount;ContentTools.ToolUI.prototype.mount=function(domParent,before){var ret=proxied.call(this,domParent,before);if(this.tool.buttonName){this._domElement.classList.add("nhb-tool-large");var label=document.createElement("div");label.classList.add("nhb-tool-title"),label.textContent=this.tool.buttonName,this._domElement.appendChild(label)}return ret}}(),ContentTools.Tools.Heading._canApply=ContentTools.Tools.Heading.canApply,ContentTools.Tools.Heading.canApply=function(element,selection){var origReturn=ContentTools.Tools.Heading._canApply(element,selection);return"ListItemText"===element.constructor.name?!1:void 0!==element.content&&element.parent().tagName?origReturn||"div"===element.parent().tagName():origReturn},ContentTools.Tools.Paragraph.isApplied=function(element){return element.tagName()===this.tagName},ContentTools.Tools.UnorderedList.canApply=function(element,selection){var ret=ContentTools.Tools.Heading1.canApply(element,selection);return element.parent()&&element.parent().tagName&&"li"===element.parent().tagName()?!0:ret},ContentTools.Tools.OrderedList.canApply=ContentTools.Tools.UnorderedList.canApply,ContentTools.Tools.UnorderedList.isApplied=function(element){return element.parent()&&element.parent().parent()&&element.parent().parent().tagName&&element.parent().parent().tagName()===this.listTag?!0:!1},ContentTools.Tools.OrderedList.isApplied=ContentTools.Tools.UnorderedList.isApplied,function(){var proxied=ContentTools.Tools.UnorderedList.apply;ContentTools.Tools.UnorderedList.apply=function(element,selection,callback){if(!this.isApplied(element)){if("ListItem"===element.parent().type()||element.content){var ret=proxied.call(this,element,selection,callback);return element.parent()&&"ListItem"===element.parent().type()&&ContentEdit.Root.get().trigger("focus",element),ret}var listItemText=new ContentEdit.ListItemText(""),listItem=new ContentEdit.ListItem;listItem.attach(listItemText);var list=new ContentEdit.List(this.listTag,{});return list.attach(listItem),element.parent().attach(list,element.parent().children.indexOf(element)+1),listItemText.focus(),callback(!0)}element.parent().unindent()}}(),function(){var proxied=ContentTools.Tools.OrderedList.apply;ContentTools.Tools.OrderedList.apply=function(element,selection,callback){if(!this.isApplied(element)){if("ListItem"===element.parent().type()||element.content){var ret=proxied.call(this,element,selection,callback);return element.parent()&&"ListItem"===element.parent().type()&&ContentEdit.Root.get().trigger("focus",element),ret}var listItemText=new ContentEdit.ListItemText(""),listItem=new ContentEdit.ListItem;listItem.attach(listItemText);var list=new ContentEdit.List(this.listTag,{});return list.attach(listItem),element.parent().attach(list,element.parent().children.indexOf(element)+1),listItemText.focus(),callback(!0)}element.parent().unindent()}}(),ContentTools.Tools.Preformatted.canApply=function(element,selection){return ContentTools.Tools.Heading1.canApply(element,selection)},function(){var proxied=ContentTools.Tools.Preformatted.apply;ContentTools.Tools.Preformatted.apply=function(element,selection,callback){if(!this.isApplied(element)){if(!element.content){var heading=new ContentEdit.Text(this.tagName);return element.parent().attach(heading,element.parent().children.indexOf(element)+1),heading.focus(),callback(!0)}return proxied.call(this,element,selection,callback)}}}(),ContentTools.Tools.Preformatted.isApplied=function(element){return element.tagName()===this.tagName},ContentTools.Tools.Bold.canApply=function(element,selection){return element.content?selection:!1},ContentTools.Tools.Bold.isApplied=function(element,selection){var _ref,from=0,to=0;if(void 0===element.content||!element.content.length())return!1;selection&&(_ref=selection.get(),from=_ref[0],to=_ref[1]),from===to&&(from=0,to=element.content.length());var styledString=element.content.substring(from,to),fontWeight=styledString.getStyle("font-weight",element);if(styledString.hasTags("strong",!0)||styledString.hasTags("b",!0))return!0;var fontWeightNum=parseInt(fontWeight,10);return isNaN(fontWeightNum)?"bold"===fontWeight:fontWeightNum>400},ContentTools.Tools.Bold.apply=function(element,selection,callback){this.tagName="span";var _ref,from=0,to=0;element.storeState(),selection&&(_ref=selection.get(),from=_ref[0],to=_ref[1]),from===to&&(from=0,to=element.content.length());var styledString=element.content.substring(from,to);if(styledString.hasTags("strong",!0))element.content=element.content.unformat(from,to,new HTMLString.Tag("strong"));else if(styledString.hasTags("b",!0))element.content=element.content.unformat(from,to,new HTMLString.Tag("b"));else{var fontWeight=styledString.getStyle("font-weight",element);if(fontWeight=fontWeight&&"normal"!==fontWeight?isNaN(parseInt(fontWeight,10))?"normal":parseInt(fontWeight,10)<=400?"bold":"normal":"bold","normal"===fontWeight){var defaultFontWeight=element.defaultStyle("font-weight");isNaN(parseInt(defaultFontWeight,10))||parseInt(defaultFontWeight,10)<400&&(fontWeight=defaultFontWeight)}var newStyle={"font-weight":fontWeight};element.content=element.content.style(from,to,element._tagName,newStyle)}return element.updateInnerHTML(),element.taint(),element.restoreState(),callback(!0)},ContentTools.Tools.Italic.canApply=function(element,selection){return ContentTools.Tools.Bold.canApply(element,selection)},ContentTools.Tools.Italic.isApplied=function(element,selection){var _ref,from=0,to=0;if(void 0===element.content||!element.content.length())return!1;selection&&(_ref=selection.get(),from=_ref[0],to=_ref[1]),from===to&&(from=0,to=element.content.length());var styledString=element.content.substring(from,to),fontStyle=styledString.getStyle("font-style",element);return styledString.hasTags("em",!0)||styledString.hasTags("i",!0)?!0:"italic"===fontStyle},ContentTools.Tools.Italic.apply=function(element,selection,callback){this.tagName="span";var _ref,from=0,to=0;element.storeState(),selection&&(_ref=selection.get(),from=_ref[0],to=_ref[1]),from===to&&(from=0,to=element.content.length());var styledString=element.content.substring(from,to);if(styledString.hasTags("em",!0))element.content=element.content.unformat(from,to,new HTMLString.Tag("em"));else if(styledString.hasTags("i",!0))element.content=element.content.unformat(from,to,new HTMLString.Tag("i"));else{var fontStyle=styledString.getStyle("font-style",element);fontStyle=fontStyle&&"normal"!==fontStyle?"normal":"italic";var newStyle={"font-style":fontStyle};element.content=element.content.style(from,to,element._tagName,newStyle)}return element.updateInnerHTML(),element.taint(),element.restoreState(),callback(!0)},ContentTools.Tools.Link.isApplied=function(element,selection){if("Image"===element.constructor.name)return element.a;if(selection){var from,to,_ref;return void 0!==element.content&&element.content.length()?(_ref=selection.get(),from=_ref[0],to=_ref[1],from===to&&(to+=1),element.content.slice(from,to).hasTags(this.tagName,!0)):!1}},function(){var proxied=ContentTools.Tools.Paragraph.apply;ContentTools.Tools.Paragraph.apply=function(element,selection,callback){var app,forceAdd,paragraph,region;if(app=ContentTools.EditorApp.get(),forceAdd=app.ctrlDown(),ContentTools.Tools.Heading.canApply(element)&&!forceAdd);else if("DivCol"===element.parent().constructor.name||"Div"===element.parent().constructor.name)return region=element.parent(),paragraph=new ContentEdit.Text("p"),region.attach(paragraph,region.children.indexOf(element)+1),paragraph.focus(),callback(!0);return proxied.call(this,element,selection,callback)}}(),function(){var proxied=ContentTools.ToolUI.prototype._onMouseDown;ContentTools.ToolUI.prototype._onMouseDown=function(ev){var ret=proxied.call(this,ev);if(!this.tool.doHold)return ret;clearTimeout(this._holdTimeout),clearInterval(this._holdInterval);var interval=30;this.tool.holdInterval&&(interval=this.tool.holdInterval);var element,selection;if(this._mouseDown){if(element=ContentEdit.Root.get().focused(),!element||!element.isMounted())return;selection=null,element.selection&&(selection=element.selection()),this._holdTimeout=setTimeout(function(){this._holdInterval=setInterval(function(){this.tool.doHold(element,selection)}.bind(this),interval)}.bind(this),500)}return ret}}(),function(){var proxied=ContentTools.ToolUI.prototype._onMouseUp;ContentTools.ToolUI.prototype._onMouseUp=function(ev){return clearTimeout(this._holdTimeout),clearInterval(this._holdInterval),proxied.call(this,ev)}}(),ContentTools.Tool.refreshTooltip=function(value){var buttonElement=window.nhbEditor.getToolUI(this.icon)._domElement;value||(value="");var tooltip;tooltip=window.nhbEditor.isCtrlDown&&window.nhbEditor.isShiftDown?this.labelReset.replace("{0}",value):window.nhbEditor.isCtrlDown?this.labelDown.replace("{0}",value):this.label.replace("{0}",value),buttonElement.getAttribute("data-tooltip")!==tooltip&&buttonElement.setAttribute("data-tooltip",tooltip)},function(){ContentTools.Tools.Table.apply;ContentTools.Tools.Table.apply=function(element,selection,callback){},ContentTools.Tools.Table.premium=!0,ContentTools.Tools.Table.buttonName=nhbParams.labels.table,ContentTools.Tools.Table.label=nhbParams.labels.table}(),ContentTools.Tools.AddElementButton=function(_super){function AddElementButton(){return AddElementButton.__super__.constructor.apply(this,arguments)}return __extends(AddElementButton,_super),AddElementButton.isAddElementButton=!0,AddElementButton.listTool="",AddElementButton.icon="add-element-button",AddElementButton.canApply=function(){return!0},AddElementButton.isApplied=function(){if(this.listTool){var tool=window.nhbEditor.getToolUI(this.listTool);if(tool)return"block"===tool._domElement.style.display}return!1},AddElementButton.apply=function(element,selection,callback){return callback(!0)},AddElementButton}(ContentTools.Tool),ContentTools.Tools.AddElementList=function(_super){function AddElementList(){return AddElementList.__super__.constructor.apply(this,arguments)}return __extends(AddElementList,_super),AddElementList.type="design-elements-list",AddElementList.icon="design-elements-list",AddElementList.label="",AddElementList.populateList=function(domToolContainer){},AddElementList.addClickedItem=function(domItemClicked,elemFocused){},AddElementList.canApply=function(){return!0},AddElementList.isApplied=function(){return!1},AddElementList.toggleList=function(){this._ceElement._domElement.style.display?this.hideList():this.showList()},AddElementList.init=function(){var toolDomElement=this._ceElement._domElement;if(!toolDomElement.children.length){toolDomElement.classList.add("nhb-add-element-list"),this.populateList(toolDomElement);for(var i=0;i<toolDomElement.children.length;i++){var el=toolDomElement.children[i];el.classList.add("nhb-add-element-list-item"),el.setAttribute("data-search-terms",el.textContent.trim().toLowerCase()),el.addEventListener("click",this._onClick.bind(this))}var elem=document.createElement("INPUT");elem.setAttribute("type","search"),elem.setAttribute("placeholder","Type to search..."),toolDomElement.insertBefore(elem,toolDomElement.firstChild),elem.addEventListener("keyup",this._doSearch.bind(this)),elem=document.createElement("SPAN"),elem.classList.add("nhb-add-element-list-none-found"),elem.innerHTML="Nothing found",toolDomElement.insertBefore(elem,toolDomElement.firstChild)}},AddElementList._onClick=function(e){var root=ContentEdit.Root.get();if(root.focused()){for(var currTarget=e.target;!currTarget.classList.contains("nhb-add-element-list-item")&&currTarget.parentNode;)currTarget=currTarget.parentNode;this.addClickedItem(currTarget,root.focused())}},AddElementList.showList=function(){this._ceElement._domElement.style.display="block";var search=this._ceElement._domElement.querySelector('[type="search"]');search.focus(),search.select()},AddElementList.hideList=function(){this._ceElement._domElement.style.display=""},AddElementList._doSearch=function(ev){var elements,searchString=ev.target.value.trim().toLowerCase(),noneFoundLabel=this._ceElement._domElement.querySelector(".nhb-add-element-list-none-found");return noneFoundLabel.style.display="none",""===searchString?(elements=ev.target.parentNode.querySelectorAll("[data-search-terms]"),void Array.prototype.forEach.call(elements,function(el){el.style.display=""})):(elements=ev.target.parentNode.querySelectorAll("[data-search-terms]"),Array.prototype.forEach.call(elements,function(el){el.style.display="none"}),elements=ev.target.parentNode.querySelectorAll('[data-search-terms*="'+searchString+'"]'),Array.prototype.forEach.call(elements,function(el){el.style.display=""}),void(elements.length||(noneFoundLabel.style.display="block")))},AddElementList}(ContentTools.Tool),function(){var proxied=ContentTools.ToolboxUI.prototype.mount;ContentTools.ToolboxUI.prototype.mount=function(){var ret=proxied.call(this);for(var i in this._toolUIs)this._toolUIs.hasOwnProperty(i)&&this._toolUIs[i].tool.init&&this._toolUIs[i].tool.init();return ret}}(),function(){var proxied=ContentTools.ToolUI.prototype._addDOMEventListeners;ContentTools.ToolUI.prototype._addDOMEventListeners=function(){if(this.tool.__super__&&"AddElementButton"===this.tool.__super__.constructor.name)this._domElement.addEventListener("mousedown",function(e){e.target.classList.contains("ct-tool")&&e.preventDefault()}),this._domElement.addEventListener("click",function(e){if(e.target.classList.contains("ct-tool")){var tool=window.nhbEditor.getToolUI(this.tool.listTool);"undefined"!=typeof tool&&tool.tool.toggleList()}}.bind(this));else{if(!this.tool.__super__||"AddElementList"!==this.tool.__super__.constructor.name)return proxied.call(this);this._domElement.addEventListener("mousedown",function(e){e.target.classList.contains("ct-tool")&&e.preventDefault()})}}}(),ContentTools.Tools.Shortcode=function(_super){function Shortcode(){return Shortcode.__super__.constructor.apply(this,arguments)}return __extends(Shortcode,_super),ContentTools.ToolShelf.stow(Shortcode,"shortcode"),Shortcode.label=nhbParams.labels.shortcode,Shortcode.icon="shortcode",Shortcode.tagName="shortcode",Shortcode.buttonName=nhbParams.labels.shortcode,Shortcode.apply=function(element,selection,callback){var parent=null,index=0,root=ContentEdit.Root.get();if(root.focused())parent=root.focused().parent(),index=parent.children.indexOf(root.focused())+1;else{var mainRegion=ContentTools.EditorApp.get().regions()["main-content"];mainRegion.children&&(parent=mainRegion.children[0].parent())}return this.createNew(parent,index),callback(!0)},Shortcode.createNew=function(parent,index){nhbEditor.shortcodeFrame.open({title:nhbParams.labels.insert_shortcode,button:nhbParams.labels.insert_shortcode,successCallback:function(view){var elem,base=view.selected.getAttribute("data-shortcode-tag"),shortcodeRaw=this.createInsertedShortcode(base),shortcode=wp.shortcode.next(base,shortcodeRaw,0),isMapped=nhbParams.shortcode_mappings[base];elem=isMapped?ContentEdit.Shortcode.createShortcode(shortcode):new ContentEdit.Text("p",{},shortcode.shortcode.string()),parent.attach(elem,index),isMapped?elem.ajaxUpdate(!0):(elem.origShortcode="",elem.origInnerHTML="",elem.isShortcodeEditing=!0),elem.focus()}.bind(this)})},Shortcode.createInsertedShortcode=function(base){var scData={tag:base,type:"closed",content:"",attrs:{}};if("undefined"==typeof nhbInspectorOptions.Shortcode[base]&&"undefined"!=typeof nhbParams.shortcode_mappings&&"undefined"!=typeof nhbParams.shortcode_mappings[base]){var editor=ContentTools.EditorApp.get();editor._toolbox.createShortcodeMappingOptions&&editor._toolbox.createShortcodeMappingOptions(base)}if(nhbInspectorOptions.Shortcode[base]&&nhbInspectorOptions.Shortcode[base].options)for(var i=0;i<nhbInspectorOptions.Shortcode[base].options.length;i++){var option=nhbInspectorOptions.Shortcode[base].options[i];option.id&&("content"===option.id?scData.content=option["default"]||"":scData.attrs[option.id]=option["default"]||"")}return new wp.shortcode(scData).string()},Shortcode}(ContentTools.Tools.ElementButton),ContentTools.Tools.Heading1=function(_super){function Heading1(){return Heading1.__super__.constructor.apply(this,arguments)}return __extends(Heading1,_super),ContentTools.ToolShelf.stow(Heading1,"h1"),Heading1.label=nhbParams.labels.heading_label.replace("%d","1"),Heading1.icon="h1",Heading1.tagName="h1",Heading1.canApply=function(element,selection){return"ListItemText"===element.constructor.name?!1:"TableCellText"===element.constructor.name?!1:ContentTools.Tools.Paragraph.canApply(element,selection)},Heading1.apply=function(element,selection,callback){if(!this.isApplied(element)){if(!element.content){var heading=new ContentEdit.Text(this.tagName);return element.parent().attach(heading,element.parent().children.indexOf(element)+1),heading.focus(),callback(!0)}return Heading1.__super__.constructor.apply.call(this,element,selection,callback)}},Heading1.isApplied=function(element){return element.tagName()===this.tagName},Heading1}(ContentTools.Tools.Heading),ContentTools.Tools.Heading2=function(_super){function Heading2(){return Heading2.__super__.constructor.apply(this,arguments)}return __extends(Heading2,_super),ContentTools.ToolShelf.stow(Heading2,"h2"),Heading2.label=nhbParams.labels.heading_label.replace("%d","2"),Heading2.icon="h2",Heading2.tagName="h2",Heading2}(ContentTools.Tools.Heading1),ContentTools.Tools.Heading3=function(_super){function Heading3(){return Heading3.__super__.constructor.apply(this,arguments)}return __extends(Heading3,_super),ContentTools.ToolShelf.stow(Heading3,"h3"),Heading3.label=nhbParams.labels.heading_label.replace("%d","3"),Heading3.icon="h3",Heading3.tagName="h3",Heading3}(ContentTools.Tools.Heading1),ContentTools.Tools.Heading4=function(_super){function Heading4(){return Heading4.__super__.constructor.apply(this,arguments)}return __extends(Heading4,_super),ContentTools.ToolShelf.stow(Heading4,"h4"),Heading4.label=nhbParams.labels.heading_label.replace("%d","4"),Heading4.icon="h4",Heading4.tagName="h4",Heading4}(ContentTools.Tools.Heading1),ContentTools.Tools.Heading5=function(_super){function Heading5(){return Heading5.__super__.constructor.apply(this,arguments)}return __extends(Heading5,_super),ContentTools.ToolShelf.stow(Heading5,"h5"),Heading5.label=nhbParams.labels.heading_label.replace("%d","5"),Heading5.icon="h5",Heading5.tagName="h5",Heading5}(ContentTools.Tools.Heading1),ContentTools.Tools.Heading6=function(_super){function Heading6(){return Heading6.__super__.constructor.apply(this,arguments)}return __extends(Heading6,_super),ContentTools.ToolShelf.stow(Heading6,"h6"),Heading6.label=nhbParams.labels.heading_label.replace("%d","6"),Heading6.icon="h6",Heading6.tagName="h6",Heading6}(ContentTools.Tools.Heading1),ContentTools.Tools.Blockquote=function(_super){function Blockquote(){return Blockquote.__super__.constructor.apply(this,arguments)}return __extends(Blockquote,_super),ContentTools.ToolShelf.stow(Blockquote,"blockquote"),Blockquote.label=nhbParams.labels.blockquote,Blockquote.icon="blockquote",Blockquote.tagName="blockquote",Blockquote}(ContentTools.Tools.Heading1),ContentTools.Tools.ClearFormatting=function(_super){function ClearFormatting(){return ClearFormatting.__super__.constructor.apply(this,arguments)}return __extends(ClearFormatting,_super),ContentTools.ToolShelf.stow(ClearFormatting,"clear-formatting"),ClearFormatting.label=nhbParams.labels.clear_formatting,ClearFormatting.icon="clear-formatting",ClearFormatting.tagName="span",ClearFormatting.canApply=function(element,selection){if(!ContentTools.Tools.Bold.canApply(element,selection))return!1;var _ref,from=0,to=0;return void 0!==element.content&&element.content.length()?(selection&&(_ref=selection.get(),from=_ref[0],to=_ref[1]),from===to&&(from=0,to=element.content.length()),element.content.hasStyle(from,to)):!1},ClearFormatting.apply=function(element,selection,callback){var from,to,_ref;return element.storeState(),_ref=selection.get(),from=_ref[0],to=_ref[1],from===to&&(from=0,to=element.content.length()),element.content=element.content.removeStyles(from,to),element.updateInnerHTML(),element.taint(),element.restoreState(),
callback(!0)},ClearFormatting}(ContentTools.Tool),ContentTools.Tools.Code=function(_super){function Code(){return Code.__super__.constructor.apply(this,arguments)}return __extends(Code,_super),ContentTools.ToolShelf.stow(Code,"code"),Code.label=nhbParams.labels.code,Code.icon="code",Code.tagName="code",Code.canApply=function(element,selection){if(!selection)return!1;var _ref=selection.get(),from=_ref[0],to=_ref[1];return from!==to},Code.apply=function(element,selection,callback){var from,to,_ref;return element.storeState(),_ref=selection.get(),from=_ref[0],to=_ref[1],this.isApplied(element,selection)?element.content=element.content.unformat(from,to,new HTMLString.Tag(this.tagName)):element.content=element.content.format(from,to,new HTMLString.Tag(this.tagName)),element.updateInnerHTML(),element.taint(),element.restoreState(),callback(!0)},Code.isApplied=function(element,selection){if(selection){var from,to,_ref;return void 0!==element.content&&element.content.length()?(_ref=selection.get(),from=_ref[0],to=_ref[1],from===to&&(to+=1),element.content.slice(from,to).hasTags(this.tagName,!0)):!1}return!1},Code}(ContentTools.Tools.Bold),ContentTools.Tools.Color=function(_super){function Color(){return Color.__super__.constructor.apply(this,arguments)}return __extends(Color,_super),ContentTools.ToolShelf.stow(Color,"color"),Color.label=nhbParams.labels.color,Color.icon="color",Color.tagName="span",Color.canApply=function(element,selection){if(!element.content)return!1;var from,to,apply=selection&&!selection.isCollapsed(),color="";if(apply){var _ref=selection.get();from=_ref[0],to=_ref[1],from===to&&(to+=1)}else from=0,to=element.content.length();var selectedContent=element.content.slice(from,to).html(),matches=selectedContent.match(/^<span[^>]style[^>]+['"\s;]color:\s?([#().,\w]+)/);if(matches&&(color=matches[1]),!color){if("undefined"==typeof this._defaultBodyTextColor){var s=getComputedStyle(document.body);this._defaultBodyTextColor=s.color}color=this._defaultBodyTextColor}return this._ceElement._domElement.style.backgroundColor!==color&&(this._ceElement._domElement.style.backgroundColor=color),color?window.nhbEditor.getToolUI(this.icon)._domElement.setAttribute("data-tooltip",this.label+": "+color):window.nhbEditor.getToolUI(this.icon)._domElement.setAttribute("data-tooltip",this.label),!0},Color.isApplied=function(){return!1},Color.apply=function(element,selection,callback){var from,to,_ref;element.storeState(),this.rememberedSelection&&(selection=this.rememberedSelection),_ref=selection.get(),from=_ref[0],to=_ref[1],from===to&&(from=0,to=element.content.length());var currColor=jQuery(this._ceElement._domElement.querySelector("input")).iris("color");return""===this._ceElement._domElement.querySelector("input").value&&(currColor=""),element.content=element.content.style(from,to,element._tagName,{color:currColor}),element.updateInnerHTML(),element.taint(),element.restoreState(),wp.hooks.doAction("nhb.tool.color.applied",element),callback(!0)},Color._colorPickerMount=function(){var _this=this,d=document.createElement("DIV"),o=document.createElement("INPUT");o.addEventListener("mousedown",function(){var element=ContentEdit.Root.get().focused(),selection=null;element.selection&&(selection=element.selection());var _ref=selection.get(),from=_ref[0],to=_ref[1];(0!==from||0!==to)&&(_this.rememberedSelection=selection)}),o.addEventListener("keyup",function(e){""===e.target.value&&(_this.selectedColor=e.target.value,_this._ceElement._mouseDown=!0,_this._ceElement._onMouseUp(),jQuery(_this._ceElement._domElement.querySelector("input")).iris("color",_this.selectedColor))}),o.addEventListener("blur",function(){_this._ceElement._domElement.querySelector("input").focus()}),o.classList.add("color-picker"),o.setAttribute("data-alpha","true"),d.appendChild(o),this._ceElement._domElement.appendChild(d),jQuery(o).iris({defaultColor:this._ceElement._domElement.style.backgroundColor,change:function(event){_this._ceElement._justShowedPicker||(_this.selectedColor=event.target.value,_this._ceElement._mouseDown=!0,_this._ceElement._onMouseUp(event)),_this._ceElement._justShowedPicker=void 0},clear:function(){},hide:!1,palettes:["#000","#fff","#CF000F","#D2527F","#F89406","#F9BF3B","#2ECC71","#19B5FE","#8E44AD"]}),document.querySelector(".ct-toolbox").addEventListener("mouseleave",function(){_this.hidePicker()}),wp.hooks.addAction("nhb.tool.popup.open",function(){this.hidePicker()}.bind(this))},Color.hidePicker=function(){this._ceElement._domElement.firstChild.style.display="",this.rememberedSelection=null},Color}(ContentTools.Tool),ContentEdit.Root.get().bind("blur",function(){var tool=window.nhbEditor.getToolUI("color");"undefined"!=typeof tool&&tool.tool.hidePicker()}),ContentTools.ToolUI.prototype._colorPickerMountOverride=ContentTools.ToolUI.prototype.mount,ContentTools.ToolUI.prototype.mount=function(domParent,before){var ret=this._colorPickerMountOverride(domParent,before);return this.tool._ceElement=this,"undefined"!=typeof this.tool._colorPickerMount&&this.tool._colorPickerMount(),ret},ContentTools.ToolUI.prototype._toolColorAddDOMEventListeners=ContentTools.ToolUI.prototype._addDOMEventListeners,ContentTools.ToolUI.prototype._addDOMEventListeners=function(){if("Color"!==this.tool.name)return this._toolColorAddDOMEventListeners();var _this=this;this._domElement.addEventListener("mousedown",function(e){e.target.classList.contains("ct-tool")&&e.preventDefault()}),this._domElement.addEventListener("click",function(e){if(e.target.classList.contains("ct-tool")){_this._domElement.querySelector("input").value=_this._domElement.style.backgroundColor,_this._justShowedPicker=!0,jQuery(_this._domElement.querySelector("input")).iris("color",_this._domElement.style.backgroundColor),""===_this._domElement.firstChild.style.display&&wp.hooks.doAction("nhb.tool.popup.open"),_this._domElement.firstChild.style.display=_this._domElement.firstChild.style.display?"":"block";var elements=_this._domElement.querySelectorAll(".iris-palette");Array.prototype.forEach.call(elements,function(el){"undefined"==typeof el._nhbInitDone&&(el._nhbInitDone=!0,el.addEventListener("mousedown",function(e){e.preventDefault()}))})}})},ContentTools.Tools.TwoColumn=function(_super){function OneColumn(){return OneColumn.__super__.constructor.apply(this,arguments)}return __extends(OneColumn,_super),ContentTools.ToolShelf.stow(OneColumn,"onecolumn"),OneColumn.label=nhbParams.labels.one_column,OneColumn.icon="onecolumn",OneColumn.tagName="onecolumn",OneColumn.buttonName=nhbParams.labels.one_column,OneColumn.apply=function(element,selection,callback){var index=element.parent().children.indexOf(element)+1;return element.blur(),this.createNew(element.parent(),index),callback(!0)},OneColumn.createNew=function(parent,index){var row=new ContentEdit.DivRow("div"),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},"");parent.attach(row,index),row.attach(col),col.attach(p),p.focus(),row.showOutline(),wp.hooks.doAction("nhb.tool.row.applied",row)},OneColumn}(ContentTools.Tools.ElementButton),ContentTools.Tools.TwoColumn=function(_super){function TwoColumn(){return TwoColumn.__super__.constructor.apply(this,arguments)}return __extends(TwoColumn,_super),ContentTools.ToolShelf.stow(TwoColumn,"twocolumn"),TwoColumn.label=nhbParams.labels.two_column,TwoColumn.icon="twocolumn",TwoColumn.tagName="twocolumn",TwoColumn.buttonName=nhbParams.labels.two_column,TwoColumn.apply=function(element,selection,callback){var index=element.parent().children.indexOf(element)+1;return element.blur(),this.createNew(element.parent(),index),callback(!0)},TwoColumn.createNew=function(parent,index){var row=new ContentEdit.DivRow("div"),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},"");parent.attach(row,index),row.attach(col),col.attach(p),p.focus(),col.style("flex-basis","50%"),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},""),row.attach(col),col.attach(p),col.style("flex-basis","50%"),row.showOutline()},TwoColumn}(ContentTools.Tools.ElementButton),ContentTools.Tools.ThreeColumn=function(_super){function ThreeColumn(){return ThreeColumn.__super__.constructor.apply(this,arguments)}return __extends(ThreeColumn,_super),ContentTools.ToolShelf.stow(ThreeColumn,"threecolumn"),ThreeColumn.label=nhbParams.labels.three_column,ThreeColumn.icon="threecolumn",ThreeColumn.tagName="threecolumn",ThreeColumn.buttonName=nhbParams.labels.three_column,ThreeColumn.apply=function(element,selection,callback){var index=element.parent().children.indexOf(element)+1;return element.blur(),this.createNew(element.parent(),index),callback(!0)},ThreeColumn.createNew=function(parent,index){var row=new ContentEdit.DivRow("div"),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},"");parent.attach(row,index),row.attach(col),col.attach(p),p.focus(),col.style("flex-basis","33.33%"),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},""),row.attach(col),col.attach(p),col.style("flex-basis","33.33%"),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},""),row.attach(col),col.attach(p),col.style("flex-basis","33.33%"),row.showOutline()},ThreeColumn}(ContentTools.Tools.ElementButton),ContentTools.Tools.FourColumn=function(_super){function FourColumn(){return FourColumn.__super__.constructor.apply(this,arguments)}return __extends(FourColumn,_super),ContentTools.ToolShelf.stow(FourColumn,"fourcolumn"),FourColumn.label=nhbParams.labels.four_column,FourColumn.icon="fourcolumn",FourColumn.tagName="fourcolumn",FourColumn.buttonName=nhbParams.labels.four_column,FourColumn.apply=function(element,selection,callback){var index=element.parent().children.indexOf(element)+1;return element.blur(),this.createNew(element.parent(),index),callback(!0)},FourColumn.createNew=function(parent,index){var row=new ContentEdit.DivRow("div"),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},"");parent.attach(row,index),row.attach(col),col.attach(p),p.focus(),col.style("flex-basis","25%"),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},""),row.attach(col),col.attach(p),col.style("flex-basis","25%"),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},""),row.attach(col),col.attach(p),col.style("flex-basis","25%"),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},""),row.attach(col),col.attach(p),col.style("flex-basis","25%"),row.showOutline()},FourColumn}(ContentTools.Tools.ElementButton),ContentTools.Tools.InsertElement=function(_super){function InsertElement(){return InsertElement.__super__.constructor.apply(this,arguments)}return __extends(InsertElement,_super),ContentTools.ToolShelf.stow(InsertElement,"insertElement"),InsertElement.label="",InsertElement.icon="insert-element",InsertElement.className="",InsertElement.apply=function(element,selection,callback){var editor=ContentTools.EditorApp.get();return editor._toolboxElements.toggle(),callback(!0)},InsertElement.canApply=function(){return!0},InsertElement}(ContentTools.Tool),function(){var proxied=ContentTools.ToolUI.prototype.mount;ContentTools.ToolUI.prototype.mount=function(domParent,before){var ret=proxied.call(this,domParent,before);return this._domElement.classList.contains("ct-tool--insert-element")&&(this._domElement.innerHTML="<span>"+nhbParams.labels.add_element+"</span>",this._toolboxElementsHoverShow=function(){ContentTools.EditorApp.get()._toolboxElements.show()},this._domElement.addEventListener("mouseenter",this._toolboxElementsHoverShow),this._toolboxElementsSideMouseEnterHandler=function(ev){window.nhbEditor.isEditing()&&ev.screenX<=10&&ev.screenY>70&&ContentTools.EditorApp.get()._toolboxElements.show()},document.body.addEventListener("mousemove",this._toolboxElementsSideMouseEnterHandler),this._toolboxElementsAdminbarEnterHandler=function(){ContentTools.EditorApp.get()._toolboxElements.hide()},document.querySelector("#wpadminbar").addEventListener("mousemove",this._toolboxElementsAdminbarEnterHandler)),ret}}(),function(){var proxied=ContentTools.ToolUI.prototype.unmount;ContentTools.ToolUI.prototype.unmount=function(t,e){return this._domElement.classList.contains("ct-tool--insert-element")&&(this._domElement.removeEventListener("mouseenter",this._toolboxElementsHoverShow),document.body.removeEventListener("mousemove",this._toolboxElementsSideMouseEnterHandler),document.querySelector("#wpadminbar").removeEventListener("mousemove",this._toolboxElementsAdminbarEnterHandler)),proxied.call(this,t,e)}}(),function(){ContentTools.Tools.AlignLeft.className="",ContentTools.Tools.AlignLeft.apply=function(element,selection,callback){var _ref;return("ListItemText"===(_ref=element.constructor.name)||"TableCellText"===_ref)&&(element=element.parent()),"Icon"===element.constructor.name?(element.hasCSSClass("alignleft")?element.removeCSSClass("alignleft"):(element.removeCSSClass("alignleft"),element.removeCSSClass("alignright"),element.removeCSSClass("aligncenter"),element.removeCSSClass("alignnone"),element.addCSSClass("alignleft")),callback(!0)):(element.style("textAlign","left"),callback(!0))},ContentTools.Tools.AlignLeft.isApplied=function(element){var _ref;return this.canApply(element)?(("ListItemText"===(_ref=element.type())||"TableCellText"===_ref)&&(element=element.parent()),"Icon"===element.constructor.name?element.hasCSSClass("alignleft"):"left"===element.style("textAlign")||"start"===element.style("textAlign")):!1};var proxiedCanApply=ContentTools.Tools.AlignLeft.canApply;ContentTools.Tools.AlignLeft.canApply=function(element,selection){return"Icon"===element.constructor.name?!0:proxiedCanApply.call(this,element,selection)}}(),function(){ContentTools.Tools.AlignCenter.className="",ContentTools.Tools.AlignCenter.apply=function(element,selection,callback){var _ref;return("ListItemText"===(_ref=element.constructor.name)||"TableCellText"===_ref)&&(element=element.parent()),"Icon"===element.constructor.name?(element.hasCSSClass("aligncenter")?element.removeCSSClass("aligncenter"):(element.removeCSSClass("alignleft"),element.removeCSSClass("alignright"),element.removeCSSClass("aligncenter"),element.removeCSSClass("alignnone"),element.addCSSClass("aligncenter")),callback(!0)):(element.style("textAlign","center"),callback(!0))},ContentTools.Tools.AlignCenter.isApplied=function(element){var _ref;return this.canApply(element)?(("ListItemText"===(_ref=element.type())||"TableCellText"===_ref)&&(element=element.parent()),"Icon"===element.constructor.name?element.hasCSSClass("aligncenter"):"center"===element.style("textAlign")):!1};var proxiedCanApply=ContentTools.Tools.AlignCenter.canApply;ContentTools.Tools.AlignCenter.canApply=function(element,selection){return"Icon"===element.constructor.name?!0:proxiedCanApply.call(this,element,selection)}}(),function(){ContentTools.Tools.AlignRight.className="",ContentTools.Tools.AlignRight.apply=function(element,selection,callback){var _ref;return("ListItemText"===(_ref=element.constructor.name)||"TableCellText"===_ref)&&(element=element.parent()),"Icon"===element.constructor.name?(element.hasCSSClass("alignright")?element.removeCSSClass("alignright"):(element.removeCSSClass("alignleft"),element.removeCSSClass("alignright"),element.removeCSSClass("aligncenter"),element.removeCSSClass("alignnone"),element.addCSSClass("alignright")),callback(!0)):(element.style("textAlign","right"),callback(!0))},ContentTools.Tools.AlignRight.isApplied=function(element){var _ref;return this.canApply(element)?(("ListItemText"===(_ref=element.type())||"TableCellText"===_ref)&&(element=element.parent()),"Icon"===element.constructor.name?element.hasCSSClass("alignright"):"right"===element.style("textAlign")||"end"===element.style("textAlign")):!1};var proxiedCanApply=ContentTools.Tools.AlignRight.canApply;ContentTools.Tools.AlignRight.canApply=function(element,selection){return"Icon"===element.constructor.name?!0:proxiedCanApply.call(this,element,selection)}}(),ContentTools.Tools.AlignJustify=function(_super){function AlignJustify(){return AlignJustify.__super__.constructor.apply(this,arguments)}return __extends(AlignJustify,_super),ContentTools.ToolShelf.stow(AlignJustify,"align-justify"),AlignJustify.label=nhbParams.labels.justify,AlignJustify.icon="align-justify",AlignJustify.className="",AlignJustify.apply=function(element,selection,callback){var _ref;return("ListItemText"===(_ref=element.constructor.name)||"TableCellText"===_ref)&&(element=element.parent()),element.style("textAlign","justify"),callback(!0)},AlignJustify.canApply=function(element,selection){return"Icon"===element.constructor.name?!1:AlignJustify.__super__.constructor.canApply.call(this,element,selection)},AlignJustify.isApplied=function(element,selection){var _ref;return this.canApply(element)?(("ListItemText"===(_ref=element.type())||"TableCellText"===_ref)&&(element=element.parent()),"justify"===element.style("textAlign")):!1},AlignJustify}(ContentTools.Tools.AlignLeft),ContentTools.Tools.Sidebar=function(_super){function Sidebar(){return Sidebar.__super__.constructor.apply(this,arguments)}return __extends(Sidebar,_super),ContentTools.ToolShelf.stow(Sidebar,"sidebar"),Sidebar.label=nhbParams.labels.sidebar_or_widget_area,Sidebar.icon="sidebar",Sidebar.tagName="sidebar",Sidebar.buttonName=nhbParams.labels.sidebar,Sidebar.apply=function(element,selection,callback){var index=element.parent().children.indexOf(element)+1;return this.createNew(element.parent(),index),callback(!0)},Sidebar.createNew=function(parent,index){var defaultSidebar="";for(var sidebarID in nhbParams.sidebar_list)if(sidebarID&&nhbParams.sidebar_list.hasOwnProperty(sidebarID)){defaultSidebar=sidebarID;break}var shortcode=wp.shortcode.next("nhb_sidebar",'[nhb_sidebar id="'+defaultSidebar+'"][/nhb_sidebar]',0),newElem=ContentEdit.Shortcode.createShortcode(shortcode);parent.attach(newElem,index),newElem.ajaxUpdate(!0),newElem.focus()},Sidebar}(ContentTools.Tools.ElementButton),ContentTools.Tools.Hr=function(_super){function Hr(){return Hr.__super__.constructor.apply(this,arguments)}return __extends(Hr,_super),ContentTools.ToolShelf.stow(Hr,"hr"),Hr.label=nhbParams.labels.horizontal_rule,Hr.icon="hr",Hr.tagName="hr",Hr.canApply=function(){return!0},Hr.apply=function(element,selection,callback){var hr=new ContentEdit.Hr("hr"),index=element.parent().children.indexOf(element);return element.parent().attach(hr,index+1),hr.focus(),callback(!0)},Hr}(ContentTools.Tool),ContentTools.Tools.Icon=function(_super){function Icon(){return Icon.__super__.constructor.apply(this,arguments)}return __extends(Icon,_super),ContentTools.ToolShelf.stow(Icon,"icon"),Icon.label=nhbParams.labels.icon,Icon.icon="icon",Icon.tagName="icon",Icon.buttonName=nhbParams.labels.icon,Icon.apply=function(element,selection,callback){return nhbEditor.iconFrame.open({title:nhbParams.labels.insert_icon,button:nhbParams.labels.use_icon,successCallback:function(view){var newElem=new ContentEdit.Icon("div",{},view.selected.innerHTML),index=element.parent().children.indexOf(element);element.parent().attach(newElem,index+1),newElem.focus()}}),callback(!0)},Icon.createNew=function(parent,index){return nhbEditor.iconFrame.open({title:nhbParams.labels.insert_icon,button:nhbParams.labels.use_icon,successCallback:function(view){var newElem=new ContentEdit.Icon("div",{},view.selected.innerHTML);parent.attach(newElem,index),newElem.focus()}}),null},Icon}(ContentTools.Tools.ElementButton),ContentTools.Tools.Link._nhbToolLinkOverrideCanApply=ContentTools.Tools.Link.canApply,ContentTools.Tools.Link.canApply=function(element,selection){var ret=this._nhbToolLinkOverrideCanApply(element,selection);if(!ret&&element.content&&selection){var _ref=selection.get(),from=_ref[0],to=_ref[1];if(from===to)return!0}return ret},ContentTools.Tools.Link.getSelectedLink=function(element,from,to){if(from<element.content.characters.length&&from>=0&&element.content.characters[from].hasTags("a"))for(;from>0;)if(from--,!element.content.characters[from].hasTags("a")){from++;break}if(to<element.content.characters.length&&to>=0&&element.content.characters[to].hasTags("a"))for(;to<element.content.characters.length&&element.content.characters[to].hasTags("a");)to++;return{from:from,to:to}},ContentTools.Tools.Link.apply=function(element,selection,callback){if("Image"===element.constructor.name)return void element.openMediaManager();var _ref=selection.get(),from=_ref[0],to=_ref[1],selected=this.getSelectedLink(element,from,to);from=selected.from,to=selected.to,selection=new ContentSelect.Range(from,to);var tag=this.getTag(element,selection),url="",target="",text="",existingClass="",existingStyles="";return tag&&(tag.attr("href")&&(url=tag.attr("href")),tag.attr("target")&&(target=tag.attr("target")),tag.attr("class")&&(existingClass=tag.attr("class")),tag.attr("style")&&(existingStyles=tag.attr("style"))),text=element.content.unformat(from,to,"a"),text=text.slice(from,to),element.storeState&&element.storeState(),wpLink.open("dummy-wplink-textarea"),text.html().trim()===text.text().trim()?(document.querySelector("#wp-link-wrap").classList.add("has-text-field"),text=text.text()):(document.querySelector("#wp-link-wrap").classList.remove("has-text-field"),text=""),document.querySelector("#wp-link-url, #link-options #url-field").value=url,document.querySelector("#wp-link-text, #link-options #link-title-field").value=text,document.querySelector("#wp-link-target, #link-options #link-target-checkbox").checked=""!==target,window._nhbCurrentLink={element:element,selection:selection,existingClass:existingClass,existingStyles:existingStyles,type:this.name},callback(!0)},window.addEventListener("DOMContentLoaded",function(){document.addEventListener("click",function(ev){if("wp-link-submit"===ev.target.getAttribute("id")){var element=window._nhbCurrentLink.element,selection=window._nhbCurrentLink.selection,existingClass=window._nhbCurrentLink.existingClass,existingStyles=window._nhbCurrentLink.existingStyles,linkType=window._nhbCurrentLink.type,_ref=selection.get(),from=_ref[0],to=_ref[1];element.content=element.content.unformat(from,to,"a");var url=document.querySelector("#wp-link-url, #link-options #url-field").value,text=document.querySelector("#wp-link-text, #link-options #link-title-field").value,target=document.querySelector("#wp-link-target, #link-options #link-target-checkbox").checked;if(url){var args={href:url};if(target&&(args.target="_blank"),existingClass&&(args["class"]=existingClass),existingStyles&&(args.style=existingStyles),args=wp.hooks.applyFilters("nhb.tool."+linkType.toLowerCase()+".args",args),document.querySelector("#wp-link-wrap").classList.contains("has-text-field")&&""===text.trim()&&(text=url),text){var content=new HTMLString.String(text,"PreText"===element.constructor.name);content=content.format(0,content.characters.length,new HTMLString.Tag("a",args));var tip=element.content.substring(0,selection.get()[0]),tail=element.content.substring(selection.get()[1]);element.content=tip.concat(content),element.content=element.content.concat(tail,!1),from===to&&(to+=content.length())}else element.content=element.content.format(from,to,new HTMLString.Tag("a",args))}else element.content=element.content.unformat(from,to,"a");delete window._nhbCurrentLink,wp.hooks.doAction("nhb.tool."+linkType.toLowerCase()+".applied",element,from,to),element.updateInnerHTML(),element.taint(),element.restoreState&&element.restoreState(),wpLink.close()}})}),ContentTools.Tools.Link.getTag=function(element,selection){var c,from,selectedContent,tag,to,_i,_j,_len,_len1,_ref,_ref1,_ref2;if("Image"===element.constructor.name){if(element.a)return element.a}else for(_ref=selection.get(),from=_ref[0],to=_ref[1],selectedContent=element.content.slice(from,to),_ref1=selectedContent.characters,_i=0,_len=_ref1.length;_len>_i;_i++)if(c=_ref1[_i],c.hasTags("a"))for(_ref2=c.tags(),_j=0,_len1=_ref2.length;_len1>_j;_j++)if(tag=_ref2[_j],"a"===tag.name())return tag;return null},ContentTools.Tools.Widget=function(_super){function Widget(){return Widget.__super__.constructor.apply(this,arguments)}return __extends(Widget,_super),ContentTools.ToolShelf.stow(Widget,"widget"),Widget.label=nhbParams.labels.widget,Widget.icon="widget",Widget.tagName="widget",Widget.buttonName=nhbParams.labels.widget,Widget.apply=function(element,selection,callback){var root=ContentEdit.Root.get(),elemFocused=null;if(root.focused())elemFocused=root.focused();else{var mainRegion=ContentTools.EditorApp.get().regions()["main-content"];mainRegion.children&&(elemFocused=mainRegion.children[0])}var index=elemFocused.parent().children.indexOf(elemFocused)+1;return this.createNew(elemFocused.parent(),index),callback(!0)},Widget.createNew=function(parent,index){nhbEditor.widgetFrame.open({title:nhbParams.labels.insert_widget,button:nhbParams.labels.insert_widget,successCallback:function(view){var base="nhb_widget",widgetSlug=view.selected.getAttribute("data-widget-slug"),shortcodeRaw='[nhb_widget widget="'+widgetSlug+'" ]',shortcode=wp.shortcode.next(base,shortcodeRaw,0),elem=ContentEdit.Shortcode.createShortcode(shortcode);parent.attach(elem,index),elem.focus(),setTimeout(function(){elem.ajaxUpdate(!0)},20)}})},Widget}(ContentTools.Tools.ElementButton),ContentTools.Tools.Text=function(_super){function Text(){return Text.__super__.constructor.apply(this,arguments)}return __extends(Text,_super),ContentTools.ToolShelf.stow(Text,"text"),Text.label=nhbParams.labels.text,Text.icon="text",Text.tagName="p",Text.shortcut="",Text.buttonName=nhbParams.labels.text,Text.apply=function(element,selection,callback){var index=element.parent().children.indexOf(element)+1;return this.createNew(element.parent(),index),callback(!0)},Text.createNew=function(parent,index){var newElem=new ContentEdit.Text("p",{},"");parent.attach(newElem,index),newElem.focus()},Text}(ContentTools.Tools.ElementButton),ContentTools.Tools.Html=function(_super){function Html(){return Html.__super__.constructor.apply(this,arguments)}return __extends(Html,_super),ContentTools.ToolShelf.stow(Html,"html"),Html.label=nhbParams.labels.html,Html.icon="html",Html.tagName="html",Html.buttonName=nhbParams.labels.html,Html.apply=function(element,selection,callback){var root=ContentEdit.Root.get(),elemFocused=null;if(root.focused())elemFocused=root.focused();else{var mainRegion=ContentTools.EditorApp.get().regions()["main-content"];mainRegion.children&&(elemFocused=mainRegion.children[0])}var dummy=document.createElement("DIV");dummy.setAttribute("data-ce-tag","html");var elem=ContentEdit.Html.fromDOMElement(dummy),index=elemFocused.parent().children.indexOf(elemFocused);return elemFocused.parent().attach(elem,index+1),elem.focus(),elem.openEditor(),callback(!0)},Html.createNew=function(parent,index){var dummy=document.createElement("DIV");dummy.setAttribute("data-ce-tag","html");var elem=ContentEdit.Html.fromDOMElement(dummy);parent.attach(elem,index),elem.focus(),elem.openEditor()},Html}(ContentTools.Tools.ElementButton),ContentTools.Tools.Map=function(_super){function Map(){return Map.__super__.constructor.apply(this,arguments)}return __extends(Map,_super),ContentTools.ToolShelf.stow(Map,"map"),Map.label=nhbParams.labels.map,Map.icon="map",Map.tagName="div",Map.shortcut="",Map.buttonName=nhbParams.labels.map,Map.apply=function(element,selection,callback){var index=element.parent().children.indexOf(element)+1;return this.createNew(element.parent(),index),callback(!0)},Map.createNew=function(parent,index){var newElem=ContentEdit.Map.create();parent.attach(newElem,index),newElem.focus()},Map}(ContentTools.Tools.ElementButton),ContentTools.Tools.Tabs=function(_super){function Tabs(){return Tabs.__super__.constructor.apply(this,arguments)}return __extends(Tabs,_super),ContentTools.ToolShelf.stow(Tabs,"tabs"),Tabs.label=nhbParams.labels.tabs,Tabs.icon="tabs",Tabs.tagName="tabs",Tabs.buttonName=nhbParams.labels.tabs,Tabs.apply=function(element,selection,callback){if(window.nhbSelectorMatches(element._domElement,'[data-ce-tag="tabs"] *'))for(;element&&"Tabs"!==element.constructor.name;)element=element.parent();var index=element.parent().children.indexOf(element)+1;return this.createNew(element.parent(),index),callback(!0)},Tabs.createNew=function(parent,index){for(var hashes=[];hashes.length<4;){var hash=window.nhbEditor.generateHash();document.querySelector(".nhb-tabs-"+hash)||document.querySelector('[id="nhb-tabs-'+hash+'"]')||-1===hashes.indexOf(hash)&&hashes.push(hash)}var elem=document.createElement("div");elem.classList.add("nhb-tabs-"+hashes[0]),elem.setAttribute("data-ce-tag","tabs"),elem.innerHTML='<input class="nhb-tab-state" type="radio" name="nhb-tabs-'+hashes[0]+'" id="nhb-tab-'+hashes[1]+'" data-tab="1" data-ce-tag="tabradio" checked /><input class="nhb-tab-state" type="radio" name="nhb-tabs-'+hashes[0]+'" id="nhb-tab-'+hashes[2]+'" data-tab="2" data-ce-tag="tabradio" /><input class="nhb-tab-state" type="radio" name="nhb-tabs-'+hashes[0]+'" id="nhb-tab-'+hashes[3]+'" data-tab="3" data-ce-tag="tabradio" /><div class="nhb-tab-tabs" data-ce-tag="tabcontainer"><label for="nhb-tab-'+hashes[1]+'" data-ce-tag="tab" class="nhb-tab-active"><span style="font-weight: bold;">Tab 1</span></label><label for="nhb-tab-'+hashes[2]+'" data-ce-tag="tab"><span style="font-weight: bold;">Tab 2</span></label><label for="nhb-tab-'+hashes[3]+'" data-ce-tag="tab"><span style="font-weight: bold;">Tab 3</span></label></div><div class="nhb-tab-panels" data-ce-tag="tabpanelcontainer"><div class="nhb-row" data-panel="1"><div class="nhb-col"><p>Tab 1 content</p></div></div><div class="nhb-row" data-panel="2"><div class="nhb-col"><p>Tab 2 content</p></div></div><div class="nhb-row" data-panel="3"><div class="nhb-col"><p>Tab 3 content</p></div></div></div>';var newElem=ContentEdit.Tabs.fromDOMElement(elem);parent.attach(newElem,index),newElem.focus()},Tabs}(ContentTools.Tools.ElementButton),wp.media.view.settings.post&&(wp.media.view.settings.post.id=nhbParams.post_id),ContentTools.Tools.nhbMedia=function(_super){function nhbMedia(){return nhbMedia.__super__.constructor.apply(this,arguments)}return __extends(nhbMedia,_super),ContentTools.ToolShelf.stow(nhbMedia,"nhb-media"),nhbMedia.label=nhbParams.labels.media,nhbMedia.icon="image",nhbMedia.buttonName=nhbParams.labels.media,nhbMedia.apply=function(element,selection){if(!this._isOpen()){var root=ContentEdit.Root.get(),elem=root.focused();ContentSelect.Range.query(elem._domElement),selection=ContentSelect.Range.query(elem._domElement),window._tempSelection=selection,this._attachToParent=elem.parent(),this._attachIndex=elem.parent().children.indexOf(elem)+1,window._nhbAddMediaOrigInsert=wp.media.editor.insert,wp.media.editor.insert=this.nhbAddMediaOverrideInsert.bind(this),wp.media.editor.open()}},nhbMedia.createNew=function(parent,index){this._attachToParent=parent,this._attachIndex=index,window._nhbAddMediaOrigInsert=wp.media.editor.insert,wp.media.editor.insert=this.nhbAddMediaOverrideInsert.bind(this),wp.media.editor.open()},nhbMedia._isOpen=function(){if(!wp.media.editor.get())return!1;var el=wp.media.editor.get().el;return!(0===el.offsetWidth&&0===el.offsetHeight)},nhbMedia.nhbAddMediaOverrideInsert=function(html){var newElem,root=ContentEdit.Root.get();if(root.focused()){var addedImage=!1;if(html.match(/^\[/)){var base=html.match(/^\[(\w+)/);base=base[1];var shortcode=wp.shortcode.next(base,html,0);newElem=ContentEdit.Shortcode.createShortcode(shortcode),this._attachToParent.attach(newElem,this._attachIndex),newElem.ajaxUpdate(!0),newElem.focus()}else{var dummy=document.createElement("p");dummy.innerHTML=html,newElem=ContentEdit.Image.fromDOMElement(dummy.firstChild),newElem&&(this._attachToParent.attach(newElem,this._attachIndex),addedImage=!0,newElem.focus())}}wp.media.editor.insert=window._nhbAddMediaOrigInsert,delete window._nhbAddMediaOrigInsert},nhbMedia}(ContentTools.Tools.ElementButton),function(){var dragEnterHandler=function(){var mediaModals=document.querySelectorAll('[tabindex="0"] .media-modal'),allModalsHidden=!0;if(Array.prototype.forEach.call(mediaModals,function(el){0!==el.offsetHeight&&(allModalsHidden=!1);
}),allModalsHidden){var root=ContentEdit.Root.get(),elem=root.focused();elem&&window.nhbEditor.getToolUI("nhb-media").apply(elem,null)}};window.addEventListener("DOMContentLoaded",function(){var editor=ContentTools.EditorApp.get();editor.bind("start",function(){document.addEventListener("dragenter",dragEnterHandler)}),editor.bind("stop",function(){document.removeEventListener("dragenter",dragEnterHandler)})})}(),function(){ContentTools.Tools.Table.canApply=function(){return!0}}(),function(){ContentTools.Tools.Table.createNew=function(parent,index){var app,dialog,modal,table;return app=ContentTools.EditorApp.get(),modal=new ContentTools.ModalUI,table=null,dialog=new ContentTools.TableDialog(table),dialog.bind("cancel",function(_this){return function(){dialog.unbind("cancel"),modal.hide(),dialog.hide()}}(this)),dialog.bind("save",function(_this){return function(tableCfg){dialog.unbind("save"),table=_this._createTable(tableCfg),parent.attach(table,index),table.firstSection().children[0].children[0].children[0].focus(),modal.hide(),dialog.hide()}}(this)),app.attach(modal),app.attach(dialog),modal.show(),dialog.show()}}(),ContentTools.Tools.Underline=function(_super){function Underline(){return Underline.__super__.constructor.apply(this,arguments)}return __extends(Underline,_super),ContentTools.ToolShelf.stow(Underline,"underline"),Underline.label=nhbParams.labels.underline,Underline.icon="underline",Underline.tagName="span",Underline.shortcut="ctrl+u",Underline.canApply=function(element,selection){return ContentTools.Tools.Bold.canApply(element,selection)},Underline.isApplied=function(element,selection){var _ref,from=0,to=0;return void 0!==element.content&&element.content.length()?(selection&&(_ref=selection.get(),from=_ref[0],to=_ref[1]),from===to&&(from=0,to=element.content.length()),"underline"===element.content.substring(from,to).getStyle("text-decoration",element)):!1},Underline.apply=function(element,selection,callback){var from,to,_ref;element.storeState(),_ref=selection.get(),from=_ref[0],to=_ref[1],from===to&&(from=0,to=element.content.length());var style=element.content.substring(from,to).getStyle("text-decoration",element);style=style&&"none"!==style&&"line-through"!==style?"none":"underline";var newStyle={"text-decoration":style};return element.content=element.content.style(from,to,element._tagName,newStyle),element.updateInnerHTML(),element.taint(),element.restoreState(),callback(!0)},Underline}(ContentTools.Tool),ContentTools.Tools.paragraphPicker=function(_super){function paragraphPicker(){return paragraphPicker.__super__.constructor.apply(this,arguments)}return __extends(paragraphPicker,_super),ContentTools.ToolShelf.stow(paragraphPicker,"paragraphPicker"),paragraphPicker.label=nhbParams.labels.text_style,paragraphPicker.icon="paragraph-picker",paragraphPicker.tagName="p",paragraphPicker.types={p:{className:"Paragraph",label:nhbParams.labels.paragraph},h1:{className:"Heading1",label:nhbParams.labels.heading_1},h2:{className:"Heading2",label:nhbParams.labels.heading_2},h3:{className:"Heading3",label:nhbParams.labels.heading_3},h4:{className:"Heading4",label:nhbParams.labels.heading_4},h5:{className:"Heading5",label:nhbParams.labels.heading_5},h6:{className:"Heading6",label:nhbParams.labels.heading_6},blockquote:{className:"Blockquote",label:'"'+nhbParams.labels.blockquote+'"'},pre:{className:"Preformatted",label:nhbParams.labels.preformatted}},paragraphPicker.canApply=function(element){if(this.types.hasOwnProperty(element.tagName())){for(var tag in this.types)this.types.hasOwnProperty(tag)&&element.tagName()!==tag&&this._ceElement._domElement.classList.contains("nhb-paragraph-picker-type-"+tag)&&this._ceElement._domElement.classList.remove("nhb-paragraph-picker-type-"+tag);this._ceElement._domElement.classList.contains("nhb-paragraph-picker-type-"+element.tagName())||(this._ceElement._domElement.classList.add("nhb-paragraph-picker-type-"+element.tagName()),this._ceElement._domElement.firstChild.textContent=this.types[element.tagName()].label)}return"LABEL"===element._domElement.tagName?!1:void 0!==element},paragraphPicker.isApplied=function(){return!this._ceElement._domElement.classList.contains("nhb-paragraph-picker-type-p")},paragraphPicker.apply=function(element,selection,callback){return this.applyTag(element,this._selectedType,selection,callback)},paragraphPicker.applyTag=function(element,tag,selection,callback){var app,forceAdd,paragraph,region;return app=ContentTools.EditorApp.get(),forceAdd=app.ctrlDown(),ContentTools.Tools.Bold.isApplied(element,selection)&&ContentTools.Tools.Bold.apply(element,selection,function(){}),ContentTools.Tools.Heading.canApply(element)&&!forceAdd?ContentTools.Tools[paragraphPicker.types[tag].className].apply(element,selection,callback):("Region"!==element.parent().type()&&(element=element.closest(function(node){return"Region"===node.parent().type()})),region=element.parent(),paragraph=new ContentEdit.Text(tag),region.attach(paragraph,region.children.indexOf(element)+1),paragraph.focus(),callback(!0))},paragraphPicker._paragraphPickerMount=function(){var _this=this,d=document.createElement("DIV");for(var tag in this.types)if(this.types.hasOwnProperty(tag)){var label=document.createElement(tag);label.innerHTML=this.types[tag].label,label.setAttribute("data-tag",tag),label.setAttribute("data-class",this.types[tag].className),d.appendChild(label),label.addEventListener("mousedown",function(ev){ev.preventDefault(),this._selectedType=ev.target.getAttribute("data-tag"),this._selectedClass=ev.target.getAttribute("data-class"),this._ceElement._mouseDown=!0,this._ceElement._onMouseUp(),this.hidePicker()}.bind(this))}this._ceElement._domElement.innerHTML=nhbParams.labels.paragraph,this._ceElement._domElement.appendChild(d),document.querySelector(".ct-toolbox").addEventListener("mouseleave",function(){_this.hidePicker()}),wp.hooks.addAction("nhb.tool.popup.open",function(){this.hidePicker()}.bind(this))},paragraphPicker.hidePicker=function(){this._ceElement._domElement.querySelector("div").style.display="",this.rememberedSelection=null},paragraphPicker}(ContentTools.Tool),ContentEdit.Root.get().bind("blur",function(){var tool=window.nhbEditor.getToolUI("paragraph");"undefined"!=typeof tool&&tool.tool.hidePicker()}),function(){var proxied=ContentTools.ToolUI.prototype.mount;ContentTools.ToolUI.prototype.mount=function(domParent,before){var ret=proxied.call(this,domParent,before);return this.tool._ceElement=this,"undefined"!=typeof this.tool._paragraphPickerMount&&this.tool._paragraphPickerMount(),ret}}(),function(){var proxied=ContentTools.ToolUI.prototype._addDOMEventListeners;ContentTools.ToolUI.prototype._addDOMEventListeners=function(){if("paragraphPicker"!==this.tool.name)return proxied.call(this);var _this=this;this._domElement.addEventListener("mousedown",function(e){e.target.classList.contains("ct-tool")&&e.preventDefault()}),this._domElement.addEventListener("click",function(e){e.target.classList.contains("ct-tool")&&(""===_this._domElement.querySelector("div").style.display&&wp.hooks.doAction("nhb.tool.popup.open"),_this._domElement.querySelector("div").style.display=_this._domElement.querySelector("div").style.display?"":"block")})}}(),ContentTools.Tools.Strikethrough=function(_super){function Strikethrough(){return Strikethrough.__super__.constructor.apply(this,arguments)}return __extends(Strikethrough,_super),ContentTools.ToolShelf.stow(Strikethrough,"strikethrough"),Strikethrough.label=nhbParams.labels.strikethrough,Strikethrough.icon="strikethrough",Strikethrough.tagName="span",Strikethrough.canApply=function(element,selection){return ContentTools.Tools.Bold.canApply(element,selection)},Strikethrough.isApplied=function(element,selection){var _ref,from=0,to=0;return void 0!==element.content&&element.content.length()?(selection&&(_ref=selection.get(),from=_ref[0],to=_ref[1]),from===to&&(from=0,to=element.content.length()),"line-through"===element.content.substring(from,to).getStyle("text-decoration",element)):!1},Strikethrough.apply=function(element,selection,callback){var from,to,_ref;element.storeState(),_ref=selection.get(),from=_ref[0],to=_ref[1],from===to&&(from=0,to=element.content.length());var style=element.content.substring(from,to).getStyle("text-decoration",element);style=style&&"none"!==style&&"underline"!==style?"none":"line-through";var newStyle={"text-decoration":style};return element.content=element.content.style(from,to,element._tagName,newStyle),element.updateInnerHTML(),element.taint(),element.restoreState(),callback(!0)},Strikethrough}(ContentTools.Tool),nhbEditor.shortcuts={"ctrl+r":function(element,selection,callback){ContentTools.Tools.AlignRight.canApply(element,selection)&&ContentTools.Tools.AlignRight.apply(element,selection,callback)},"ctrl+u":function(element,selection,callback){ContentTools.Tools.Underline.canApply(element,selection)&&ContentTools.Tools.Underline.apply(element,selection,callback)},"ctrl+e":function(element,selection,callback){ContentTools.Tools.AlignCenter.canApply(element,selection)&&ContentTools.Tools.AlignCenter.apply(element,selection,callback)},"ctrl+l":function(element,selection,callback){ContentTools.Tools.AlignLeft.canApply(element,selection)&&ContentTools.Tools.AlignLeft.apply(element,selection,callback)},"ctrl+j":function(element,selection,callback){ContentTools.Tools.AlignJustify.canApply(element,selection)&&ContentTools.Tools.AlignJustify.apply(element,selection,callback)},"ctrl+i":function(element,selection,callback){ContentTools.Tools.Italic.canApply(element,selection)&&ContentTools.Tools.Italic.apply(element,selection,callback)},"ctrl+b":function(element,selection,callback){ContentTools.Tools.Bold.canApply(element,selection)&&ContentTools.Tools.Bold.apply(element,selection,callback)},"ctrl+k":function(element,selection,callback){ContentTools.Tools.Link.canApply(element,selection)&&ContentTools.Tools.Link.apply(element,selection,callback)},"ctrl+shift+k":function(element,selection,callback){ContentTools.Tools.Button.canApply(element,selection)&&ContentTools.Tools.Button.apply(element,selection,callback)},"ctrl+p":function(element,selection,callback){ContentTools.Tools.paragraphPicker.applyTag(element,"p",selection,callback)},"ctrl+1":function(element,selection,callback){ContentTools.Tools.paragraphPicker.applyTag(element,"h1",selection,callback)},"ctrl+2":function(element,selection,callback){ContentTools.Tools.paragraphPicker.applyTag(element,"h2",selection,callback)},"ctrl+3":function(element,selection,callback){ContentTools.Tools.paragraphPicker.applyTag(element,"h3",selection,callback)},"ctrl+4":function(element,selection,callback){ContentTools.Tools.paragraphPicker.applyTag(element,"h4",selection,callback)},"ctrl+.":function(element,selection,callback){ContentTools.Tools.UnorderedList.canApply(element,selection)&&ContentTools.Tools.UnorderedList.apply(element,selection,callback)},"ctrl+/":function(element,selection,callback){ContentTools.Tools.OrderedList.canApply(element,selection)&&ContentTools.Tools.OrderedList.apply(element,selection,callback)},"ctrl+=":function(element,selection,callback){ContentTools.Tools.FontUp.canApply(element,selection)&&ContentTools.Tools.FontUp.apply(element,selection,callback,"up")},"ctrl+-":function(element,selection,callback){ContentTools.Tools.FontUp.canApply(element,selection)&&ContentTools.Tools.FontUp.apply(element,selection,callback,"down")},"ctrl+o":function(element,selection,callback){ContentTools.Tools.Code.canApply(element,selection)&&ContentTools.Tools.Code.apply(element,selection,callback)},"ctrl+z":function(){ContentTools.Tools.Undo.apply(null,null,function(){})},"ctrl+m":function(element,selection,callback){ContentTools.Tools.nhbMedia.apply(element,selection,callback)}};var redoKey=-1!==navigator.appVersion.indexOf("Mac")?"ctrl+shift+z":"ctrl+y";nhbEditor.shortcuts[redoKey]=function(){ContentTools.Tools.Redo.apply(null,null,function(){})},ContentTools.Tools.paragraphPicker.label+=" (ctrl+p/1/2/3)",ContentTools.Tools.Bold.label+=" (ctrl+b)",ContentTools.Tools.Italic.label+=" (ctrl+i)",ContentTools.Tools.Underline.label+=" (ctrl+u)",ContentTools.Tools.Link.label+=" (ctrl+k)",ContentTools.Tools.AlignLeft.label+=" (ctrl+l)",ContentTools.Tools.AlignCenter.label+=" (ctrl+e)",ContentTools.Tools.AlignRight.label+=" (ctrl+r)",ContentTools.Tools.AlignJustify.label+=" (ctrl+j)",ContentTools.Tools.Code.label+=" (ctrl+o)",ContentTools.Tools.UnorderedList.label+=" (ctrl+.)",ContentTools.Tools.OrderedList.label+=" (ctrl+/)",ContentTools.Tools.Undo.label+=" (ctrl+z)",ContentTools.Tools.Redo.label+=" ("+redoKey+")",nhbEditor._shortcuts={};for(var code in nhbEditor.shortcuts)if(nhbEditor.shortcuts.hasOwnProperty(code)){var matches=code.match(/(^.*\+)([^+]*)$/);if(!matches.length)continue;var key=matches[1],sc=matches[2];"space"===sc?sc=32:"up"===sc?sc=38:"right"===sc?sc=39:"down"===sc?sc=40:"left"===sc?sc=37:"tab"===sc?sc=9:"enter"===sc?sc=13:"."===sc?sc=190:"/"===sc?sc=191:"="===sc?sc=187:"-"===sc?sc=189:"delete"===sc&&(sc=8),"number"==typeof sc?key+=sc:(sc=sc.match(/[a-z]/)?sc.toUpperCase():sc,key+=sc.charCodeAt(0)),nhbEditor._shortcuts[key]=nhbEditor.shortcuts[code]}nhbEditor.shortcuts=nhbEditor._shortcuts,nhbEditor._shortcuts=null,function(){var getShortcutKey=function(ev){var key="";return(ev.metaKey||ev.ctrlKey)&&(key+="ctrl"),ev.shiftKey&&(key+=key?"+":"",key+="shift"),key?key+="+"+ev.keyCode:void 0},shortcutListener=function(ev){var key=getShortcutKey(ev),element=ContentEdit.Root.get().focused();if(wp.hooks.applyFilters("nhb.shortcuts",!1,key,element))return void ev.preventDefault();if(element&&nhbEditor.shortcuts[key]){var selection=null;return element.selection&&(selection=element.selection()),ev.preventDefault(),nhbEditor.shortcuts[key](element,selection,function(){}),ev.preventDefault(),void ev.stopPropagation()}},addDomEventListenersProxy=ContentTools.ToolboxBarUI.prototype._addDOMEventListeners;ContentTools.ToolboxBarUI.prototype._addDOMEventListeners=function(){return document.addEventListener("keydown",shortcutListener),addDomEventListenersProxy.call(this)};var removeDomEventListenersProxy=ContentTools.ToolboxBarUI.prototype._removeDOMEventListeners;ContentTools.ToolboxBarUI.prototype._removeDOMEventListeners=function(){return document.removeEventListener("keydown",shortcutListener),removeDomEventListenersProxy.call(this)}}(),window.addEventListener("DOMContentLoaded",function(){document.addEventListener("keydown",function(ev){if(window.nhbEditor.isEditing())if(!ev.metaKey&&!ev.ctrlKey||83!==ev.keyCode&&27!==ev.keyCode)(ev.metaKey||ev.ctrlKey)&&ev.shiftKey&&82===ev.keyCode&&(ev.preventDefault(),location.reload());else{ev.preventDefault();var element=ContentEdit.Root.get().focused();element&&element.blur(),83===ev.keyCode?document.querySelector("#wp-admin-bar-gambit_builder_save").dispatchEvent(new CustomEvent("click")):document.querySelector("#wp-admin-bar-gambit_builder_cancel").dispatchEvent(new CustomEvent("click"))}else(ev.metaKey||ev.ctrlKey)&&69===ev.keyCode&&(document.querySelector("#wp-admin-bar-gambit_builder_edit").dispatchEvent(new CustomEvent("click")),ev.preventDefault())})}),document.addEventListener("DOMContentLoaded",function(){var goPremiumButton=document.querySelector("#wp-admin-bar-nhb_go_premium");goPremiumButton&&goPremiumButton.addEventListener("click",function(){function carouselHide(num){indicators[num].setAttribute("data-state",""),slides[num].setAttribute("data-state",""),slides[num].style.opacity=0}function carouselShow(num){indicators[num].checked=!0,indicators[num].setAttribute("data-state","active"),slides[num].setAttribute("data-state","active"),slides[num].style.opacity=1}function setSlide(slide){return function(){for(var i=0;i<indicators.length;i++)indicators[i].setAttribute("data-state",""),slides[i].setAttribute("data-state",""),carouselHide(i);indicators[slide].setAttribute("data-state","active"),slides[slide].setAttribute("data-state","active"),carouselShow(slide),clearInterval(switcher)}}function switchSlide(){for(var nextSlide=0,i=0;i<indicators.length;i++)"active"===indicators[i].getAttribute("data-state")&&i!==indicators.length-1&&(nextSlide=i+1),carouselHide(i);carouselShow(nextSlide)}var div=document.createElement("DIV");div.innerHTML=wp.template("nhb-learn-premium")(),div.setAttribute("id","nhb-learn-premium-wrapper"),document.body.appendChild(div),setTimeout(function(){div.classList.add("nhb-shown")},50),document.querySelector("#nhb-learn-premium-wrapper .nhb-tour-close").addEventListener("click",function(){document.body.removeChild(div)});var carousel=document.querySelector(".nhb-learn-carousel"),speed=7e3;if(carousel)for(var slides=carousel.querySelectorAll(".nhb-learn-slide"),indicators=carousel.querySelectorAll(".nhb-learn-indicators label"),switcher=setInterval(function(){switchSlide()},speed),i=0;i<indicators.length;i++)indicators[i].querySelector("input").addEventListener("click",setSlide(i))})}),window.nhbPlayTour=function(){if(localStorage){if(localStorage.getItem("nhb_did_intro"))return;localStorage.setItem("nhb_did_intro",1)}var tourModalWrapper=document.createElement("DIV");tourModalWrapper.classList.add("nhb-tour-modal-wrapper");var tourModal=document.createElement("DIV");tourModal.classList.add("nhb-tour-modal"),tourModalWrapper.appendChild(tourModal);var closeButton=document.createElement("DIV");closeButton.classList.add("nhb-tour-close"),tourModal.appendChild(closeButton),closeButton.addEventListener("click",function(){tourModalWrapper.classList.remove("nhb-tour-shown"),setTimeout(function(){document.body.removeChild(tourModalWrapper)},400)});var iframe=document.createElement("IFRAME");iframe.setAttribute("src","https://www.youtube.com/embed/dSU2l1Vhp50?rel=0&autoplay=1&showinfo=0&autohide=1&controls=0"),iframe.setAttribute("width","800"),iframe.setAttribute("height","450"),iframe.setAttribute("frameborder","0"),iframe.setAttribute("allowfullscreen","1"),tourModal.appendChild(iframe),document.body.appendChild(tourModalWrapper),setTimeout(function(){tourModalWrapper.classList.add("nhb-tour-shown")},100);var editor=ContentTools.EditorApp.get();editor.unbind("start",window.nhbPlayTour)},wp.hooks.addAction("nhb.ct.ready",function(){if(nhbParams.do_intro){var editor=ContentTools.EditorApp.get();editor.bind("start",window.nhbPlayTour)}}),window.addEventListener("DOMContentLoaded",function(){jQuery(document).on("heartbeat-send",function(e,data){window.nhbEditor.isEditing()&&(data.tracking_interval=wp.heartbeat.interval())}),jQuery(document).on("heartbeat-tick",function(e,data){window.nhbEditor.isEditing()&&data.ask_for_rating&&(document.querySelector("#nhb-rate-desc").innerHTML=data.ask_for_rating,document.querySelector("#wp-admin-bar-nhb_rate").classList.remove("nhb-hidden"),document.querySelector("#nhb-rate-no").addEventListener("click",function(ev){ev.preventDefault(),document.querySelector("#wp-admin-bar-nhb_rate").classList.add("nhb-hidden")}),document.querySelector("#nhb-rate-go").addEventListener("click",function(ev){ev.preventDefault(),document.querySelector("#wp-admin-bar-nhb_rate").classList.add("nhb-hidden");var payload=new FormData;payload.append("action","nhb_ask_rating_rated"),payload.append("nonce",nhbParams.nonce);var xhr=new XMLHttpRequest;xhr.open("POST",nhbParams.ajax_url),xhr.send(payload)}))})}),window.addEventListener("DOMContentLoaded",function(){nhbParams.tracking_opted_in&&wp.hooks.addAction("nhb.save.payload.post",function(payload){var xhrTracking=new XMLHttpRequest;xhrTracking.open("POST",nhbParams.ajax_url),payload.append("action","nhb_save_content_tracking"),xhrTracking.send(payload)})}),function(){var proxied=jQuery.fn.is;jQuery.fn.is=function(selector){var ret=proxied.call(this,selector);if(ret){var elem=this[0];if('<div tabindex="0"></div>'===elem.outerHTML)return!!(elem.offsetWidth||elem.offsetHeight||elem.getClientRects().length)}return ret}}(),window.addEventListener("DOMContentLoaded",function(){function checkHeartbeat(){var payload=new FormData;payload.append("action","nhb_heartbeat_check"),payload.append("post_id",nhbParams.post_id),payload.append("nonce",nhbParams.nonce),payload.append("media_manager_editor_nonce",wp.media.view.settings.nonce.sendToEditor);var xhr=new XMLHttpRequest;xhr.onload=function(){if(xhr.status>=200&&xhr.status<400){var response=JSON.parse(xhr.responseText);if(response){if(response.post_lock){var data={avatar:response.post_lock_avatar,avatar2x:response.post_lock_avatar2x,author_name:response.post_lock_author_name},div=document.createElement("DIV");div.innerHTML=wp.template("nhb-heartbeat-locked")(data),div.setAttribute("id","nhb-post-locked-dialog"),document.body.appendChild(div),modalIsOpen=!0,document.querySelector(".nhb-post-locked-back").addEventListener("click",function(ev){ev.preventDefault(),modalIsOpen=!1,doRemovePostLock=!1,document.querySelector("#wp-admin-bar-gambit_builder_cancel").dispatchEvent(new CustomEvent("click")),div.parentNode.removeChild(div)}),document.querySelector(".nhb-post-locked-takeover").addEventListener("click",function(ev){ev.preventDefault(),modalIsOpen=!1,overridePostLock(),div.parentNode.removeChild(div)})}response.nonce&&(nhbParams.nonce=response.nonce),response.media_manager_editor_nonce&&(wp.media.view.settings.nonce.sendToEditor=response.media_manager_editor_nonce)}}}.bind(this),xhr.onerror=function(){},xhr.open("POST",nhbParams.ajax_url),xhr.send(payload)}function removePostLock(){var payload=new FormData;payload.append("action","nhb_remove_post_lock"),payload.append("post_id",nhbParams.post_id),payload.append("nonce",nhbParams.nonce);var xhr=new XMLHttpRequest;xhr.open("POST",nhbParams.ajax_url),xhr.send(payload)}function overridePostLock(){var payload=new FormData;payload.append("action","nhb_override_post_lock"),payload.append("post_id",nhbParams.post_id),payload.append("nonce",nhbParams.nonce);var xhr=new XMLHttpRequest;xhr.open("POST",nhbParams.ajax_url),xhr.send(payload)}function doAutosave(){var payload=new FormData;payload.append("action","nhb_autosave"),payload.append("post_id",nhbParams.post_id),payload.append("nonce",nhbParams.nonce);var content=ContentTools.EditorApp.get().regions()["main-content"].html();content=wp.hooks.applyFilters("nhb.save",content),payload.append("content",content);var xhr=new XMLHttpRequest;xhr.open("POST",nhbParams.ajax_url),xhr.send(payload)}if(wp.heartbeat){wp.heartbeat.interval(120);var lastAutosave=+new Date,loginListenerInterval=null,loginListener=function(){var authCheckWrapper=document.querySelector("#wp-auth-check-wrap");authCheckWrapper?authCheckWrapper.classList.contains("hidden")&&(clearInterval(loginListenerInterval),modalIsOpen=!1,wp.heartbeat.connectNow()):(clearInterval(loginListenerInterval),modalIsOpen=!1)},startLoginListener=function(){clearInterval(loginListenerInterval),loginListenerInterval=setInterval(loginListener,500)},modalIsOpen=!1;jQuery(document).on("heartbeat-send",function(e,data){if(window.nhbEditor.isEditing()&&(data["wp-refresh-post-nonces"]={post_id:nhbParams.post_id},data.nhb_nonce=nhbParams.nonce,data.media_manager_editor_nonce=wp.media.view.settings.nonce.sendToEditor,data.post_id=nhbParams.post_id,!modalIsOpen)){var autosaveDiff=(+new Date-lastAutosave)/1e3,autosaveInterval=15;nhbParams.autosave_interval&&(autosaveInterval=60*parseInt(nhbParams.autosave_interval,10)),autosaveDiff>autosaveInterval&&(lastAutosave=+new Date,data.content=ContentTools.EditorApp.get().regions()["main-content"].html(),data.content=wp.hooks.applyFilters("nhb.save",data.content))}}),jQuery(document).on("heartbeat-tick",function(e,data){if(window.nhbEditor.isEditing()){if(data["wp-auth-check"]===!1)return modalIsOpen=!0,void startLoginListener();if(data["wp-refresh-post-nonces"]){var nonces=data["wp-refresh-post-nonces"];nonces.heartbeatNonce&&(window.heartbeatSettings.nonce=nonces.heartbeatNonce),nonces.nhb_nonce_new&&(nhbParams.nonce=nonces.nhb_nonce_new),data.media_manager_editor_nonce_new&&(wp.media.view.settings.nonce.sendToEditor=data.media_manager_editor_nonce_new)}if(data.nhb_nonce_new&&(nhbParams.nonce=data.nhb_nonce_new),data.media_manager_editor_nonce_new&&(wp.media.view.settings.nonce.sendToEditor=data.media_manager_editor_nonce_new),!modalIsOpen&&data.has_post_lock&&!document.querySelector("#nhb-post-locked-dialog")){doAutosave();var templateData={avatar:data.post_lock_avatar,avatar2x:data.post_lock_avatar2x,author_name:data.post_lock_author_name},div=document.createElement("DIV");div.innerHTML=wp.template("nhb-heartbeat-takeover")(templateData),div.setAttribute("id","nhb-post-locked-dialog"),document.body.appendChild(div),modalIsOpen=!0,document.querySelector(".nhb-post-takeover-refresh").addEventListener("click",function(ev){ev.preventDefault(),modalIsOpen=!1,doRemovePostLock=!1,ContentTools.EditorApp.get().stop(),window.location.reload(),div.parentNode.removeChild(div)})}}});var doRemovePostLock=!0;ContentTools.EditorApp.get().bind("start",function(){wp.heartbeat.interval(15),checkHeartbeat(),doRemovePostLock=!0}),ContentTools.EditorApp.get().bind("stop",function(){wp.heartbeat.interval(120),doRemovePostLock&&removePostLock()})}}),window.nhbEditor||(window.nhbEditor={}),window.nhbEditor.hexToRgb=function(hex){var shorthandRegex=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;hex=hex.replace(shorthandRegex,function(m,r,g,b){return r+r+g+g+b+b});var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return result?{r:parseInt(result[1],16),g:parseInt(result[2],16),b:parseInt(result[3],16)}:null},window.nhbEditor.rgbToHsl=function(r,g,b){r/=255,g/=255,b/=255;var h,s,max=Math.max(r,g,b),min=Math.min(r,g,b),l=(max+min)/2;if(max===min)h=s=0;else{var d=max-min;switch(s=l>.5?d/(2-max-min):d/(max+min),max){case r:h=(g-b)/d+(b>g?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4}h/=6}return{h:h,s:s,l:l}},window.nhbEditor.formattingTools=[[]],window.nhbEditor.formattingTools[0].push("insertElement","paragraphPicker","|","color","bold","italic","underline","strikethrough","link","|","align-left","align-center","align-right","align-justify","|","hr"),window.nhbEditor.formattingTools[0].push("code","|","unordered-list","ordered-list","indent","unindent","|","clear-formatting","undo","redo"),window.nhbEditor.insertElements=[[]],window.nhbEditor.insertElements[0].push("onecolumn","twocolumn","threecolumn","fourcolumn","text","nhb-media","shortcode"),window.nhbEditor.insertElements[0].push("widget","sidebar","icon"),window.nhbEditor.insertElements[0].push("html","map","tabs"),ContentTools.DEFAULT_TOOLS=[[]],window.nhbEditor.toolHeadings=[],window.addEventListener("DOMContentLoaded",function(){new nhbEditor.OverlayColumn,new nhbEditor.OverlayRow,new nhbEditor.OverlayElement,new nhbEditor.ToolbarElement,new nhbEditor.ToolbarImage,new nhbEditor.ToolbarHtml,new nhbEditor.ToolbarIframe,new nhbEditor.ToolbarEmbed,new nhbEditor.ToolbarMap,new nhbEditor.ToolbarIcon,new nhbEditor.ToolbarShortcode,new nhbEditor.ToolbarRow,new nhbEditor.ToolbarColumn,new nhbEditor.ToolbarNewsletter,new nhbEditor.ToolbarList,new nhbEditor.ToolbarTabContainer,new nhbEditor.ToolbarTable,new nhbEditor.ToolbarTitle,!nhbParams.is_lite,new nhbEditor.TooltipLink,new nhbEditor.TooltipButton,new nhbEditor.TooltipInput,new nhbEditor.TooltipTab});